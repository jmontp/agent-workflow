<!DOCTYPE html>
<html>
<head>
    <title>Simple Chat Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .chat-area {
            border: 2px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            min-height: 100px;
        }
        textarea {
            width: 100%;
            padding: 10px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        button:hover:not(:disabled) {
            background: #45a049;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .log-entry {
            padding: 5px;
            margin: 2px 0;
            border-left: 3px solid #4CAF50;
            background: #f0f0f0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧪 Simple Chat Interface Test</h1>
        
        <p>This is a minimal test to verify the chat functionality works in isolation.</p>
        
        <div class="chat-area">
            <h3>Chat Interface</h3>
            <textarea id="chat-input-field" placeholder="Type a message..." rows="3"></textarea>
            <button id="chat-send-btn" disabled>Send Message</button>
        </div>
        
        <div id="status" class="status info">Status will appear here...</div>
        
        <div id="messages" style="margin-top: 20px;">
            <h3>Messages:</h3>
            <div id="message-list"></div>
        </div>
        
        <div style="margin-top: 20px;">
            <h3>Event Log:</h3>
            <div id="event-log"></div>
        </div>
        
        <button onclick="runFullTest()">🚀 Run Full Test</button>
        <button onclick="clearAll()">🧹 Clear All</button>
    </div>
    
    <script>
        // Get elements
        const input = document.getElementById('chat-input-field');
        const button = document.getElementById('chat-send-btn');
        const status = document.getElementById('status');
        const messageList = document.getElementById('message-list');
        const eventLog = document.getElementById('event-log');
        
        // Log function
        function log(message, type = 'info') {
            console.log(message);
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            eventLog.appendChild(entry);
            eventLog.scrollTop = eventLog.scrollHeight;
        }
        
        // Update status
        function updateStatus(message, type = 'info') {
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        // Initialize event handlers
        function initializeHandlers() {
            log('Initializing event handlers...');
            
            // Check elements exist
            if (!input || !button) {
                log('❌ Elements not found!', 'error');
                updateStatus('Elements not found!', 'error');
                return;
            }
            
            log('✅ Elements found');
            
            // Input event handler
            input.addEventListener('input', (e) => {
                const value = e.target.value.trim();
                const hasContent = value.length > 0;
                button.disabled = !hasContent;
                log(`Input changed: "${value}" (length: ${value.length}, button disabled: ${!hasContent})`);
            });
            
            log('✅ Input handler attached');
            
            // Button click handler
            button.addEventListener('click', () => {
                log('Button clicked!');
                sendMessage();
            });
            
            log('✅ Button handler attached');
            
            // Enter key handler
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    if (!button.disabled) {
                        log('Enter key pressed - sending message');
                        sendMessage();
                    }
                }
            });
            
            log('✅ Keyboard handler attached');
            
            // Set initial state
            button.disabled = input.value.trim().length === 0;
            log(`Initial state set - button disabled: ${button.disabled}`);
            
            updateStatus('Handlers initialized successfully', 'success');
        }
        
        // Send message function
        function sendMessage() {
            const message = input.value.trim();
            if (!message) {
                log('Cannot send empty message', 'error');
                return;
            }
            
            log(`Sending message: "${message}"`);
            
            // Add to message list
            const msgDiv = document.createElement('div');
            msgDiv.style.padding = '10px';
            msgDiv.style.margin = '5px 0';
            msgDiv.style.background = '#e3f2fd';
            msgDiv.style.borderRadius = '4px';
            msgDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            messageList.appendChild(msgDiv);
            
            // Clear input
            input.value = '';
            button.disabled = true;
            
            log('Message sent and input cleared');
            updateStatus(`Message sent: "${message}"`, 'success');
        }
        
        // Run full test
        function runFullTest() {
            log('=== Running Full Test ===');
            
            // Test 1: Check elements
            log('Test 1: Checking elements...');
            log(`Input exists: ${!!input}`);
            log(`Button exists: ${!!button}`);
            log(`Input ID: ${input?.id}`);
            log(`Button ID: ${button?.id}`);
            
            // Test 2: Test button state
            log('\nTest 2: Testing button state...');
            log(`Current button disabled: ${button.disabled}`);
            
            // Test 3: Simulate typing
            log('\nTest 3: Simulating typing...');
            input.value = 'Test message';
            input.dispatchEvent(new Event('input', { bubbles: true }));
            
            setTimeout(() => {
                log(`After typing - Input value: "${input.value}"`);
                log(`After typing - Button disabled: ${button.disabled}`);
                
                // Test 4: Simulate click
                if (!button.disabled) {
                    log('\nTest 4: Simulating button click...');
                    button.click();
                    
                    setTimeout(() => {
                        log(`After click - Input value: "${input.value}"`);
                        log(`After click - Button disabled: ${button.disabled}`);
                        log('=== Test Complete ===');
                        updateStatus('All tests completed', 'success');
                    }, 100);
                } else {
                    log('❌ Button is still disabled!', 'error');
                    updateStatus('Test failed - button stayed disabled', 'error');
                }
            }, 100);
        }
        
        // Clear all
        function clearAll() {
            messageList.innerHTML = '';
            eventLog.innerHTML = '';
            input.value = '';
            button.disabled = true;
            updateStatus('Cleared', 'info');
            log('All cleared');
        }
        
        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            log('DOM loaded');
            initializeHandlers();
        });
        
        // Also log to console for debugging
        console.log('Simple chat test page loaded');
    </script>
</body>
</html>