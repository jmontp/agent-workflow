<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI Fixes Verification</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .test-status { display: inline-block; padding: 5px 10px; border-radius: 5px; margin-left: 10px; }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        .manual { background: #fff3cd; color: #856404; }
        iframe { width: 100%; height: 400px; border: 1px solid #ccc; }
        .button-test { padding: 10px; margin: 10px 0; background: #f8f9fa; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>🔧 UI Fixes Verification Test</h1>
    <p>This page helps verify that the three UI issues have been resolved.</p>

    <div class="test-section">
        <h2>1. Initialization Error Banner <span id="init-status" class="test-status manual">MANUAL TEST</span></h2>
        <p><strong>Expected:</strong> No initialization error banners should appear when loading the page.</p>
        <p><strong>Test:</strong> Load the main interface in the iframe below and check for error banners.</p>
        <iframe src="http://localhost:5001" id="main-iframe"></iframe>
        <div class="button-test">
            <button onclick="checkInitializationErrors()">Check for Initialization Errors</button>
            <div id="init-result"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>2. Chat Send Button Functionality <span id="chat-status" class="test-status manual">MANUAL TEST</span></h2>
        <p><strong>Expected:</strong> Send button should be disabled when empty, enabled when text is entered, and be clickable (no cross cursor).</p>
        <p><strong>Test:</strong> Use the chat interface in the iframe above.</p>
        <div class="button-test">
            <button onclick="testChatSendButton()">Test Chat Send Button</button>
            <div id="chat-result"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>3. Layout Button Fix <span id="layout-status" class="test-status manual">MANUAL TEST</span></h2>
        <p><strong>Expected:</strong> Layout button should be hidden or have correct function call (no "emergencyLayoutFix" error).</p>
        <div class="button-test">
            <button onclick="checkLayoutButton()">Check Layout Button</button>
            <div id="layout-result"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>4. WebSocket Connection <span id="websocket-status" class="test-status manual">MANUAL TEST</span></h2>
        <p><strong>Expected:</strong> Connection status should show "Connected" in the interface.</p>
        <div class="button-test">
            <button onclick="checkWebSocketConnection()">Check WebSocket Connection</button>
            <div id="websocket-result"></div>
        </div>
    </div>

    <script>
        function updateStatus(elementId, status, message) {
            const element = document.getElementById(elementId);
            element.className = `test-status ${status}`;
            element.textContent = status.toUpperCase();
            
            const resultDiv = document.getElementById(elementId.replace('-status', '-result'));
            resultDiv.innerHTML = `<p>${message}</p>`;
        }

        function checkInitializationErrors() {
            try {
                const iframe = document.getElementById('main-iframe');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // Look for error elements
                const errors = iframeDoc.querySelectorAll('.error, .alert, [class*="error"], [id*="error"]');
                const initErrors = Array.from(errors).filter(el => 
                    el.textContent && el.textContent.toLowerCase().includes('initialization')
                );
                
                if (initErrors.length === 0) {
                    updateStatus('init-status', 'pass', '✅ No initialization errors found');
                } else {
                    updateStatus('init-status', 'fail', `❌ Found ${initErrors.length} initialization errors`);
                }
            } catch (e) {
                updateStatus('init-status', 'fail', '❌ Could not access iframe content (CORS restriction)');
            }
        }

        function testChatSendButton() {
            try {
                const iframe = document.getElementById('main-iframe');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                const sendButton = iframeDoc.getElementById('chat-send-btn');
                const inputField = iframeDoc.getElementById('chat-input-field');
                
                if (!sendButton || !inputField) {
                    updateStatus('chat-status', 'fail', '❌ Chat elements not found');
                    return;
                }
                
                // Test initial state
                if (sendButton.disabled) {
                    updateStatus('chat-status', 'pass', '✅ Send button properly disabled when empty');
                } else {
                    updateStatus('chat-status', 'fail', '❌ Send button should be disabled when empty');
                }
            } catch (e) {
                updateStatus('chat-status', 'fail', '❌ Could not access iframe content (CORS restriction). Please test manually in the iframe.');
            }
        }

        function checkLayoutButton() {
            try {
                const iframe = document.getElementById('main-iframe');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                const layoutButton = iframeDoc.getElementById('emergency-reset-btn');
                
                if (!layoutButton) {
                    updateStatus('layout-status', 'pass', '✅ Layout button not found (removed)');
                    return;
                }
                
                const isHidden = window.getComputedStyle(layoutButton).display === 'none';
                const onclick = layoutButton.getAttribute('onclick');
                
                if (isHidden) {
                    updateStatus('layout-status', 'pass', '✅ Layout button is hidden');
                } else if (onclick && onclick.includes('forceVisualizerLayout')) {
                    updateStatus('layout-status', 'pass', '✅ Layout button has correct function');
                } else {
                    updateStatus('layout-status', 'fail', '❌ Layout button visible with incorrect function');
                }
            } catch (e) {
                updateStatus('layout-status', 'fail', '❌ Could not access iframe content (CORS restriction). Please check manually.');
            }
        }

        function checkWebSocketConnection() {
            try {
                const iframe = document.getElementById('main-iframe');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                const connectionStatus = iframeDoc.getElementById('connection-status');
                
                if (!connectionStatus) {
                    updateStatus('websocket-status', 'fail', '❌ Connection status element not found');
                    return;
                }
                
                const statusText = connectionStatus.textContent.toLowerCase();
                
                if (statusText.includes('connected')) {
                    updateStatus('websocket-status', 'pass', '✅ WebSocket shows connected status');
                } else {
                    updateStatus('websocket-status', 'fail', `❌ Status shows: ${statusText}`);
                }
            } catch (e) {
                updateStatus('websocket-status', 'fail', '❌ Could not access iframe content (CORS restriction). Please check manually in the iframe.');
            }
        }

        // Auto-run tests after iframe loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkInitializationErrors();
                testChatSendButton();
                checkLayoutButton();
                checkWebSocketConnection();
            }, 3000); // Wait for iframe to load
        });
    </script>
</body>
</html>