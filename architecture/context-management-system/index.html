
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Human-In-The-Loop orchestration framework for AI-assisted software development" name="description"/>
<meta content="AI Agent Workflow Team" name="author"/>
<link href="https://jmontp.github.io/agent-workflow/architecture/context-management-system/" rel="canonical"/>
<link href="../overview/" rel="prev"/>
<link href="../parallel-tdd-architecture/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.14" name="generator"/>
<title>Context Management - AI Agent TDD-Scrum Workflow</title>
<link href="../../assets/stylesheets/main.342714a4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="blue" data-md-color-primary="blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#context-management-system-design">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="AI Agent TDD-Scrum Workflow" class="md-header__button md-logo" data-md-component="logo" href="../.." title="AI Agent TDD-Scrum Workflow">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            AI Agent TDD-Scrum Workflow
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Context Management
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/jmontp/agent-workflow" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    jmontp/agent-workflow
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../getting-started/quick-start/">
          
  
  
  Getting Started

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../user-guide/hitl-commands/">
          
  
  
  User Guide

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../concepts/overview/">
          
  
  
  Concepts

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../advanced/context/">
          
  
  
  Advanced

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../overview/">
          
  
  
  Architecture

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../development/contributing/">
          
  
  
  Development

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../deployment/discord-setup/">
          
  
  
  Deployment

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="AI Agent TDD-Scrum Workflow" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="AI Agent TDD-Scrum Workflow">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    AI Agent TDD-Scrum Workflow
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/jmontp/agent-workflow" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    jmontp/agent-workflow
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Getting Started
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/quick-start/">
<span class="md-ellipsis">
    Quick Start
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/installation/">
<span class="md-ellipsis">
    Installation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/configuration/">
<span class="md-ellipsis">
    Configuration
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    User Guide
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/hitl-commands/">
<span class="md-ellipsis">
    HITL Commands
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/state-machine/">
<span class="md-ellipsis">
    State Machine
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/tdd-workflow/">
<span class="md-ellipsis">
    TDD Workflow
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/project-setup/">
<span class="md-ellipsis">
    Project Setup
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/workflow-sequences/">
<span class="md-ellipsis">
    Workflow Sequences
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/user-profile/">
<span class="md-ellipsis">
    User Profile
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/troubleshooting/">
<span class="md-ellipsis">
    Troubleshooting
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/faq/">
<span class="md-ellipsis">
    FAQ
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Concepts
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../concepts/overview/">
<span class="md-ellipsis">
    System Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../concepts/security/">
<span class="md-ellipsis">
    Security Model
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Advanced
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../advanced/context/">
<span class="md-ellipsis">
    Context Diagram
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../advanced/architecture-detailed/">
<span class="md-ellipsis">
    Detailed Architecture
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../advanced/container/">
<span class="md-ellipsis">
    Container Architecture
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../advanced/component/">
<span class="md-ellipsis">
    System Components
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../advanced/data-flow/">
<span class="md-ellipsis">
    Data Flow
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../advanced/orchestration-repo/">
<span class="md-ellipsis">
    Orchestration Repository
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../advanced/project-repo/">
<span class="md-ellipsis">
    Project Repository
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../advanced/security-implementation/">
<span class="md-ellipsis">
    Security Implementation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../advanced/testing/">
<span class="md-ellipsis">
    Testing Strategy
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../advanced/code/">
<span class="md-ellipsis">
    Code Structure
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
<span class="md-ellipsis">
    Architecture
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../overview/">
<span class="md-ellipsis">
    System Overview
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Context Management
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Context Management
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#executive-summary">
<span class="md-ellipsis">
      Executive Summary
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#system-overview">
<span class="md-ellipsis">
      System Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#architecture-design">
<span class="md-ellipsis">
      Architecture Design
    </span>
</a>
<nav aria-label="Architecture Design" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#high-level-architecture">
<span class="md-ellipsis">
      High-Level Architecture
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#core-components">
<span class="md-ellipsis">
      Core Components
    </span>
</a>
<nav aria-label="Core Components" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-context-manager-central-coordinator">
<span class="md-ellipsis">
      1. Context Manager (Central Coordinator)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-context-filter-relevance-engine">
<span class="md-ellipsis">
      2. Context Filter (Relevance Engine)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-token-calculator-budget-manager">
<span class="md-ellipsis">
      3. Token Calculator (Budget Manager)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-agent-memory-persistent-context">
<span class="md-ellipsis">
      4. Agent Memory (Persistent Context)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-context-compressor-intelligent-summarization">
<span class="md-ellipsis">
      5. Context Compressor (Intelligent Summarization)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-context-index-search-and-discovery">
<span class="md-ellipsis">
      6. Context Index (Search and Discovery)
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-flow-diagrams">
<span class="md-ellipsis">
      Data Flow Diagrams
    </span>
</a>
<nav aria-label="Data Flow Diagrams" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#context-preparation-flow">
<span class="md-ellipsis">
      Context Preparation Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#agent-handoff-flow">
<span class="md-ellipsis">
      Agent Handoff Flow
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#implementation-strategy">
<span class="md-ellipsis">
      Implementation Strategy
    </span>
</a>
<nav aria-label="Implementation Strategy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-1-core-infrastructure-weeks-1-2">
<span class="md-ellipsis">
      Phase 1: Core Infrastructure (Weeks 1-2)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-2-intelligence-layer-weeks-3-4">
<span class="md-ellipsis">
      Phase 2: Intelligence Layer (Weeks 3-4)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-3-optimization-weeks-5-6">
<span class="md-ellipsis">
      Phase 3: Optimization (Weeks 5-6)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-4-advanced-features-weeks-7-8">
<span class="md-ellipsis">
      Phase 4: Advanced Features (Weeks 7-8)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#algorithm-designs">
<span class="md-ellipsis">
      Algorithm Designs
    </span>
</a>
<nav aria-label="Algorithm Designs" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#relevance-scoring-algorithm">
<span class="md-ellipsis">
      Relevance Scoring Algorithm
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#context-compression-algorithm">
<span class="md-ellipsis">
      Context Compression Algorithm
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#token-budget-allocation-algorithm">
<span class="md-ellipsis">
      Token Budget Allocation Algorithm
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-requirements">
<span class="md-ellipsis">
      Performance Requirements
    </span>
</a>
<nav aria-label="Performance Requirements" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#latency-targets">
<span class="md-ellipsis">
      Latency Targets
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#throughput-targets">
<span class="md-ellipsis">
      Throughput Targets
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scalability-targets">
<span class="md-ellipsis">
      Scalability Targets
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling-strategy">
<span class="md-ellipsis">
      Error Handling Strategy
    </span>
</a>
<nav aria-label="Error Handling Strategy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#graceful-degradation">
<span class="md-ellipsis">
      Graceful Degradation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recovery-mechanisms">
<span class="md-ellipsis">
      Recovery Mechanisms
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#evaluation-framework">
<span class="md-ellipsis">
      Evaluation Framework
    </span>
</a>
<nav aria-label="Evaluation Framework" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#success-metrics">
<span class="md-ellipsis">
      Success Metrics
    </span>
</a>
<nav aria-label="Success Metrics" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#efficiency-metrics">
<span class="md-ellipsis">
      Efficiency Metrics
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#quality-metrics">
<span class="md-ellipsis">
      Quality Metrics
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-metrics">
<span class="md-ellipsis">
      Performance Metrics
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#benchmarking-strategy">
<span class="md-ellipsis">
      Benchmarking Strategy
    </span>
</a>
<nav aria-label="Benchmarking Strategy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#synthetic-benchmarks">
<span class="md-ellipsis">
      Synthetic Benchmarks
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#real-world-benchmarks">
<span class="md-ellipsis">
      Real-World Benchmarks
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration-points">
<span class="md-ellipsis">
      Integration Points
    </span>
</a>
<nav aria-label="Integration Points" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#claude-code-cli-integration">
<span class="md-ellipsis">
      Claude Code CLI Integration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tdd-state-machine-integration">
<span class="md-ellipsis">
      TDD State Machine Integration
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#future-enhancements">
<span class="md-ellipsis">
      Future Enhancements
    </span>
</a>
<nav aria-label="Future Enhancements" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#machine-learning-integration">
<span class="md-ellipsis">
      Machine Learning Integration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#advanced-features">
<span class="md-ellipsis">
      Advanced Features
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-optimizations">
<span class="md-ellipsis">
      Performance Optimizations
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../parallel-tdd-architecture/">
<span class="md-ellipsis">
    Parallel TDD Design
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    Development
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            Development
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/contributing/">
<span class="md-ellipsis">
    Contributing
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/api-reference/">
<span class="md-ellipsis">
    API Reference
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-ellipsis">
    Deployment
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../deployment/discord-setup/">
<span class="md-ellipsis">
    Discord Setup
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../deployment/production/">
<span class="md-ellipsis">
    Production Deployment
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../deployment/github-pages/">
<span class="md-ellipsis">
    GitHub Pages
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#executive-summary">
<span class="md-ellipsis">
      Executive Summary
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#system-overview">
<span class="md-ellipsis">
      System Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#architecture-design">
<span class="md-ellipsis">
      Architecture Design
    </span>
</a>
<nav aria-label="Architecture Design" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#high-level-architecture">
<span class="md-ellipsis">
      High-Level Architecture
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#core-components">
<span class="md-ellipsis">
      Core Components
    </span>
</a>
<nav aria-label="Core Components" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-context-manager-central-coordinator">
<span class="md-ellipsis">
      1. Context Manager (Central Coordinator)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-context-filter-relevance-engine">
<span class="md-ellipsis">
      2. Context Filter (Relevance Engine)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-token-calculator-budget-manager">
<span class="md-ellipsis">
      3. Token Calculator (Budget Manager)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-agent-memory-persistent-context">
<span class="md-ellipsis">
      4. Agent Memory (Persistent Context)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-context-compressor-intelligent-summarization">
<span class="md-ellipsis">
      5. Context Compressor (Intelligent Summarization)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-context-index-search-and-discovery">
<span class="md-ellipsis">
      6. Context Index (Search and Discovery)
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-flow-diagrams">
<span class="md-ellipsis">
      Data Flow Diagrams
    </span>
</a>
<nav aria-label="Data Flow Diagrams" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#context-preparation-flow">
<span class="md-ellipsis">
      Context Preparation Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#agent-handoff-flow">
<span class="md-ellipsis">
      Agent Handoff Flow
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#implementation-strategy">
<span class="md-ellipsis">
      Implementation Strategy
    </span>
</a>
<nav aria-label="Implementation Strategy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-1-core-infrastructure-weeks-1-2">
<span class="md-ellipsis">
      Phase 1: Core Infrastructure (Weeks 1-2)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-2-intelligence-layer-weeks-3-4">
<span class="md-ellipsis">
      Phase 2: Intelligence Layer (Weeks 3-4)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-3-optimization-weeks-5-6">
<span class="md-ellipsis">
      Phase 3: Optimization (Weeks 5-6)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-4-advanced-features-weeks-7-8">
<span class="md-ellipsis">
      Phase 4: Advanced Features (Weeks 7-8)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#algorithm-designs">
<span class="md-ellipsis">
      Algorithm Designs
    </span>
</a>
<nav aria-label="Algorithm Designs" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#relevance-scoring-algorithm">
<span class="md-ellipsis">
      Relevance Scoring Algorithm
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#context-compression-algorithm">
<span class="md-ellipsis">
      Context Compression Algorithm
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#token-budget-allocation-algorithm">
<span class="md-ellipsis">
      Token Budget Allocation Algorithm
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-requirements">
<span class="md-ellipsis">
      Performance Requirements
    </span>
</a>
<nav aria-label="Performance Requirements" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#latency-targets">
<span class="md-ellipsis">
      Latency Targets
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#throughput-targets">
<span class="md-ellipsis">
      Throughput Targets
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scalability-targets">
<span class="md-ellipsis">
      Scalability Targets
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling-strategy">
<span class="md-ellipsis">
      Error Handling Strategy
    </span>
</a>
<nav aria-label="Error Handling Strategy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#graceful-degradation">
<span class="md-ellipsis">
      Graceful Degradation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#recovery-mechanisms">
<span class="md-ellipsis">
      Recovery Mechanisms
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#evaluation-framework">
<span class="md-ellipsis">
      Evaluation Framework
    </span>
</a>
<nav aria-label="Evaluation Framework" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#success-metrics">
<span class="md-ellipsis">
      Success Metrics
    </span>
</a>
<nav aria-label="Success Metrics" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#efficiency-metrics">
<span class="md-ellipsis">
      Efficiency Metrics
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#quality-metrics">
<span class="md-ellipsis">
      Quality Metrics
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-metrics">
<span class="md-ellipsis">
      Performance Metrics
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#benchmarking-strategy">
<span class="md-ellipsis">
      Benchmarking Strategy
    </span>
</a>
<nav aria-label="Benchmarking Strategy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#synthetic-benchmarks">
<span class="md-ellipsis">
      Synthetic Benchmarks
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#real-world-benchmarks">
<span class="md-ellipsis">
      Real-World Benchmarks
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration-points">
<span class="md-ellipsis">
      Integration Points
    </span>
</a>
<nav aria-label="Integration Points" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#claude-code-cli-integration">
<span class="md-ellipsis">
      Claude Code CLI Integration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tdd-state-machine-integration">
<span class="md-ellipsis">
      TDD State Machine Integration
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#future-enhancements">
<span class="md-ellipsis">
      Future Enhancements
    </span>
</a>
<nav aria-label="Future Enhancements" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#machine-learning-integration">
<span class="md-ellipsis">
      Machine Learning Integration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#advanced-features">
<span class="md-ellipsis">
      Advanced Features
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-optimizations">
<span class="md-ellipsis">
      Performance Optimizations
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="context-management-system-design">Context Management System Design<a class="headerlink" href="#context-management-system-design" title="Permanent link">¶</a></h1>
<h2 id="executive-summary">Executive Summary<a class="headerlink" href="#executive-summary" title="Permanent link">¶</a></h2>
<p>The Context Management System (CMS) is a foundational component that enables intelligent agent communication, manages Claude Code token limits, and optimizes information flow between agents and the orchestrator. This system addresses the critical challenge of efficiently sharing context across TDD phases while respecting Claude Code's ~200k token limitations.</p>
<h2 id="system-overview">System Overview<a class="headerlink" href="#system-overview" title="Permanent link">¶</a></h2>
<p>The CMS acts as an intelligent middleware layer between the orchestrator and individual agents, providing:</p>
<ul>
<li><strong>Context Filtering</strong>: Intelligent selection of relevant files based on current task</li>
<li><strong>Token Budget Management</strong>: Optimal allocation of context within Claude Code limits  </li>
<li><strong>Agent Memory</strong>: Persistent storage of agent decisions and artifacts</li>
<li><strong>Content Piping</strong>: Efficient handoff of work products between TDD phases</li>
<li><strong>Context Compression</strong>: Intelligent summarization of large codebases</li>
</ul>
<h2 id="architecture-design">Architecture Design<a class="headerlink" href="#architecture-design" title="Permanent link">¶</a></h2>
<h3 id="high-level-architecture">High-Level Architecture<a class="headerlink" href="#high-level-architecture" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>graph TB
    subgraph "Orchestrator Layer"
        O[Orchestrator]
    end

    subgraph "Context Management System"
        CM[Context Manager]
        CF[Context Filter]
        TC[Token Calculator]
        AM[Agent Memory]
        CC[Context Compressor]
        CI[Context Index]
    end

    subgraph "Agent Layer"
        DA[Design Agent]
        QA[QA Agent] 
        CA[Code Agent]
        DTA[Data Agent]
    end

    subgraph "Storage Layer"
        CS[Context Storage]
        AC[Artifact Cache]
        MI[Memory Index]
        FS[File System]
    end

    O --&gt; CM
    CM --&gt; CF
    CM --&gt; TC
    CM --&gt; AM
    CM --&gt; CC
    CM --&gt; CI

    CM --&gt; DA
    CM --&gt; QA
    CM --&gt; CA
    CM --&gt; DTA

    CM --&gt; CS
    AM --&gt; AC
    CI --&gt; MI
    CS --&gt; FS</code></pre>
<h3 id="core-components">Core Components<a class="headerlink" href="#core-components" title="Permanent link">¶</a></h3>
<h4 id="1-context-manager-central-coordinator">1. Context Manager (Central Coordinator)<a class="headerlink" href="#1-context-manager-central-coordinator" title="Permanent link">¶</a></h4>
<p><strong>Responsibilities:</strong>
- Orchestrate context preparation for agent tasks
- Coordinate between filtering, compression, and caching components
- Manage context lifecycle and invalidation
- Interface with agents and orchestrator</p>
<p><strong>Key Methods:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">prepare_context</span><span class="p">(</span><span class="n">agent_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">TDDTask</span><span class="p">,</span> <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AgentContext</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">update_context</span><span class="p">(</span><span class="n">context_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">changes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span>  
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">invalidate_context</span><span class="p">(</span><span class="n">context_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">get_agent_memory</span><span class="p">(</span><span class="n">agent_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">story_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AgentMemory</span>
</code></pre></div></p>
<h4 id="2-context-filter-relevance-engine">2. Context Filter (Relevance Engine)<a class="headerlink" href="#2-context-filter-relevance-engine" title="Permanent link">¶</a></h4>
<p><strong>Responsibilities:</strong>
- Analyze task requirements to determine relevant files
- Apply relevance scoring algorithms
- Filter out noise while preserving critical dependencies
- Handle cross-story context isolation</p>
<p><strong>Filtering Strategies:</strong>
- <strong>Direct Relevance</strong>: Files explicitly mentioned in task or tests
- <strong>Dependency Analysis</strong>: Static analysis of imports and references
- <strong>Historical Relevance</strong>: Files frequently accessed in similar tasks
- <strong>Semantic Similarity</strong>: Content similarity to current task description
- <strong>TDD Phase Relevance</strong>: Phase-specific context requirements</p>
<h4 id="3-token-calculator-budget-manager">3. Token Calculator (Budget Manager)<a class="headerlink" href="#3-token-calculator-budget-manager" title="Permanent link">¶</a></h4>
<p><strong>Responsibilities:</strong>
- Calculate token usage for context components
- Optimize context selection within budget constraints
- Provide token usage analytics and warnings
- Handle budget allocation across context types</p>
<p><strong>Budget Allocation Strategy:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>Total Budget: ~200k tokens
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>- Core Task Context: 40% (80k tokens)
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>- Historical Context: 25% (50k tokens)  
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>- Dependency Context: 20% (40k tokens)
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>- Agent Memory: 10% (20k tokens)
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>- Buffer/Metadata: 5% (10k tokens)
</code></pre></div></p>
<h4 id="4-agent-memory-persistent-context">4. Agent Memory (Persistent Context)<a class="headerlink" href="#4-agent-memory-persistent-context" title="Permanent link">¶</a></h4>
<p><strong>Responsibilities:</strong>
- Store agent decisions, rationale, and learned patterns
- Maintain context across TDD phases and sessions
- Track evolution of understanding over time
- Provide context inheritance between phases</p>
<p><strong>Memory Structure:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nd">@dataclass</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="k">class</span> <span class="nc">AgentMemory</span><span class="p">:</span>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>    <span class="n">agent_type</span><span class="p">:</span> <span class="nb">str</span>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>    <span class="n">story_id</span><span class="p">:</span> <span class="nb">str</span>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>    <span class="n">decisions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Decision</span><span class="p">]</span>
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>    <span class="n">artifacts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a>    <span class="n">learned_patterns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Pattern</span><span class="p">]</span>
<a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a>    <span class="n">context_history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ContextSnapshot</span><span class="p">]</span>
<a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a>    <span class="n">phase_handoffs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PhaseHandoff</span><span class="p">]</span>
</code></pre></div></p>
<h4 id="5-context-compressor-intelligent-summarization">5. Context Compressor (Intelligent Summarization)<a class="headerlink" href="#5-context-compressor-intelligent-summarization" title="Permanent link">¶</a></h4>
<p><strong>Responsibilities:</strong>
- Compress large files into relevant summaries
- Maintain semantic meaning while reducing token count
- Apply compression strategies based on content type
- Preserve critical information for agent tasks</p>
<p><strong>Compression Techniques:</strong>
- <strong>Code Summarization</strong>: Extract signatures, docstrings, key logic
- <strong>Test Summarization</strong>: Preserve test intent and assertions
- <strong>Documentation Compression</strong>: Extract key requirements and specs
- <strong>Git History Compression</strong>: Relevant commits and change patterns</p>
<h4 id="6-context-index-search-and-discovery">6. Context Index (Search and Discovery)<a class="headerlink" href="#6-context-index-search-and-discovery" title="Permanent link">¶</a></h4>
<p><strong>Responsibilities:</strong>
- Build searchable indexes of codebase content
- Enable fast lookup of relevant code sections
- Track file relationships and dependencies
- Support semantic search for context discovery</p>
<h2 id="data-flow-diagrams">Data Flow Diagrams<a class="headerlink" href="#data-flow-diagrams" title="Permanent link">¶</a></h2>
<h3 id="context-preparation-flow">Context Preparation Flow<a class="headerlink" href="#context-preparation-flow" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant O as Orchestrator
    participant CM as Context Manager
    participant CF as Context Filter
    participant TC as Token Calculator
    participant CC as Context Compressor
    participant AM as Agent Memory
    participant A as Agent

    O-&gt;&gt;CM: prepare_context(agent_type, task, max_tokens)
    CM-&gt;&gt;CF: filter_relevant_files(task, story_id)
    CF-&gt;&gt;CM: relevant_files[]
    CM-&gt;&gt;TC: calculate_token_budget(relevant_files, max_tokens)
    TC-&gt;&gt;CM: budget_allocation
    CM-&gt;&gt;CC: compress_if_needed(files, budget)
    CC-&gt;&gt;CM: compressed_context
    CM-&gt;&gt;AM: get_agent_memory(agent_type, story_id)
    AM-&gt;&gt;CM: agent_memory
    CM-&gt;&gt;CM: assemble_final_context()
    CM-&gt;&gt;O: agent_context
    O-&gt;&gt;A: execute_task(context)</code></pre>
<h3 id="agent-handoff-flow">Agent Handoff Flow<a class="headerlink" href="#agent-handoff-flow" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant DA as Design Agent
    participant CM as Context Manager
    participant AM as Agent Memory
    participant QA as QA Agent

    DA-&gt;&gt;CM: complete_phase(design_artifacts)
    CM-&gt;&gt;AM: store_artifacts(design_artifacts)
    AM-&gt;&gt;CM: artifacts_stored
    CM-&gt;&gt;CM: prepare_handoff_context(DESIGN-&gt;TEST_RED)
    CM-&gt;&gt;QA: provide_context(design_context + requirements)
    QA-&gt;&gt;CM: request_additional_context(specific_files)
    CM-&gt;&gt;QA: filtered_context(specific_files)</code></pre>
<h2 id="implementation-strategy">Implementation Strategy<a class="headerlink" href="#implementation-strategy" title="Permanent link">¶</a></h2>
<h3 id="phase-1-core-infrastructure-weeks-1-2">Phase 1: Core Infrastructure (Weeks 1-2)<a class="headerlink" href="#phase-1-core-infrastructure-weeks-1-2" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Context Manager</strong>: Central coordination component</li>
<li><strong>Basic Token Calculator</strong>: Simple token counting and budget allocation</li>
<li><strong>File System Interface</strong>: Direct file access and basic caching</li>
<li><strong>Agent Memory Storage</strong>: Simple JSON-based persistence</li>
</ol>
<h3 id="phase-2-intelligence-layer-weeks-3-4">Phase 2: Intelligence Layer (Weeks 3-4)<a class="headerlink" href="#phase-2-intelligence-layer-weeks-3-4" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Context Filter</strong>: Relevance scoring and file filtering</li>
<li><strong>Context Compressor</strong>: Basic summarization for code and docs</li>
<li><strong>Context Index</strong>: File relationship mapping and search</li>
<li><strong>Agent Memory Intelligence</strong>: Pattern recognition and learning</li>
</ol>
<h3 id="phase-3-optimization-weeks-5-6">Phase 3: Optimization (Weeks 5-6)<a class="headerlink" href="#phase-3-optimization-weeks-5-6" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Advanced Compression</strong>: ML-based summarization</li>
<li><strong>Predictive Caching</strong>: Anticipate context needs</li>
<li><strong>Performance Optimization</strong>: Caching strategies and performance tuning</li>
<li><strong>Cross-Story Context</strong>: Handle multiple concurrent stories</li>
</ol>
<h3 id="phase-4-advanced-features-weeks-7-8">Phase 4: Advanced Features (Weeks 7-8)<a class="headerlink" href="#phase-4-advanced-features-weeks-7-8" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Semantic Search</strong>: Content-based context discovery</li>
<li><strong>Auto-tuning</strong>: Dynamic optimization based on usage patterns</li>
<li><strong>Integration Testing</strong>: End-to-end TDD workflow validation</li>
<li><strong>Documentation and Training</strong>: Complete system documentation</li>
</ol>
<h2 id="algorithm-designs">Algorithm Designs<a class="headerlink" href="#algorithm-designs" title="Permanent link">¶</a></h2>
<h3 id="relevance-scoring-algorithm">Relevance Scoring Algorithm<a class="headerlink" href="#relevance-scoring-algorithm" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">def</span> <span class="nf">calculate_relevance_score</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">TDDTask</span><span class="p">,</span> <span class="n">story_context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="sd">"""Calculate relevance score (0-1) for a file given current task"""</span>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>    <span class="n">score</span> <span class="o">=</span> <span class="mf">0.0</span>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>    <span class="c1"># Direct mention in task (40% weight)</span>
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a>    <span class="k">if</span> <span class="n">file_mentioned_in_task</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
<a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a>        <span class="n">score</span> <span class="o">+=</span> <span class="mf">0.4</span>
<a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a>
<a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a>    <span class="c1"># Dependency analysis (25% weight)  </span>
<a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a>    <span class="n">dependency_score</span> <span class="o">=</span> <span class="n">analyze_dependencies</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">source_files</span><span class="p">)</span>
<a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a>    <span class="n">score</span> <span class="o">+=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">dependency_score</span>
<a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a>
<a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a>    <span class="c1"># Historical relevance (20% weight)</span>
<a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a>    <span class="n">historical_score</span> <span class="o">=</span> <span class="n">get_historical_relevance</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">agent_type</span><span class="p">)</span>
<a href="#__codelineno-3-15" id="__codelineno-3-15" name="__codelineno-3-15"></a>    <span class="n">score</span> <span class="o">+=</span> <span class="mf">0.20</span> <span class="o">*</span> <span class="n">historical_score</span>
<a href="#__codelineno-3-16" id="__codelineno-3-16" name="__codelineno-3-16"></a>
<a href="#__codelineno-3-17" id="__codelineno-3-17" name="__codelineno-3-17"></a>    <span class="c1"># Semantic similarity (10% weight)</span>
<a href="#__codelineno-3-18" id="__codelineno-3-18" name="__codelineno-3-18"></a>    <span class="n">semantic_score</span> <span class="o">=</span> <span class="n">calculate_semantic_similarity</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
<a href="#__codelineno-3-19" id="__codelineno-3-19" name="__codelineno-3-19"></a>    <span class="n">score</span> <span class="o">+=</span> <span class="mf">0.10</span> <span class="o">*</span> <span class="n">semantic_score</span>
<a href="#__codelineno-3-20" id="__codelineno-3-20" name="__codelineno-3-20"></a>
<a href="#__codelineno-3-21" id="__codelineno-3-21" name="__codelineno-3-21"></a>    <span class="c1"># TDD phase relevance (5% weight)</span>
<a href="#__codelineno-3-22" id="__codelineno-3-22" name="__codelineno-3-22"></a>    <span class="n">phase_score</span> <span class="o">=</span> <span class="n">get_phase_relevance</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">current_state</span><span class="p">)</span>
<a href="#__codelineno-3-23" id="__codelineno-3-23" name="__codelineno-3-23"></a>    <span class="n">score</span> <span class="o">+=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">phase_score</span>
<a href="#__codelineno-3-24" id="__codelineno-3-24" name="__codelineno-3-24"></a>
<a href="#__codelineno-3-25" id="__codelineno-3-25" name="__codelineno-3-25"></a>    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
</code></pre></div>
<h3 id="context-compression-algorithm">Context Compression Algorithm<a class="headerlink" href="#context-compression-algorithm" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">def</span> <span class="nf">compress_file_content</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_tokens</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">    </span><span class="sd">"""Compress file content to target token count while preserving meaning"""</span>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a>
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a>    <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s2">"python"</span><span class="p">:</span>
<a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a>        <span class="k">return</span> <span class="n">compress_python_code</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">target_tokens</span><span class="p">)</span>
<a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>    <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s2">"test"</span><span class="p">:</span>
<a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a>        <span class="k">return</span> <span class="n">compress_test_file</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">target_tokens</span><span class="p">)</span>
<a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a>    <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s2">"markdown"</span><span class="p">:</span>
<a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a>        <span class="k">return</span> <span class="n">compress_documentation</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">target_tokens</span><span class="p">)</span>
<a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a>    <span class="k">else</span><span class="p">:</span>
<a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a>        <span class="k">return</span> <span class="n">compress_generic_text</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">target_tokens</span><span class="p">)</span>
<a href="#__codelineno-4-12" id="__codelineno-4-12" name="__codelineno-4-12"></a>
<a href="#__codelineno-4-13" id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="k">def</span> <span class="nf">compress_python_code</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_tokens</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a href="#__codelineno-4-14" id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="w">    </span><span class="sd">"""Python-specific compression preserving structure and key logic"""</span>
<a href="#__codelineno-4-15" id="__codelineno-4-15" name="__codelineno-4-15"></a>    <span class="n">ast_tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<a href="#__codelineno-4-16" id="__codelineno-4-16" name="__codelineno-4-16"></a>
<a href="#__codelineno-4-17" id="__codelineno-4-17" name="__codelineno-4-17"></a>    <span class="c1"># Extract critical elements</span>
<a href="#__codelineno-4-18" id="__codelineno-4-18" name="__codelineno-4-18"></a>    <span class="n">imports</span> <span class="o">=</span> <span class="n">extract_imports</span><span class="p">(</span><span class="n">ast_tree</span><span class="p">)</span>
<a href="#__codelineno-4-19" id="__codelineno-4-19" name="__codelineno-4-19"></a>    <span class="n">class_signatures</span> <span class="o">=</span> <span class="n">extract_class_signatures</span><span class="p">(</span><span class="n">ast_tree</span><span class="p">)</span>
<a href="#__codelineno-4-20" id="__codelineno-4-20" name="__codelineno-4-20"></a>    <span class="n">method_signatures</span> <span class="o">=</span> <span class="n">extract_method_signatures</span><span class="p">(</span><span class="n">ast_tree</span><span class="p">)</span>
<a href="#__codelineno-4-21" id="__codelineno-4-21" name="__codelineno-4-21"></a>    <span class="n">key_logic</span> <span class="o">=</span> <span class="n">extract_key_logic_blocks</span><span class="p">(</span><span class="n">ast_tree</span><span class="p">)</span>
<a href="#__codelineno-4-22" id="__codelineno-4-22" name="__codelineno-4-22"></a>
<a href="#__codelineno-4-23" id="__codelineno-4-23" name="__codelineno-4-23"></a>    <span class="c1"># Reconstruct with compression</span>
<a href="#__codelineno-4-24" id="__codelineno-4-24" name="__codelineno-4-24"></a>    <span class="n">compressed</span> <span class="o">=</span> <span class="n">rebuild_compressed_code</span><span class="p">(</span>
<a href="#__codelineno-4-25" id="__codelineno-4-25" name="__codelineno-4-25"></a>        <span class="n">imports</span><span class="p">,</span> <span class="n">class_signatures</span><span class="p">,</span> <span class="n">method_signatures</span><span class="p">,</span> <span class="n">key_logic</span><span class="p">,</span> <span class="n">target_tokens</span>
<a href="#__codelineno-4-26" id="__codelineno-4-26" name="__codelineno-4-26"></a>    <span class="p">)</span>
<a href="#__codelineno-4-27" id="__codelineno-4-27" name="__codelineno-4-27"></a>
<a href="#__codelineno-4-28" id="__codelineno-4-28" name="__codelineno-4-28"></a>    <span class="k">return</span> <span class="n">compressed</span>
</code></pre></div>
<h3 id="token-budget-allocation-algorithm">Token Budget Allocation Algorithm<a class="headerlink" href="#token-budget-allocation-algorithm" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">def</span> <span class="nf">allocate_token_budget</span><span class="p">(</span><span class="n">total_budget</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">context_components</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">    </span><span class="sd">"""Dynamically allocate token budget based on task priority and available content"""</span>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a>    <span class="n">allocation</span> <span class="o">=</span> <span class="p">{}</span>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a>
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a>    <span class="c1"># Base allocation percentages</span>
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>    <span class="n">base_allocations</span> <span class="o">=</span> <span class="p">{</span>
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a>        <span class="s2">"core_task"</span><span class="p">:</span> <span class="mf">0.40</span><span class="p">,</span>
<a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a>        <span class="s2">"historical"</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span> 
<a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a>        <span class="s2">"dependencies"</span><span class="p">:</span> <span class="mf">0.20</span><span class="p">,</span>
<a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a>        <span class="s2">"agent_memory"</span><span class="p">:</span> <span class="mf">0.10</span><span class="p">,</span>
<a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a>        <span class="s2">"buffer"</span><span class="p">:</span> <span class="mf">0.05</span>
<a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a>    <span class="p">}</span>
<a href="#__codelineno-5-14" id="__codelineno-5-14" name="__codelineno-5-14"></a>
<a href="#__codelineno-5-15" id="__codelineno-5-15" name="__codelineno-5-15"></a>    <span class="c1"># Adjust based on context availability</span>
<a href="#__codelineno-5-16" id="__codelineno-5-16" name="__codelineno-5-16"></a>    <span class="k">for</span> <span class="n">component</span><span class="p">,</span> <span class="n">base_pct</span> <span class="ow">in</span> <span class="n">base_allocations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a href="#__codelineno-5-17" id="__codelineno-5-17" name="__codelineno-5-17"></a>        <span class="n">available_content</span> <span class="o">=</span> <span class="n">context_components</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="p">{})</span>
<a href="#__codelineno-5-18" id="__codelineno-5-18" name="__codelineno-5-18"></a>
<a href="#__codelineno-5-19" id="__codelineno-5-19" name="__codelineno-5-19"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">available_content</span><span class="p">:</span>
<a href="#__codelineno-5-20" id="__codelineno-5-20" name="__codelineno-5-20"></a>            <span class="c1"># Redistribute unused allocation</span>
<a href="#__codelineno-5-21" id="__codelineno-5-21" name="__codelineno-5-21"></a>            <span class="n">base_allocations</span> <span class="o">=</span> <span class="n">redistribute_unused_allocation</span><span class="p">(</span><span class="n">base_allocations</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
<a href="#__codelineno-5-22" id="__codelineno-5-22" name="__codelineno-5-22"></a>        <span class="k">else</span><span class="p">:</span>
<a href="#__codelineno-5-23" id="__codelineno-5-23" name="__codelineno-5-23"></a>            <span class="c1"># Calculate actual need vs available content</span>
<a href="#__codelineno-5-24" id="__codelineno-5-24" name="__codelineno-5-24"></a>            <span class="n">content_size</span> <span class="o">=</span> <span class="n">estimate_token_size</span><span class="p">(</span><span class="n">available_content</span><span class="p">)</span>
<a href="#__codelineno-5-25" id="__codelineno-5-25" name="__codelineno-5-25"></a>            <span class="n">base_allocation</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_budget</span> <span class="o">*</span> <span class="n">base_pct</span><span class="p">)</span>
<a href="#__codelineno-5-26" id="__codelineno-5-26" name="__codelineno-5-26"></a>
<a href="#__codelineno-5-27" id="__codelineno-5-27" name="__codelineno-5-27"></a>            <span class="c1"># Don't over-allocate if content is smaller than allocation</span>
<a href="#__codelineno-5-28" id="__codelineno-5-28" name="__codelineno-5-28"></a>            <span class="n">allocation</span><span class="p">[</span><span class="n">component</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_allocation</span><span class="p">,</span> <span class="n">content_size</span><span class="p">)</span>
<a href="#__codelineno-5-29" id="__codelineno-5-29" name="__codelineno-5-29"></a>
<a href="#__codelineno-5-30" id="__codelineno-5-30" name="__codelineno-5-30"></a>    <span class="k">return</span> <span class="n">allocation</span>
</code></pre></div>
<h2 id="performance-requirements">Performance Requirements<a class="headerlink" href="#performance-requirements" title="Permanent link">¶</a></h2>
<h3 id="latency-targets">Latency Targets<a class="headerlink" href="#latency-targets" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Context Preparation</strong>: &lt; 2 seconds for typical tasks</li>
<li><strong>Agent Handoff</strong>: &lt; 1 second for artifact transfer</li>
<li><strong>Context Invalidation</strong>: &lt; 500ms for cache updates</li>
<li><strong>Memory Retrieval</strong>: &lt; 100ms for agent memory access</li>
</ul>
<h3 id="throughput-targets">Throughput Targets<a class="headerlink" href="#throughput-targets" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Concurrent Contexts</strong>: Support 10+ parallel TDD cycles</li>
<li><strong>File Processing</strong>: 1000+ files/second for relevance scoring</li>
<li><strong>Compression</strong>: 100KB/second sustained compression rate</li>
<li><strong>Cache Hit Rate</strong>: &gt;80% for repeated context requests</li>
</ul>
<h3 id="scalability-targets">Scalability Targets<a class="headerlink" href="#scalability-targets" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Codebase Size</strong>: Support projects with 100k+ lines of code</li>
<li><strong>Context History</strong>: 1000+ context snapshots per story</li>
<li><strong>Agent Memory</strong>: 10MB+ per agent across all stories</li>
<li><strong>File Index</strong>: 50k+ files with sub-second search</li>
</ul>
<h2 id="error-handling-strategy">Error Handling Strategy<a class="headerlink" href="#error-handling-strategy" title="Permanent link">¶</a></h2>
<h3 id="graceful-degradation">Graceful Degradation<a class="headerlink" href="#graceful-degradation" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Token Limit Exceeded</strong>: Automatic compression and pruning</li>
<li><strong>Context Service Unavailable</strong>: Fall back to basic file access</li>
<li><strong>Memory Corruption</strong>: Rebuild from artifacts and git history</li>
<li><strong>Index Corruption</strong>: Rebuild from filesystem scan</li>
</ol>
<h3 id="recovery-mechanisms">Recovery Mechanisms<a class="headerlink" href="#recovery-mechanisms" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Context Snapshots</strong>: Regular snapshots for quick recovery</li>
<li><strong>Incremental Rebuilds</strong>: Rebuild only affected components</li>
<li><strong>Fallback Modes</strong>: Progressively simpler context provision</li>
<li><strong>Health Monitoring</strong>: Continuous monitoring with automatic recovery</li>
</ol>
<h2 id="evaluation-framework">Evaluation Framework<a class="headerlink" href="#evaluation-framework" title="Permanent link">¶</a></h2>
<h3 id="success-metrics">Success Metrics<a class="headerlink" href="#success-metrics" title="Permanent link">¶</a></h3>
<h4 id="efficiency-metrics">Efficiency Metrics<a class="headerlink" href="#efficiency-metrics" title="Permanent link">¶</a></h4>
<ul>
<li><strong>Context Relevance</strong>: &gt;95% of provided context is used by agents</li>
<li><strong>Token Utilization</strong>: &gt;90% of allocated tokens are effectively used</li>
<li><strong>Redundancy Reduction</strong>: &lt;5% duplicate information in context</li>
<li><strong>Preparation Speed</strong>: Context preparation within latency targets</li>
</ul>
<h4 id="quality-metrics">Quality Metrics<a class="headerlink" href="#quality-metrics" title="Permanent link">¶</a></h4>
<ul>
<li><strong>Agent Task Success</strong>: &gt;95% agent task completion rate</li>
<li><strong>Context Completeness</strong>: &lt;2% missing critical information</li>
<li><strong>Cross-Phase Continuity</strong>: &gt;98% successful phase handoffs</li>
<li><strong>Memory Accuracy</strong>: &gt;95% accurate agent memory retrieval</li>
</ul>
<h4 id="performance-metrics">Performance Metrics<a class="headerlink" href="#performance-metrics" title="Permanent link">¶</a></h4>
<ul>
<li><strong>System Throughput</strong>: Support target concurrent operations</li>
<li><strong>Resource Utilization</strong>: &lt;70% CPU and memory usage</li>
<li><strong>Cache Effectiveness</strong>: &gt;80% cache hit rate</li>
<li><strong>Scalability</strong>: Linear performance degradation with codebase size</li>
</ul>
<h3 id="benchmarking-strategy">Benchmarking Strategy<a class="headerlink" href="#benchmarking-strategy" title="Permanent link">¶</a></h3>
<h4 id="synthetic-benchmarks">Synthetic Benchmarks<a class="headerlink" href="#synthetic-benchmarks" title="Permanent link">¶</a></h4>
<ul>
<li><strong>Token Budget Stress Tests</strong>: Extreme token limit scenarios</li>
<li><strong>Large Codebase Tests</strong>: 100k+ file repositories</li>
<li><strong>Concurrent Load Tests</strong>: Multiple parallel TDD cycles</li>
<li><strong>Memory Pressure Tests</strong>: Limited system memory scenarios</li>
</ul>
<h4 id="real-world-benchmarks">Real-World Benchmarks<a class="headerlink" href="#real-world-benchmarks" title="Permanent link">¶</a></h4>
<ul>
<li><strong>Open Source Projects</strong>: Test on popular GitHub repositories</li>
<li><strong>Legacy Codebase</strong>: Test on complex, undocumented codebases</li>
<li><strong>Multi-Language</strong>: Test cross-language context management</li>
<li><strong>Long-Running Sessions</strong>: Extended TDD sessions over days</li>
</ul>
<h2 id="integration-points">Integration Points<a class="headerlink" href="#integration-points" title="Permanent link">¶</a></h2>
<h3 id="claude-code-cli-integration">Claude Code CLI Integration<a class="headerlink" href="#claude-code-cli-integration" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">class</span> <span class="nc">ClaudeCodeContextProvider</span><span class="p">:</span>
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">    </span><span class="sd">"""Integration with Claude Code CLI for optimized prompts"""</span>
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a>
<a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">prepare_claude_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">AgentContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">        </span><span class="sd">"""Prepare optimized prompt for Claude Code CLI"""</span>
<a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a>        <span class="n">prompt_parts</span> <span class="o">=</span> <span class="p">[]</span>
<a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a>
<a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a>        <span class="c1"># Add core context with highest priority</span>
<a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a>        <span class="n">prompt_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"## Core Task Context</span><span class="se">\n</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">core_context</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a>
<a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a>        <span class="c1"># Add compressed dependencies </span>
<a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a>        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">dependencies</span><span class="p">:</span>
<a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a>            <span class="n">prompt_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"## Dependencies</span><span class="se">\n</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">dependencies</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a>
<a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a>        <span class="c1"># Add agent memory if relevant</span>
<a href="#__codelineno-6-16" id="__codelineno-6-16" name="__codelineno-6-16"></a>        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">agent_memory</span><span class="p">:</span>
<a href="#__codelineno-6-17" id="__codelineno-6-17" name="__codelineno-6-17"></a>            <span class="n">prompt_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"## Previous Decisions</span><span class="se">\n</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">agent_memory</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-6-18" id="__codelineno-6-18" name="__codelineno-6-18"></a>
<a href="#__codelineno-6-19" id="__codelineno-6-19" name="__codelineno-6-19"></a>        <span class="c1"># Add specific instructions based on TDD phase</span>
<a href="#__codelineno-6-20" id="__codelineno-6-20" name="__codelineno-6-20"></a>        <span class="n">phase_instructions</span> <span class="o">=</span> <span class="n">get_phase_specific_instructions</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">tdd_phase</span><span class="p">)</span>
<a href="#__codelineno-6-21" id="__codelineno-6-21" name="__codelineno-6-21"></a>        <span class="n">prompt_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"## Phase Instructions</span><span class="se">\n</span><span class="si">{</span><span class="n">phase_instructions</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-6-22" id="__codelineno-6-22" name="__codelineno-6-22"></a>
<a href="#__codelineno-6-23" id="__codelineno-6-23" name="__codelineno-6-23"></a>        <span class="k">return</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt_parts</span><span class="p">)</span>
</code></pre></div>
<h3 id="tdd-state-machine-integration">TDD State Machine Integration<a class="headerlink" href="#tdd-state-machine-integration" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">class</span> <span class="nc">TDDContextManager</span><span class="p">:</span>
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">    </span><span class="sd">"""Integration with TDD state machine for phase-aware context"""</span>
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a>
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a>    <span class="k">def</span> <span class="nf">get_phase_context_requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase</span><span class="p">:</span> <span class="n">TDDState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">        </span><span class="sd">"""Get context requirements specific to TDD phase"""</span>
<a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a>        <span class="n">requirements</span> <span class="o">=</span> <span class="p">{</span>
<a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a>            <span class="n">TDDState</span><span class="o">.</span><span class="n">DESIGN</span><span class="p">:</span> <span class="p">{</span>
<a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a>                <span class="s2">"focus"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"requirements"</span><span class="p">,</span> <span class="s2">"architecture"</span><span class="p">,</span> <span class="s2">"existing_patterns"</span><span class="p">],</span>
<a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a>                <span class="s2">"exclude"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"implementation_details"</span><span class="p">,</span> <span class="s2">"test_specifics"</span><span class="p">],</span>
<a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a>                <span class="s2">"compression_level"</span><span class="p">:</span> <span class="s2">"moderate"</span>
<a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a>            <span class="p">},</span>
<a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a>            <span class="n">TDDState</span><span class="o">.</span><span class="n">TEST_RED</span><span class="p">:</span> <span class="p">{</span>
<a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a>                <span class="s2">"focus"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"design_specs"</span><span class="p">,</span> <span class="s2">"acceptance_criteria"</span><span class="p">,</span> <span class="s2">"existing_tests"</span><span class="p">],</span>
<a href="#__codelineno-7-14" id="__codelineno-7-14" name="__codelineno-7-14"></a>                <span class="s2">"exclude"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"implementation_files"</span><span class="p">],</span>
<a href="#__codelineno-7-15" id="__codelineno-7-15" name="__codelineno-7-15"></a>                <span class="s2">"compression_level"</span><span class="p">:</span> <span class="s2">"low"</span>
<a href="#__codelineno-7-16" id="__codelineno-7-16" name="__codelineno-7-16"></a>            <span class="p">},</span>
<a href="#__codelineno-7-17" id="__codelineno-7-17" name="__codelineno-7-17"></a>            <span class="n">TDDState</span><span class="o">.</span><span class="n">CODE_GREEN</span><span class="p">:</span> <span class="p">{</span>
<a href="#__codelineno-7-18" id="__codelineno-7-18" name="__codelineno-7-18"></a>                <span class="s2">"focus"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"failing_tests"</span><span class="p">,</span> <span class="s2">"minimal_examples"</span><span class="p">,</span> <span class="s2">"interfaces"</span><span class="p">],</span>
<a href="#__codelineno-7-19" id="__codelineno-7-19" name="__codelineno-7-19"></a>                <span class="s2">"exclude"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"refactoring_notes"</span><span class="p">,</span> <span class="s2">"performance_docs"</span><span class="p">],</span>
<a href="#__codelineno-7-20" id="__codelineno-7-20" name="__codelineno-7-20"></a>                <span class="s2">"compression_level"</span><span class="p">:</span> <span class="s2">"moderate"</span>
<a href="#__codelineno-7-21" id="__codelineno-7-21" name="__codelineno-7-21"></a>            <span class="p">},</span>
<a href="#__codelineno-7-22" id="__codelineno-7-22" name="__codelineno-7-22"></a>            <span class="n">TDDState</span><span class="o">.</span><span class="n">REFACTOR</span><span class="p">:</span> <span class="p">{</span>
<a href="#__codelineno-7-23" id="__codelineno-7-23" name="__codelineno-7-23"></a>                <span class="s2">"focus"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"current_implementation"</span><span class="p">,</span> <span class="s2">"quality_patterns"</span><span class="p">,</span> <span class="s2">"best_practices"</span><span class="p">],</span>
<a href="#__codelineno-7-24" id="__codelineno-7-24" name="__codelineno-7-24"></a>                <span class="s2">"exclude"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"test_files"</span><span class="p">],</span>
<a href="#__codelineno-7-25" id="__codelineno-7-25" name="__codelineno-7-25"></a>                <span class="s2">"compression_level"</span><span class="p">:</span> <span class="s2">"high"</span>
<a href="#__codelineno-7-26" id="__codelineno-7-26" name="__codelineno-7-26"></a>            <span class="p">},</span>
<a href="#__codelineno-7-27" id="__codelineno-7-27" name="__codelineno-7-27"></a>            <span class="n">TDDState</span><span class="o">.</span><span class="n">COMMIT</span><span class="p">:</span> <span class="p">{</span>
<a href="#__codelineno-7-28" id="__codelineno-7-28" name="__codelineno-7-28"></a>                <span class="s2">"focus"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"all_changes"</span><span class="p">,</span> <span class="s2">"commit_history"</span><span class="p">,</span> <span class="s2">"integration_tests"</span><span class="p">],</span>
<a href="#__codelineno-7-29" id="__codelineno-7-29" name="__codelineno-7-29"></a>                <span class="s2">"exclude"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"draft_files"</span><span class="p">],</span>
<a href="#__codelineno-7-30" id="__codelineno-7-30" name="__codelineno-7-30"></a>                <span class="s2">"compression_level"</span><span class="p">:</span> <span class="s2">"low"</span>
<a href="#__codelineno-7-31" id="__codelineno-7-31" name="__codelineno-7-31"></a>            <span class="p">}</span>
<a href="#__codelineno-7-32" id="__codelineno-7-32" name="__codelineno-7-32"></a>        <span class="p">}</span>
<a href="#__codelineno-7-33" id="__codelineno-7-33" name="__codelineno-7-33"></a>        <span class="k">return</span> <span class="n">requirements</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="p">{})</span>
</code></pre></div>
<h2 id="future-enhancements">Future Enhancements<a class="headerlink" href="#future-enhancements" title="Permanent link">¶</a></h2>
<h3 id="machine-learning-integration">Machine Learning Integration<a class="headerlink" href="#machine-learning-integration" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Context Relevance ML</strong>: Train models on agent context usage patterns</li>
<li><strong>Compression Optimization</strong>: ML-powered compression for better semantic preservation</li>
<li><strong>Predictive Caching</strong>: Predict future context needs based on TDD patterns</li>
<li><strong>Agent Behavior Learning</strong>: Learn optimal context for each agent type</li>
</ul>
<h3 id="advanced-features">Advanced Features<a class="headerlink" href="#advanced-features" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Multi-Project Context</strong>: Share learnings across related projects</li>
<li><strong>Team Context Sharing</strong>: Share context insights across team members</li>
<li><strong>Real-time Collaboration</strong>: Support concurrent agent operations</li>
<li><strong>Version-Aware Context</strong>: Context management across git branches</li>
</ul>
<h3 id="performance-optimizations">Performance Optimizations<a class="headerlink" href="#performance-optimizations" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Distributed Context</strong>: Distribute context processing across nodes</li>
<li><strong>Streaming Context</strong>: Stream large contexts to agents incrementally</li>
<li><strong>Edge Caching</strong>: Cache contexts at network edges for global teams</li>
<li><strong>Hardware Acceleration</strong>: GPU acceleration for large-scale compression</li>
</ul>
<p>This Context Management System design provides the foundation for efficient agent communication while respecting Claude Code's token limitations. The system is designed to be extensible, performant, and maintainable while providing the intelligent context filtering necessary for effective TDD workflow execution.</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "navigation.top", "search.highlight", "search.suggest", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
<script src="../../js/mermaid-zoom.js"></script>
</body>
</html>