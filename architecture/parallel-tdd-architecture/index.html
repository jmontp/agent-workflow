<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Human-In-The-Loop orchestration framework for AI-assisted software development"><meta name=author content="AI Agent Workflow Team"><link href=https://jmontp.github.io/agent-workflow/architecture/parallel-tdd-architecture/ rel=canonical><link href=../context-implementation-plan/ rel=prev><link href=../parallel-tdd-technical-specification/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.14"><title>Parallel TDD Design - AI Agent TDD-Scrum Workflow</title><link rel=stylesheet href=../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><style>:root{.md-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M5.5%207A1.5%201.5%200%200%201%204%205.5%201.5%201.5%200%200%201%205.5%204%201.5%201.5%200%200%201%207%205.5%201.5%201.5%200%200%201%205.5%207m15.91%204.58-9-9C12.05%202.22%2011.55%202%2011%202H4c-1.11%200-2%20.89-2%202v7c0%20.55.22%201.05.59%201.41l8.99%209c.37.36.87.59%201.42.59s1.05-.23%201.41-.59l7-7c.37-.36.59-.86.59-1.41%200-.56-.23-1.06-.59-1.42%22/%3E%3C/svg%3E');}.md-tag.md-tag--html{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22m12%2017.56%204.07-1.13.55-6.1H9.38L9.2%208.3h7.6l.2-1.99H7l.56%206.01h6.89l-.23%202.58-2.22.6-2.22-.6-.14-1.66h-2l.29%203.19zM4.07%203h15.86L18.5%2019.2%2012%2021l-6.5-1.8z%22/%3E%3C/svg%3E');}.md-tag.md-tag--js{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M3%203h18v18H3zm4.73%2015.04c.4.85%201.19%201.55%202.54%201.55%201.5%200%202.53-.8%202.53-2.55v-5.78h-1.7V17c0%20.86-.35%201.08-.9%201.08-.58%200-.82-.4-1.09-.87zm5.98-.18c.5.98%201.51%201.73%203.09%201.73%201.6%200%202.8-.83%202.8-2.36%200-1.41-.81-2.04-2.25-2.66l-.42-.18c-.73-.31-1.04-.52-1.04-1.02%200-.41.31-.73.81-.73.48%200%20.8.21%201.09.73l1.31-.87c-.55-.96-1.33-1.33-2.4-1.33-1.51%200-2.48.96-2.48%202.23%200%201.38.81%202.03%202.03%202.55l.42.18c.78.34%201.24.55%201.24%201.13%200%20.48-.45.83-1.15.83-.83%200-1.31-.43-1.67-1.03z%22/%3E%3C/svg%3E');}.md-tag.md-tag--css{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22m5%203-.65%203.34h13.59L17.5%208.5H3.92l-.66%203.33h13.59l-.76%203.81-5.48%201.81-4.75-1.81.33-1.64H2.85l-.79%204%207.85%203%209.05-3%201.2-6.03.24-1.21L21.94%203z%22/%3E%3C/svg%3E');}.md-tag.md-tag--python{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M19.14%207.5A2.86%202.86%200%200%201%2022%2010.36v3.78A2.86%202.86%200%200%201%2019.14%2017H12c0%20.39.32.96.71.96H17v1.68a2.86%202.86%200%200%201-2.86%202.86H9.86A2.86%202.86%200%200%201%207%2019.64v-3.75a2.85%202.85%200%200%201%202.86-2.85h5.25a2.85%202.85%200%200%200%202.85-2.86V7.5zm-4.28%2011.79c-.4%200-.72.3-.72.89s.32.71.72.71a.71.71%200%200%200%20.71-.71c0-.59-.32-.89-.71-.89m-10-1.79A2.86%202.86%200%200%201%202%2014.64v-3.78A2.86%202.86%200%200%201%204.86%208H12c0-.39-.32-.96-.71-.96H7V5.36A2.86%202.86%200%200%201%209.86%202.5h4.28A2.86%202.86%200%200%201%2017%205.36v3.75a2.85%202.85%200%200%201-2.86%202.85H8.89a2.85%202.85%200%200%200-2.85%202.86v2.68zM9.14%205.71c.4%200%20.72-.3.72-.89s-.32-.71-.72-.71c-.39%200-.71.12-.71.71s.32.89.71.89%22/%3E%3C/svg%3E');}}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><link rel=stylesheet href=../../stylesheets/enhanced-navigation.css><link rel=stylesheet href=../../stylesheets/color-schemes.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script> <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head><body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=black><input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off><input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off><label class=md-overlay for=__drawer></label><div data-md-component=skip><a href=#parallel-tdd-execution-architecture class=md-skip> Skip to content </a></div><div data-md-component=announce></div><div data-md-color-scheme=default data-md-component=outdated hidden></div><header class="md-header md-header--shadow md-header--lifted" data-md-component=header><nav class="md-header__inner md-grid" aria-label=Header><a href=../.. title="AI Agent TDD-Scrum Workflow" class="md-header__button md-logo" aria-label="AI Agent TDD-Scrum Workflow" data-md-component=logo><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg></a><label class="md-header__button md-icon" for=__drawer><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg></label><div class=md-header__title data-md-component=header-title><div class=md-header__ellipsis><div class=md-header__topic><span class=md-ellipsis> AI Agent TDD-Scrum Workflow </span></div><div class=md-header__topic data-md-component=header-topic><span class=md-ellipsis> Parallel TDD Design </span></div></div></div><div class=md-header__option><div class=md-select><button class="md-header__button md-icon" aria-label="Select language"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg></button><div class=md-select__inner><ul class=md-select__list><li class=md-select__item><a href=../../ hreflang=en class=md-select__link> English </a></li></ul></div></div></div><label class="md-header__button md-icon" for=__search><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required><label class="md-search__icon md-icon" for=__search><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M15.41 16.58 10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg></label><nav class=md-search__options aria-label=Search><a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg></a><button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button></nav><div class=md-search__suggest data-md-component=search-suggest></div></form><div class=md-search__output><div class=md-search__scrollwrap tabindex=0 data-md-scrollfix><div class=md-search-result data-md-component=search-result><div class=md-search-result__meta> Initializing search </div><ol class=md-search-result__list role=presentation></ol></div></div></div></div></div><div class=md-header__source><a href=https://github.com/jmontp/agent-workflow title="Go to repository" class=md-source data-md-component=source><div class="md-source__icon md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg></div><div class=md-source__repository> jmontp/agent-workflow </div></a></div></nav><nav class=md-tabs aria-label=Tabs data-md-component=tabs><div class=md-grid><ul class=md-tabs__list><li class=md-tabs__item><a href=../.. class=md-tabs__link> 🏠 Home </a></li><li class=md-tabs__item><a href=../../getting-started/ class=md-tabs__link> ⚡ Getting Started </a></li><li class=md-tabs__item><a href=../../user-guide/ class=md-tabs__link> 📊 User Guide </a></li><li class=md-tabs__item><a href=../../concepts/ class=md-tabs__link> 🎯 Core Concepts </a></li><li class="md-tabs__item md-tabs__item--active"><a href=../ class=md-tabs__link> 🔥 Architecture </a></li><li class=md-tabs__item><a href=../../advanced/ class=md-tabs__link> ⚡ Advanced Topics </a></li><li class=md-tabs__item><a href=../../planning/ class=md-tabs__link> 🎨 Planning & Design </a></li><li class=md-tabs__item><a href=../../development/ class=md-tabs__link> 📊 Development </a></li><li class=md-tabs__item><a href=../../deployment/ class=md-tabs__link> 🔥 Deployment </a></li><li class=md-tabs__item><a href=../../templates/ class=md-tabs__link> 📋 Templates </a></li><li class=md-tabs__item><a href=../../theme-integration-guide/ class=md-tabs__link> 🎨 Theme Integration </a></li><li class=md-tabs__item><a href=../../archive/compliance/ class=md-tabs__link> 📁 Archive </a></li></ul></div></nav></header><div class=md-container data-md-component=container><main class=md-main data-md-component=main><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0><label class=md-nav__title for=__drawer><a href=../.. title="AI Agent TDD-Scrum Workflow" class="md-nav__button md-logo" aria-label="AI Agent TDD-Scrum Workflow" data-md-component=logo><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg></a> AI Agent TDD-Scrum Workflow </label><div class=md-nav__source><a href=https://github.com/jmontp/agent-workflow title="Go to repository" class=md-source data-md-component=source><div class="md-source__icon md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg></div><div class=md-source__repository> jmontp/agent-workflow </div></a></div><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../.. class=md-nav__link><span class=md-ellipsis> 🏠 Home </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../getting-started/ class=md-nav__link><span class=md-ellipsis> ⚡ Getting Started </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../user-guide/ class=md-nav__link><span class=md-ellipsis> 📊 User Guide </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../concepts/ class=md-nav__link><span class=md-ellipsis> 🎯 Core Concepts </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked><div class="md-nav__link md-nav__container"><a href=../ class="md-nav__link "><span class=md-ellipsis> 🔥 Architecture </span></a><label class="md-nav__link " for=__nav_5 id=__nav_5_label tabindex><span class="md-nav__icon md-icon"></span></label></div><nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true><label class=md-nav__title for=__nav_5><span class="md-nav__icon md-icon"></span> 🔥 Architecture </label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../system-overview/ class=md-nav__link><span class=md-ellipsis> 🏗️ System Overview </span></a></li><li class=md-nav__item><a href=../component-architecture/ class=md-nav__link><span class=md-ellipsis> 🔧 Component Architecture </span></a></li><li class=md-nav__item><a href=../context-management-system/ class=md-nav__link><span class=md-ellipsis> 🧠 Context Management </span></a></li><li class=md-nav__item><a href=../context-api-specification/ class=md-nav__link><span class=md-ellipsis> Context API Specification </span></a></li><li class=md-nav__item><a href=../context-algorithms/ class=md-nav__link><span class=md-ellipsis> Context Algorithms </span></a></li><li class=md-nav__item><a href=../context-evaluation-framework/ class=md-nav__link><span class=md-ellipsis> Context Evaluation Framework </span></a></li><li class=md-nav__item><a href=../context-implementation-plan/ class=md-nav__link><span class=md-ellipsis> Context Implementation Plan </span></a></li><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle" type=checkbox id=__toc><label class="md-nav__link md-nav__link--active" for=__toc><span class=md-ellipsis> Parallel TDD Design </span><span class="md-nav__icon md-icon"></span></label><a href=./ class="md-nav__link md-nav__link--active"><span class=md-ellipsis> Parallel TDD Design </span></a><nav class="md-nav md-nav--secondary" aria-label="On this page"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> On this page </label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a href=#executive-summary class=md-nav__link><span class=md-ellipsis> Executive Summary </span></a></li><li class=md-nav__item><a href=#system-overview class=md-nav__link><span class=md-ellipsis> System Overview </span></a><nav class=md-nav aria-label="System Overview"><ul class=md-nav__list><li class=md-nav__item><a href=#core-capabilities class=md-nav__link><span class=md-ellipsis> Core Capabilities </span></a></li><li class=md-nav__item><a href=#architecture-principles class=md-nav__link><span class=md-ellipsis> Architecture Principles </span></a></li></ul></nav></li><li class=md-nav__item><a href=#high-level-architecture class=md-nav__link><span class=md-ellipsis> High-Level Architecture </span></a></li><li class=md-nav__item><a href=#core-components class=md-nav__link><span class=md-ellipsis> Core Components </span></a><nav class=md-nav aria-label="Core Components"><ul class=md-nav__list><li class=md-nav__item><a href=#1-parallel-coordinator-central-brain class=md-nav__link><span class=md-ellipsis> 1. Parallel Coordinator (Central Brain) </span></a></li><li class=md-nav__item><a href=#2-agent-pool-manager class=md-nav__link><span class=md-ellipsis> 2. Agent Pool Manager </span></a></li><li class=md-nav__item><a href=#3-cycle-synchronizer class=md-nav__link><span class=md-ellipsis> 3. Cycle Synchronizer </span></a></li><li class=md-nav__item><a href=#4-conflict-detector class=md-nav__link><span class=md-ellipsis> 4. Conflict Detector </span></a></li><li class=md-nav__item><a href=#5-parallel-context-isolator class=md-nav__link><span class=md-ellipsis> 5. Parallel Context Isolator </span></a></li></ul></nav></li><li class=md-nav__item><a href=#concurrency-architecture class=md-nav__link><span class=md-ellipsis> Concurrency Architecture </span></a><nav class=md-nav aria-label="Concurrency Architecture"><ul class=md-nav__list><li class=md-nav__item><a href=#execution-models class=md-nav__link><span class=md-ellipsis> Execution Models </span></a></li><li class=md-nav__item><a href=#conflict-resolution-strategies class=md-nav__link><span class=md-ellipsis> Conflict Resolution Strategies </span></a></li></ul></nav></li><li class=md-nav__item><a href=#resource-management class=md-nav__link><span class=md-ellipsis> Resource Management </span></a><nav class=md-nav aria-label="Resource Management"><ul class=md-nav__list><li class=md-nav__item><a href=#agent-pool-scaling class=md-nav__link><span class=md-ellipsis> Agent Pool Scaling </span></a></li><li class=md-nav__item><a href=#token-budget-distribution class=md-nav__link><span class=md-ellipsis> Token Budget Distribution </span></a></li></ul></nav></li><li class=md-nav__item><a href=#test-execution-coordination class=md-nav__link><span class=md-ellipsis> Test Execution Coordination </span></a><nav class=md-nav aria-label="Test Execution Coordination"><ul class=md-nav__list><li class=md-nav__item><a href=#parallel-test-runner class=md-nav__link><span class=md-ellipsis> Parallel Test Runner </span></a></li><li class=md-nav__item><a href=#test-fixture-management class=md-nav__link><span class=md-ellipsis> Test Fixture Management </span></a></li></ul></nav></li><li class=md-nav__item><a href=#human-in-the-loop-coordination class=md-nav__link><span class=md-ellipsis> Human-in-the-Loop Coordination </span></a><nav class=md-nav aria-label="Human-in-the-Loop Coordination"><ul class=md-nav__list><li class=md-nav__item><a href=#parallel-approval-queue class=md-nav__link><span class=md-ellipsis> Parallel Approval Queue </span></a></li><li class=md-nav__item><a href=#parallel-progress-dashboard class=md-nav__link><span class=md-ellipsis> Parallel Progress Dashboard </span></a></li></ul></nav></li><li class=md-nav__item><a href=#implementation-strategy class=md-nav__link><span class=md-ellipsis> Implementation Strategy </span></a><nav class=md-nav aria-label="Implementation Strategy"><ul class=md-nav__list><li class=md-nav__item><a href=#phase-1-basic-parallel-execution-weeks-1-2 class=md-nav__link><span class=md-ellipsis> Phase 1: Basic Parallel Execution (Weeks 1-2) </span></a></li><li class=md-nav__item><a href=#phase-2-intelligent-scheduling-weeks-3-4 class=md-nav__link><span class=md-ellipsis> Phase 2: Intelligent Scheduling (Weeks 3-4) </span></a></li><li class=md-nav__item><a href=#phase-3-advanced-parallelism-weeks-5-6 class=md-nav__link><span class=md-ellipsis> Phase 3: Advanced Parallelism (Weeks 5-6) </span></a></li><li class=md-nav__item><a href=#phase-4-production-optimization-weeks-7-8 class=md-nav__link><span class=md-ellipsis> Phase 4: Production Optimization (Weeks 7-8) </span></a></li></ul></nav></li><li class=md-nav__item><a href=#performance-targets class=md-nav__link><span class=md-ellipsis> Performance Targets </span></a><nav class=md-nav aria-label="Performance Targets"><ul class=md-nav__list><li class=md-nav__item><a href=#throughput-metrics class=md-nav__link><span class=md-ellipsis> Throughput Metrics </span></a></li><li class=md-nav__item><a href=#quality-metrics class=md-nav__link><span class=md-ellipsis> Quality Metrics </span></a></li><li class=md-nav__item><a href=#resource-metrics class=md-nav__link><span class=md-ellipsis> Resource Metrics </span></a></li></ul></nav></li><li class=md-nav__item><a href=#risk-mitigation class=md-nav__link><span class=md-ellipsis> Risk Mitigation </span></a><nav class=md-nav aria-label="Risk Mitigation"><ul class=md-nav__list><li class=md-nav__item><a href=#technical-risks class=md-nav__link><span class=md-ellipsis> Technical Risks </span></a></li><li class=md-nav__item><a href=#operational-risks class=md-nav__link><span class=md-ellipsis> Operational Risks </span></a></li></ul></nav></li><li class=md-nav__item><a href=#testing-strategy class=md-nav__link><span class=md-ellipsis> Testing Strategy </span></a><nav class=md-nav aria-label="Testing Strategy"><ul class=md-nav__list><li class=md-nav__item><a href=#unit-testing class=md-nav__link><span class=md-ellipsis> Unit Testing </span></a></li><li class=md-nav__item><a href=#integration-testing class=md-nav__link><span class=md-ellipsis> Integration Testing </span></a></li><li class=md-nav__item><a href=#stress-testing class=md-nav__link><span class=md-ellipsis> Stress Testing </span></a></li></ul></nav></li><li class=md-nav__item><a href=#monitoring-and-observability class=md-nav__link><span class=md-ellipsis> Monitoring and Observability </span></a><nav class=md-nav aria-label="Monitoring and Observability"><ul class=md-nav__list><li class=md-nav__item><a href=#key-metrics class=md-nav__link><span class=md-ellipsis> Key Metrics </span></a></li><li class=md-nav__item><a href=#distributed-tracing class=md-nav__link><span class=md-ellipsis> Distributed Tracing </span></a></li></ul></nav></li><li class=md-nav__item><a href=#future-enhancements class=md-nav__link><span class=md-ellipsis> Future Enhancements </span></a><nav class=md-nav aria-label="Future Enhancements"><ul class=md-nav__list><li class=md-nav__item><a href=#machine-learning-integration class=md-nav__link><span class=md-ellipsis> Machine Learning Integration </span></a></li><li class=md-nav__item><a href=#advanced-features class=md-nav__link><span class=md-ellipsis> Advanced Features </span></a></li></ul></nav></li></ul></nav></li><li class=md-nav__item><a href=../parallel-tdd-technical-specification/ class=md-nav__link><span class=md-ellipsis> Parallel TDD Implementation </span></a></li><li class=md-nav__item><a href=../parallel-tdd-implementation-strategy/ class=md-nav__link><span class=md-ellipsis> Parallel TDD Implementation Strategy </span></a></li><li class=md-nav__item><a href=../parallel-tdd-comprehensive-implementation-plan/ class=md-nav__link><span class=md-ellipsis> Parallel TDD Comprehensive Plan </span></a></li><li class=md-nav__item><a href=../parallel-tdd-testing-strategy/ class=md-nav__link><span class=md-ellipsis> Parallel TDD Testing Strategy </span></a></li><li class=md-nav__item><a href=../parallel-context-integration/ class=md-nav__link><span class=md-ellipsis> Parallel Context Integration </span></a></li><li class=md-nav__item><a href=../parallel-agent-pool-management/ class=md-nav__link><span class=md-ellipsis> Parallel Agent Pool Management </span></a></li><li class=md-nav__item><a href=../parallel-conflict-algorithms/ class=md-nav__link><span class=md-ellipsis> Parallel Conflict Resolution </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../advanced/ class=md-nav__link><span class=md-ellipsis> ⚡ Advanced Topics </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../planning/ class=md-nav__link><span class=md-ellipsis> 🎨 Planning & Design </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../development/ class=md-nav__link><span class=md-ellipsis> 📊 Development </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../deployment/ class=md-nav__link><span class=md-ellipsis> 🔥 Deployment </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../templates/ class=md-nav__link><span class=md-ellipsis> 📋 Templates </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../theme-integration-guide/ class=md-nav__link><span class=md-ellipsis> 🎨 Theme Integration </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../archive/compliance/ class=md-nav__link><span class=md-ellipsis> 📁 Archive </span><span class="md-nav__icon md-icon"></span></a></li></ul></nav></div></div></div><div class=md-content data-md-component=content><article class="md-content__inner md-typeset"><a href=https://github.com/jmontp/agent-workflow/edit/master/docs/architecture/parallel-tdd-architecture.md title="Edit this page" class="md-content__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg></a><a href=https://github.com/jmontp/agent-workflow/raw/master/docs/architecture/parallel-tdd-architecture.md title="View source of this page" class="md-content__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg></a><h1 id=parallel-tdd-execution-architecture>Parallel TDD Execution Architecture<a class=headerlink href=#parallel-tdd-execution-architecture title="Permanent link">&para;</a></h1><h2 id=executive-summary>Executive Summary<a class=headerlink href=#executive-summary title="Permanent link">&para;</a></h2><p>The Parallel TDD Execution Architecture enables concurrent execution of multiple TDD cycles while maintaining code quality, preventing conflicts, and optimizing resource utilization. This architecture builds on the proven sequential TDD foundation and integrates with the Context Management System to enable 2-3x faster story completion through intelligent parallelization.</p><h2 id=system-overview>System Overview<a class=headerlink href=#system-overview title="Permanent link">&para;</a></h2><h3 id=core-capabilities>Core Capabilities<a class=headerlink href=#core-capabilities title="Permanent link">&para;</a></h3><ul><li><strong>Concurrent TDD Cycles</strong>: Run 2-5 TDD cycles in parallel with intelligent scheduling</li><li><strong>Conflict Prevention</strong>: Proactive detection and resolution of code conflicts</li><li><strong>Resource Optimization</strong>: Dynamic agent pool management with efficient allocation</li><li><strong>Context Isolation</strong>: Parallel-aware context management with shared knowledge</li><li><strong>Quality Preservation</strong>: Maintain TDD integrity and test coverage across parallel execution</li></ul><h3 id=architecture-principles>Architecture Principles<a class=headerlink href=#architecture-principles title="Permanent link">&para;</a></h3><ol><li><strong>Sequential Foundation</strong>: Preserve sequential mode as default, parallel as opt-in enhancement</li><li><strong>Graceful Degradation</strong>: Automatic fallback to sequential on conflict or failure</li><li><strong>Zero Data Corruption</strong>: Transactional state management with rollback capability</li><li><strong>Progressive Enhancement</strong>: Phased rollout from 2 parallel cycles to 5+</li></ol><h2 id=high-level-architecture>High-Level Architecture<a class=headerlink href=#high-level-architecture title="Permanent link">&para;</a></h2><pre class=mermaid><code>graph TB
    subgraph "Orchestration Layer"
        O[Orchestrator]
        PS[Parallel Scheduler]
        CR[Conflict Resolver]
    end
    
    subgraph "Parallel Coordination"
        PC[Parallel Coordinator]
        AP[Agent Pool Manager]
        CS[Cycle Synchronizer]
        CD[Conflict Detector]
    end
    
    subgraph "TDD Execution Engines"
        TE1[TDD Engine 1]
        TE2[TDD Engine 2]
        TE3[TDD Engine 3]
        TEn[TDD Engine N]
    end
    
    subgraph "Agent Pools"
        DAP[Design Agent Pool]
        QAP[QA Agent Pool]
        CAP[Code Agent Pool]
        RAP[Refactor Agent Pool]
    end
    
    subgraph "Context Management"
        CMS[Context Manager]
        PCI[Parallel Context Isolator]
        SCK[Shared Context Knowledge]
        TB[Token Budget Allocator]
    end
    
    subgraph "Storage &amp; State"
        PSS[Parallel State Store]
        LS[Lock Service]
        TS[Transaction Log]
        BS[Backup Service]
    end
    
    O --&gt; PS
    PS --&gt; PC
    PC --&gt; AP
    PC --&gt; CS
    PC --&gt; CD
    
    PC --&gt; TE1
    PC --&gt; TE2
    PC --&gt; TE3
    PC --&gt; TEn
    
    AP --&gt; DAP
    AP --&gt; QAP
    AP --&gt; CAP
    AP --&gt; RAP
    
    TE1 --&gt; CMS
    TE2 --&gt; CMS
    TE3 --&gt; CMS
    TEn --&gt; CMS
    
    CMS --&gt; PCI
    CMS --&gt; SCK
    CMS --&gt; TB
    
    CS --&gt; PSS
    CD --&gt; LS
    PC --&gt; TS
    PSS --&gt; BS</code></pre><h2 id=core-components>Core Components<a class=headerlink href=#core-components title="Permanent link">&para;</a></h2><h3 id=1-parallel-coordinator-central-brain>1. Parallel Coordinator (Central Brain)<a class=headerlink href=#1-parallel-coordinator-central-brain title="Permanent link">&para;</a></h3><p><strong>Responsibilities:</strong> - Orchestrate multiple TDD cycles concurrently - Manage cycle lifecycle and state transitions - Coordinate resource allocation and scheduling - Handle conflict detection and resolution</p><p><strong>Key Interfaces:</strong><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1></a><a href=#__codelineno-0-1><span class=linenos data-linenos="1 "></span></a><span class=k>class</span> <span class=nc>ParallelCoordinator</span><span class=p>:</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2></a><a href=#__codelineno-0-2><span class=linenos data-linenos="2 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>start_parallel_cycle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>story_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>priority</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>TDDCycle</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3></a><a href=#__codelineno-0-3><span class=linenos data-linenos="3 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>schedule_cycles</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>pending_stories</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Story</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>TDDCycle</span><span class=p>]</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4></a><a href=#__codelineno-0-4><span class=linenos data-linenos="4 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>detect_conflicts</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycle1</span><span class=p>:</span> <span class=n>TDDCycle</span><span class=p>,</span> <span class=n>cycle2</span><span class=p>:</span> <span class=n>TDDCycle</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Conflict</span><span class=p>]</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5></a><a href=#__codelineno-0-5><span class=linenos data-linenos="5 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>resolve_conflicts</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>conflicts</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Conflict</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>ResolutionStrategy</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6></a><a href=#__codelineno-0-6><span class=linenos data-linenos="6 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>monitor_parallel_execution</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ParallelStatus</span>
</span></code></pre></div></p><h3 id=2-agent-pool-manager>2. Agent Pool Manager<a class=headerlink href=#2-agent-pool-manager title="Permanent link">&para;</a></h3><p><strong>Responsibilities:</strong> - Maintain pools of specialized agents - Dynamic scaling based on workload - Efficient agent allocation across cycles - Health monitoring and recovery</p><p><strong>Agent Pool Strategy:</strong><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1></a><a href=#__codelineno-1-1><span class=linenos data-linenos=" 1 "></span></a><span class=nd>@dataclass</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2></a><a href=#__codelineno-1-2><span class=linenos data-linenos=" 2 "></span></a><span class=k>class</span> <span class=nc>AgentPoolConfig</span><span class=p>:</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3></a><a href=#__codelineno-1-3><span class=linenos data-linenos=" 3 "></span></a>    <span class=n>agent_type</span><span class=p>:</span> <span class=n>AgentType</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4></a><a href=#__codelineno-1-4><span class=linenos data-linenos=" 4 "></span></a>    <span class=n>min_instances</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5></a><a href=#__codelineno-1-5><span class=linenos data-linenos=" 5 "></span></a>    <span class=n>max_instances</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>5</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6></a><a href=#__codelineno-1-6><span class=linenos data-linenos=" 6 "></span></a>    <span class=n>idle_timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>300</span>  <span class=c1># seconds</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7></a><a href=#__codelineno-1-7><span class=linenos data-linenos=" 7 "></span></a>    <span class=n>scaling_policy</span><span class=p>:</span> <span class=n>ScalingPolicy</span> <span class=o>=</span> <span class=n>ScalingPolicy</span><span class=o>.</span><span class=n>DYNAMIC</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8></a><a href=#__codelineno-1-8><span class=linenos data-linenos=" 8 "></span></a>    
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9></a><a href=#__codelineno-1-9><span class=linenos data-linenos=" 9 "></span></a><span class=k>class</span> <span class=nc>AgentPool</span><span class=p>:</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10></a><a href=#__codelineno-1-10><span class=linenos data-linenos="10 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>AgentPoolConfig</span><span class=p>):</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11></a><a href=#__codelineno-1-11><span class=linenos data-linenos="11 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>available_agents</span><span class=p>:</span> <span class=n>Queue</span><span class=p>[</span><span class=n>Agent</span><span class=p>]</span> <span class=o>=</span> <span class=n>Queue</span><span class=p>()</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12></a><a href=#__codelineno-1-12><span class=linenos data-linenos="12 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>busy_agents</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Agent</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13></a><a href=#__codelineno-1-13><span class=linenos data-linenos="13 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>config</span> <span class=o>=</span> <span class=n>config</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14></a><a href=#__codelineno-1-14><span class=linenos data-linenos="14 "></span></a>        
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15></a><a href=#__codelineno-1-15><span class=linenos data-linenos="15 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>acquire_agent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>30</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Agent</span><span class=p>:</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16></a><a href=#__codelineno-1-16><span class=linenos data-linenos="16 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Acquire agent from pool with timeout&quot;&quot;&quot;</span>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17></a><a href=#__codelineno-1-17><span class=linenos data-linenos="17 "></span></a>        
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18></a><a href=#__codelineno-1-18><span class=linenos data-linenos="18 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>release_agent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=n>Agent</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19></a><a href=#__codelineno-1-19><span class=linenos data-linenos="19 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Return agent to pool for reuse&quot;&quot;&quot;</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20></a><a href=#__codelineno-1-20><span class=linenos data-linenos="20 "></span></a>        
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21></a><a href=#__codelineno-1-21><span class=linenos data-linenos="21 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>scale_pool</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>demand</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22></a><a href=#__codelineno-1-22><span class=linenos data-linenos="22 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Scale pool size based on demand&quot;&quot;&quot;</span>
</span></code></pre></div></p><h3 id=3-cycle-synchronizer>3. Cycle Synchronizer<a class=headerlink href=#3-cycle-synchronizer title="Permanent link">&para;</a></h3><p><strong>Responsibilities:</strong> - Synchronize state across parallel cycles - Manage shared resources and locks - Coordinate phase transitions - Handle cycle dependencies</p><p><strong>Synchronization Patterns:</strong><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1></a><a href=#__codelineno-2-1><span class=linenos data-linenos="1 "></span></a><span class=k>class</span> <span class=nc>CycleSynchronizer</span><span class=p>:</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2></a><a href=#__codelineno-2-2><span class=linenos data-linenos="2 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>acquire_file_lock</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>cycle_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>FileLock</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3></a><a href=#__codelineno-2-3><span class=linenos data-linenos="3 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>wait_for_dependency</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycle_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>depends_on</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4></a><a href=#__codelineno-2-4><span class=linenos data-linenos="4 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>broadcast_phase_transition</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycle_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>new_phase</span><span class=p>:</span> <span class=n>TDDState</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5></a><a href=#__codelineno-2-5><span class=linenos data-linenos="5 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>coordinate_test_execution</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycles</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>TDDCycle</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>TestSchedule</span>
</span></code></pre></div></p><h3 id=4-conflict-detector>4. Conflict Detector<a class=headerlink href=#4-conflict-detector title="Permanent link">&para;</a></h3><p><strong>Responsibilities:</strong> - Proactive conflict detection before they occur - Static analysis of code dependencies - Runtime monitoring of file access patterns - Predictive conflict analysis using ML</p><p><strong>Conflict Detection Strategy:</strong><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1></a><a href=#__codelineno-3-1><span class=linenos data-linenos=" 1 "></span></a><span class=nd>@dataclass</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2></a><a href=#__codelineno-3-2><span class=linenos data-linenos=" 2 "></span></a><span class=k>class</span> <span class=nc>Conflict</span><span class=p>:</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3></a><a href=#__codelineno-3-3><span class=linenos data-linenos=" 3 "></span></a>    <span class=nb>type</span><span class=p>:</span> <span class=n>ConflictType</span>  <span class=c1># FILE_OVERLAP, TEST_COLLISION, DEPENDENCY_CONFLICT</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4></a><a href=#__codelineno-3-4><span class=linenos data-linenos=" 4 "></span></a>    <span class=n>severity</span><span class=p>:</span> <span class=n>Severity</span>  <span class=c1># LOW, MEDIUM, HIGH, CRITICAL</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5></a><a href=#__codelineno-3-5><span class=linenos data-linenos=" 5 "></span></a>    <span class=n>cycles</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>   <span class=c1># Affected cycle IDs</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6></a><a href=#__codelineno-3-6><span class=linenos data-linenos=" 6 "></span></a>    <span class=n>resources</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>  <span class=c1># Conflicting resources</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7></a><a href=#__codelineno-3-7><span class=linenos data-linenos=" 7 "></span></a>    <span class=n>suggested_resolution</span><span class=p>:</span> <span class=n>ResolutionStrategy</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8></a><a href=#__codelineno-3-8><span class=linenos data-linenos=" 8 "></span></a>    
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9></a><a href=#__codelineno-3-9><span class=linenos data-linenos=" 9 "></span></a><span class=k>class</span> <span class=nc>ConflictDetector</span><span class=p>:</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10></a><a href=#__codelineno-3-10><span class=linenos data-linenos="10 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>analyze_static_conflicts</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycle1</span><span class=p>:</span> <span class=n>TDDCycle</span><span class=p>,</span> <span class=n>cycle2</span><span class=p>:</span> <span class=n>TDDCycle</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Conflict</span><span class=p>]</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11></a><a href=#__codelineno-3-11><span class=linenos data-linenos="11 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>monitor_runtime_conflicts</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>AsyncIterator</span><span class=p>[</span><span class=n>Conflict</span><span class=p>]</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12></a><a href=#__codelineno-3-12><span class=linenos data-linenos="12 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>predict_future_conflicts</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>scheduled_cycles</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>TDDCycle</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Conflict</span><span class=p>]</span>
</span></code></pre></div></p><h3 id=5-parallel-context-isolator>5. Parallel Context Isolator<a class=headerlink href=#5-parallel-context-isolator title="Permanent link">&para;</a></h3><p><strong>Responsibilities:</strong> - Isolate context between parallel cycles - Share common project knowledge efficiently - Manage token budget across parallel agents - Prevent context contamination</p><p><strong>Context Isolation Model:</strong><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1></a><a href=#__codelineno-4-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>class</span> <span class=nc>ParallelContextIsolator</span><span class=p>:</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2></a><a href=#__codelineno-4-2><span class=linenos data-linenos=" 2 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>base_context</span><span class=p>:</span> <span class=n>ProjectContext</span><span class=p>):</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3></a><a href=#__codelineno-4-3><span class=linenos data-linenos=" 3 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>shared_context</span> <span class=o>=</span> <span class=n>base_context</span>  <span class=c1># Read-only shared knowledge</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4></a><a href=#__codelineno-4-4><span class=linenos data-linenos=" 4 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>cycle_contexts</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>CycleContext</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5></a><a href=#__codelineno-4-5><span class=linenos data-linenos=" 5 "></span></a>        
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6></a><a href=#__codelineno-4-6><span class=linenos data-linenos=" 6 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>create_isolated_context</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycle_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>CycleContext</span><span class=p>:</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7></a><a href=#__codelineno-4-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create isolated context for a TDD cycle&quot;&quot;&quot;</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8></a><a href=#__codelineno-4-8><span class=linenos data-linenos=" 8 "></span></a>        <span class=n>context</span> <span class=o>=</span> <span class=n>CycleContext</span><span class=p>(</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9></a><a href=#__codelineno-4-9><span class=linenos data-linenos=" 9 "></span></a>            <span class=n>cycle_id</span><span class=o>=</span><span class=n>cycle_id</span><span class=p>,</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10></a><a href=#__codelineno-4-10><span class=linenos data-linenos="10 "></span></a>            <span class=n>shared_knowledge</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>shared_context</span><span class=o>.</span><span class=n>get_readonly_view</span><span class=p>(),</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11></a><a href=#__codelineno-4-11><span class=linenos data-linenos="11 "></span></a>            <span class=n>token_budget</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>calculate_token_allocation</span><span class=p>(</span><span class=n>cycle_id</span><span class=p>),</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12></a><a href=#__codelineno-4-12><span class=linenos data-linenos="12 "></span></a>            <span class=n>file_scope</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>determine_file_scope</span><span class=p>(</span><span class=n>cycle_id</span><span class=p>)</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13></a><a href=#__codelineno-4-13><span class=linenos data-linenos="13 "></span></a>        <span class=p>)</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14></a><a href=#__codelineno-4-14><span class=linenos data-linenos="14 "></span></a>        <span class=k>return</span> <span class=n>context</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15></a><a href=#__codelineno-4-15><span class=linenos data-linenos="15 "></span></a>        
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16></a><a href=#__codelineno-4-16><span class=linenos data-linenos="16 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>merge_context_changes</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycle_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17></a><a href=#__codelineno-4-17><span class=linenos data-linenos="17 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Merge cycle context changes back to shared knowledge&quot;&quot;&quot;</span>
</span></code></pre></div></p><h2 id=concurrency-architecture>Concurrency Architecture<a class=headerlink href=#concurrency-architecture title="Permanent link">&para;</a></h2><h3 id=execution-models>Execution Models<a class=headerlink href=#execution-models title="Permanent link">&para;</a></h3><h4 id=1-work-stealing-model>1. Work-Stealing Model<a class=headerlink href=#1-work-stealing-model title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1></a><a href=#__codelineno-5-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>class</span> <span class=nc>WorkStealingScheduler</span><span class=p>:</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2></a><a href=#__codelineno-5-2><span class=linenos data-linenos=" 2 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Agents steal work from other queues when idle&quot;&quot;&quot;</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3></a><a href=#__codelineno-5-3><span class=linenos data-linenos=" 3 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>worker_count</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4></a><a href=#__codelineno-5-4><span class=linenos data-linenos=" 4 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>work_queues</span> <span class=o>=</span> <span class=p>[</span><span class=n>deque</span><span class=p>()</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>worker_count</span><span class=p>)]</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5></a><a href=#__codelineno-5-5><span class=linenos data-linenos=" 5 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>workers</span> <span class=o>=</span> <span class=p>[</span><span class=n>Worker</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>work_queues</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>worker_count</span><span class=p>)]</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6></a><a href=#__codelineno-5-6><span class=linenos data-linenos=" 6 "></span></a>        
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7></a><a href=#__codelineno-5-7><span class=linenos data-linenos=" 7 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>schedule_task</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>task</span><span class=p>:</span> <span class=n>TDDTask</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8></a><a href=#__codelineno-5-8><span class=linenos data-linenos=" 8 "></span></a>        <span class=c1># Find least loaded queue</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9></a><a href=#__codelineno-5-9><span class=linenos data-linenos=" 9 "></span></a>        <span class=n>min_queue</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>work_queues</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=nb>len</span><span class=p>)</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10></a><a href=#__codelineno-5-10><span class=linenos data-linenos="10 "></span></a>        <span class=n>min_queue</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>task</span><span class=p>)</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11></a><a href=#__codelineno-5-11><span class=linenos data-linenos="11 "></span></a>        
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12></a><a href=#__codelineno-5-12><span class=linenos data-linenos="12 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>steal_work</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>worker_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>TDDTask</span><span class=p>]:</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13></a><a href=#__codelineno-5-13><span class=linenos data-linenos="13 "></span></a>        <span class=c1># Steal from longest queue</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14></a><a href=#__codelineno-5-14><span class=linenos data-linenos="14 "></span></a>        <span class=n>max_queue</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>work_queues</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=nb>len</span><span class=p>)</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15></a><a href=#__codelineno-5-15><span class=linenos data-linenos="15 "></span></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>max_queue</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16></a><a href=#__codelineno-5-16><span class=linenos data-linenos="16 "></span></a>            <span class=k>return</span> <span class=n>max_queue</span><span class=o>.</span><span class=n>popleft</span><span class=p>()</span>
</span></code></pre></div><h4 id=2-pipeline-model>2. Pipeline Model<a class=headerlink href=#2-pipeline-model title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1></a><a href=#__codelineno-6-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>class</span> <span class=nc>PipelineScheduler</span><span class=p>:</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2></a><a href=#__codelineno-6-2><span class=linenos data-linenos=" 2 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Pipeline TDD phases across multiple cycles&quot;&quot;&quot;</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3></a><a href=#__codelineno-6-3><span class=linenos data-linenos=" 3 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4></a><a href=#__codelineno-6-4><span class=linenos data-linenos=" 4 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>phase_queues</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5></a><a href=#__codelineno-6-5><span class=linenos data-linenos=" 5 "></span></a>            <span class=n>TDDState</span><span class=o>.</span><span class=n>DESIGN</span><span class=p>:</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>Queue</span><span class=p>(),</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6></a><a href=#__codelineno-6-6><span class=linenos data-linenos=" 6 "></span></a>            <span class=n>TDDState</span><span class=o>.</span><span class=n>TEST_RED</span><span class=p>:</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>Queue</span><span class=p>(),</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7></a><a href=#__codelineno-6-7><span class=linenos data-linenos=" 7 "></span></a>            <span class=n>TDDState</span><span class=o>.</span><span class=n>CODE_GREEN</span><span class=p>:</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>Queue</span><span class=p>(),</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8></a><a href=#__codelineno-6-8><span class=linenos data-linenos=" 8 "></span></a>            <span class=n>TDDState</span><span class=o>.</span><span class=n>REFACTOR</span><span class=p>:</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>Queue</span><span class=p>()</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9></a><a href=#__codelineno-6-9><span class=linenos data-linenos=" 9 "></span></a>        <span class=p>}</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10></a><a href=#__codelineno-6-10><span class=linenos data-linenos="10 "></span></a>        
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11></a><a href=#__codelineno-6-11><span class=linenos data-linenos="11 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>schedule_phase</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycle</span><span class=p>:</span> <span class=n>TDDCycle</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12></a><a href=#__codelineno-6-12><span class=linenos data-linenos="12 "></span></a>        <span class=n>current_phase</span> <span class=o>=</span> <span class=n>cycle</span><span class=o>.</span><span class=n>current_state</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13></a><a href=#__codelineno-6-13><span class=linenos data-linenos="13 "></span></a>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>phase_queues</span><span class=p>[</span><span class=n>current_phase</span><span class=p>]</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>cycle</span><span class=p>)</span>
</span></code></pre></div><h3 id=conflict-resolution-strategies>Conflict Resolution Strategies<a class=headerlink href=#conflict-resolution-strategies title="Permanent link">&para;</a></h3><h4 id=1-file-level-locking>1. File-Level Locking<a class=headerlink href=#1-file-level-locking title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1></a><a href=#__codelineno-7-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>class</span> <span class=nc>FileLockManager</span><span class=p>:</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2></a><a href=#__codelineno-7-2><span class=linenos data-linenos=" 2 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3></a><a href=#__codelineno-7-3><span class=linenos data-linenos=" 3 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>file_locks</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>FileLock</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4></a><a href=#__codelineno-7-4><span class=linenos data-linenos=" 4 "></span></a>        
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5></a><a href=#__codelineno-7-5><span class=linenos data-linenos=" 5 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>acquire_files</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_paths</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>cycle_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>FileLock</span><span class=p>]:</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6></a><a href=#__codelineno-7-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Acquire locks for multiple files atomically&quot;&quot;&quot;</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7></a><a href=#__codelineno-7-7><span class=linenos data-linenos=" 7 "></span></a>        <span class=n>locks</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8></a><a href=#__codelineno-7-8><span class=linenos data-linenos=" 8 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9></a><a href=#__codelineno-7-9><span class=linenos data-linenos=" 9 "></span></a>            <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>file_paths</span><span class=p>):</span>  <span class=c1># Sort to prevent deadlock</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10></a><a href=#__codelineno-7-10><span class=linenos data-linenos="10 "></span></a>                <span class=n>lock</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>acquire_file</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>cycle_id</span><span class=p>)</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11></a><a href=#__codelineno-7-11><span class=linenos data-linenos="11 "></span></a>                <span class=n>locks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>lock</span><span class=p>)</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12></a><a href=#__codelineno-7-12><span class=linenos data-linenos="12 "></span></a>            <span class=k>return</span> <span class=n>locks</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13></a><a href=#__codelineno-7-13><span class=linenos data-linenos="13 "></span></a>        <span class=k>except</span> <span class=n>LockTimeout</span><span class=p>:</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14></a><a href=#__codelineno-7-14><span class=linenos data-linenos="14 "></span></a>            <span class=c1># Release all acquired locks on failure</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15></a><a href=#__codelineno-7-15><span class=linenos data-linenos="15 "></span></a>            <span class=k>for</span> <span class=n>lock</span> <span class=ow>in</span> <span class=n>locks</span><span class=p>:</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16></a><a href=#__codelineno-7-16><span class=linenos data-linenos="16 "></span></a>                <span class=k>await</span> <span class=n>lock</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17></a><a href=#__codelineno-7-17><span class=linenos data-linenos="17 "></span></a>            <span class=k>raise</span>
</span></code></pre></div><h4 id=2-optimistic-concurrency-control>2. Optimistic Concurrency Control<a class=headerlink href=#2-optimistic-concurrency-control title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1></a><a href=#__codelineno-8-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>class</span> <span class=nc>OptimisticConcurrencyManager</span><span class=p>:</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2></a><a href=#__codelineno-8-2><span class=linenos data-linenos=" 2 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>validate_changes</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycle_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>changes</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>FileChange</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3></a><a href=#__codelineno-8-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Validate changes haven&#39;t conflicted with other cycles&quot;&quot;&quot;</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4></a><a href=#__codelineno-8-4><span class=linenos data-linenos=" 4 "></span></a>        <span class=k>for</span> <span class=n>file_path</span><span class=p>,</span> <span class=n>change</span> <span class=ow>in</span> <span class=n>changes</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5></a><a href=#__codelineno-8-5><span class=linenos data-linenos=" 5 "></span></a>            <span class=n>current_version</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_file_version</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6></a><a href=#__codelineno-8-6><span class=linenos data-linenos=" 6 "></span></a>            <span class=k>if</span> <span class=n>current_version</span> <span class=o>!=</span> <span class=n>change</span><span class=o>.</span><span class=n>base_version</span><span class=p>:</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7></a><a href=#__codelineno-8-7><span class=linenos data-linenos=" 7 "></span></a>                <span class=c1># Conflict detected - attempt auto-merge</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8></a><a href=#__codelineno-8-8><span class=linenos data-linenos=" 8 "></span></a>                <span class=k>if</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>can_auto_merge</span><span class=p>(</span><span class=n>change</span><span class=p>,</span> <span class=n>current_version</span><span class=p>):</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9></a><a href=#__codelineno-8-9><span class=linenos data-linenos=" 9 "></span></a>                    <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>auto_merge</span><span class=p>(</span><span class=n>change</span><span class=p>,</span> <span class=n>current_version</span><span class=p>)</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10></a><a href=#__codelineno-8-10><span class=linenos data-linenos="10 "></span></a>                <span class=k>else</span><span class=p>:</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11></a><a href=#__codelineno-8-11><span class=linenos data-linenos="11 "></span></a>                    <span class=k>return</span> <span class=kc>False</span>  <span class=c1># Manual resolution required</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12></a><a href=#__codelineno-8-12><span class=linenos data-linenos="12 "></span></a>        <span class=k>return</span> <span class=kc>True</span>
</span></code></pre></div><h4 id=3-dependency-based-scheduling>3. Dependency-Based Scheduling<a class=headerlink href=#3-dependency-based-scheduling title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1></a><a href=#__codelineno-9-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>class</span> <span class=nc>DependencyScheduler</span><span class=p>:</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2></a><a href=#__codelineno-9-2><span class=linenos data-linenos=" 2 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3></a><a href=#__codelineno-9-3><span class=linenos data-linenos=" 3 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>dependency_graph</span> <span class=o>=</span> <span class=n>nx</span><span class=o>.</span><span class=n>DiGraph</span><span class=p>()</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4></a><a href=#__codelineno-9-4><span class=linenos data-linenos=" 4 "></span></a>        
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5></a><a href=#__codelineno-9-5><span class=linenos data-linenos=" 5 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>add_cycle_dependencies</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycle</span><span class=p>:</span> <span class=n>TDDCycle</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6></a><a href=#__codelineno-9-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Add cycle to dependency graph&quot;&quot;&quot;</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7></a><a href=#__codelineno-9-7><span class=linenos data-linenos=" 7 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>dependency_graph</span><span class=o>.</span><span class=n>add_node</span><span class=p>(</span><span class=n>cycle</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>cycle</span><span class=o>=</span><span class=n>cycle</span><span class=p>)</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8></a><a href=#__codelineno-9-8><span class=linenos data-linenos=" 8 "></span></a>        
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9></a><a href=#__codelineno-9-9><span class=linenos data-linenos=" 9 "></span></a>        <span class=c1># Add edges for dependencies</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10></a><a href=#__codelineno-9-10><span class=linenos data-linenos="10 "></span></a>        <span class=k>for</span> <span class=n>dep_story_id</span> <span class=ow>in</span> <span class=n>cycle</span><span class=o>.</span><span class=n>depends_on</span><span class=p>:</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11></a><a href=#__codelineno-9-11><span class=linenos data-linenos="11 "></span></a>            <span class=n>dep_cycle</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_cycle_for_story</span><span class=p>(</span><span class=n>dep_story_id</span><span class=p>)</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12></a><a href=#__codelineno-9-12><span class=linenos data-linenos="12 "></span></a>            <span class=k>if</span> <span class=n>dep_cycle</span><span class=p>:</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13></a><a href=#__codelineno-9-13><span class=linenos data-linenos="13 "></span></a>                <span class=bp>self</span><span class=o>.</span><span class=n>dependency_graph</span><span class=o>.</span><span class=n>add_edge</span><span class=p>(</span><span class=n>dep_cycle</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>cycle</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14></a><a href=#__codelineno-9-14><span class=linenos data-linenos="14 "></span></a>                
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15></a><a href=#__codelineno-9-15><span class=linenos data-linenos="15 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_schedulable_cycles</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>TDDCycle</span><span class=p>]:</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16></a><a href=#__codelineno-9-16><span class=linenos data-linenos="16 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get cycles that can be scheduled (no pending dependencies)&quot;&quot;&quot;</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17></a><a href=#__codelineno-9-17><span class=linenos data-linenos="17 "></span></a>        <span class=n>schedulable</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18></a><a href=#__codelineno-9-18><span class=linenos data-linenos="18 "></span></a>        <span class=k>for</span> <span class=n>node</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>dependency_graph</span><span class=o>.</span><span class=n>nodes</span><span class=p>():</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19></a><a href=#__codelineno-9-19><span class=linenos data-linenos="19 "></span></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>dependency_graph</span><span class=o>.</span><span class=n>in_degree</span><span class=p>(</span><span class=n>node</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20></a><a href=#__codelineno-9-20><span class=linenos data-linenos="20 "></span></a>                <span class=n>cycle</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dependency_graph</span><span class=o>.</span><span class=n>nodes</span><span class=p>[</span><span class=n>node</span><span class=p>][</span><span class=s1>&#39;cycle&#39;</span><span class=p>]</span>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21></a><a href=#__codelineno-9-21><span class=linenos data-linenos="21 "></span></a>                <span class=k>if</span> <span class=n>cycle</span><span class=o>.</span><span class=n>current_state</span> <span class=o>!=</span> <span class=n>TDDState</span><span class=o>.</span><span class=n>COMMIT</span><span class=p>:</span>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22></a><a href=#__codelineno-9-22><span class=linenos data-linenos="22 "></span></a>                    <span class=n>schedulable</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>cycle</span><span class=p>)</span>
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23></a><a href=#__codelineno-9-23><span class=linenos data-linenos="23 "></span></a>        <span class=k>return</span> <span class=n>schedulable</span>
</span></code></pre></div><h2 id=resource-management>Resource Management<a class=headerlink href=#resource-management title="Permanent link">&para;</a></h2><h3 id=agent-pool-scaling>Agent Pool Scaling<a class=headerlink href=#agent-pool-scaling title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1></a><a href=#__codelineno-10-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>class</span> <span class=nc>DynamicAgentScaler</span><span class=p>:</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2></a><a href=#__codelineno-10-2><span class=linenos data-linenos=" 2 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>metrics_provider</span><span class=p>:</span> <span class=n>MetricsProvider</span><span class=p>):</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3></a><a href=#__codelineno-10-3><span class=linenos data-linenos=" 3 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span> <span class=o>=</span> <span class=n>metrics_provider</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4></a><a href=#__codelineno-10-4><span class=linenos data-linenos=" 4 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>scaling_decisions</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5></a><a href=#__codelineno-10-5><span class=linenos data-linenos=" 5 "></span></a>        
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6></a><a href=#__codelineno-10-6><span class=linenos data-linenos=" 6 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>calculate_optimal_pool_size</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>agent_type</span><span class=p>:</span> <span class=n>AgentType</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7></a><a href=#__codelineno-10-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculate optimal pool size based on metrics&quot;&quot;&quot;</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8></a><a href=#__codelineno-10-8><span class=linenos data-linenos=" 8 "></span></a>        <span class=n>current_size</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_current_pool_size</span><span class=p>(</span><span class=n>agent_type</span><span class=p>)</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9></a><a href=#__codelineno-10-9><span class=linenos data-linenos=" 9 "></span></a>        <span class=n>pending_tasks</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>get_pending_tasks</span><span class=p>(</span><span class=n>agent_type</span><span class=p>)</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10></a><a href=#__codelineno-10-10><span class=linenos data-linenos="10 "></span></a>        <span class=n>avg_task_duration</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>get_avg_task_duration</span><span class=p>(</span><span class=n>agent_type</span><span class=p>)</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11></a><a href=#__codelineno-10-11><span class=linenos data-linenos="11 "></span></a>        <span class=n>current_utilization</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>get_utilization</span><span class=p>(</span><span class=n>agent_type</span><span class=p>)</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12></a><a href=#__codelineno-10-12><span class=linenos data-linenos="12 "></span></a>        
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13></a><a href=#__codelineno-10-13><span class=linenos data-linenos="13 "></span></a>        <span class=c1># Scaling algorithm</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14></a><a href=#__codelineno-10-14><span class=linenos data-linenos="14 "></span></a>        <span class=k>if</span> <span class=n>current_utilization</span> <span class=o>&gt;</span> <span class=mf>0.8</span> <span class=ow>and</span> <span class=n>pending_tasks</span> <span class=o>&gt;</span> <span class=n>current_size</span><span class=p>:</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15></a><a href=#__codelineno-10-15><span class=linenos data-linenos="15 "></span></a>            <span class=c1># Scale up</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16></a><a href=#__codelineno-10-16><span class=linenos data-linenos="16 "></span></a>            <span class=k>return</span> <span class=nb>min</span><span class=p>(</span><span class=n>current_size</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>MAX_POOL_SIZE</span><span class=p>)</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17></a><a href=#__codelineno-10-17><span class=linenos data-linenos="17 "></span></a>        <span class=k>elif</span> <span class=n>current_utilization</span> <span class=o>&lt;</span> <span class=mf>0.3</span> <span class=ow>and</span> <span class=n>current_size</span> <span class=o>&gt;</span> <span class=n>MIN_POOL_SIZE</span><span class=p>:</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18></a><a href=#__codelineno-10-18><span class=linenos data-linenos="18 "></span></a>            <span class=c1># Scale down</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19></a><a href=#__codelineno-10-19><span class=linenos data-linenos="19 "></span></a>            <span class=k>return</span> <span class=n>current_size</span> <span class=o>-</span> <span class=mi>1</span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20></a><a href=#__codelineno-10-20><span class=linenos data-linenos="20 "></span></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21></a><a href=#__codelineno-10-21><span class=linenos data-linenos="21 "></span></a>            <span class=k>return</span> <span class=n>current_size</span>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22></a><a href=#__codelineno-10-22><span class=linenos data-linenos="22 "></span></a>            
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23></a><a href=#__codelineno-10-23><span class=linenos data-linenos="23 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>apply_scaling_decision</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>agent_type</span><span class=p>:</span> <span class=n>AgentType</span><span class=p>,</span> <span class=n>target_size</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24></a><a href=#__codelineno-10-24><span class=linenos data-linenos="24 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Apply scaling decision with gradual rollout&quot;&quot;&quot;</span>
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25></a><a href=#__codelineno-10-25><span class=linenos data-linenos="25 "></span></a>        <span class=n>current_size</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_current_pool_size</span><span class=p>(</span><span class=n>agent_type</span><span class=p>)</span>
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26></a><a href=#__codelineno-10-26><span class=linenos data-linenos="26 "></span></a>        
</span><span id=__span-10-27><a id=__codelineno-10-27 name=__codelineno-10-27></a><a href=#__codelineno-10-27><span class=linenos data-linenos="27 "></span></a>        <span class=k>if</span> <span class=n>target_size</span> <span class=o>&gt;</span> <span class=n>current_size</span><span class=p>:</span>
</span><span id=__span-10-28><a id=__codelineno-10-28 name=__codelineno-10-28></a><a href=#__codelineno-10-28><span class=linenos data-linenos="28 "></span></a>            <span class=c1># Scale up gradually</span>
</span><span id=__span-10-29><a id=__codelineno-10-29 name=__codelineno-10-29></a><a href=#__codelineno-10-29><span class=linenos data-linenos="29 "></span></a>            <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>target_size</span> <span class=o>-</span> <span class=n>current_size</span><span class=p>):</span>
</span><span id=__span-10-30><a id=__codelineno-10-30 name=__codelineno-10-30></a><a href=#__codelineno-10-30><span class=linenos data-linenos="30 "></span></a>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>add_agent_to_pool</span><span class=p>(</span><span class=n>agent_type</span><span class=p>)</span>
</span><span id=__span-10-31><a id=__codelineno-10-31 name=__codelineno-10-31></a><a href=#__codelineno-10-31><span class=linenos data-linenos="31 "></span></a>                <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>  <span class=c1># Gradual rollout</span>
</span><span id=__span-10-32><a id=__codelineno-10-32 name=__codelineno-10-32></a><a href=#__codelineno-10-32><span class=linenos data-linenos="32 "></span></a>        <span class=k>elif</span> <span class=n>target_size</span> <span class=o>&lt;</span> <span class=n>current_size</span><span class=p>:</span>
</span><span id=__span-10-33><a id=__codelineno-10-33 name=__codelineno-10-33></a><a href=#__codelineno-10-33><span class=linenos data-linenos="33 "></span></a>            <span class=c1># Scale down gracefully</span>
</span><span id=__span-10-34><a id=__codelineno-10-34 name=__codelineno-10-34></a><a href=#__codelineno-10-34><span class=linenos data-linenos="34 "></span></a>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>mark_agents_for_removal</span><span class=p>(</span><span class=n>agent_type</span><span class=p>,</span> <span class=n>current_size</span> <span class=o>-</span> <span class=n>target_size</span><span class=p>)</span>
</span></code></pre></div><h3 id=token-budget-distribution>Token Budget Distribution<a class=headerlink href=#token-budget-distribution title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1></a><a href=#__codelineno-11-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>class</span> <span class=nc>ParallelTokenBudgetManager</span><span class=p>:</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2></a><a href=#__codelineno-11-2><span class=linenos data-linenos=" 2 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>total_budget</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>200000</span><span class=p>):</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3></a><a href=#__codelineno-11-3><span class=linenos data-linenos=" 3 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>total_budget</span> <span class=o>=</span> <span class=n>total_budget</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4></a><a href=#__codelineno-11-4><span class=linenos data-linenos=" 4 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>allocated_budgets</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5></a><a href=#__codelineno-11-5><span class=linenos data-linenos=" 5 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>usage_history</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]]</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>list</span><span class=p>)</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6></a><a href=#__codelineno-11-6><span class=linenos data-linenos=" 6 "></span></a>        
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7></a><a href=#__codelineno-11-7><span class=linenos data-linenos=" 7 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>allocate_budget</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycle_ids</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>]:</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8></a><a href=#__codelineno-11-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Allocate token budget across parallel cycles&quot;&quot;&quot;</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9></a><a href=#__codelineno-11-9><span class=linenos data-linenos=" 9 "></span></a>        <span class=n>num_cycles</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>cycle_ids</span><span class=p>)</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10></a><a href=#__codelineno-11-10><span class=linenos data-linenos="10 "></span></a>        
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11></a><a href=#__codelineno-11-11><span class=linenos data-linenos="11 "></span></a>        <span class=c1># Base allocation strategy</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12></a><a href=#__codelineno-11-12><span class=linenos data-linenos="12 "></span></a>        <span class=n>base_allocation</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>total_budget</span> <span class=o>//</span> <span class=p>(</span><span class=n>num_cycles</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>  <span class=c1># +1 for buffer</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13></a><a href=#__codelineno-11-13><span class=linenos data-linenos="13 "></span></a>        
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14></a><a href=#__codelineno-11-14><span class=linenos data-linenos="14 "></span></a>        <span class=c1># Adjust based on historical usage</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15></a><a href=#__codelineno-11-15><span class=linenos data-linenos="15 "></span></a>        <span class=n>allocations</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16></a><a href=#__codelineno-11-16><span class=linenos data-linenos="16 "></span></a>        <span class=k>for</span> <span class=n>cycle_id</span> <span class=ow>in</span> <span class=n>cycle_ids</span><span class=p>:</span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17></a><a href=#__codelineno-11-17><span class=linenos data-linenos="17 "></span></a>            <span class=n>cycle_history</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>usage_history</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>cycle_id</span><span class=p>,</span> <span class=p>[])</span>
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18></a><a href=#__codelineno-11-18><span class=linenos data-linenos="18 "></span></a>            <span class=k>if</span> <span class=n>cycle_history</span><span class=p>:</span>
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19></a><a href=#__codelineno-11-19><span class=linenos data-linenos="19 "></span></a>                <span class=c1># Use 95th percentile of historical usage</span>
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20></a><a href=#__codelineno-11-20><span class=linenos data-linenos="20 "></span></a>                <span class=n>historical_need</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>percentile</span><span class=p>(</span><span class=n>cycle_history</span><span class=p>,</span> <span class=mi>95</span><span class=p>)</span>
</span><span id=__span-11-21><a id=__codelineno-11-21 name=__codelineno-11-21></a><a href=#__codelineno-11-21><span class=linenos data-linenos="21 "></span></a>                <span class=n>allocations</span><span class=p>[</span><span class=n>cycle_id</span><span class=p>]</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span>
</span><span id=__span-11-22><a id=__codelineno-11-22 name=__codelineno-11-22></a><a href=#__codelineno-11-22><span class=linenos data-linenos="22 "></span></a>                    <span class=nb>int</span><span class=p>(</span><span class=n>historical_need</span> <span class=o>*</span> <span class=mf>1.1</span><span class=p>),</span>  <span class=c1># 10% buffer</span>
</span><span id=__span-11-23><a id=__codelineno-11-23 name=__codelineno-11-23></a><a href=#__codelineno-11-23><span class=linenos data-linenos="23 "></span></a>                    <span class=n>base_allocation</span> <span class=o>*</span> <span class=mf>1.5</span>  <span class=c1># Max 50% above base</span>
</span><span id=__span-11-24><a id=__codelineno-11-24 name=__codelineno-11-24></a><a href=#__codelineno-11-24><span class=linenos data-linenos="24 "></span></a>                <span class=p>)</span>
</span><span id=__span-11-25><a id=__codelineno-11-25 name=__codelineno-11-25></a><a href=#__codelineno-11-25><span class=linenos data-linenos="25 "></span></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-11-26><a id=__codelineno-11-26 name=__codelineno-11-26></a><a href=#__codelineno-11-26><span class=linenos data-linenos="26 "></span></a>                <span class=n>allocations</span><span class=p>[</span><span class=n>cycle_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>base_allocation</span>
</span><span id=__span-11-27><a id=__codelineno-11-27 name=__codelineno-11-27></a><a href=#__codelineno-11-27><span class=linenos data-linenos="27 "></span></a>                
</span><span id=__span-11-28><a id=__codelineno-11-28 name=__codelineno-11-28></a><a href=#__codelineno-11-28><span class=linenos data-linenos="28 "></span></a>        <span class=c1># Ensure we don&#39;t exceed total budget</span>
</span><span id=__span-11-29><a id=__codelineno-11-29 name=__codelineno-11-29></a><a href=#__codelineno-11-29><span class=linenos data-linenos="29 "></span></a>        <span class=n>total_allocated</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>allocations</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
</span><span id=__span-11-30><a id=__codelineno-11-30 name=__codelineno-11-30></a><a href=#__codelineno-11-30><span class=linenos data-linenos="30 "></span></a>        <span class=k>if</span> <span class=n>total_allocated</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>total_budget</span> <span class=o>*</span> <span class=mf>0.9</span><span class=p>:</span>  <span class=c1># Keep 10% buffer</span>
</span><span id=__span-11-31><a id=__codelineno-11-31 name=__codelineno-11-31></a><a href=#__codelineno-11-31><span class=linenos data-linenos="31 "></span></a>            <span class=c1># Scale down proportionally</span>
</span><span id=__span-11-32><a id=__codelineno-11-32 name=__codelineno-11-32></a><a href=#__codelineno-11-32><span class=linenos data-linenos="32 "></span></a>            <span class=n>scale_factor</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>total_budget</span> <span class=o>*</span> <span class=mf>0.9</span><span class=p>)</span> <span class=o>/</span> <span class=n>total_allocated</span>
</span><span id=__span-11-33><a id=__codelineno-11-33 name=__codelineno-11-33></a><a href=#__codelineno-11-33><span class=linenos data-linenos="33 "></span></a>            <span class=k>for</span> <span class=n>cycle_id</span> <span class=ow>in</span> <span class=n>allocations</span><span class=p>:</span>
</span><span id=__span-11-34><a id=__codelineno-11-34 name=__codelineno-11-34></a><a href=#__codelineno-11-34><span class=linenos data-linenos="34 "></span></a>                <span class=n>allocations</span><span class=p>[</span><span class=n>cycle_id</span><span class=p>]</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>allocations</span><span class=p>[</span><span class=n>cycle_id</span><span class=p>]</span> <span class=o>*</span> <span class=n>scale_factor</span><span class=p>)</span>
</span><span id=__span-11-35><a id=__codelineno-11-35 name=__codelineno-11-35></a><a href=#__codelineno-11-35><span class=linenos data-linenos="35 "></span></a>                
</span><span id=__span-11-36><a id=__codelineno-11-36 name=__codelineno-11-36></a><a href=#__codelineno-11-36><span class=linenos data-linenos="36 "></span></a>        <span class=k>return</span> <span class=n>allocations</span>
</span></code></pre></div><h2 id=test-execution-coordination>Test Execution Coordination<a class=headerlink href=#test-execution-coordination title="Permanent link">&para;</a></h2><h3 id=parallel-test-runner>Parallel Test Runner<a class=headerlink href=#parallel-test-runner title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1></a><a href=#__codelineno-12-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>class</span> <span class=nc>ParallelTestCoordinator</span><span class=p>:</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2></a><a href=#__codelineno-12-2><span class=linenos data-linenos=" 2 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>max_parallel_suites</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>):</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3></a><a href=#__codelineno-12-3><span class=linenos data-linenos=" 3 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>max_parallel</span> <span class=o>=</span> <span class=n>max_parallel_suites</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4></a><a href=#__codelineno-12-4><span class=linenos data-linenos=" 4 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>test_environments</span> <span class=o>=</span> <span class=n>TestEnvironmentPool</span><span class=p>(</span><span class=n>max_parallel</span><span class=p>)</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5></a><a href=#__codelineno-12-5><span class=linenos data-linenos=" 5 "></span></a>        
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6></a><a href=#__codelineno-12-6><span class=linenos data-linenos=" 6 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>run_parallel_test_suites</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>test_suites</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>TestSuite</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>TestResults</span><span class=p>:</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7></a><a href=#__codelineno-12-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Run multiple test suites in parallel with isolation&quot;&quot;&quot;</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8></a><a href=#__codelineno-12-8><span class=linenos data-linenos=" 8 "></span></a>        <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9></a><a href=#__codelineno-12-9><span class=linenos data-linenos=" 9 "></span></a>        
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10></a><a href=#__codelineno-12-10><span class=linenos data-linenos="10 "></span></a>        <span class=c1># Group test suites by potential conflicts</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11></a><a href=#__codelineno-12-11><span class=linenos data-linenos="11 "></span></a>        <span class=n>suite_groups</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>group_by_conflicts</span><span class=p>(</span><span class=n>test_suites</span><span class=p>)</span>
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12></a><a href=#__codelineno-12-12><span class=linenos data-linenos="12 "></span></a>        
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13></a><a href=#__codelineno-12-13><span class=linenos data-linenos="13 "></span></a>        <span class=k>for</span> <span class=n>group</span> <span class=ow>in</span> <span class=n>suite_groups</span><span class=p>:</span>
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14></a><a href=#__codelineno-12-14><span class=linenos data-linenos="14 "></span></a>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>group</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15></a><a href=#__codelineno-12-15><span class=linenos data-linenos="15 "></span></a>                <span class=c1># No conflicts - run directly</span>
</span><span id=__span-12-16><a id=__codelineno-12-16 name=__codelineno-12-16></a><a href=#__codelineno-12-16><span class=linenos data-linenos="16 "></span></a>                <span class=n>env</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>test_environments</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span><span id=__span-12-17><a id=__codelineno-12-17 name=__codelineno-12-17></a><a href=#__codelineno-12-17><span class=linenos data-linenos="17 "></span></a>                <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>run_suite_isolated</span><span class=p>(</span><span class=n>group</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>env</span><span class=p>)</span>
</span><span id=__span-12-18><a id=__codelineno-12-18 name=__codelineno-12-18></a><a href=#__codelineno-12-18><span class=linenos data-linenos="18 "></span></a>                <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span><span id=__span-12-19><a id=__codelineno-12-19 name=__codelineno-12-19></a><a href=#__codelineno-12-19><span class=linenos data-linenos="19 "></span></a>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>test_environments</span><span class=o>.</span><span class=n>release</span><span class=p>(</span><span class=n>env</span><span class=p>)</span>
</span><span id=__span-12-20><a id=__codelineno-12-20 name=__codelineno-12-20></a><a href=#__codelineno-12-20><span class=linenos data-linenos="20 "></span></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-12-21><a id=__codelineno-12-21 name=__codelineno-12-21></a><a href=#__codelineno-12-21><span class=linenos data-linenos="21 "></span></a>                <span class=c1># Potential conflicts - run sequentially within group</span>
</span><span id=__span-12-22><a id=__codelineno-12-22 name=__codelineno-12-22></a><a href=#__codelineno-12-22><span class=linenos data-linenos="22 "></span></a>                <span class=k>for</span> <span class=n>suite</span> <span class=ow>in</span> <span class=n>group</span><span class=p>:</span>
</span><span id=__span-12-23><a id=__codelineno-12-23 name=__codelineno-12-23></a><a href=#__codelineno-12-23><span class=linenos data-linenos="23 "></span></a>                    <span class=n>env</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>test_environments</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
</span><span id=__span-12-24><a id=__codelineno-12-24 name=__codelineno-12-24></a><a href=#__codelineno-12-24><span class=linenos data-linenos="24 "></span></a>                    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>run_suite_isolated</span><span class=p>(</span><span class=n>suite</span><span class=p>,</span> <span class=n>env</span><span class=p>)</span>
</span><span id=__span-12-25><a id=__codelineno-12-25 name=__codelineno-12-25></a><a href=#__codelineno-12-25><span class=linenos data-linenos="25 "></span></a>                    <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span><span id=__span-12-26><a id=__codelineno-12-26 name=__codelineno-12-26></a><a href=#__codelineno-12-26><span class=linenos data-linenos="26 "></span></a>                    <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>test_environments</span><span class=o>.</span><span class=n>release</span><span class=p>(</span><span class=n>env</span><span class=p>)</span>
</span><span id=__span-12-27><a id=__codelineno-12-27 name=__codelineno-12-27></a><a href=#__codelineno-12-27><span class=linenos data-linenos="27 "></span></a>                    
</span><span id=__span-12-28><a id=__codelineno-12-28 name=__codelineno-12-28></a><a href=#__codelineno-12-28><span class=linenos data-linenos="28 "></span></a>        <span class=k>return</span> <span class=n>TestResults</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>
</span><span id=__span-12-29><a id=__codelineno-12-29 name=__codelineno-12-29></a><a href=#__codelineno-12-29><span class=linenos data-linenos="29 "></span></a>        
</span><span id=__span-12-30><a id=__codelineno-12-30 name=__codelineno-12-30></a><a href=#__codelineno-12-30><span class=linenos data-linenos="30 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>run_suite_isolated</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>suite</span><span class=p>:</span> <span class=n>TestSuite</span><span class=p>,</span> <span class=n>env</span><span class=p>:</span> <span class=n>TestEnvironment</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>TestResult</span><span class=p>:</span>
</span><span id=__span-12-31><a id=__codelineno-12-31 name=__codelineno-12-31></a><a href=#__codelineno-12-31><span class=linenos data-linenos="31 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Run test suite in isolated environment&quot;&quot;&quot;</span>
</span><span id=__span-12-32><a id=__codelineno-12-32 name=__codelineno-12-32></a><a href=#__codelineno-12-32><span class=linenos data-linenos="32 "></span></a>        <span class=c1># Set up isolated database</span>
</span><span id=__span-12-33><a id=__codelineno-12-33 name=__codelineno-12-33></a><a href=#__codelineno-12-33><span class=linenos data-linenos="33 "></span></a>        <span class=n>test_db</span> <span class=o>=</span> <span class=k>await</span> <span class=n>env</span><span class=o>.</span><span class=n>create_test_database</span><span class=p>()</span>
</span><span id=__span-12-34><a id=__codelineno-12-34 name=__codelineno-12-34></a><a href=#__codelineno-12-34><span class=linenos data-linenos="34 "></span></a>        
</span><span id=__span-12-35><a id=__codelineno-12-35 name=__codelineno-12-35></a><a href=#__codelineno-12-35><span class=linenos data-linenos="35 "></span></a>        <span class=c1># Set up isolated file system</span>
</span><span id=__span-12-36><a id=__codelineno-12-36 name=__codelineno-12-36></a><a href=#__codelineno-12-36><span class=linenos data-linenos="36 "></span></a>        <span class=n>test_fs</span> <span class=o>=</span> <span class=k>await</span> <span class=n>env</span><span class=o>.</span><span class=n>create_test_filesystem</span><span class=p>()</span>
</span><span id=__span-12-37><a id=__codelineno-12-37 name=__codelineno-12-37></a><a href=#__codelineno-12-37><span class=linenos data-linenos="37 "></span></a>        
</span><span id=__span-12-38><a id=__codelineno-12-38 name=__codelineno-12-38></a><a href=#__codelineno-12-38><span class=linenos data-linenos="38 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-12-39><a id=__codelineno-12-39 name=__codelineno-12-39></a><a href=#__codelineno-12-39><span class=linenos data-linenos="39 "></span></a>            <span class=c1># Run tests with isolation</span>
</span><span id=__span-12-40><a id=__codelineno-12-40 name=__codelineno-12-40></a><a href=#__codelineno-12-40><span class=linenos data-linenos="40 "></span></a>            <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>suite</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-12-41><a id=__codelineno-12-41 name=__codelineno-12-41></a><a href=#__codelineno-12-41><span class=linenos data-linenos="41 "></span></a>                <span class=n>database</span><span class=o>=</span><span class=n>test_db</span><span class=p>,</span>
</span><span id=__span-12-42><a id=__codelineno-12-42 name=__codelineno-12-42></a><a href=#__codelineno-12-42><span class=linenos data-linenos="42 "></span></a>                <span class=n>filesystem</span><span class=o>=</span><span class=n>test_fs</span><span class=p>,</span>
</span><span id=__span-12-43><a id=__codelineno-12-43 name=__codelineno-12-43></a><a href=#__codelineno-12-43><span class=linenos data-linenos="43 "></span></a>                <span class=n>network_isolation</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-12-44><a id=__codelineno-12-44 name=__codelineno-12-44></a><a href=#__codelineno-12-44><span class=linenos data-linenos="44 "></span></a>            <span class=p>)</span>
</span><span id=__span-12-45><a id=__codelineno-12-45 name=__codelineno-12-45></a><a href=#__codelineno-12-45><span class=linenos data-linenos="45 "></span></a>            <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-12-46><a id=__codelineno-12-46 name=__codelineno-12-46></a><a href=#__codelineno-12-46><span class=linenos data-linenos="46 "></span></a>        <span class=k>finally</span><span class=p>:</span>
</span><span id=__span-12-47><a id=__codelineno-12-47 name=__codelineno-12-47></a><a href=#__codelineno-12-47><span class=linenos data-linenos="47 "></span></a>            <span class=c1># Clean up</span>
</span><span id=__span-12-48><a id=__codelineno-12-48 name=__codelineno-12-48></a><a href=#__codelineno-12-48><span class=linenos data-linenos="48 "></span></a>            <span class=k>await</span> <span class=n>env</span><span class=o>.</span><span class=n>cleanup</span><span class=p>()</span>
</span></code></pre></div><h3 id=test-fixture-management>Test Fixture Management<a class=headerlink href=#test-fixture-management title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1></a><a href=#__codelineno-13-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>class</span> <span class=nc>ParallelFixtureManager</span><span class=p>:</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2></a><a href=#__codelineno-13-2><span class=linenos data-linenos=" 2 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3></a><a href=#__codelineno-13-3><span class=linenos data-linenos=" 3 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>shared_fixtures</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4></a><a href=#__codelineno-13-4><span class=linenos data-linenos=" 4 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>fixture_locks</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>Lock</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5></a><a href=#__codelineno-13-5><span class=linenos data-linenos=" 5 "></span></a>        
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6></a><a href=#__codelineno-13-6><span class=linenos data-linenos=" 6 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_fixture</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>fixture_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>cycle_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7></a><a href=#__codelineno-13-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get test fixture with copy-on-write semantics&quot;&quot;&quot;</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8></a><a href=#__codelineno-13-8><span class=linenos data-linenos=" 8 "></span></a>        <span class=k>if</span> <span class=n>fixture_name</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>shared_fixtures</span><span class=p>:</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9></a><a href=#__codelineno-13-9><span class=linenos data-linenos=" 9 "></span></a>            <span class=c1># Return deep copy for isolation</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10></a><a href=#__codelineno-13-10><span class=linenos data-linenos="10 "></span></a>            <span class=k>return</span> <span class=n>deepcopy</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>shared_fixtures</span><span class=p>[</span><span class=n>fixture_name</span><span class=p>])</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11></a><a href=#__codelineno-13-11><span class=linenos data-linenos="11 "></span></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12></a><a href=#__codelineno-13-12><span class=linenos data-linenos="12 "></span></a>            <span class=c1># Create fixture if not exists</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13></a><a href=#__codelineno-13-13><span class=linenos data-linenos="13 "></span></a>            <span class=k>async</span> <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_fixture_lock</span><span class=p>(</span><span class=n>fixture_name</span><span class=p>):</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14></a><a href=#__codelineno-13-14><span class=linenos data-linenos="14 "></span></a>                <span class=k>if</span> <span class=n>fixture_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>shared_fixtures</span><span class=p>:</span>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15></a><a href=#__codelineno-13-15><span class=linenos data-linenos="15 "></span></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>shared_fixtures</span><span class=p>[</span><span class=n>fixture_name</span><span class=p>]</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_fixture</span><span class=p>(</span><span class=n>fixture_name</span><span class=p>)</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16></a><a href=#__codelineno-13-16><span class=linenos data-linenos="16 "></span></a>                <span class=k>return</span> <span class=n>deepcopy</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>shared_fixtures</span><span class=p>[</span><span class=n>fixture_name</span><span class=p>])</span>
</span></code></pre></div><h2 id=human-in-the-loop-coordination>Human-in-the-Loop Coordination<a class=headerlink href=#human-in-the-loop-coordination title="Permanent link">&para;</a></h2><h3 id=parallel-approval-queue>Parallel Approval Queue<a class=headerlink href=#parallel-approval-queue title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1></a><a href=#__codelineno-14-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>class</span> <span class=nc>ParallelApprovalQueue</span><span class=p>:</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2></a><a href=#__codelineno-14-2><span class=linenos data-linenos=" 2 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3></a><a href=#__codelineno-14-3><span class=linenos data-linenos=" 3 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>pending_approvals</span><span class=p>:</span> <span class=n>PriorityQueue</span> <span class=o>=</span> <span class=n>PriorityQueue</span><span class=p>()</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4></a><a href=#__codelineno-14-4><span class=linenos data-linenos=" 4 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>approval_contexts</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>ApprovalContext</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5></a><a href=#__codelineno-14-5><span class=linenos data-linenos=" 5 "></span></a>        
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6></a><a href=#__codelineno-14-6><span class=linenos data-linenos=" 6 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>request_approval</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycle_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>phase</span><span class=p>:</span> <span class=n>TDDState</span><span class=p>,</span> <span class=n>priority</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7></a><a href=#__codelineno-14-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Request human approval with priority&quot;&quot;&quot;</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8></a><a href=#__codelineno-14-8><span class=linenos data-linenos=" 8 "></span></a>        <span class=n>context</span> <span class=o>=</span> <span class=n>ApprovalContext</span><span class=p>(</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9></a><a href=#__codelineno-14-9><span class=linenos data-linenos=" 9 "></span></a>            <span class=n>cycle_id</span><span class=o>=</span><span class=n>cycle_id</span><span class=p>,</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10></a><a href=#__codelineno-14-10><span class=linenos data-linenos="10 "></span></a>            <span class=n>phase</span><span class=o>=</span><span class=n>phase</span><span class=p>,</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11></a><a href=#__codelineno-14-11><span class=linenos data-linenos="11 "></span></a>            <span class=n>priority</span><span class=o>=</span><span class=n>priority</span><span class=p>,</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12></a><a href=#__codelineno-14-12><span class=linenos data-linenos="12 "></span></a>            <span class=n>requested_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13></a><a href=#__codelineno-14-13><span class=linenos data-linenos="13 "></span></a>            <span class=n>timeout</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>hours</span><span class=o>=</span><span class=mi>2</span><span class=p>),</span>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14></a><a href=#__codelineno-14-14><span class=linenos data-linenos="14 "></span></a>            <span class=n>fallback_action</span><span class=o>=</span><span class=n>FallbackAction</span><span class=o>.</span><span class=n>PAUSE_CYCLE</span>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15></a><a href=#__codelineno-14-15><span class=linenos data-linenos="15 "></span></a>        <span class=p>)</span>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16></a><a href=#__codelineno-14-16><span class=linenos data-linenos="16 "></span></a>        
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17></a><a href=#__codelineno-14-17><span class=linenos data-linenos="17 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>approval_contexts</span><span class=p>[</span><span class=n>cycle_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>context</span>
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18></a><a href=#__codelineno-14-18><span class=linenos data-linenos="18 "></span></a>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>pending_approvals</span><span class=o>.</span><span class=n>put</span><span class=p>((</span><span class=o>-</span><span class=n>priority</span><span class=p>,</span> <span class=n>cycle_id</span><span class=p>))</span>  <span class=c1># Negative for max heap</span>
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19></a><a href=#__codelineno-14-19><span class=linenos data-linenos="19 "></span></a>        
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20></a><a href=#__codelineno-14-20><span class=linenos data-linenos="20 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_next_approval</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ApprovalContext</span><span class=p>]:</span>
</span><span id=__span-14-21><a id=__codelineno-14-21 name=__codelineno-14-21></a><a href=#__codelineno-14-21><span class=linenos data-linenos="21 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get highest priority approval request&quot;&quot;&quot;</span>
</span><span id=__span-14-22><a id=__codelineno-14-22 name=__codelineno-14-22></a><a href=#__codelineno-14-22><span class=linenos data-linenos="22 "></span></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>pending_approvals</span><span class=o>.</span><span class=n>empty</span><span class=p>():</span>
</span><span id=__span-14-23><a id=__codelineno-14-23 name=__codelineno-14-23></a><a href=#__codelineno-14-23><span class=linenos data-linenos="23 "></span></a>            <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-14-24><a id=__codelineno-14-24 name=__codelineno-14-24></a><a href=#__codelineno-14-24><span class=linenos data-linenos="24 "></span></a>            
</span><span id=__span-14-25><a id=__codelineno-14-25 name=__codelineno-14-25></a><a href=#__codelineno-14-25><span class=linenos data-linenos="25 "></span></a>        <span class=n>_</span><span class=p>,</span> <span class=n>cycle_id</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>pending_approvals</span><span class=o>.</span><span class=n>get</span><span class=p>()</span>
</span><span id=__span-14-26><a id=__codelineno-14-26 name=__codelineno-14-26></a><a href=#__codelineno-14-26><span class=linenos data-linenos="26 "></span></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>approval_contexts</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>cycle_id</span><span class=p>)</span>
</span><span id=__span-14-27><a id=__codelineno-14-27 name=__codelineno-14-27></a><a href=#__codelineno-14-27><span class=linenos data-linenos="27 "></span></a>        
</span><span id=__span-14-28><a id=__codelineno-14-28 name=__codelineno-14-28></a><a href=#__codelineno-14-28><span class=linenos data-linenos="28 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>handle_approval_timeout</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycle_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-14-29><a id=__codelineno-14-29 name=__codelineno-14-29></a><a href=#__codelineno-14-29><span class=linenos data-linenos="29 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Handle approval timeout with fallback action&quot;&quot;&quot;</span>
</span><span id=__span-14-30><a id=__codelineno-14-30 name=__codelineno-14-30></a><a href=#__codelineno-14-30><span class=linenos data-linenos="30 "></span></a>        <span class=n>context</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>approval_contexts</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>cycle_id</span><span class=p>)</span>
</span><span id=__span-14-31><a id=__codelineno-14-31 name=__codelineno-14-31></a><a href=#__codelineno-14-31><span class=linenos data-linenos="31 "></span></a>        <span class=k>if</span> <span class=n>context</span> <span class=ow>and</span> <span class=n>context</span><span class=o>.</span><span class=n>is_expired</span><span class=p>():</span>
</span><span id=__span-14-32><a id=__codelineno-14-32 name=__codelineno-14-32></a><a href=#__codelineno-14-32><span class=linenos data-linenos="32 "></span></a>            <span class=k>if</span> <span class=n>context</span><span class=o>.</span><span class=n>fallback_action</span> <span class=o>==</span> <span class=n>FallbackAction</span><span class=o>.</span><span class=n>PAUSE_CYCLE</span><span class=p>:</span>
</span><span id=__span-14-33><a id=__codelineno-14-33 name=__codelineno-14-33></a><a href=#__codelineno-14-33><span class=linenos data-linenos="33 "></span></a>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>pause_cycle</span><span class=p>(</span><span class=n>cycle_id</span><span class=p>)</span>
</span><span id=__span-14-34><a id=__codelineno-14-34 name=__codelineno-14-34></a><a href=#__codelineno-14-34><span class=linenos data-linenos="34 "></span></a>            <span class=k>elif</span> <span class=n>context</span><span class=o>.</span><span class=n>fallback_action</span> <span class=o>==</span> <span class=n>FallbackAction</span><span class=o>.</span><span class=n>AUTO_APPROVE</span><span class=p>:</span>
</span><span id=__span-14-35><a id=__codelineno-14-35 name=__codelineno-14-35></a><a href=#__codelineno-14-35><span class=linenos data-linenos="35 "></span></a>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>auto_approve_with_restrictions</span><span class=p>(</span><span class=n>cycle_id</span><span class=p>)</span>
</span></code></pre></div><h3 id=parallel-progress-dashboard>Parallel Progress Dashboard<a class=headerlink href=#parallel-progress-dashboard title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1></a><a href=#__codelineno-15-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>class</span> <span class=nc>ParallelProgressMonitor</span><span class=p>:</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2></a><a href=#__codelineno-15-2><span class=linenos data-linenos=" 2 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3></a><a href=#__codelineno-15-3><span class=linenos data-linenos=" 3 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>cycle_metrics</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>CycleMetrics</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4></a><a href=#__codelineno-15-4><span class=linenos data-linenos=" 4 "></span></a>        
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5></a><a href=#__codelineno-15-5><span class=linenos data-linenos=" 5 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_dashboard_data</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6></a><a href=#__codelineno-15-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get real-time dashboard data for all parallel cycles&quot;&quot;&quot;</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7></a><a href=#__codelineno-15-7><span class=linenos data-linenos=" 7 "></span></a>        <span class=n>active_cycles</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_active_cycles</span><span class=p>()</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8></a><a href=#__codelineno-15-8><span class=linenos data-linenos=" 8 "></span></a>        
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9></a><a href=#__codelineno-15-9><span class=linenos data-linenos=" 9 "></span></a>        <span class=n>dashboard</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10></a><a href=#__codelineno-15-10><span class=linenos data-linenos="10 "></span></a>            <span class=s2>&quot;summary&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11></a><a href=#__codelineno-15-11><span class=linenos data-linenos="11 "></span></a>                <span class=s2>&quot;active_cycles&quot;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>active_cycles</span><span class=p>),</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12></a><a href=#__codelineno-15-12><span class=linenos data-linenos="12 "></span></a>                <span class=s2>&quot;total_throughput&quot;</span><span class=p>:</span> <span class=nb>sum</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>tasks_per_hour</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>cycle_metrics</span><span class=o>.</span><span class=n>values</span><span class=p>()),</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13></a><a href=#__codelineno-15-13><span class=linenos data-linenos="13 "></span></a>                <span class=s2>&quot;average_cycle_time&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_avg_cycle_time</span><span class=p>(),</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14></a><a href=#__codelineno-15-14><span class=linenos data-linenos="14 "></span></a>                <span class=s2>&quot;conflict_rate&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_conflict_rate</span><span class=p>(),</span>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15></a><a href=#__codelineno-15-15><span class=linenos data-linenos="15 "></span></a>                <span class=s2>&quot;resource_utilization&quot;</span><span class=p>:</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_resource_utilization</span><span class=p>()</span>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16></a><a href=#__codelineno-15-16><span class=linenos data-linenos="16 "></span></a>            <span class=p>},</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17></a><a href=#__codelineno-15-17><span class=linenos data-linenos="17 "></span></a>            <span class=s2>&quot;cycles&quot;</span><span class=p>:</span> <span class=p>[]</span>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18></a><a href=#__codelineno-15-18><span class=linenos data-linenos="18 "></span></a>        <span class=p>}</span>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19></a><a href=#__codelineno-15-19><span class=linenos data-linenos="19 "></span></a>        
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20></a><a href=#__codelineno-15-20><span class=linenos data-linenos="20 "></span></a>        <span class=k>for</span> <span class=n>cycle</span> <span class=ow>in</span> <span class=n>active_cycles</span><span class=p>:</span>
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21></a><a href=#__codelineno-15-21><span class=linenos data-linenos="21 "></span></a>            <span class=n>metrics</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cycle_metrics</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>cycle</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>CycleMetrics</span><span class=p>())</span>
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22></a><a href=#__codelineno-15-22><span class=linenos data-linenos="22 "></span></a>            <span class=n>dashboard</span><span class=p>[</span><span class=s2>&quot;cycles&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-15-23><a id=__codelineno-15-23 name=__codelineno-15-23></a><a href=#__codelineno-15-23><span class=linenos data-linenos="23 "></span></a>                <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>cycle</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-15-24><a id=__codelineno-15-24 name=__codelineno-15-24></a><a href=#__codelineno-15-24><span class=linenos data-linenos="24 "></span></a>                <span class=s2>&quot;story&quot;</span><span class=p>:</span> <span class=n>cycle</span><span class=o>.</span><span class=n>story_id</span><span class=p>,</span>
</span><span id=__span-15-25><a id=__codelineno-15-25 name=__codelineno-15-25></a><a href=#__codelineno-15-25><span class=linenos data-linenos="25 "></span></a>                <span class=s2>&quot;phase&quot;</span><span class=p>:</span> <span class=n>cycle</span><span class=o>.</span><span class=n>current_state</span><span class=o>.</span><span class=n>value</span><span class=p>,</span>
</span><span id=__span-15-26><a id=__codelineno-15-26 name=__codelineno-15-26></a><a href=#__codelineno-15-26><span class=linenos data-linenos="26 "></span></a>                <span class=s2>&quot;progress&quot;</span><span class=p>:</span> <span class=n>metrics</span><span class=o>.</span><span class=n>progress_percentage</span><span class=p>,</span>
</span><span id=__span-15-27><a id=__codelineno-15-27 name=__codelineno-15-27></a><a href=#__codelineno-15-27><span class=linenos data-linenos="27 "></span></a>                <span class=s2>&quot;eta&quot;</span><span class=p>:</span> <span class=n>metrics</span><span class=o>.</span><span class=n>estimated_completion</span><span class=p>,</span>
</span><span id=__span-15-28><a id=__codelineno-15-28 name=__codelineno-15-28></a><a href=#__codelineno-15-28><span class=linenos data-linenos="28 "></span></a>                <span class=s2>&quot;blockers&quot;</span><span class=p>:</span> <span class=n>metrics</span><span class=o>.</span><span class=n>current_blockers</span><span class=p>,</span>
</span><span id=__span-15-29><a id=__codelineno-15-29 name=__codelineno-15-29></a><a href=#__codelineno-15-29><span class=linenos data-linenos="29 "></span></a>                <span class=s2>&quot;agent&quot;</span><span class=p>:</span> <span class=n>metrics</span><span class=o>.</span><span class=n>current_agent_type</span>
</span><span id=__span-15-30><a id=__codelineno-15-30 name=__codelineno-15-30></a><a href=#__codelineno-15-30><span class=linenos data-linenos="30 "></span></a>            <span class=p>})</span>
</span><span id=__span-15-31><a id=__codelineno-15-31 name=__codelineno-15-31></a><a href=#__codelineno-15-31><span class=linenos data-linenos="31 "></span></a>            
</span><span id=__span-15-32><a id=__codelineno-15-32 name=__codelineno-15-32></a><a href=#__codelineno-15-32><span class=linenos data-linenos="32 "></span></a>        <span class=k>return</span> <span class=n>dashboard</span>
</span></code></pre></div><h2 id=implementation-strategy>Implementation Strategy<a class=headerlink href=#implementation-strategy title="Permanent link">&para;</a></h2><h3 id=phase-1-basic-parallel-execution-weeks-1-2>Phase 1: Basic Parallel Execution (Weeks 1-2)<a class=headerlink href=#phase-1-basic-parallel-execution-weeks-1-2 title="Permanent link">&para;</a></h3><ol><li><strong>Dual Cycle Support</strong>: Enable 2 concurrent TDD cycles</li><li><strong>Simple Conflict Detection</strong>: File-level locking only</li><li><strong>Static Agent Allocation</strong>: Fixed agent pools</li><li><strong>Manual Conflict Resolution</strong>: Human intervention required</li></ol><h3 id=phase-2-intelligent-scheduling-weeks-3-4>Phase 2: Intelligent Scheduling (Weeks 3-4)<a class=headerlink href=#phase-2-intelligent-scheduling-weeks-3-4 title="Permanent link">&para;</a></h3><ol><li><strong>Dependency-Based Scheduling</strong>: Honor story dependencies</li><li><strong>Dynamic Agent Pools</strong>: Scale based on demand</li><li><strong>Automated Conflict Resolution</strong>: Simple auto-merge</li><li><strong>Parallel Test Execution</strong>: Isolated test environments</li></ol><h3 id=phase-3-advanced-parallelism-weeks-5-6>Phase 3: Advanced Parallelism (Weeks 5-6)<a class=headerlink href=#phase-3-advanced-parallelism-weeks-5-6 title="Permanent link">&para;</a></h3><ol><li><strong>5+ Concurrent Cycles</strong>: Scale to more parallel execution</li><li><strong>Predictive Conflict Avoidance</strong>: ML-based prediction</li><li><strong>Optimistic Concurrency</strong>: Reduce locking overhead</li><li><strong>Context Optimization</strong>: Parallel-aware context management</li></ol><h3 id=phase-4-production-optimization-weeks-7-8>Phase 4: Production Optimization (Weeks 7-8)<a class=headerlink href=#phase-4-production-optimization-weeks-7-8 title="Permanent link">&para;</a></h3><ol><li><strong>Performance Tuning</strong>: Optimize for throughput</li><li><strong>Advanced Monitoring</strong>: Real-time analytics</li><li><strong>Cross-Project Parallelism</strong>: Coordinate across projects</li><li><strong>Automated Scaling</strong>: Self-tuning system</li></ol><h2 id=performance-targets>Performance Targets<a class=headerlink href=#performance-targets title="Permanent link">&para;</a></h2><h3 id=throughput-metrics>Throughput Metrics<a class=headerlink href=#throughput-metrics title="Permanent link">&para;</a></h3><ul><li><strong>2 Parallel Cycles</strong>: 1.8x throughput improvement</li><li><strong>3 Parallel Cycles</strong>: 2.5x throughput improvement</li><li><strong>5 Parallel Cycles</strong>: 3.5x throughput improvement</li><li><strong>Overhead</strong>: &lt;10% coordination overhead</li></ul><h3 id=quality-metrics>Quality Metrics<a class=headerlink href=#quality-metrics title="Permanent link">&para;</a></h3><ul><li><strong>Test Coverage</strong>: Maintain &gt;95% coverage</li><li><strong>Conflict Rate</strong>: &lt;5% of cycles experience conflicts</li><li><strong>Auto-Resolution</strong>: &gt;80% of conflicts resolved automatically</li><li><strong>Zero Defects</strong>: No quality degradation from parallelism</li></ul><h3 id=resource-metrics>Resource Metrics<a class=headerlink href=#resource-metrics title="Permanent link">&para;</a></h3><ul><li><strong>CPU Utilization</strong>: 70-85% optimal range</li><li><strong>Memory Usage</strong>: &lt;2GB per TDD cycle</li><li><strong>Agent Efficiency</strong>: &gt;80% agent utilization</li><li><strong>Context Size</strong>: &lt;100k tokens per cycle</li></ul><h2 id=risk-mitigation>Risk Mitigation<a class=headerlink href=#risk-mitigation title="Permanent link">&para;</a></h2><h3 id=technical-risks>Technical Risks<a class=headerlink href=#technical-risks title="Permanent link">&para;</a></h3><ol><li><strong>Data Corruption</strong>: Transactional state with automatic rollback</li><li><strong>Deadlocks</strong>: Timeout-based deadlock detection and recovery</li><li><strong>Resource Exhaustion</strong>: Hard limits and circuit breakers</li><li><strong>Quality Degradation</strong>: Continuous quality monitoring</li></ol><h3 id=operational-risks>Operational Risks<a class=headerlink href=#operational-risks title="Permanent link">&para;</a></h3><ol><li><strong>Complexity</strong>: Progressive rollout with feature flags</li><li><strong>Debugging</strong>: Comprehensive distributed tracing</li><li><strong>Recovery</strong>: Automatic fallback to sequential mode</li><li><strong>Monitoring</strong>: Real-time alerting and dashboards</li></ol><h2 id=testing-strategy>Testing Strategy<a class=headerlink href=#testing-strategy title="Permanent link">&para;</a></h2><h3 id=unit-testing>Unit Testing<a class=headerlink href=#unit-testing title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1></a><a href=#__codelineno-16-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>class</span> <span class=nc>TestParallelCoordinator</span><span class=p>:</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2></a><a href=#__codelineno-16-2><span class=linenos data-linenos=" 2 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>test_conflict_detection</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3></a><a href=#__codelineno-16-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Test conflict detection between cycles&quot;&quot;&quot;</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4></a><a href=#__codelineno-16-4><span class=linenos data-linenos=" 4 "></span></a>        <span class=n>cycle1</span> <span class=o>=</span> <span class=n>create_test_cycle</span><span class=p>(</span><span class=n>files</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;user.py&quot;</span><span class=p>,</span> <span class=s2>&quot;auth.py&quot;</span><span class=p>])</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5></a><a href=#__codelineno-16-5><span class=linenos data-linenos=" 5 "></span></a>        <span class=n>cycle2</span> <span class=o>=</span> <span class=n>create_test_cycle</span><span class=p>(</span><span class=n>files</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;auth.py&quot;</span><span class=p>,</span> <span class=s2>&quot;db.py&quot;</span><span class=p>])</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6></a><a href=#__codelineno-16-6><span class=linenos data-linenos=" 6 "></span></a>        
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7></a><a href=#__codelineno-16-7><span class=linenos data-linenos=" 7 "></span></a>        <span class=n>conflicts</span> <span class=o>=</span> <span class=k>await</span> <span class=n>coordinator</span><span class=o>.</span><span class=n>detect_conflicts</span><span class=p>(</span><span class=n>cycle1</span><span class=p>,</span> <span class=n>cycle2</span><span class=p>)</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8></a><a href=#__codelineno-16-8><span class=linenos data-linenos=" 8 "></span></a>        <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>conflicts</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9></a><a href=#__codelineno-16-9><span class=linenos data-linenos=" 9 "></span></a>        <span class=k>assert</span> <span class=n>conflicts</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>resources</span> <span class=o>==</span> <span class=p>[</span><span class=s2>&quot;auth.py&quot;</span><span class=p>]</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10></a><a href=#__codelineno-16-10><span class=linenos data-linenos="10 "></span></a>        
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11></a><a href=#__codelineno-16-11><span class=linenos data-linenos="11 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>test_deadlock_prevention</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12></a><a href=#__codelineno-16-12><span class=linenos data-linenos="12 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Test deadlock prevention in file locking&quot;&quot;&quot;</span>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13></a><a href=#__codelineno-16-13><span class=linenos data-linenos="13 "></span></a>        <span class=c1># Create circular dependency scenario</span>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14></a><a href=#__codelineno-16-14><span class=linenos data-linenos="14 "></span></a>        <span class=n>cycle1</span> <span class=o>=</span> <span class=n>create_test_cycle</span><span class=p>(</span><span class=n>files</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;a.py&quot;</span><span class=p>,</span> <span class=s2>&quot;b.py&quot;</span><span class=p>])</span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15></a><a href=#__codelineno-16-15><span class=linenos data-linenos="15 "></span></a>        <span class=n>cycle2</span> <span class=o>=</span> <span class=n>create_test_cycle</span><span class=p>(</span><span class=n>files</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;b.py&quot;</span><span class=p>,</span> <span class=s2>&quot;a.py&quot;</span><span class=p>])</span>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16></a><a href=#__codelineno-16-16><span class=linenos data-linenos="16 "></span></a>        
</span><span id=__span-16-17><a id=__codelineno-16-17 name=__codelineno-16-17></a><a href=#__codelineno-16-17><span class=linenos data-linenos="17 "></span></a>        <span class=c1># Should not deadlock</span>
</span><span id=__span-16-18><a id=__codelineno-16-18 name=__codelineno-16-18></a><a href=#__codelineno-16-18><span class=linenos data-linenos="18 "></span></a>        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>coordinator</span><span class=o>.</span><span class=n>schedule_cycles</span><span class=p>([</span><span class=n>cycle1</span><span class=p>,</span> <span class=n>cycle2</span><span class=p>])</span>
</span><span id=__span-16-19><a id=__codelineno-16-19 name=__codelineno-16-19></a><a href=#__codelineno-16-19><span class=linenos data-linenos="19 "></span></a>        <span class=k>assert</span> <span class=n>result</span><span class=o>.</span><span class=n>success</span>
</span></code></pre></div><h3 id=integration-testing>Integration Testing<a class=headerlink href=#integration-testing title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1></a><a href=#__codelineno-17-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>class</span> <span class=nc>TestParallelIntegration</span><span class=p>:</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2></a><a href=#__codelineno-17-2><span class=linenos data-linenos=" 2 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>test_full_parallel_execution</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3></a><a href=#__codelineno-17-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Test complete parallel TDD execution&quot;&quot;&quot;</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4></a><a href=#__codelineno-17-4><span class=linenos data-linenos=" 4 "></span></a>        <span class=n>stories</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5></a><a href=#__codelineno-17-5><span class=linenos data-linenos=" 5 "></span></a>            <span class=n>create_story</span><span class=p>(</span><span class=s2>&quot;feature_a&quot;</span><span class=p>,</span> <span class=n>files</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;feature_a.py&quot;</span><span class=p>]),</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6></a><a href=#__codelineno-17-6><span class=linenos data-linenos=" 6 "></span></a>            <span class=n>create_story</span><span class=p>(</span><span class=s2>&quot;feature_b&quot;</span><span class=p>,</span> <span class=n>files</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;feature_b.py&quot;</span><span class=p>]),</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7></a><a href=#__codelineno-17-7><span class=linenos data-linenos=" 7 "></span></a>            <span class=n>create_story</span><span class=p>(</span><span class=s2>&quot;feature_c&quot;</span><span class=p>,</span> <span class=n>files</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;feature_c.py&quot;</span><span class=p>])</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8></a><a href=#__codelineno-17-8><span class=linenos data-linenos=" 8 "></span></a>        <span class=p>]</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9></a><a href=#__codelineno-17-9><span class=linenos data-linenos=" 9 "></span></a>        
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10></a><a href=#__codelineno-17-10><span class=linenos data-linenos="10 "></span></a>        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>orchestrator</span><span class=o>.</span><span class=n>execute_parallel_tdd</span><span class=p>(</span><span class=n>stories</span><span class=p>)</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11></a><a href=#__codelineno-17-11><span class=linenos data-linenos="11 "></span></a>        
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12></a><a href=#__codelineno-17-12><span class=linenos data-linenos="12 "></span></a>        <span class=k>assert</span> <span class=nb>all</span><span class=p>(</span><span class=n>s</span><span class=o>.</span><span class=n>status</span> <span class=o>==</span> <span class=s2>&quot;completed&quot;</span> <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>result</span><span class=o>.</span><span class=n>stories</span><span class=p>)</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13></a><a href=#__codelineno-17-13><span class=linenos data-linenos="13 "></span></a>        <span class=k>assert</span> <span class=n>result</span><span class=o>.</span><span class=n>total_time</span> <span class=o>&lt;</span> <span class=n>sequential_baseline</span> <span class=o>*</span> <span class=mf>0.5</span>  <span class=c1># 2x speedup</span>
</span></code></pre></div><h3 id=stress-testing>Stress Testing<a class=headerlink href=#stress-testing title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1></a><a href=#__codelineno-18-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>class</span> <span class=nc>TestParallelStress</span><span class=p>:</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2></a><a href=#__codelineno-18-2><span class=linenos data-linenos=" 2 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>test_high_concurrency</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3></a><a href=#__codelineno-18-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Test system under high parallel load&quot;&quot;&quot;</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4></a><a href=#__codelineno-18-4><span class=linenos data-linenos=" 4 "></span></a>        <span class=n>num_cycles</span> <span class=o>=</span> <span class=mi>10</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5></a><a href=#__codelineno-18-5><span class=linenos data-linenos=" 5 "></span></a>        <span class=n>cycles</span> <span class=o>=</span> <span class=p>[</span><span class=n>create_test_cycle</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;cycle_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_cycles</span><span class=p>)]</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6></a><a href=#__codelineno-18-6><span class=linenos data-linenos=" 6 "></span></a>        
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7></a><a href=#__codelineno-18-7><span class=linenos data-linenos=" 7 "></span></a>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8></a><a href=#__codelineno-18-8><span class=linenos data-linenos=" 8 "></span></a>        <span class=n>results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>coordinator</span><span class=o>.</span><span class=n>execute_parallel</span><span class=p>(</span><span class=n>cycles</span><span class=p>,</span> <span class=n>max_parallel</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9></a><a href=#__codelineno-18-9><span class=linenos data-linenos=" 9 "></span></a>        <span class=n>duration</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10></a><a href=#__codelineno-18-10><span class=linenos data-linenos="10 "></span></a>        
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11></a><a href=#__codelineno-18-11><span class=linenos data-linenos="11 "></span></a>        <span class=k>assert</span> <span class=nb>all</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>success</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>results</span><span class=p>)</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12></a><a href=#__codelineno-18-12><span class=linenos data-linenos="12 "></span></a>        <span class=k>assert</span> <span class=n>duration</span> <span class=o>&lt;</span> <span class=n>sequential_estimate</span> <span class=o>*</span> <span class=mf>0.3</span>  <span class=c1># 3x+ speedup</span>
</span></code></pre></div><h2 id=monitoring-and-observability>Monitoring and Observability<a class=headerlink href=#monitoring-and-observability title="Permanent link">&para;</a></h2><h3 id=key-metrics>Key Metrics<a class=headerlink href=#key-metrics title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1></a><a href=#__codelineno-19-1><span class=linenos data-linenos=" 1 "></span></a><span class=nd>@dataclass</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2></a><a href=#__codelineno-19-2><span class=linenos data-linenos=" 2 "></span></a><span class=k>class</span> <span class=nc>ParallelMetrics</span><span class=p>:</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3></a><a href=#__codelineno-19-3><span class=linenos data-linenos=" 3 "></span></a>    <span class=c1># Throughput metrics</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4></a><a href=#__codelineno-19-4><span class=linenos data-linenos=" 4 "></span></a>    <span class=n>cycles_per_hour</span><span class=p>:</span> <span class=nb>float</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5></a><a href=#__codelineno-19-5><span class=linenos data-linenos=" 5 "></span></a>    <span class=n>tasks_completed_per_hour</span><span class=p>:</span> <span class=nb>float</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6></a><a href=#__codelineno-19-6><span class=linenos data-linenos=" 6 "></span></a>    <span class=n>average_cycle_duration</span><span class=p>:</span> <span class=n>timedelta</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7></a><a href=#__codelineno-19-7><span class=linenos data-linenos=" 7 "></span></a>    
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8></a><a href=#__codelineno-19-8><span class=linenos data-linenos=" 8 "></span></a>    <span class=c1># Conflict metrics</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9></a><a href=#__codelineno-19-9><span class=linenos data-linenos=" 9 "></span></a>    <span class=n>conflicts_detected</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10></a><a href=#__codelineno-19-10><span class=linenos data-linenos="10 "></span></a>    <span class=n>conflicts_auto_resolved</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11></a><a href=#__codelineno-19-11><span class=linenos data-linenos="11 "></span></a>    <span class=n>conflicts_manual_resolved</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12></a><a href=#__codelineno-19-12><span class=linenos data-linenos="12 "></span></a>    <span class=n>conflict_resolution_time</span><span class=p>:</span> <span class=n>timedelta</span>
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13></a><a href=#__codelineno-19-13><span class=linenos data-linenos="13 "></span></a>    
</span><span id=__span-19-14><a id=__codelineno-19-14 name=__codelineno-19-14></a><a href=#__codelineno-19-14><span class=linenos data-linenos="14 "></span></a>    <span class=c1># Resource metrics</span>
</span><span id=__span-19-15><a id=__codelineno-19-15 name=__codelineno-19-15></a><a href=#__codelineno-19-15><span class=linenos data-linenos="15 "></span></a>    <span class=n>agent_utilization</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=n>AgentType</span><span class=p>,</span> <span class=nb>float</span><span class=p>]</span>
</span><span id=__span-19-16><a id=__codelineno-19-16 name=__codelineno-19-16></a><a href=#__codelineno-19-16><span class=linenos data-linenos="16 "></span></a>    <span class=n>pool_scaling_events</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-19-17><a id=__codelineno-19-17 name=__codelineno-19-17></a><a href=#__codelineno-19-17><span class=linenos data-linenos="17 "></span></a>    <span class=n>token_budget_efficiency</span><span class=p>:</span> <span class=nb>float</span>
</span><span id=__span-19-18><a id=__codelineno-19-18 name=__codelineno-19-18></a><a href=#__codelineno-19-18><span class=linenos data-linenos="18 "></span></a>    
</span><span id=__span-19-19><a id=__codelineno-19-19 name=__codelineno-19-19></a><a href=#__codelineno-19-19><span class=linenos data-linenos="19 "></span></a>    <span class=c1># Quality metrics</span>
</span><span id=__span-19-20><a id=__codelineno-19-20 name=__codelineno-19-20></a><a href=#__codelineno-19-20><span class=linenos data-linenos="20 "></span></a>    <span class=n>test_pass_rate</span><span class=p>:</span> <span class=nb>float</span>
</span><span id=__span-19-21><a id=__codelineno-19-21 name=__codelineno-19-21></a><a href=#__codelineno-19-21><span class=linenos data-linenos="21 "></span></a>    <span class=n>code_coverage</span><span class=p>:</span> <span class=nb>float</span>
</span><span id=__span-19-22><a id=__codelineno-19-22 name=__codelineno-19-22></a><a href=#__codelineno-19-22><span class=linenos data-linenos="22 "></span></a>    <span class=n>refactoring_impact</span><span class=p>:</span> <span class=nb>float</span>
</span></code></pre></div><h3 id=distributed-tracing>Distributed Tracing<a class=headerlink href=#distributed-tracing title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1></a><a href=#__codelineno-20-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>class</span> <span class=nc>ParallelTracer</span><span class=p>:</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2></a><a href=#__codelineno-20-2><span class=linenos data-linenos=" 2 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>trace_cycle_execution</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycle_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>TraceData</span><span class=p>:</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3></a><a href=#__codelineno-20-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Trace complete cycle execution across parallel system&quot;&quot;&quot;</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4></a><a href=#__codelineno-20-4><span class=linenos data-linenos=" 4 "></span></a>        <span class=n>trace</span> <span class=o>=</span> <span class=n>TraceData</span><span class=p>(</span><span class=n>cycle_id</span><span class=o>=</span><span class=n>cycle_id</span><span class=p>)</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5></a><a href=#__codelineno-20-5><span class=linenos data-linenos=" 5 "></span></a>        
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6></a><a href=#__codelineno-20-6><span class=linenos data-linenos=" 6 "></span></a>        <span class=c1># Trace agent interactions</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7></a><a href=#__codelineno-20-7><span class=linenos data-linenos=" 7 "></span></a>        <span class=n>trace</span><span class=o>.</span><span class=n>add_span</span><span class=p>(</span><span class=s2>&quot;agent_acquisition&quot;</span><span class=p>,</span> 
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8></a><a href=#__codelineno-20-8><span class=linenos data-linenos=" 8 "></span></a>                      <span class=n>duration</span><span class=o>=</span><span class=n>agent_acquire_time</span><span class=p>,</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9></a><a href=#__codelineno-20-9><span class=linenos data-linenos=" 9 "></span></a>                      <span class=n>metadata</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;agent_type&quot;</span><span class=p>:</span> <span class=n>agent_type</span><span class=p>,</span> <span class=s2>&quot;pool_size&quot;</span><span class=p>:</span> <span class=n>pool_size</span><span class=p>})</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10></a><a href=#__codelineno-20-10><span class=linenos data-linenos="10 "></span></a>        
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11></a><a href=#__codelineno-20-11><span class=linenos data-linenos="11 "></span></a>        <span class=c1># Trace conflict detection</span>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12></a><a href=#__codelineno-20-12><span class=linenos data-linenos="12 "></span></a>        <span class=n>trace</span><span class=o>.</span><span class=n>add_span</span><span class=p>(</span><span class=s2>&quot;conflict_detection&quot;</span><span class=p>,</span>
</span><span id=__span-20-13><a id=__codelineno-20-13 name=__codelineno-20-13></a><a href=#__codelineno-20-13><span class=linenos data-linenos="13 "></span></a>                      <span class=n>duration</span><span class=o>=</span><span class=n>conflict_check_time</span><span class=p>,</span>
</span><span id=__span-20-14><a id=__codelineno-20-14 name=__codelineno-20-14></a><a href=#__codelineno-20-14><span class=linenos data-linenos="14 "></span></a>                      <span class=n>metadata</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;conflicts_found&quot;</span><span class=p>:</span> <span class=n>num_conflicts</span><span class=p>})</span>
</span><span id=__span-20-15><a id=__codelineno-20-15 name=__codelineno-20-15></a><a href=#__codelineno-20-15><span class=linenos data-linenos="15 "></span></a>        
</span><span id=__span-20-16><a id=__codelineno-20-16 name=__codelineno-20-16></a><a href=#__codelineno-20-16><span class=linenos data-linenos="16 "></span></a>        <span class=c1># Trace context preparation</span>
</span><span id=__span-20-17><a id=__codelineno-20-17 name=__codelineno-20-17></a><a href=#__codelineno-20-17><span class=linenos data-linenos="17 "></span></a>        <span class=n>trace</span><span class=o>.</span><span class=n>add_span</span><span class=p>(</span><span class=s2>&quot;context_preparation&quot;</span><span class=p>,</span>
</span><span id=__span-20-18><a id=__codelineno-20-18 name=__codelineno-20-18></a><a href=#__codelineno-20-18><span class=linenos data-linenos="18 "></span></a>                      <span class=n>duration</span><span class=o>=</span><span class=n>context_prep_time</span><span class=p>,</span>
</span><span id=__span-20-19><a id=__codelineno-20-19 name=__codelineno-20-19></a><a href=#__codelineno-20-19><span class=linenos data-linenos="19 "></span></a>                      <span class=n>metadata</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;token_count&quot;</span><span class=p>:</span> <span class=n>tokens_used</span><span class=p>})</span>
</span><span id=__span-20-20><a id=__codelineno-20-20 name=__codelineno-20-20></a><a href=#__codelineno-20-20><span class=linenos data-linenos="20 "></span></a>        
</span><span id=__span-20-21><a id=__codelineno-20-21 name=__codelineno-20-21></a><a href=#__codelineno-20-21><span class=linenos data-linenos="21 "></span></a>        <span class=k>return</span> <span class=n>trace</span>
</span></code></pre></div><h2 id=future-enhancements>Future Enhancements<a class=headerlink href=#future-enhancements title="Permanent link">&para;</a></h2><h3 id=machine-learning-integration>Machine Learning Integration<a class=headerlink href=#machine-learning-integration title="Permanent link">&para;</a></h3><ul><li><strong>Conflict Prediction</strong>: ML model to predict conflicts before they occur</li><li><strong>Optimal Scheduling</strong>: Learn optimal scheduling patterns</li><li><strong>Resource Prediction</strong>: Predict resource needs based on story analysis</li><li><strong>Quality Prediction</strong>: Predict quality issues from parallel execution</li></ul><h3 id=advanced-features>Advanced Features<a class=headerlink href=#advanced-features title="Permanent link">&para;</a></h3><ul><li><strong>Cross-Project Coordination</strong>: Coordinate parallel execution across projects</li><li><strong>Distributed Execution</strong>: Distribute cycles across multiple machines</li><li><strong>Real-time Collaboration</strong>: Multiple humans coordinating parallel cycles</li><li><strong>Adaptive Parallelism</strong>: Self-adjusting parallelism level</li></ul><p>This parallel TDD architecture provides a robust foundation for scaling TDD execution while maintaining quality and preventing conflicts. The phased implementation approach ensures gradual rollout with minimal risk.</p><aside class=md-source-file><span class=md-source-file__fact><span class=md-icon title="Last update"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="June 18, 2025 00:22:32 UTC">June 18, 2025 00:22:32</span></span><span class=md-source-file__fact><span class=md-icon title=Created><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="June 18, 2025 00:22:32 UTC">June 18, 2025 00:22:32</span></span></aside><form class=md-feedback name=feedback hidden><fieldset><legend class=md-feedback__title> Was this page helpful? </legend><div class=md-feedback__inner><div class=md-feedback__list><button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg></button><button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg></button></div><div class=md-feedback__note><div data-md-value=1 hidden> Thanks for your feedback! </div><div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by <a href="https://github.com/jmontp/agent-workflow/issues/new/?title=[Feedback]+Parallel%20TDD%20Design+-+/architecture/parallel-tdd-architecture/" target=_blank rel=noopener>telling us what you found confusing</a>. </div></div></div></fieldset></form></article></div><script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script><script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script></div><button type=button class="md-top md-icon" data-md-component=top hidden><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button></main><footer class=md-footer><nav class="md-footer__inner md-grid" aria-label=Footer><a href=../context-implementation-plan/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Context Implementation Plan"><div class="md-footer__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M15.41 16.58 10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg></div><div class=md-footer__title><span class=md-footer__direction> Previous </span><div class=md-ellipsis> Context Implementation Plan </div></div></a><a href=../parallel-tdd-technical-specification/ class="md-footer__link md-footer__link--next" aria-label="Next: Parallel TDD Implementation"><div class=md-footer__title><span class=md-footer__direction> Next </span><div class=md-ellipsis> Parallel TDD Implementation </div></div><div class="md-footer__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg></div></a></nav><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-copyright></div><div class=md-social><a href=https://github.com/jmontp/agent-workflow target=_blank rel=noopener title="GitHub Repository" class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg></a><a href=https://jmontp.github.io/agent-workflow/ target=_blank rel=noopener title="Documentation Site" class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg></a><a href=https://discord.gg/your-discord-server target=_blank rel=noopener title="Discord Community" class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3c5.5 0 10 3.58 10 8s-4.5 8-10 8c-1.24 0-2.43-.18-3.53-.5C5.55 21 2 21 2 21c2.33-2.33 2.7-3.9 2.75-4.5C3.05 15.07 2 13.13 2 11c0-4.42 4.5-8 10-8"/></svg></a><a href=https://github.com/sponsors/jmontp target=_blank rel=noopener title=Sponsor class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12 21.35-1.45-1.32C5.4 15.36 2 12.27 2 8.5 2 5.41 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.08C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53z"/></svg></a></div></div></div></footer></div><div class=md-dialog data-md-component=dialog><div class="md-dialog__inner md-typeset"></div></div><div class=md-progress data-md-component=progress role=progressbar></div><div class=md-consent data-md-component=consent id=__consent hidden><div class=md-consent__overlay></div><aside class=md-consent__inner><form class="md-consent__form md-grid md-typeset" name=consent><h4>Cookie consent</h4><p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p><input class=md-toggle type=checkbox id=__settings><div class=md-consent__settings><ul class=task-list><li class=task-list-item><label class=task-list-control><input type=checkbox name=analytics checked><span class=task-list-indicator></span> Google Analytics </label></li><li class=task-list-item><label class=task-list-control><input type=checkbox name=github checked><span class=task-list-indicator></span> GitHub </label></li></ul></div><div class=md-consent__controls><button class="md-button md-button--primary">Accept</button><button type=reset class="md-button md-button--primary">Reject</button><label class=md-button for=__settings>Manage settings</label></div></form></aside></div><script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script><script id=__config type=application/json>{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.footnote.tooltips", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": {"API": "api", "Architecture": "architecture", "CSS": "css", "Discord": "discord", "HTML5": "html", "JavaScript": "js", "Python": "python", "Scrum": "scrum", "TDD": "tdd"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script><script src=../../assets/javascripts/bundle.13a4f30d.min.js></script><script src=https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mtml-chtml.js></script><script src=../../js/mermaid-zoom.js></script><script src=../../js/universal-search.js></script><script src=../../js/enhanced-navigation.js></script><script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body></html>