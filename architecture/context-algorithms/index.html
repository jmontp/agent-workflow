<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Human-In-The-Loop orchestration framework for AI-assisted software development"><meta name=author content="AI Agent Workflow Team"><link href=https://jmontp.github.io/agent-workflow/architecture/context-algorithms/ rel=canonical><link href=../context-api-specification/ rel=prev><link href=../context-evaluation-framework/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.14"><title>Context Algorithms - AI Agent TDD-Scrum Workflow</title><link rel=stylesheet href=../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><style>:root{.md-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M5.5%207A1.5%201.5%200%200%201%204%205.5%201.5%201.5%200%200%201%205.5%204%201.5%201.5%200%200%201%207%205.5%201.5%201.5%200%200%201%205.5%207m15.91%204.58-9-9C12.05%202.22%2011.55%202%2011%202H4c-1.11%200-2%20.89-2%202v7c0%20.55.22%201.05.59%201.41l8.99%209c.37.36.87.59%201.42.59s1.05-.23%201.41-.59l7-7c.37-.36.59-.86.59-1.41%200-.56-.23-1.06-.59-1.42%22/%3E%3C/svg%3E');}.md-tag.md-tag--html{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22m12%2017.56%204.07-1.13.55-6.1H9.38L9.2%208.3h7.6l.2-1.99H7l.56%206.01h6.89l-.23%202.58-2.22.6-2.22-.6-.14-1.66h-2l.29%203.19zM4.07%203h15.86L18.5%2019.2%2012%2021l-6.5-1.8z%22/%3E%3C/svg%3E');}.md-tag.md-tag--js{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M3%203h18v18H3zm4.73%2015.04c.4.85%201.19%201.55%202.54%201.55%201.5%200%202.53-.8%202.53-2.55v-5.78h-1.7V17c0%20.86-.35%201.08-.9%201.08-.58%200-.82-.4-1.09-.87zm5.98-.18c.5.98%201.51%201.73%203.09%201.73%201.6%200%202.8-.83%202.8-2.36%200-1.41-.81-2.04-2.25-2.66l-.42-.18c-.73-.31-1.04-.52-1.04-1.02%200-.41.31-.73.81-.73.48%200%20.8.21%201.09.73l1.31-.87c-.55-.96-1.33-1.33-2.4-1.33-1.51%200-2.48.96-2.48%202.23%200%201.38.81%202.03%202.03%202.55l.42.18c.78.34%201.24.55%201.24%201.13%200%20.48-.45.83-1.15.83-.83%200-1.31-.43-1.67-1.03z%22/%3E%3C/svg%3E');}.md-tag.md-tag--css{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22m5%203-.65%203.34h13.59L17.5%208.5H3.92l-.66%203.33h13.59l-.76%203.81-5.48%201.81-4.75-1.81.33-1.64H2.85l-.79%204%207.85%203%209.05-3%201.2-6.03.24-1.21L21.94%203z%22/%3E%3C/svg%3E');}.md-tag.md-tag--python{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M19.14%207.5A2.86%202.86%200%200%201%2022%2010.36v3.78A2.86%202.86%200%200%201%2019.14%2017H12c0%20.39.32.96.71.96H17v1.68a2.86%202.86%200%200%201-2.86%202.86H9.86A2.86%202.86%200%200%201%207%2019.64v-3.75a2.85%202.85%200%200%201%202.86-2.85h5.25a2.85%202.85%200%200%200%202.85-2.86V7.5zm-4.28%2011.79c-.4%200-.72.3-.72.89s.32.71.72.71a.71.71%200%200%200%20.71-.71c0-.59-.32-.89-.71-.89m-10-1.79A2.86%202.86%200%200%201%202%2014.64v-3.78A2.86%202.86%200%200%201%204.86%208H12c0-.39-.32-.96-.71-.96H7V5.36A2.86%202.86%200%200%201%209.86%202.5h4.28A2.86%202.86%200%200%201%2017%205.36v3.75a2.85%202.85%200%200%201-2.86%202.85H8.89a2.85%202.85%200%200%200-2.85%202.86v2.68zM9.14%205.71c.4%200%20.72-.3.72-.89s-.32-.71-.72-.71c-.39%200-.71.12-.71.71s.32.89.71.89%22/%3E%3C/svg%3E');}}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><link rel=stylesheet href=../../stylesheets/enhanced-navigation.css><link rel=stylesheet href=../../stylesheets/color-schemes.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script> <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head><body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=black><input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off><input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off><label class=md-overlay for=__drawer></label><div data-md-component=skip><a href=#context-management-algorithms-and-research class=md-skip> Skip to content </a></div><div data-md-component=announce></div><div data-md-color-scheme=default data-md-component=outdated hidden></div><header class="md-header md-header--shadow md-header--lifted" data-md-component=header><nav class="md-header__inner md-grid" aria-label=Header><a href=../.. title="AI Agent TDD-Scrum Workflow" class="md-header__button md-logo" aria-label="AI Agent TDD-Scrum Workflow" data-md-component=logo><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg></a><label class="md-header__button md-icon" for=__drawer><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg></label><div class=md-header__title data-md-component=header-title><div class=md-header__ellipsis><div class=md-header__topic><span class=md-ellipsis> AI Agent TDD-Scrum Workflow </span></div><div class=md-header__topic data-md-component=header-topic><span class=md-ellipsis> Context Algorithms </span></div></div></div><div class=md-header__option><div class=md-select><button class="md-header__button md-icon" aria-label="Select language"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg></button><div class=md-select__inner><ul class=md-select__list><li class=md-select__item><a href=../../ hreflang=en class=md-select__link> English </a></li></ul></div></div></div><label class="md-header__button md-icon" for=__search><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required><label class="md-search__icon md-icon" for=__search><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M15.41 16.58 10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg></label><nav class=md-search__options aria-label=Search><a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg></a><button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button></nav><div class=md-search__suggest data-md-component=search-suggest></div></form><div class=md-search__output><div class=md-search__scrollwrap tabindex=0 data-md-scrollfix><div class=md-search-result data-md-component=search-result><div class=md-search-result__meta> Initializing search </div><ol class=md-search-result__list role=presentation></ol></div></div></div></div></div><div class=md-header__source><a href=https://github.com/jmontp/agent-workflow title="Go to repository" class=md-source data-md-component=source><div class="md-source__icon md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg></div><div class=md-source__repository> jmontp/agent-workflow </div></a></div></nav><nav class=md-tabs aria-label=Tabs data-md-component=tabs><div class=md-grid><ul class=md-tabs__list><li class=md-tabs__item><a href=../.. class=md-tabs__link> 🏠 Home </a></li><li class=md-tabs__item><a href=../../getting-started/ class=md-tabs__link> ⚡ Getting Started </a></li><li class=md-tabs__item><a href=../../user-guide/ class=md-tabs__link> 📊 User Guide </a></li><li class=md-tabs__item><a href=../../concepts/ class=md-tabs__link> 🎯 Core Concepts </a></li><li class="md-tabs__item md-tabs__item--active"><a href=../ class=md-tabs__link> 🔥 Architecture </a></li><li class=md-tabs__item><a href=../../advanced/ class=md-tabs__link> ⚡ Advanced Topics </a></li><li class=md-tabs__item><a href=../../planning/ class=md-tabs__link> 🎨 Planning & Design </a></li><li class=md-tabs__item><a href=../../development/ class=md-tabs__link> 📊 Development </a></li><li class=md-tabs__item><a href=../../deployment/ class=md-tabs__link> 🔥 Deployment </a></li><li class=md-tabs__item><a href=../../templates/ class=md-tabs__link> 📋 Templates </a></li><li class=md-tabs__item><a href=../../theme-integration-guide/ class=md-tabs__link> 🎨 Theme Integration </a></li></ul></div></nav></header><div class=md-container data-md-component=container><main class=md-main data-md-component=main><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0><label class=md-nav__title for=__drawer><a href=../.. title="AI Agent TDD-Scrum Workflow" class="md-nav__button md-logo" aria-label="AI Agent TDD-Scrum Workflow" data-md-component=logo><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg></a> AI Agent TDD-Scrum Workflow </label><div class=md-nav__source><a href=https://github.com/jmontp/agent-workflow title="Go to repository" class=md-source data-md-component=source><div class="md-source__icon md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg></div><div class=md-source__repository> jmontp/agent-workflow </div></a></div><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../.. class=md-nav__link><span class=md-ellipsis> 🏠 Home </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../getting-started/ class=md-nav__link><span class=md-ellipsis> ⚡ Getting Started </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../user-guide/ class=md-nav__link><span class=md-ellipsis> 📊 User Guide </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../concepts/ class=md-nav__link><span class=md-ellipsis> 🎯 Core Concepts </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked><div class="md-nav__link md-nav__container"><a href=../ class="md-nav__link "><span class=md-ellipsis> 🔥 Architecture </span></a><label class="md-nav__link " for=__nav_5 id=__nav_5_label tabindex><span class="md-nav__icon md-icon"></span></label></div><nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true><label class=md-nav__title for=__nav_5><span class="md-nav__icon md-icon"></span> 🔥 Architecture </label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../system-overview/ class=md-nav__link><span class=md-ellipsis> 🏗️ System Overview </span></a></li><li class=md-nav__item><a href=../component-architecture/ class=md-nav__link><span class=md-ellipsis> 🔧 Component Architecture </span></a></li><li class=md-nav__item><a href=../context-management-system/ class=md-nav__link><span class=md-ellipsis> 🧠 Context Management </span></a></li><li class=md-nav__item><a href=../context-api-specification/ class=md-nav__link><span class=md-ellipsis> Context API Specification </span></a></li><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle" type=checkbox id=__toc><label class="md-nav__link md-nav__link--active" for=__toc><span class=md-ellipsis> Context Algorithms </span><span class="md-nav__icon md-icon"></span></label><a href=./ class="md-nav__link md-nav__link--active"><span class=md-ellipsis> Context Algorithms </span></a><nav class="md-nav md-nav--secondary" aria-label="On this page"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> On this page </label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a href=#overview class=md-nav__link><span class=md-ellipsis> Overview </span></a></li><li class=md-nav__item><a href=#relevance-scoring-algorithm class=md-nav__link><span class=md-ellipsis> Relevance Scoring Algorithm </span></a><nav class=md-nav aria-label="Relevance Scoring Algorithm"><ul class=md-nav__list><li class=md-nav__item><a href=#multi-factor-relevance-scoring class=md-nav__link><span class=md-ellipsis> Multi-Factor Relevance Scoring </span></a></li><li class=md-nav__item><a href=#component-algorithms class=md-nav__link><span class=md-ellipsis> Component Algorithms </span></a></li></ul></nav></li><li class=md-nav__item><a href=#content-compression-algorithms class=md-nav__link><span class=md-ellipsis> Content Compression Algorithms </span></a><nav class=md-nav aria-label="Content Compression Algorithms"><ul class=md-nav__list><li class=md-nav__item><a href=#adaptive-python-code-compression class=md-nav__link><span class=md-ellipsis> Adaptive Python Code Compression </span></a></li><li class=md-nav__item><a href=#test-file-compression class=md-nav__link><span class=md-ellipsis> Test File Compression </span></a></li></ul></nav></li><li class=md-nav__item><a href=#token-budget-allocation-algorithm class=md-nav__link><span class=md-ellipsis> Token Budget Allocation Algorithm </span></a><nav class=md-nav aria-label="Token Budget Allocation Algorithm"><ul class=md-nav__list><li class=md-nav__item><a href=#dynamic-budget-allocation class=md-nav__link><span class=md-ellipsis> Dynamic Budget Allocation </span></a></li></ul></nav></li><li class=md-nav__item><a href=#dependency-analysis-algorithm class=md-nav__link><span class=md-ellipsis> Dependency Analysis Algorithm </span></a><nav class=md-nav aria-label="Dependency Analysis Algorithm"><ul class=md-nav__list><li class=md-nav__item><a href=#static-dependency-analysis class=md-nav__link><span class=md-ellipsis> Static Dependency Analysis </span></a></li></ul></nav></li><li class=md-nav__item><a href=#caching-and-performance-algorithms class=md-nav__link><span class=md-ellipsis> Caching and Performance Algorithms </span></a><nav class=md-nav aria-label="Caching and Performance Algorithms"><ul class=md-nav__list><li class=md-nav__item><a href=#intelligent-cache-management class=md-nav__link><span class=md-ellipsis> Intelligent Cache Management </span></a></li></ul></nav></li></ul></nav></li><li class=md-nav__item><a href=../context-evaluation-framework/ class=md-nav__link><span class=md-ellipsis> Context Evaluation Framework </span></a></li><li class=md-nav__item><a href=../context-implementation-plan/ class=md-nav__link><span class=md-ellipsis> Context Implementation Plan </span></a></li><li class=md-nav__item><a href=../parallel-tdd-architecture/ class=md-nav__link><span class=md-ellipsis> Parallel TDD Design </span></a></li><li class=md-nav__item><a href=../parallel-tdd-technical-specification/ class=md-nav__link><span class=md-ellipsis> Parallel TDD Implementation </span></a></li><li class=md-nav__item><a href=../parallel-tdd-implementation-strategy/ class=md-nav__link><span class=md-ellipsis> Parallel TDD Implementation Strategy </span></a></li><li class=md-nav__item><a href=../parallel-tdd-comprehensive-implementation-plan/ class=md-nav__link><span class=md-ellipsis> Parallel TDD Comprehensive Plan </span></a></li><li class=md-nav__item><a href=../parallel-tdd-testing-strategy/ class=md-nav__link><span class=md-ellipsis> Parallel TDD Testing Strategy </span></a></li><li class=md-nav__item><a href=../parallel-context-integration/ class=md-nav__link><span class=md-ellipsis> Parallel Context Integration </span></a></li><li class=md-nav__item><a href=../parallel-agent-pool-management/ class=md-nav__link><span class=md-ellipsis> Parallel Agent Pool Management </span></a></li><li class=md-nav__item><a href=../parallel-conflict-algorithms/ class=md-nav__link><span class=md-ellipsis> Parallel Conflict Resolution </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../advanced/ class=md-nav__link><span class=md-ellipsis> ⚡ Advanced Topics </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../planning/ class=md-nav__link><span class=md-ellipsis> 🎨 Planning & Design </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../development/ class=md-nav__link><span class=md-ellipsis> 📊 Development </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../deployment/ class=md-nav__link><span class=md-ellipsis> 🔥 Deployment </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../templates/ class=md-nav__link><span class=md-ellipsis> 📋 Templates </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../theme-integration-guide/ class=md-nav__link><span class=md-ellipsis> 🎨 Theme Integration </span><span class="md-nav__icon md-icon"></span></a></li></ul></nav></div></div></div><div class=md-content data-md-component=content><article class="md-content__inner md-typeset"><a href=https://github.com/jmontp/agent-workflow/edit/master/docs/architecture/context-algorithms.md title="Edit this page" class="md-content__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg></a><a href=https://github.com/jmontp/agent-workflow/raw/master/docs/architecture/context-algorithms.md title="View source of this page" class="md-content__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg></a><h1 id=context-management-algorithms-and-research>Context Management Algorithms and Research<a class=headerlink href=#context-management-algorithms-and-research title="Permanent link">&para;</a></h1><h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2><p>This document details the core algorithms powering the Context Management System, including relevance scoring, content compression, dependency analysis, and token optimization. Each algorithm is designed to address specific challenges in managing context for AI agents while respecting token limitations.</p><h2 id=relevance-scoring-algorithm>Relevance Scoring Algorithm<a class=headerlink href=#relevance-scoring-algorithm title="Permanent link">&para;</a></h2><h3 id=multi-factor-relevance-scoring>Multi-Factor Relevance Scoring<a class=headerlink href=#multi-factor-relevance-scoring title="Permanent link">&para;</a></h3><p>The relevance scoring algorithm combines multiple factors to determine how relevant a file is to the current task context.</p><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1></a><a href=#__codelineno-0-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>def</span> <span class=nf>calculate_relevance_score</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>task</span><span class=p>:</span> <span class=n>TDDTask</span><span class=p>,</span> 
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2></a><a href=#__codelineno-0-2><span class=linenos data-linenos=" 2 "></span></a>                            <span class=n>context</span><span class=p>:</span> <span class=n>ContextRequest</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3></a><a href=#__codelineno-0-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4></a><a href=#__codelineno-0-4><span class=linenos data-linenos=" 4 "></span></a><span class=sd>    Calculate multi-factor relevance score (0.0 to 1.0)</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5></a><a href=#__codelineno-0-5><span class=linenos data-linenos=" 5 "></span></a><span class=sd>    </span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6></a><a href=#__codelineno-0-6><span class=linenos data-linenos=" 6 "></span></a><span class=sd>    Factors:</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7></a><a href=#__codelineno-0-7><span class=linenos data-linenos=" 7 "></span></a><span class=sd>    - Direct mention (40% weight): File explicitly referenced in task</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8></a><a href=#__codelineno-0-8><span class=linenos data-linenos=" 8 "></span></a><span class=sd>    - Dependency analysis (25% weight): Code dependencies and imports</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a><a href=#__codelineno-0-9><span class=linenos data-linenos=" 9 "></span></a><span class=sd>    - Historical relevance (20% weight): Past usage patterns</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10></a><a href=#__codelineno-0-10><span class=linenos data-linenos="10 "></span></a><span class=sd>    - Semantic similarity (10% weight): Content similarity to task</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11></a><a href=#__codelineno-0-11><span class=linenos data-linenos="11 "></span></a><span class=sd>    - TDD phase relevance (5% weight): Phase-specific importance</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a><a href=#__codelineno-0-12><span class=linenos data-linenos="12 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a><a href=#__codelineno-0-13><span class=linenos data-linenos="13 "></span></a>    
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a><a href=#__codelineno-0-14><span class=linenos data-linenos="14 "></span></a>    <span class=c1># Factor 1: Direct mention in task description or files</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a><a href=#__codelineno-0-15><span class=linenos data-linenos="15 "></span></a>    <span class=n>direct_mention_score</span> <span class=o>=</span> <span class=n>calculate_direct_mention_score</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>task</span><span class=p>)</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a><a href=#__codelineno-0-16><span class=linenos data-linenos="16 "></span></a>    
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a><a href=#__codelineno-0-17><span class=linenos data-linenos="17 "></span></a>    <span class=c1># Factor 2: Static dependency analysis</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a><a href=#__codelineno-0-18><span class=linenos data-linenos="18 "></span></a>    <span class=n>dependency_score</span> <span class=o>=</span> <span class=n>calculate_dependency_score</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>task</span><span class=o>.</span><span class=n>source_files</span><span class=p>)</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a><a href=#__codelineno-0-19><span class=linenos data-linenos="19 "></span></a>    
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a><a href=#__codelineno-0-20><span class=linenos data-linenos="20 "></span></a>    <span class=c1># Factor 3: Historical usage patterns</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a><a href=#__codelineno-0-21><span class=linenos data-linenos="21 "></span></a>    <span class=n>historical_score</span> <span class=o>=</span> <span class=n>calculate_historical_relevance</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>context</span><span class=o>.</span><span class=n>agent_type</span><span class=p>,</span> <span class=n>task</span><span class=o>.</span><span class=n>story_id</span><span class=p>)</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a><a href=#__codelineno-0-22><span class=linenos data-linenos="22 "></span></a>    
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a><a href=#__codelineno-0-23><span class=linenos data-linenos="23 "></span></a>    <span class=c1># Factor 4: Semantic content similarity</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a><a href=#__codelineno-0-24><span class=linenos data-linenos="24 "></span></a>    <span class=n>semantic_score</span> <span class=o>=</span> <span class=n>calculate_semantic_similarity</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>task</span><span class=o>.</span><span class=n>description</span><span class=p>)</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a><a href=#__codelineno-0-25><span class=linenos data-linenos="25 "></span></a>    
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a><a href=#__codelineno-0-26><span class=linenos data-linenos="26 "></span></a>    <span class=c1># Factor 5: TDD phase-specific relevance</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a><a href=#__codelineno-0-27><span class=linenos data-linenos="27 "></span></a>    <span class=n>phase_score</span> <span class=o>=</span> <span class=n>calculate_phase_relevance</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>task</span><span class=o>.</span><span class=n>current_state</span><span class=p>)</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a><a href=#__codelineno-0-28><span class=linenos data-linenos="28 "></span></a>    
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a><a href=#__codelineno-0-29><span class=linenos data-linenos="29 "></span></a>    <span class=c1># Weighted combination</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a><a href=#__codelineno-0-30><span class=linenos data-linenos="30 "></span></a>    <span class=n>total_score</span> <span class=o>=</span> <span class=p>(</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a><a href=#__codelineno-0-31><span class=linenos data-linenos="31 "></span></a>        <span class=mf>0.40</span> <span class=o>*</span> <span class=n>direct_mention_score</span> <span class=o>+</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a><a href=#__codelineno-0-32><span class=linenos data-linenos="32 "></span></a>        <span class=mf>0.25</span> <span class=o>*</span> <span class=n>dependency_score</span> <span class=o>+</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a><a href=#__codelineno-0-33><span class=linenos data-linenos="33 "></span></a>        <span class=mf>0.20</span> <span class=o>*</span> <span class=n>historical_score</span> <span class=o>+</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a><a href=#__codelineno-0-34><span class=linenos data-linenos="34 "></span></a>        <span class=mf>0.10</span> <span class=o>*</span> <span class=n>semantic_score</span> <span class=o>+</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a><a href=#__codelineno-0-35><span class=linenos data-linenos="35 "></span></a>        <span class=mf>0.05</span> <span class=o>*</span> <span class=n>phase_score</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a><a href=#__codelineno-0-36><span class=linenos data-linenos="36 "></span></a>    <span class=p>)</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a><a href=#__codelineno-0-37><span class=linenos data-linenos="37 "></span></a>    
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a><a href=#__codelineno-0-38><span class=linenos data-linenos="38 "></span></a>    <span class=c1># Apply boost factors</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a><a href=#__codelineno-0-39><span class=linenos data-linenos="39 "></span></a>    <span class=n>boost_factor</span> <span class=o>=</span> <span class=n>calculate_boost_factors</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>task</span><span class=p>)</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a><a href=#__codelineno-0-40><span class=linenos data-linenos="40 "></span></a>    
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a><a href=#__codelineno-0-41><span class=linenos data-linenos="41 "></span></a>    <span class=k>return</span> <span class=nb>min</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>total_score</span> <span class=o>*</span> <span class=n>boost_factor</span><span class=p>)</span>
</span></code></pre></div><h3 id=component-algorithms>Component Algorithms<a class=headerlink href=#component-algorithms title="Permanent link">&para;</a></h3><h4 id=direct-mention-scoring>Direct Mention Scoring<a class=headerlink href=#direct-mention-scoring title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1></a><a href=#__codelineno-1-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>def</span> <span class=nf>calculate_direct_mention_score</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>task</span><span class=p>:</span> <span class=n>TDDTask</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2></a><a href=#__codelineno-1-2><span class=linenos data-linenos=" 2 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Calculate score based on direct mentions of file in task context&quot;&quot;&quot;</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3></a><a href=#__codelineno-1-3><span class=linenos data-linenos=" 3 "></span></a>    <span class=n>score</span> <span class=o>=</span> <span class=mf>0.0</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4></a><a href=#__codelineno-1-4><span class=linenos data-linenos=" 4 "></span></a>    
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5></a><a href=#__codelineno-1-5><span class=linenos data-linenos=" 5 "></span></a>    <span class=c1># Check if file is explicitly mentioned in task description</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6></a><a href=#__codelineno-1-6><span class=linenos data-linenos=" 6 "></span></a>    <span class=k>if</span> <span class=n>file_path</span> <span class=ow>in</span> <span class=n>task</span><span class=o>.</span><span class=n>description</span> <span class=ow>or</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span> <span class=ow>in</span> <span class=n>task</span><span class=o>.</span><span class=n>description</span><span class=p>:</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7></a><a href=#__codelineno-1-7><span class=linenos data-linenos=" 7 "></span></a>        <span class=n>score</span> <span class=o>+=</span> <span class=mf>0.8</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8></a><a href=#__codelineno-1-8><span class=linenos data-linenos=" 8 "></span></a>    
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9></a><a href=#__codelineno-1-9><span class=linenos data-linenos=" 9 "></span></a>    <span class=c1># Check if file is in task source files</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10></a><a href=#__codelineno-1-10><span class=linenos data-linenos="10 "></span></a>    <span class=k>if</span> <span class=n>file_path</span> <span class=ow>in</span> <span class=n>task</span><span class=o>.</span><span class=n>source_files</span><span class=p>:</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11></a><a href=#__codelineno-1-11><span class=linenos data-linenos="11 "></span></a>        <span class=n>score</span> <span class=o>+=</span> <span class=mf>1.0</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12></a><a href=#__codelineno-1-12><span class=linenos data-linenos="12 "></span></a>    
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13></a><a href=#__codelineno-1-13><span class=linenos data-linenos="13 "></span></a>    <span class=c1># Check if file is in test files</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14></a><a href=#__codelineno-1-14><span class=linenos data-linenos="14 "></span></a>    <span class=k>if</span> <span class=n>file_path</span> <span class=ow>in</span> <span class=n>task</span><span class=o>.</span><span class=n>test_files</span><span class=p>:</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15></a><a href=#__codelineno-1-15><span class=linenos data-linenos="15 "></span></a>        <span class=n>score</span> <span class=o>+=</span> <span class=mf>0.9</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16></a><a href=#__codelineno-1-16><span class=linenos data-linenos="16 "></span></a>    
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17></a><a href=#__codelineno-1-17><span class=linenos data-linenos="17 "></span></a>    <span class=c1># Check for file name mentions in acceptance criteria</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18></a><a href=#__codelineno-1-18><span class=linenos data-linenos="18 "></span></a>    <span class=k>for</span> <span class=n>criteria</span> <span class=ow>in</span> <span class=n>task</span><span class=o>.</span><span class=n>acceptance_criteria</span><span class=p>:</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19></a><a href=#__codelineno-1-19><span class=linenos data-linenos="19 "></span></a>        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span> <span class=ow>in</span> <span class=n>criteria</span><span class=p>:</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20></a><a href=#__codelineno-1-20><span class=linenos data-linenos="20 "></span></a>            <span class=n>score</span> <span class=o>+=</span> <span class=mf>0.6</span>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21></a><a href=#__codelineno-1-21><span class=linenos data-linenos="21 "></span></a>    
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22></a><a href=#__codelineno-1-22><span class=linenos data-linenos="22 "></span></a>    <span class=k>return</span> <span class=nb>min</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>score</span><span class=p>)</span>
</span></code></pre></div><h4 id=dependency-analysis-scoring>Dependency Analysis Scoring<a class=headerlink href=#dependency-analysis-scoring title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1></a><a href=#__codelineno-2-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>def</span> <span class=nf>calculate_dependency_score</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>source_files</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2></a><a href=#__codelineno-2-2><span class=linenos data-linenos=" 2 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Calculate relevance based on code dependencies&quot;&quot;&quot;</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3></a><a href=#__codelineno-2-3><span class=linenos data-linenos=" 3 "></span></a>    
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4></a><a href=#__codelineno-2-4><span class=linenos data-linenos=" 4 "></span></a>    <span class=c1># Get direct dependencies (imports)</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5></a><a href=#__codelineno-2-5><span class=linenos data-linenos=" 5 "></span></a>    <span class=n>direct_deps</span> <span class=o>=</span> <span class=n>get_direct_dependencies</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6></a><a href=#__codelineno-2-6><span class=linenos data-linenos=" 6 "></span></a>    
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7></a><a href=#__codelineno-2-7><span class=linenos data-linenos=" 7 "></span></a>    <span class=c1># Get reverse dependencies (what imports this file)</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8></a><a href=#__codelineno-2-8><span class=linenos data-linenos=" 8 "></span></a>    <span class=n>reverse_deps</span> <span class=o>=</span> <span class=n>get_reverse_dependencies</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9></a><a href=#__codelineno-2-9><span class=linenos data-linenos=" 9 "></span></a>    
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10></a><a href=#__codelineno-2-10><span class=linenos data-linenos="10 "></span></a>    <span class=c1># Calculate overlap with task source files</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11></a><a href=#__codelineno-2-11><span class=linenos data-linenos="11 "></span></a>    <span class=n>source_set</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>source_files</span><span class=p>)</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12></a><a href=#__codelineno-2-12><span class=linenos data-linenos="12 "></span></a>    
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13></a><a href=#__codelineno-2-13><span class=linenos data-linenos="13 "></span></a>    <span class=c1># Score based on direct dependencies overlap</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14></a><a href=#__codelineno-2-14><span class=linenos data-linenos="14 "></span></a>    <span class=n>direct_overlap</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>direct_deps</span><span class=p>)</span> <span class=o>&amp;</span> <span class=n>source_set</span><span class=p>)</span> <span class=o>/</span> <span class=nb>max</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>direct_deps</span><span class=p>),</span> <span class=mi>1</span><span class=p>)</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15></a><a href=#__codelineno-2-15><span class=linenos data-linenos="15 "></span></a>    
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16></a><a href=#__codelineno-2-16><span class=linenos data-linenos="16 "></span></a>    <span class=c1># Score based on reverse dependencies overlap</span>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17></a><a href=#__codelineno-2-17><span class=linenos data-linenos="17 "></span></a>    <span class=n>reverse_overlap</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>reverse_deps</span><span class=p>)</span> <span class=o>&amp;</span> <span class=n>source_set</span><span class=p>)</span> <span class=o>/</span> <span class=nb>max</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>reverse_deps</span><span class=p>),</span> <span class=mi>1</span><span class=p>)</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18></a><a href=#__codelineno-2-18><span class=linenos data-linenos="18 "></span></a>    
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19></a><a href=#__codelineno-2-19><span class=linenos data-linenos="19 "></span></a>    <span class=c1># Calculate transitive dependency score</span>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20></a><a href=#__codelineno-2-20><span class=linenos data-linenos="20 "></span></a>    <span class=n>transitive_score</span> <span class=o>=</span> <span class=n>calculate_transitive_dependency_score</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>source_files</span><span class=p>,</span> <span class=n>max_depth</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21></a><a href=#__codelineno-2-21><span class=linenos data-linenos="21 "></span></a>    
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22></a><a href=#__codelineno-2-22><span class=linenos data-linenos="22 "></span></a>    <span class=c1># Weighted combination</span>
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23></a><a href=#__codelineno-2-23><span class=linenos data-linenos="23 "></span></a>    <span class=n>dependency_score</span> <span class=o>=</span> <span class=p>(</span>
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24></a><a href=#__codelineno-2-24><span class=linenos data-linenos="24 "></span></a>        <span class=mf>0.5</span> <span class=o>*</span> <span class=n>direct_overlap</span> <span class=o>+</span>
</span><span id=__span-2-25><a id=__codelineno-2-25 name=__codelineno-2-25></a><a href=#__codelineno-2-25><span class=linenos data-linenos="25 "></span></a>        <span class=mf>0.3</span> <span class=o>*</span> <span class=n>reverse_overlap</span> <span class=o>+</span>
</span><span id=__span-2-26><a id=__codelineno-2-26 name=__codelineno-2-26></a><a href=#__codelineno-2-26><span class=linenos data-linenos="26 "></span></a>        <span class=mf>0.2</span> <span class=o>*</span> <span class=n>transitive_score</span>
</span><span id=__span-2-27><a id=__codelineno-2-27 name=__codelineno-2-27></a><a href=#__codelineno-2-27><span class=linenos data-linenos="27 "></span></a>    <span class=p>)</span>
</span><span id=__span-2-28><a id=__codelineno-2-28 name=__codelineno-2-28></a><a href=#__codelineno-2-28><span class=linenos data-linenos="28 "></span></a>    
</span><span id=__span-2-29><a id=__codelineno-2-29 name=__codelineno-2-29></a><a href=#__codelineno-2-29><span class=linenos data-linenos="29 "></span></a>    <span class=k>return</span> <span class=n>dependency_score</span>
</span><span id=__span-2-30><a id=__codelineno-2-30 name=__codelineno-2-30></a><a href=#__codelineno-2-30><span class=linenos data-linenos="30 "></span></a>
</span><span id=__span-2-31><a id=__codelineno-2-31 name=__codelineno-2-31></a><a href=#__codelineno-2-31><span class=linenos data-linenos="31 "></span></a><span class=k>def</span> <span class=nf>get_direct_dependencies</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-2-32><a id=__codelineno-2-32 name=__codelineno-2-32></a><a href=#__codelineno-2-32><span class=linenos data-linenos="32 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Extract direct dependencies from Python file&quot;&quot;&quot;</span>
</span><span id=__span-2-33><a id=__codelineno-2-33 name=__codelineno-2-33></a><a href=#__codelineno-2-33><span class=linenos data-linenos="33 "></span></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-2-34><a id=__codelineno-2-34 name=__codelineno-2-34></a><a href=#__codelineno-2-34><span class=linenos data-linenos="34 "></span></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-2-35><a id=__codelineno-2-35 name=__codelineno-2-35></a><a href=#__codelineno-2-35><span class=linenos data-linenos="35 "></span></a>            <span class=n>content</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span><span id=__span-2-36><a id=__codelineno-2-36 name=__codelineno-2-36></a><a href=#__codelineno-2-36><span class=linenos data-linenos="36 "></span></a>        
</span><span id=__span-2-37><a id=__codelineno-2-37 name=__codelineno-2-37></a><a href=#__codelineno-2-37><span class=linenos data-linenos="37 "></span></a>        <span class=n>tree</span> <span class=o>=</span> <span class=n>ast</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-2-38><a id=__codelineno-2-38 name=__codelineno-2-38></a><a href=#__codelineno-2-38><span class=linenos data-linenos="38 "></span></a>        <span class=n>dependencies</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-2-39><a id=__codelineno-2-39 name=__codelineno-2-39></a><a href=#__codelineno-2-39><span class=linenos data-linenos="39 "></span></a>        
</span><span id=__span-2-40><a id=__codelineno-2-40 name=__codelineno-2-40></a><a href=#__codelineno-2-40><span class=linenos data-linenos="40 "></span></a>        <span class=k>for</span> <span class=n>node</span> <span class=ow>in</span> <span class=n>ast</span><span class=o>.</span><span class=n>walk</span><span class=p>(</span><span class=n>tree</span><span class=p>):</span>
</span><span id=__span-2-41><a id=__codelineno-2-41 name=__codelineno-2-41></a><a href=#__codelineno-2-41><span class=linenos data-linenos="41 "></span></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>ast</span><span class=o>.</span><span class=n>Import</span><span class=p>):</span>
</span><span id=__span-2-42><a id=__codelineno-2-42 name=__codelineno-2-42></a><a href=#__codelineno-2-42><span class=linenos data-linenos="42 "></span></a>                <span class=k>for</span> <span class=n>alias</span> <span class=ow>in</span> <span class=n>node</span><span class=o>.</span><span class=n>names</span><span class=p>:</span>
</span><span id=__span-2-43><a id=__codelineno-2-43 name=__codelineno-2-43></a><a href=#__codelineno-2-43><span class=linenos data-linenos="43 "></span></a>                    <span class=n>dependencies</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>alias</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span><span id=__span-2-44><a id=__codelineno-2-44 name=__codelineno-2-44></a><a href=#__codelineno-2-44><span class=linenos data-linenos="44 "></span></a>            <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>ast</span><span class=o>.</span><span class=n>ImportFrom</span><span class=p>):</span>
</span><span id=__span-2-45><a id=__codelineno-2-45 name=__codelineno-2-45></a><a href=#__codelineno-2-45><span class=linenos data-linenos="45 "></span></a>                <span class=k>if</span> <span class=n>node</span><span class=o>.</span><span class=n>module</span><span class=p>:</span>
</span><span id=__span-2-46><a id=__codelineno-2-46 name=__codelineno-2-46></a><a href=#__codelineno-2-46><span class=linenos data-linenos="46 "></span></a>                    <span class=n>dependencies</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>node</span><span class=o>.</span><span class=n>module</span><span class=p>)</span>
</span><span id=__span-2-47><a id=__codelineno-2-47 name=__codelineno-2-47></a><a href=#__codelineno-2-47><span class=linenos data-linenos="47 "></span></a>        
</span><span id=__span-2-48><a id=__codelineno-2-48 name=__codelineno-2-48></a><a href=#__codelineno-2-48><span class=linenos data-linenos="48 "></span></a>        <span class=c1># Convert module names to file paths</span>
</span><span id=__span-2-49><a id=__codelineno-2-49 name=__codelineno-2-49></a><a href=#__codelineno-2-49><span class=linenos data-linenos="49 "></span></a>        <span class=k>return</span> <span class=n>resolve_module_paths</span><span class=p>(</span><span class=n>dependencies</span><span class=p>,</span> <span class=n>file_path</span><span class=p>)</span>
</span><span id=__span-2-50><a id=__codelineno-2-50 name=__codelineno-2-50></a><a href=#__codelineno-2-50><span class=linenos data-linenos="50 "></span></a>        
</span><span id=__span-2-51><a id=__codelineno-2-51 name=__codelineno-2-51></a><a href=#__codelineno-2-51><span class=linenos data-linenos="51 "></span></a>    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-2-52><a id=__codelineno-2-52 name=__codelineno-2-52></a><a href=#__codelineno-2-52><span class=linenos data-linenos="52 "></span></a>        <span class=k>return</span> <span class=p>[]</span>
</span></code></pre></div><h4 id=historical-relevance-scoring>Historical Relevance Scoring<a class=headerlink href=#historical-relevance-scoring title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1></a><a href=#__codelineno-3-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>def</span> <span class=nf>calculate_historical_relevance</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>agent_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>story_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2></a><a href=#__codelineno-3-2><span class=linenos data-linenos=" 2 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Calculate relevance based on historical usage patterns&quot;&quot;&quot;</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3></a><a href=#__codelineno-3-3><span class=linenos data-linenos=" 3 "></span></a>    
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4></a><a href=#__codelineno-3-4><span class=linenos data-linenos=" 4 "></span></a>    <span class=c1># Get historical access patterns</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5></a><a href=#__codelineno-3-5><span class=linenos data-linenos=" 5 "></span></a>    <span class=n>access_history</span> <span class=o>=</span> <span class=n>get_file_access_history</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>agent_type</span><span class=p>)</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6></a><a href=#__codelineno-3-6><span class=linenos data-linenos=" 6 "></span></a>    
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7></a><a href=#__codelineno-3-7><span class=linenos data-linenos=" 7 "></span></a>    <span class=c1># Get similar story patterns</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8></a><a href=#__codelineno-3-8><span class=linenos data-linenos=" 8 "></span></a>    <span class=n>similar_stories</span> <span class=o>=</span> <span class=n>get_similar_story_files</span><span class=p>(</span><span class=n>story_id</span><span class=p>,</span> <span class=n>file_path</span><span class=p>)</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9></a><a href=#__codelineno-3-9><span class=linenos data-linenos=" 9 "></span></a>    
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10></a><a href=#__codelineno-3-10><span class=linenos data-linenos="10 "></span></a>    <span class=c1># Calculate access frequency score</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11></a><a href=#__codelineno-3-11><span class=linenos data-linenos="11 "></span></a>    <span class=n>frequency_score</span> <span class=o>=</span> <span class=n>calculate_access_frequency_score</span><span class=p>(</span><span class=n>access_history</span><span class=p>)</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12></a><a href=#__codelineno-3-12><span class=linenos data-linenos="12 "></span></a>    
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13></a><a href=#__codelineno-3-13><span class=linenos data-linenos="13 "></span></a>    <span class=c1># Calculate recency score (more recent = higher score)</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14></a><a href=#__codelineno-3-14><span class=linenos data-linenos="14 "></span></a>    <span class=n>recency_score</span> <span class=o>=</span> <span class=n>calculate_recency_score</span><span class=p>(</span><span class=n>access_history</span><span class=p>)</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15></a><a href=#__codelineno-3-15><span class=linenos data-linenos="15 "></span></a>    
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16></a><a href=#__codelineno-3-16><span class=linenos data-linenos="16 "></span></a>    <span class=c1># Calculate similar story score</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17></a><a href=#__codelineno-3-17><span class=linenos data-linenos="17 "></span></a>    <span class=n>similarity_score</span> <span class=o>=</span> <span class=n>calculate_story_similarity_score</span><span class=p>(</span><span class=n>similar_stories</span><span class=p>)</span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18></a><a href=#__codelineno-3-18><span class=linenos data-linenos="18 "></span></a>    
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19></a><a href=#__codelineno-3-19><span class=linenos data-linenos="19 "></span></a>    <span class=c1># Weighted combination</span>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20></a><a href=#__codelineno-3-20><span class=linenos data-linenos="20 "></span></a>    <span class=n>historical_score</span> <span class=o>=</span> <span class=p>(</span>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21></a><a href=#__codelineno-3-21><span class=linenos data-linenos="21 "></span></a>        <span class=mf>0.4</span> <span class=o>*</span> <span class=n>frequency_score</span> <span class=o>+</span>
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22></a><a href=#__codelineno-3-22><span class=linenos data-linenos="22 "></span></a>        <span class=mf>0.3</span> <span class=o>*</span> <span class=n>recency_score</span> <span class=o>+</span>
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23></a><a href=#__codelineno-3-23><span class=linenos data-linenos="23 "></span></a>        <span class=mf>0.3</span> <span class=o>*</span> <span class=n>similarity_score</span>
</span><span id=__span-3-24><a id=__codelineno-3-24 name=__codelineno-3-24></a><a href=#__codelineno-3-24><span class=linenos data-linenos="24 "></span></a>    <span class=p>)</span>
</span><span id=__span-3-25><a id=__codelineno-3-25 name=__codelineno-3-25></a><a href=#__codelineno-3-25><span class=linenos data-linenos="25 "></span></a>    
</span><span id=__span-3-26><a id=__codelineno-3-26 name=__codelineno-3-26></a><a href=#__codelineno-3-26><span class=linenos data-linenos="26 "></span></a>    <span class=k>return</span> <span class=n>historical_score</span>
</span><span id=__span-3-27><a id=__codelineno-3-27 name=__codelineno-3-27></a><a href=#__codelineno-3-27><span class=linenos data-linenos="27 "></span></a>
</span><span id=__span-3-28><a id=__codelineno-3-28 name=__codelineno-3-28></a><a href=#__codelineno-3-28><span class=linenos data-linenos="28 "></span></a><span class=k>def</span> <span class=nf>calculate_access_frequency_score</span><span class=p>(</span><span class=n>access_history</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span><span id=__span-3-29><a id=__codelineno-3-29 name=__codelineno-3-29></a><a href=#__codelineno-3-29><span class=linenos data-linenos="29 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Score based on how frequently file has been accessed&quot;&quot;&quot;</span>
</span><span id=__span-3-30><a id=__codelineno-3-30 name=__codelineno-3-30></a><a href=#__codelineno-3-30><span class=linenos data-linenos="30 "></span></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>access_history</span><span class=p>:</span>
</span><span id=__span-3-31><a id=__codelineno-3-31 name=__codelineno-3-31></a><a href=#__codelineno-3-31><span class=linenos data-linenos="31 "></span></a>        <span class=k>return</span> <span class=mf>0.0</span>
</span><span id=__span-3-32><a id=__codelineno-3-32 name=__codelineno-3-32></a><a href=#__codelineno-3-32><span class=linenos data-linenos="32 "></span></a>    
</span><span id=__span-3-33><a id=__codelineno-3-33 name=__codelineno-3-33></a><a href=#__codelineno-3-33><span class=linenos data-linenos="33 "></span></a>    <span class=c1># Count accesses in different time windows</span>
</span><span id=__span-3-34><a id=__codelineno-3-34 name=__codelineno-3-34></a><a href=#__codelineno-3-34><span class=linenos data-linenos="34 "></span></a>    <span class=n>now</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span>
</span><span id=__span-3-35><a id=__codelineno-3-35 name=__codelineno-3-35></a><a href=#__codelineno-3-35><span class=linenos data-linenos="35 "></span></a>    
</span><span id=__span-3-36><a id=__codelineno-3-36 name=__codelineno-3-36></a><a href=#__codelineno-3-36><span class=linenos data-linenos="36 "></span></a>    <span class=n>recent_accesses</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=mi>1</span> <span class=k>for</span> <span class=n>access</span> <span class=ow>in</span> <span class=n>access_history</span> 
</span><span id=__span-3-37><a id=__codelineno-3-37 name=__codelineno-3-37></a><a href=#__codelineno-3-37><span class=linenos data-linenos="37 "></span></a>                         <span class=k>if</span> <span class=p>(</span><span class=n>now</span> <span class=o>-</span> <span class=n>access</span><span class=p>[</span><span class=s1>&#39;timestamp&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>days</span> <span class=o>&lt;=</span> <span class=mi>7</span><span class=p>)</span>
</span><span id=__span-3-38><a id=__codelineno-3-38 name=__codelineno-3-38></a><a href=#__codelineno-3-38><span class=linenos data-linenos="38 "></span></a>    <span class=n>total_accesses</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>access_history</span><span class=p>)</span>
</span><span id=__span-3-39><a id=__codelineno-3-39 name=__codelineno-3-39></a><a href=#__codelineno-3-39><span class=linenos data-linenos="39 "></span></a>    
</span><span id=__span-3-40><a id=__codelineno-3-40 name=__codelineno-3-40></a><a href=#__codelineno-3-40><span class=linenos data-linenos="40 "></span></a>    <span class=c1># Normalize based on total project activity</span>
</span><span id=__span-3-41><a id=__codelineno-3-41 name=__codelineno-3-41></a><a href=#__codelineno-3-41><span class=linenos data-linenos="41 "></span></a>    <span class=n>project_activity</span> <span class=o>=</span> <span class=n>get_project_activity_baseline</span><span class=p>()</span>
</span><span id=__span-3-42><a id=__codelineno-3-42 name=__codelineno-3-42></a><a href=#__codelineno-3-42><span class=linenos data-linenos="42 "></span></a>    
</span><span id=__span-3-43><a id=__codelineno-3-43 name=__codelineno-3-43></a><a href=#__codelineno-3-43><span class=linenos data-linenos="43 "></span></a>    <span class=n>frequency_ratio</span> <span class=o>=</span> <span class=n>total_accesses</span> <span class=o>/</span> <span class=nb>max</span><span class=p>(</span><span class=n>project_activity</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span><span id=__span-3-44><a id=__codelineno-3-44 name=__codelineno-3-44></a><a href=#__codelineno-3-44><span class=linenos data-linenos="44 "></span></a>    <span class=n>recency_boost</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>recent_accesses</span> <span class=o>/</span> <span class=mi>5</span><span class=p>)</span>  <span class=c1># Boost for recent activity</span>
</span><span id=__span-3-45><a id=__codelineno-3-45 name=__codelineno-3-45></a><a href=#__codelineno-3-45><span class=linenos data-linenos="45 "></span></a>    
</span><span id=__span-3-46><a id=__codelineno-3-46 name=__codelineno-3-46></a><a href=#__codelineno-3-46><span class=linenos data-linenos="46 "></span></a>    <span class=k>return</span> <span class=nb>min</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>frequency_ratio</span> <span class=o>*</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>+</span> <span class=n>recency_boost</span><span class=p>))</span>
</span></code></pre></div><h4 id=semantic-similarity-scoring>Semantic Similarity Scoring<a class=headerlink href=#semantic-similarity-scoring title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1></a><a href=#__codelineno-4-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>def</span> <span class=nf>calculate_semantic_similarity</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>task_description</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2></a><a href=#__codelineno-4-2><span class=linenos data-linenos=" 2 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Calculate semantic similarity between file content and task description&quot;&quot;&quot;</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3></a><a href=#__codelineno-4-3><span class=linenos data-linenos=" 3 "></span></a>    
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4></a><a href=#__codelineno-4-4><span class=linenos data-linenos=" 4 "></span></a>    <span class=c1># Extract key content from file</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5></a><a href=#__codelineno-4-5><span class=linenos data-linenos=" 5 "></span></a>    <span class=n>file_content</span> <span class=o>=</span> <span class=n>extract_file_summary</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6></a><a href=#__codelineno-4-6><span class=linenos data-linenos=" 6 "></span></a>    
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7></a><a href=#__codelineno-4-7><span class=linenos data-linenos=" 7 "></span></a>    <span class=c1># Use sentence embeddings for similarity</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8></a><a href=#__codelineno-4-8><span class=linenos data-linenos=" 8 "></span></a>    <span class=n>task_embedding</span> <span class=o>=</span> <span class=n>get_sentence_embedding</span><span class=p>(</span><span class=n>task_description</span><span class=p>)</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9></a><a href=#__codelineno-4-9><span class=linenos data-linenos=" 9 "></span></a>    <span class=n>file_embedding</span> <span class=o>=</span> <span class=n>get_sentence_embedding</span><span class=p>(</span><span class=n>file_content</span><span class=p>)</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10></a><a href=#__codelineno-4-10><span class=linenos data-linenos="10 "></span></a>    
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11></a><a href=#__codelineno-4-11><span class=linenos data-linenos="11 "></span></a>    <span class=c1># Calculate cosine similarity</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12></a><a href=#__codelineno-4-12><span class=linenos data-linenos="12 "></span></a>    <span class=n>similarity</span> <span class=o>=</span> <span class=n>cosine_similarity</span><span class=p>(</span><span class=n>task_embedding</span><span class=p>,</span> <span class=n>file_embedding</span><span class=p>)</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13></a><a href=#__codelineno-4-13><span class=linenos data-linenos="13 "></span></a>    
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14></a><a href=#__codelineno-4-14><span class=linenos data-linenos="14 "></span></a>    <span class=c1># Apply content type boosts</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15></a><a href=#__codelineno-4-15><span class=linenos data-linenos="15 "></span></a>    <span class=n>content_boost</span> <span class=o>=</span> <span class=n>get_content_type_boost</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>task_description</span><span class=p>)</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16></a><a href=#__codelineno-4-16><span class=linenos data-linenos="16 "></span></a>    
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17></a><a href=#__codelineno-4-17><span class=linenos data-linenos="17 "></span></a>    <span class=k>return</span> <span class=nb>min</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>similarity</span> <span class=o>*</span> <span class=n>content_boost</span><span class=p>)</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18></a><a href=#__codelineno-4-18><span class=linenos data-linenos="18 "></span></a>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19></a><a href=#__codelineno-4-19><span class=linenos data-linenos="19 "></span></a><span class=k>def</span> <span class=nf>extract_file_summary</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20></a><a href=#__codelineno-4-20><span class=linenos data-linenos="20 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Extract meaningful summary from file for semantic analysis&quot;&quot;&quot;</span>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21></a><a href=#__codelineno-4-21><span class=linenos data-linenos="21 "></span></a>    
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22></a><a href=#__codelineno-4-22><span class=linenos data-linenos="22 "></span></a>    <span class=k>if</span> <span class=n>file_path</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s1>&#39;.py&#39;</span><span class=p>):</span>
</span><span id=__span-4-23><a id=__codelineno-4-23 name=__codelineno-4-23></a><a href=#__codelineno-4-23><span class=linenos data-linenos="23 "></span></a>        <span class=k>return</span> <span class=n>extract_python_summary</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span><span id=__span-4-24><a id=__codelineno-4-24 name=__codelineno-4-24></a><a href=#__codelineno-4-24><span class=linenos data-linenos="24 "></span></a>    <span class=k>elif</span> <span class=n>file_path</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s1>&#39;.md&#39;</span><span class=p>):</span>
</span><span id=__span-4-25><a id=__codelineno-4-25 name=__codelineno-4-25></a><a href=#__codelineno-4-25><span class=linenos data-linenos="25 "></span></a>        <span class=k>return</span> <span class=n>extract_markdown_summary</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span><span id=__span-4-26><a id=__codelineno-4-26 name=__codelineno-4-26></a><a href=#__codelineno-4-26><span class=linenos data-linenos="26 "></span></a>    <span class=k>elif</span> <span class=n>file_path</span><span class=o>.</span><span class=n>endswith</span><span class=p>((</span><span class=s1>&#39;.yml&#39;</span><span class=p>,</span> <span class=s1>&#39;.yaml&#39;</span><span class=p>)):</span>
</span><span id=__span-4-27><a id=__codelineno-4-27 name=__codelineno-4-27></a><a href=#__codelineno-4-27><span class=linenos data-linenos="27 "></span></a>        <span class=k>return</span> <span class=n>extract_yaml_summary</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span><span id=__span-4-28><a id=__codelineno-4-28 name=__codelineno-4-28></a><a href=#__codelineno-4-28><span class=linenos data-linenos="28 "></span></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-4-29><a id=__codelineno-4-29 name=__codelineno-4-29></a><a href=#__codelineno-4-29><span class=linenos data-linenos="29 "></span></a>        <span class=k>return</span> <span class=n>extract_generic_summary</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span><span id=__span-4-30><a id=__codelineno-4-30 name=__codelineno-4-30></a><a href=#__codelineno-4-30><span class=linenos data-linenos="30 "></span></a>
</span><span id=__span-4-31><a id=__codelineno-4-31 name=__codelineno-4-31></a><a href=#__codelineno-4-31><span class=linenos data-linenos="31 "></span></a><span class=k>def</span> <span class=nf>extract_python_summary</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-4-32><a id=__codelineno-4-32 name=__codelineno-4-32></a><a href=#__codelineno-4-32><span class=linenos data-linenos="32 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Extract Python file summary including docstrings and key elements&quot;&quot;&quot;</span>
</span><span id=__span-4-33><a id=__codelineno-4-33 name=__codelineno-4-33></a><a href=#__codelineno-4-33><span class=linenos data-linenos="33 "></span></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-4-34><a id=__codelineno-4-34 name=__codelineno-4-34></a><a href=#__codelineno-4-34><span class=linenos data-linenos="34 "></span></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-4-35><a id=__codelineno-4-35 name=__codelineno-4-35></a><a href=#__codelineno-4-35><span class=linenos data-linenos="35 "></span></a>            <span class=n>content</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span><span id=__span-4-36><a id=__codelineno-4-36 name=__codelineno-4-36></a><a href=#__codelineno-4-36><span class=linenos data-linenos="36 "></span></a>        
</span><span id=__span-4-37><a id=__codelineno-4-37 name=__codelineno-4-37></a><a href=#__codelineno-4-37><span class=linenos data-linenos="37 "></span></a>        <span class=n>tree</span> <span class=o>=</span> <span class=n>ast</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-4-38><a id=__codelineno-4-38 name=__codelineno-4-38></a><a href=#__codelineno-4-38><span class=linenos data-linenos="38 "></span></a>        <span class=n>summary_parts</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-4-39><a id=__codelineno-4-39 name=__codelineno-4-39></a><a href=#__codelineno-4-39><span class=linenos data-linenos="39 "></span></a>        
</span><span id=__span-4-40><a id=__codelineno-4-40 name=__codelineno-4-40></a><a href=#__codelineno-4-40><span class=linenos data-linenos="40 "></span></a>        <span class=c1># Extract module docstring</span>
</span><span id=__span-4-41><a id=__codelineno-4-41 name=__codelineno-4-41></a><a href=#__codelineno-4-41><span class=linenos data-linenos="41 "></span></a>        <span class=k>if</span> <span class=n>ast</span><span class=o>.</span><span class=n>get_docstring</span><span class=p>(</span><span class=n>tree</span><span class=p>):</span>
</span><span id=__span-4-42><a id=__codelineno-4-42 name=__codelineno-4-42></a><a href=#__codelineno-4-42><span class=linenos data-linenos="42 "></span></a>            <span class=n>summary_parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>ast</span><span class=o>.</span><span class=n>get_docstring</span><span class=p>(</span><span class=n>tree</span><span class=p>))</span>
</span><span id=__span-4-43><a id=__codelineno-4-43 name=__codelineno-4-43></a><a href=#__codelineno-4-43><span class=linenos data-linenos="43 "></span></a>        
</span><span id=__span-4-44><a id=__codelineno-4-44 name=__codelineno-4-44></a><a href=#__codelineno-4-44><span class=linenos data-linenos="44 "></span></a>        <span class=c1># Extract class and function names and docstrings</span>
</span><span id=__span-4-45><a id=__codelineno-4-45 name=__codelineno-4-45></a><a href=#__codelineno-4-45><span class=linenos data-linenos="45 "></span></a>        <span class=k>for</span> <span class=n>node</span> <span class=ow>in</span> <span class=n>ast</span><span class=o>.</span><span class=n>walk</span><span class=p>(</span><span class=n>tree</span><span class=p>):</span>
</span><span id=__span-4-46><a id=__codelineno-4-46 name=__codelineno-4-46></a><a href=#__codelineno-4-46><span class=linenos data-linenos="46 "></span></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=p>(</span><span class=n>ast</span><span class=o>.</span><span class=n>ClassDef</span><span class=p>,</span> <span class=n>ast</span><span class=o>.</span><span class=n>FunctionDef</span><span class=p>)):</span>
</span><span id=__span-4-47><a id=__codelineno-4-47 name=__codelineno-4-47></a><a href=#__codelineno-4-47><span class=linenos data-linenos="47 "></span></a>                <span class=n>summary_parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>node</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span><span id=__span-4-48><a id=__codelineno-4-48 name=__codelineno-4-48></a><a href=#__codelineno-4-48><span class=linenos data-linenos="48 "></span></a>                <span class=k>if</span> <span class=n>ast</span><span class=o>.</span><span class=n>get_docstring</span><span class=p>(</span><span class=n>node</span><span class=p>):</span>
</span><span id=__span-4-49><a id=__codelineno-4-49 name=__codelineno-4-49></a><a href=#__codelineno-4-49><span class=linenos data-linenos="49 "></span></a>                    <span class=n>summary_parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>ast</span><span class=o>.</span><span class=n>get_docstring</span><span class=p>(</span><span class=n>node</span><span class=p>))</span>
</span><span id=__span-4-50><a id=__codelineno-4-50 name=__codelineno-4-50></a><a href=#__codelineno-4-50><span class=linenos data-linenos="50 "></span></a>        
</span><span id=__span-4-51><a id=__codelineno-4-51 name=__codelineno-4-51></a><a href=#__codelineno-4-51><span class=linenos data-linenos="51 "></span></a>        <span class=c1># Extract comments</span>
</span><span id=__span-4-52><a id=__codelineno-4-52 name=__codelineno-4-52></a><a href=#__codelineno-4-52><span class=linenos data-linenos="52 "></span></a>        <span class=n>comments</span> <span class=o>=</span> <span class=n>extract_comments</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-4-53><a id=__codelineno-4-53 name=__codelineno-4-53></a><a href=#__codelineno-4-53><span class=linenos data-linenos="53 "></span></a>        <span class=n>summary_parts</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>comments</span><span class=p>)</span>
</span><span id=__span-4-54><a id=__codelineno-4-54 name=__codelineno-4-54></a><a href=#__codelineno-4-54><span class=linenos data-linenos="54 "></span></a>        
</span><span id=__span-4-55><a id=__codelineno-4-55 name=__codelineno-4-55></a><a href=#__codelineno-4-55><span class=linenos data-linenos="55 "></span></a>        <span class=k>return</span> <span class=s1>&#39; &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>summary_parts</span><span class=p>)</span>
</span><span id=__span-4-56><a id=__codelineno-4-56 name=__codelineno-4-56></a><a href=#__codelineno-4-56><span class=linenos data-linenos="56 "></span></a>        
</span><span id=__span-4-57><a id=__codelineno-4-57 name=__codelineno-4-57></a><a href=#__codelineno-4-57><span class=linenos data-linenos="57 "></span></a>    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-4-58><a id=__codelineno-4-58 name=__codelineno-4-58></a><a href=#__codelineno-4-58><span class=linenos data-linenos="58 "></span></a>        <span class=k>return</span> <span class=s2>&quot;&quot;</span>
</span></code></pre></div><h2 id=content-compression-algorithms>Content Compression Algorithms<a class=headerlink href=#content-compression-algorithms title="Permanent link">&para;</a></h2><h3 id=adaptive-python-code-compression>Adaptive Python Code Compression<a class=headerlink href=#adaptive-python-code-compression title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1></a><a href=#__codelineno-5-1><span class=linenos data-linenos="  1 "></span></a><span class=k>def</span> <span class=nf>compress_python_code</span><span class=p>(</span><span class=n>content</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>target_tokens</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> 
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2></a><a href=#__codelineno-5-2><span class=linenos data-linenos="  2 "></span></a>                        <span class=n>preserve_structure</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>CompressionResult</span><span class=p>:</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3></a><a href=#__codelineno-5-3><span class=linenos data-linenos="  3 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4></a><a href=#__codelineno-5-4><span class=linenos data-linenos="  4 "></span></a><span class=sd>    Compress Python code while preserving semantic meaning and structure</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5></a><a href=#__codelineno-5-5><span class=linenos data-linenos="  5 "></span></a><span class=sd>    </span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6></a><a href=#__codelineno-5-6><span class=linenos data-linenos="  6 "></span></a><span class=sd>    Compression Strategy:</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7></a><a href=#__codelineno-5-7><span class=linenos data-linenos="  7 "></span></a><span class=sd>    1. Parse AST to understand code structure</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8></a><a href=#__codelineno-5-8><span class=linenos data-linenos="  8 "></span></a><span class=sd>    2. Identify critical elements (classes, functions, key logic)</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9></a><a href=#__codelineno-5-9><span class=linenos data-linenos="  9 "></span></a><span class=sd>    3. Remove or summarize non-critical elements</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10></a><a href=#__codelineno-5-10><span class=linenos data-linenos=" 10 "></span></a><span class=sd>    4. Reconstruct code with preserved structure</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11></a><a href=#__codelineno-5-11><span class=linenos data-linenos=" 11 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12></a><a href=#__codelineno-5-12><span class=linenos data-linenos=" 12 "></span></a>    
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13></a><a href=#__codelineno-5-13><span class=linenos data-linenos=" 13 "></span></a>    <span class=n>original_tokens</span> <span class=o>=</span> <span class=n>estimate_tokens</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14></a><a href=#__codelineno-5-14><span class=linenos data-linenos=" 14 "></span></a>    
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15></a><a href=#__codelineno-5-15><span class=linenos data-linenos=" 15 "></span></a>    <span class=k>if</span> <span class=n>original_tokens</span> <span class=o>&lt;=</span> <span class=n>target_tokens</span><span class=p>:</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16></a><a href=#__codelineno-5-16><span class=linenos data-linenos=" 16 "></span></a>        <span class=k>return</span> <span class=n>CompressionResult</span><span class=p>(</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17></a><a href=#__codelineno-5-17><span class=linenos data-linenos=" 17 "></span></a>            <span class=n>compressed_content</span><span class=o>=</span><span class=n>content</span><span class=p>,</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18></a><a href=#__codelineno-5-18><span class=linenos data-linenos=" 18 "></span></a>            <span class=n>original_tokens</span><span class=o>=</span><span class=n>original_tokens</span><span class=p>,</span>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19></a><a href=#__codelineno-5-19><span class=linenos data-linenos=" 19 "></span></a>            <span class=n>compressed_tokens</span><span class=o>=</span><span class=n>original_tokens</span><span class=p>,</span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20></a><a href=#__codelineno-5-20><span class=linenos data-linenos=" 20 "></span></a>            <span class=n>compression_ratio</span><span class=o>=</span><span class=mf>1.0</span><span class=p>,</span>
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21></a><a href=#__codelineno-5-21><span class=linenos data-linenos=" 21 "></span></a>            <span class=n>semantic_preservation_score</span><span class=o>=</span><span class=mf>1.0</span>
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22></a><a href=#__codelineno-5-22><span class=linenos data-linenos=" 22 "></span></a>        <span class=p>)</span>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23></a><a href=#__codelineno-5-23><span class=linenos data-linenos=" 23 "></span></a>    
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24></a><a href=#__codelineno-5-24><span class=linenos data-linenos=" 24 "></span></a>    <span class=c1># Parse code into AST</span>
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25></a><a href=#__codelineno-5-25><span class=linenos data-linenos=" 25 "></span></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26></a><a href=#__codelineno-5-26><span class=linenos data-linenos=" 26 "></span></a>        <span class=n>tree</span> <span class=o>=</span> <span class=n>ast</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27></a><a href=#__codelineno-5-27><span class=linenos data-linenos=" 27 "></span></a>    <span class=k>except</span> <span class=ne>SyntaxError</span><span class=p>:</span>
</span><span id=__span-5-28><a id=__codelineno-5-28 name=__codelineno-5-28></a><a href=#__codelineno-5-28><span class=linenos data-linenos=" 28 "></span></a>        <span class=c1># Fallback to line-based compression for invalid syntax</span>
</span><span id=__span-5-29><a id=__codelineno-5-29 name=__codelineno-5-29></a><a href=#__codelineno-5-29><span class=linenos data-linenos=" 29 "></span></a>        <span class=k>return</span> <span class=n>compress_python_lines</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=n>target_tokens</span><span class=p>)</span>
</span><span id=__span-5-30><a id=__codelineno-5-30 name=__codelineno-5-30></a><a href=#__codelineno-5-30><span class=linenos data-linenos=" 30 "></span></a>    
</span><span id=__span-5-31><a id=__codelineno-5-31 name=__codelineno-5-31></a><a href=#__codelineno-5-31><span class=linenos data-linenos=" 31 "></span></a>    <span class=c1># Analyze code elements</span>
</span><span id=__span-5-32><a id=__codelineno-5-32 name=__codelineno-5-32></a><a href=#__codelineno-5-32><span class=linenos data-linenos=" 32 "></span></a>    <span class=n>elements</span> <span class=o>=</span> <span class=n>analyze_code_elements</span><span class=p>(</span><span class=n>tree</span><span class=p>)</span>
</span><span id=__span-5-33><a id=__codelineno-5-33 name=__codelineno-5-33></a><a href=#__codelineno-5-33><span class=linenos data-linenos=" 33 "></span></a>    
</span><span id=__span-5-34><a id=__codelineno-5-34 name=__codelineno-5-34></a><a href=#__codelineno-5-34><span class=linenos data-linenos=" 34 "></span></a>    <span class=c1># Determine compression strategy based on target ratio</span>
</span><span id=__span-5-35><a id=__codelineno-5-35 name=__codelineno-5-35></a><a href=#__codelineno-5-35><span class=linenos data-linenos=" 35 "></span></a>    <span class=n>target_ratio</span> <span class=o>=</span> <span class=n>target_tokens</span> <span class=o>/</span> <span class=n>original_tokens</span>
</span><span id=__span-5-36><a id=__codelineno-5-36 name=__codelineno-5-36></a><a href=#__codelineno-5-36><span class=linenos data-linenos=" 36 "></span></a>    <span class=n>compression_strategy</span> <span class=o>=</span> <span class=n>select_compression_strategy</span><span class=p>(</span><span class=n>target_ratio</span><span class=p>)</span>
</span><span id=__span-5-37><a id=__codelineno-5-37 name=__codelineno-5-37></a><a href=#__codelineno-5-37><span class=linenos data-linenos=" 37 "></span></a>    
</span><span id=__span-5-38><a id=__codelineno-5-38 name=__codelineno-5-38></a><a href=#__codelineno-5-38><span class=linenos data-linenos=" 38 "></span></a>    <span class=c1># Apply compression strategy</span>
</span><span id=__span-5-39><a id=__codelineno-5-39 name=__codelineno-5-39></a><a href=#__codelineno-5-39><span class=linenos data-linenos=" 39 "></span></a>    <span class=n>compressed_tree</span> <span class=o>=</span> <span class=n>apply_compression_strategy</span><span class=p>(</span><span class=n>tree</span><span class=p>,</span> <span class=n>elements</span><span class=p>,</span> <span class=n>compression_strategy</span><span class=p>)</span>
</span><span id=__span-5-40><a id=__codelineno-5-40 name=__codelineno-5-40></a><a href=#__codelineno-5-40><span class=linenos data-linenos=" 40 "></span></a>    
</span><span id=__span-5-41><a id=__codelineno-5-41 name=__codelineno-5-41></a><a href=#__codelineno-5-41><span class=linenos data-linenos=" 41 "></span></a>    <span class=c1># Reconstruct code</span>
</span><span id=__span-5-42><a id=__codelineno-5-42 name=__codelineno-5-42></a><a href=#__codelineno-5-42><span class=linenos data-linenos=" 42 "></span></a>    <span class=n>compressed_content</span> <span class=o>=</span> <span class=n>ast</span><span class=o>.</span><span class=n>unparse</span><span class=p>(</span><span class=n>compressed_tree</span><span class=p>)</span>
</span><span id=__span-5-43><a id=__codelineno-5-43 name=__codelineno-5-43></a><a href=#__codelineno-5-43><span class=linenos data-linenos=" 43 "></span></a>    <span class=n>compressed_tokens</span> <span class=o>=</span> <span class=n>estimate_tokens</span><span class=p>(</span><span class=n>compressed_content</span><span class=p>)</span>
</span><span id=__span-5-44><a id=__codelineno-5-44 name=__codelineno-5-44></a><a href=#__codelineno-5-44><span class=linenos data-linenos=" 44 "></span></a>    
</span><span id=__span-5-45><a id=__codelineno-5-45 name=__codelineno-5-45></a><a href=#__codelineno-5-45><span class=linenos data-linenos=" 45 "></span></a>    <span class=c1># Calculate semantic preservation score</span>
</span><span id=__span-5-46><a id=__codelineno-5-46 name=__codelineno-5-46></a><a href=#__codelineno-5-46><span class=linenos data-linenos=" 46 "></span></a>    <span class=n>semantic_score</span> <span class=o>=</span> <span class=n>calculate_semantic_preservation</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=n>compressed_content</span><span class=p>)</span>
</span><span id=__span-5-47><a id=__codelineno-5-47 name=__codelineno-5-47></a><a href=#__codelineno-5-47><span class=linenos data-linenos=" 47 "></span></a>    
</span><span id=__span-5-48><a id=__codelineno-5-48 name=__codelineno-5-48></a><a href=#__codelineno-5-48><span class=linenos data-linenos=" 48 "></span></a>    <span class=k>return</span> <span class=n>CompressionResult</span><span class=p>(</span>
</span><span id=__span-5-49><a id=__codelineno-5-49 name=__codelineno-5-49></a><a href=#__codelineno-5-49><span class=linenos data-linenos=" 49 "></span></a>        <span class=n>compressed_content</span><span class=o>=</span><span class=n>compressed_content</span><span class=p>,</span>
</span><span id=__span-5-50><a id=__codelineno-5-50 name=__codelineno-5-50></a><a href=#__codelineno-5-50><span class=linenos data-linenos=" 50 "></span></a>        <span class=n>original_tokens</span><span class=o>=</span><span class=n>original_tokens</span><span class=p>,</span>
</span><span id=__span-5-51><a id=__codelineno-5-51 name=__codelineno-5-51></a><a href=#__codelineno-5-51><span class=linenos data-linenos=" 51 "></span></a>        <span class=n>compressed_tokens</span><span class=o>=</span><span class=n>compressed_tokens</span><span class=p>,</span>
</span><span id=__span-5-52><a id=__codelineno-5-52 name=__codelineno-5-52></a><a href=#__codelineno-5-52><span class=linenos data-linenos=" 52 "></span></a>        <span class=n>compression_ratio</span><span class=o>=</span><span class=n>original_tokens</span> <span class=o>/</span> <span class=n>compressed_tokens</span><span class=p>,</span>
</span><span id=__span-5-53><a id=__codelineno-5-53 name=__codelineno-5-53></a><a href=#__codelineno-5-53><span class=linenos data-linenos=" 53 "></span></a>        <span class=n>semantic_preservation_score</span><span class=o>=</span><span class=n>semantic_score</span>
</span><span id=__span-5-54><a id=__codelineno-5-54 name=__codelineno-5-54></a><a href=#__codelineno-5-54><span class=linenos data-linenos=" 54 "></span></a>    <span class=p>)</span>
</span><span id=__span-5-55><a id=__codelineno-5-55 name=__codelineno-5-55></a><a href=#__codelineno-5-55><span class=linenos data-linenos=" 55 "></span></a>
</span><span id=__span-5-56><a id=__codelineno-5-56 name=__codelineno-5-56></a><a href=#__codelineno-5-56><span class=linenos data-linenos=" 56 "></span></a><span class=k>def</span> <span class=nf>analyze_code_elements</span><span class=p>(</span><span class=n>tree</span><span class=p>:</span> <span class=n>ast</span><span class=o>.</span><span class=n>AST</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>]:</span>
</span><span id=__span-5-57><a id=__codelineno-5-57 name=__codelineno-5-57></a><a href=#__codelineno-5-57><span class=linenos data-linenos=" 57 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Analyze and categorize code elements by importance&quot;&quot;&quot;</span>
</span><span id=__span-5-58><a id=__codelineno-5-58 name=__codelineno-5-58></a><a href=#__codelineno-5-58><span class=linenos data-linenos=" 58 "></span></a>    <span class=n>elements</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-5-59><a id=__codelineno-5-59 name=__codelineno-5-59></a><a href=#__codelineno-5-59><span class=linenos data-linenos=" 59 "></span></a>        <span class=s1>&#39;critical&#39;</span><span class=p>:</span> <span class=p>[],</span>      <span class=c1># Core classes, main functions</span>
</span><span id=__span-5-60><a id=__codelineno-5-60 name=__codelineno-5-60></a><a href=#__codelineno-5-60><span class=linenos data-linenos=" 60 "></span></a>        <span class=s1>&#39;important&#39;</span><span class=p>:</span> <span class=p>[],</span>     <span class=c1># Helper functions, key methods</span>
</span><span id=__span-5-61><a id=__codelineno-5-61 name=__codelineno-5-61></a><a href=#__codelineno-5-61><span class=linenos data-linenos=" 61 "></span></a>        <span class=s1>&#39;standard&#39;</span><span class=p>:</span> <span class=p>[],</span>      <span class=c1># Regular methods, properties</span>
</span><span id=__span-5-62><a id=__codelineno-5-62 name=__codelineno-5-62></a><a href=#__codelineno-5-62><span class=linenos data-linenos=" 62 "></span></a>        <span class=s1>&#39;optional&#39;</span><span class=p>:</span> <span class=p>[],</span>      <span class=c1># Comments, docstrings, debug code</span>
</span><span id=__span-5-63><a id=__codelineno-5-63 name=__codelineno-5-63></a><a href=#__codelineno-5-63><span class=linenos data-linenos=" 63 "></span></a>        <span class=s1>&#39;removable&#39;</span><span class=p>:</span> <span class=p>[]</span>      <span class=c1># Dead code, unused imports</span>
</span><span id=__span-5-64><a id=__codelineno-5-64 name=__codelineno-5-64></a><a href=#__codelineno-5-64><span class=linenos data-linenos=" 64 "></span></a>    <span class=p>}</span>
</span><span id=__span-5-65><a id=__codelineno-5-65 name=__codelineno-5-65></a><a href=#__codelineno-5-65><span class=linenos data-linenos=" 65 "></span></a>    
</span><span id=__span-5-66><a id=__codelineno-5-66 name=__codelineno-5-66></a><a href=#__codelineno-5-66><span class=linenos data-linenos=" 66 "></span></a>    <span class=k>for</span> <span class=n>node</span> <span class=ow>in</span> <span class=n>ast</span><span class=o>.</span><span class=n>walk</span><span class=p>(</span><span class=n>tree</span><span class=p>):</span>
</span><span id=__span-5-67><a id=__codelineno-5-67 name=__codelineno-5-67></a><a href=#__codelineno-5-67><span class=linenos data-linenos=" 67 "></span></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>ast</span><span class=o>.</span><span class=n>ClassDef</span><span class=p>):</span>
</span><span id=__span-5-68><a id=__codelineno-5-68 name=__codelineno-5-68></a><a href=#__codelineno-5-68><span class=linenos data-linenos=" 68 "></span></a>            <span class=n>importance</span> <span class=o>=</span> <span class=n>classify_class_importance</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span><span id=__span-5-69><a id=__codelineno-5-69 name=__codelineno-5-69></a><a href=#__codelineno-5-69><span class=linenos data-linenos=" 69 "></span></a>            <span class=n>elements</span><span class=p>[</span><span class=n>importance</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span><span id=__span-5-70><a id=__codelineno-5-70 name=__codelineno-5-70></a><a href=#__codelineno-5-70><span class=linenos data-linenos=" 70 "></span></a>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>ast</span><span class=o>.</span><span class=n>FunctionDef</span><span class=p>):</span>
</span><span id=__span-5-71><a id=__codelineno-5-71 name=__codelineno-5-71></a><a href=#__codelineno-5-71><span class=linenos data-linenos=" 71 "></span></a>            <span class=n>importance</span> <span class=o>=</span> <span class=n>classify_function_importance</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span><span id=__span-5-72><a id=__codelineno-5-72 name=__codelineno-5-72></a><a href=#__codelineno-5-72><span class=linenos data-linenos=" 72 "></span></a>            <span class=n>elements</span><span class=p>[</span><span class=n>importance</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span><span id=__span-5-73><a id=__codelineno-5-73 name=__codelineno-5-73></a><a href=#__codelineno-5-73><span class=linenos data-linenos=" 73 "></span></a>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>ast</span><span class=o>.</span><span class=n>Import</span><span class=p>):</span>
</span><span id=__span-5-74><a id=__codelineno-5-74 name=__codelineno-5-74></a><a href=#__codelineno-5-74><span class=linenos data-linenos=" 74 "></span></a>            <span class=k>if</span> <span class=n>is_unused_import</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>tree</span><span class=p>):</span>
</span><span id=__span-5-75><a id=__codelineno-5-75 name=__codelineno-5-75></a><a href=#__codelineno-5-75><span class=linenos data-linenos=" 75 "></span></a>                <span class=n>elements</span><span class=p>[</span><span class=s1>&#39;removable&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span><span id=__span-5-76><a id=__codelineno-5-76 name=__codelineno-5-76></a><a href=#__codelineno-5-76><span class=linenos data-linenos=" 76 "></span></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-5-77><a id=__codelineno-5-77 name=__codelineno-5-77></a><a href=#__codelineno-5-77><span class=linenos data-linenos=" 77 "></span></a>                <span class=n>elements</span><span class=p>[</span><span class=s1>&#39;standard&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span><span id=__span-5-78><a id=__codelineno-5-78 name=__codelineno-5-78></a><a href=#__codelineno-5-78><span class=linenos data-linenos=" 78 "></span></a>    
</span><span id=__span-5-79><a id=__codelineno-5-79 name=__codelineno-5-79></a><a href=#__codelineno-5-79><span class=linenos data-linenos=" 79 "></span></a>    <span class=k>return</span> <span class=n>elements</span>
</span><span id=__span-5-80><a id=__codelineno-5-80 name=__codelineno-5-80></a><a href=#__codelineno-5-80><span class=linenos data-linenos=" 80 "></span></a>
</span><span id=__span-5-81><a id=__codelineno-5-81 name=__codelineno-5-81></a><a href=#__codelineno-5-81><span class=linenos data-linenos=" 81 "></span></a><span class=k>def</span> <span class=nf>select_compression_strategy</span><span class=p>(</span><span class=n>target_ratio</span><span class=p>:</span> <span class=nb>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-5-82><a id=__codelineno-5-82 name=__codelineno-5-82></a><a href=#__codelineno-5-82><span class=linenos data-linenos=" 82 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Select compression strategy based on target compression ratio&quot;&quot;&quot;</span>
</span><span id=__span-5-83><a id=__codelineno-5-83 name=__codelineno-5-83></a><a href=#__codelineno-5-83><span class=linenos data-linenos=" 83 "></span></a>    <span class=k>if</span> <span class=n>target_ratio</span> <span class=o>&gt;</span> <span class=mf>0.8</span><span class=p>:</span>
</span><span id=__span-5-84><a id=__codelineno-5-84 name=__codelineno-5-84></a><a href=#__codelineno-5-84><span class=linenos data-linenos=" 84 "></span></a>        <span class=k>return</span> <span class=s1>&#39;conservative&#39;</span>  <span class=c1># Remove only comments and dead code</span>
</span><span id=__span-5-85><a id=__codelineno-5-85 name=__codelineno-5-85></a><a href=#__codelineno-5-85><span class=linenos data-linenos=" 85 "></span></a>    <span class=k>elif</span> <span class=n>target_ratio</span> <span class=o>&gt;</span> <span class=mf>0.6</span><span class=p>:</span>
</span><span id=__span-5-86><a id=__codelineno-5-86 name=__codelineno-5-86></a><a href=#__codelineno-5-86><span class=linenos data-linenos=" 86 "></span></a>        <span class=k>return</span> <span class=s1>&#39;moderate&#39;</span>      <span class=c1># Remove optional elements, compress docstrings</span>
</span><span id=__span-5-87><a id=__codelineno-5-87 name=__codelineno-5-87></a><a href=#__codelineno-5-87><span class=linenos data-linenos=" 87 "></span></a>    <span class=k>elif</span> <span class=n>target_ratio</span> <span class=o>&gt;</span> <span class=mf>0.4</span><span class=p>:</span>
</span><span id=__span-5-88><a id=__codelineno-5-88 name=__codelineno-5-88></a><a href=#__codelineno-5-88><span class=linenos data-linenos=" 88 "></span></a>        <span class=k>return</span> <span class=s1>&#39;aggressive&#39;</span>    <span class=c1># Keep only critical and important elements</span>
</span><span id=__span-5-89><a id=__codelineno-5-89 name=__codelineno-5-89></a><a href=#__codelineno-5-89><span class=linenos data-linenos=" 89 "></span></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-5-90><a id=__codelineno-5-90 name=__codelineno-5-90></a><a href=#__codelineno-5-90><span class=linenos data-linenos=" 90 "></span></a>        <span class=k>return</span> <span class=s1>&#39;extreme&#39;</span>       <span class=c1># Keep only critical elements, summarize everything else</span>
</span><span id=__span-5-91><a id=__codelineno-5-91 name=__codelineno-5-91></a><a href=#__codelineno-5-91><span class=linenos data-linenos=" 91 "></span></a>
</span><span id=__span-5-92><a id=__codelineno-5-92 name=__codelineno-5-92></a><a href=#__codelineno-5-92><span class=linenos data-linenos=" 92 "></span></a><span class=k>def</span> <span class=nf>apply_compression_strategy</span><span class=p>(</span><span class=n>tree</span><span class=p>:</span> <span class=n>ast</span><span class=o>.</span><span class=n>AST</span><span class=p>,</span> <span class=n>elements</span><span class=p>:</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>strategy</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ast</span><span class=o>.</span><span class=n>AST</span><span class=p>:</span>
</span><span id=__span-5-93><a id=__codelineno-5-93 name=__codelineno-5-93></a><a href=#__codelineno-5-93><span class=linenos data-linenos=" 93 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Apply selected compression strategy to AST&quot;&quot;&quot;</span>
</span><span id=__span-5-94><a id=__codelineno-5-94 name=__codelineno-5-94></a><a href=#__codelineno-5-94><span class=linenos data-linenos=" 94 "></span></a>    
</span><span id=__span-5-95><a id=__codelineno-5-95 name=__codelineno-5-95></a><a href=#__codelineno-5-95><span class=linenos data-linenos=" 95 "></span></a>    <span class=k>if</span> <span class=n>strategy</span> <span class=o>==</span> <span class=s1>&#39;conservative&#39;</span><span class=p>:</span>
</span><span id=__span-5-96><a id=__codelineno-5-96 name=__codelineno-5-96></a><a href=#__codelineno-5-96><span class=linenos data-linenos=" 96 "></span></a>        <span class=k>return</span> <span class=n>compress_conservative</span><span class=p>(</span><span class=n>tree</span><span class=p>,</span> <span class=n>elements</span><span class=p>)</span>
</span><span id=__span-5-97><a id=__codelineno-5-97 name=__codelineno-5-97></a><a href=#__codelineno-5-97><span class=linenos data-linenos=" 97 "></span></a>    <span class=k>elif</span> <span class=n>strategy</span> <span class=o>==</span> <span class=s1>&#39;moderate&#39;</span><span class=p>:</span>
</span><span id=__span-5-98><a id=__codelineno-5-98 name=__codelineno-5-98></a><a href=#__codelineno-5-98><span class=linenos data-linenos=" 98 "></span></a>        <span class=k>return</span> <span class=n>compress_moderate</span><span class=p>(</span><span class=n>tree</span><span class=p>,</span> <span class=n>elements</span><span class=p>)</span>
</span><span id=__span-5-99><a id=__codelineno-5-99 name=__codelineno-5-99></a><a href=#__codelineno-5-99><span class=linenos data-linenos=" 99 "></span></a>    <span class=k>elif</span> <span class=n>strategy</span> <span class=o>==</span> <span class=s1>&#39;aggressive&#39;</span><span class=p>:</span>
</span><span id=__span-5-100><a id=__codelineno-5-100 name=__codelineno-5-100></a><a href=#__codelineno-5-100><span class=linenos data-linenos="100 "></span></a>        <span class=k>return</span> <span class=n>compress_aggressive</span><span class=p>(</span><span class=n>tree</span><span class=p>,</span> <span class=n>elements</span><span class=p>)</span>
</span><span id=__span-5-101><a id=__codelineno-5-101 name=__codelineno-5-101></a><a href=#__codelineno-5-101><span class=linenos data-linenos="101 "></span></a>    <span class=k>elif</span> <span class=n>strategy</span> <span class=o>==</span> <span class=s1>&#39;extreme&#39;</span><span class=p>:</span>
</span><span id=__span-5-102><a id=__codelineno-5-102 name=__codelineno-5-102></a><a href=#__codelineno-5-102><span class=linenos data-linenos="102 "></span></a>        <span class=k>return</span> <span class=n>compress_extreme</span><span class=p>(</span><span class=n>tree</span><span class=p>,</span> <span class=n>elements</span><span class=p>)</span>
</span><span id=__span-5-103><a id=__codelineno-5-103 name=__codelineno-5-103></a><a href=#__codelineno-5-103><span class=linenos data-linenos="103 "></span></a>    
</span><span id=__span-5-104><a id=__codelineno-5-104 name=__codelineno-5-104></a><a href=#__codelineno-5-104><span class=linenos data-linenos="104 "></span></a>    <span class=k>return</span> <span class=n>tree</span>
</span><span id=__span-5-105><a id=__codelineno-5-105 name=__codelineno-5-105></a><a href=#__codelineno-5-105><span class=linenos data-linenos="105 "></span></a>
</span><span id=__span-5-106><a id=__codelineno-5-106 name=__codelineno-5-106></a><a href=#__codelineno-5-106><span class=linenos data-linenos="106 "></span></a><span class=k>def</span> <span class=nf>compress_conservative</span><span class=p>(</span><span class=n>tree</span><span class=p>:</span> <span class=n>ast</span><span class=o>.</span><span class=n>AST</span><span class=p>,</span> <span class=n>elements</span><span class=p>:</span> <span class=n>Dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ast</span><span class=o>.</span><span class=n>AST</span><span class=p>:</span>
</span><span id=__span-5-107><a id=__codelineno-5-107 name=__codelineno-5-107></a><a href=#__codelineno-5-107><span class=linenos data-linenos="107 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Conservative compression: remove only non-essential elements&quot;&quot;&quot;</span>
</span><span id=__span-5-108><a id=__codelineno-5-108 name=__codelineno-5-108></a><a href=#__codelineno-5-108><span class=linenos data-linenos="108 "></span></a>    <span class=n>transformer</span> <span class=o>=</span> <span class=n>ConservativeTransformer</span><span class=p>(</span><span class=n>elements</span><span class=p>)</span>
</span><span id=__span-5-109><a id=__codelineno-5-109 name=__codelineno-5-109></a><a href=#__codelineno-5-109><span class=linenos data-linenos="109 "></span></a>    <span class=k>return</span> <span class=n>transformer</span><span class=o>.</span><span class=n>visit</span><span class=p>(</span><span class=n>tree</span><span class=p>)</span>
</span><span id=__span-5-110><a id=__codelineno-5-110 name=__codelineno-5-110></a><a href=#__codelineno-5-110><span class=linenos data-linenos="110 "></span></a>
</span><span id=__span-5-111><a id=__codelineno-5-111 name=__codelineno-5-111></a><a href=#__codelineno-5-111><span class=linenos data-linenos="111 "></span></a><span class=k>class</span> <span class=nc>ConservativeTransformer</span><span class=p>(</span><span class=n>ast</span><span class=o>.</span><span class=n>NodeTransformer</span><span class=p>):</span>
</span><span id=__span-5-112><a id=__codelineno-5-112 name=__codelineno-5-112></a><a href=#__codelineno-5-112><span class=linenos data-linenos="112 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>elements</span><span class=p>):</span>
</span><span id=__span-5-113><a id=__codelineno-5-113 name=__codelineno-5-113></a><a href=#__codelineno-5-113><span class=linenos data-linenos="113 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>elements</span> <span class=o>=</span> <span class=n>elements</span>
</span><span id=__span-5-114><a id=__codelineno-5-114 name=__codelineno-5-114></a><a href=#__codelineno-5-114><span class=linenos data-linenos="114 "></span></a>    
</span><span id=__span-5-115><a id=__codelineno-5-115 name=__codelineno-5-115></a><a href=#__codelineno-5-115><span class=linenos data-linenos="115 "></span></a>    <span class=k>def</span> <span class=nf>visit_FunctionDef</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>node</span><span class=p>):</span>
</span><span id=__span-5-116><a id=__codelineno-5-116 name=__codelineno-5-116></a><a href=#__codelineno-5-116><span class=linenos data-linenos="116 "></span></a>        <span class=c1># Remove docstrings but keep function structure</span>
</span><span id=__span-5-117><a id=__codelineno-5-117 name=__codelineno-5-117></a><a href=#__codelineno-5-117><span class=linenos data-linenos="117 "></span></a>        <span class=k>if</span> <span class=n>ast</span><span class=o>.</span><span class=n>get_docstring</span><span class=p>(</span><span class=n>node</span><span class=p>):</span>
</span><span id=__span-5-118><a id=__codelineno-5-118 name=__codelineno-5-118></a><a href=#__codelineno-5-118><span class=linenos data-linenos="118 "></span></a>            <span class=n>node</span><span class=o>.</span><span class=n>body</span> <span class=o>=</span> <span class=p>[</span><span class=n>stmt</span> <span class=k>for</span> <span class=n>stmt</span> <span class=ow>in</span> <span class=n>node</span><span class=o>.</span><span class=n>body</span> 
</span><span id=__span-5-119><a id=__codelineno-5-119 name=__codelineno-5-119></a><a href=#__codelineno-5-119><span class=linenos data-linenos="119 "></span></a>                        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>stmt</span><span class=p>,</span> <span class=n>ast</span><span class=o>.</span><span class=n>Expr</span><span class=p>)</span> <span class=ow>or</span> 
</span><span id=__span-5-120><a id=__codelineno-5-120 name=__codelineno-5-120></a><a href=#__codelineno-5-120><span class=linenos data-linenos="120 "></span></a>                        <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>stmt</span><span class=o>.</span><span class=n>value</span><span class=p>,</span> <span class=n>ast</span><span class=o>.</span><span class=n>Constant</span><span class=p>)]</span>
</span><span id=__span-5-121><a id=__codelineno-5-121 name=__codelineno-5-121></a><a href=#__codelineno-5-121><span class=linenos data-linenos="121 "></span></a>        
</span><span id=__span-5-122><a id=__codelineno-5-122 name=__codelineno-5-122></a><a href=#__codelineno-5-122><span class=linenos data-linenos="122 "></span></a>        <span class=c1># Remove comments (handled at line level)</span>
</span><span id=__span-5-123><a id=__codelineno-5-123 name=__codelineno-5-123></a><a href=#__codelineno-5-123><span class=linenos data-linenos="123 "></span></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>generic_visit</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span><span id=__span-5-124><a id=__codelineno-5-124 name=__codelineno-5-124></a><a href=#__codelineno-5-124><span class=linenos data-linenos="124 "></span></a>    
</span><span id=__span-5-125><a id=__codelineno-5-125 name=__codelineno-5-125></a><a href=#__codelineno-5-125><span class=linenos data-linenos="125 "></span></a>    <span class=k>def</span> <span class=nf>visit_Import</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>node</span><span class=p>):</span>
</span><span id=__span-5-126><a id=__codelineno-5-126 name=__codelineno-5-126></a><a href=#__codelineno-5-126><span class=linenos data-linenos="126 "></span></a>        <span class=c1># Remove unused imports</span>
</span><span id=__span-5-127><a id=__codelineno-5-127 name=__codelineno-5-127></a><a href=#__codelineno-5-127><span class=linenos data-linenos="127 "></span></a>        <span class=k>if</span> <span class=n>node</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>elements</span><span class=p>[</span><span class=s1>&#39;removable&#39;</span><span class=p>]:</span>
</span><span id=__span-5-128><a id=__codelineno-5-128 name=__codelineno-5-128></a><a href=#__codelineno-5-128><span class=linenos data-linenos="128 "></span></a>            <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-5-129><a id=__codelineno-5-129 name=__codelineno-5-129></a><a href=#__codelineno-5-129><span class=linenos data-linenos="129 "></span></a>        <span class=k>return</span> <span class=n>node</span>
</span></code></pre></div><h3 id=test-file-compression>Test File Compression<a class=headerlink href=#test-file-compression title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1></a><a href=#__codelineno-6-1><span class=linenos data-linenos=" 1 "></span></a><span class=k>def</span> <span class=nf>compress_test_file</span><span class=p>(</span><span class=n>content</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>target_tokens</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>CompressionResult</span><span class=p>:</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2></a><a href=#__codelineno-6-2><span class=linenos data-linenos=" 2 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3></a><a href=#__codelineno-6-3><span class=linenos data-linenos=" 3 "></span></a><span class=sd>    Compress test files while preserving test intent and assertions</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4></a><a href=#__codelineno-6-4><span class=linenos data-linenos=" 4 "></span></a><span class=sd>    </span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5></a><a href=#__codelineno-6-5><span class=linenos data-linenos=" 5 "></span></a><span class=sd>    Strategy:</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6></a><a href=#__codelineno-6-6><span class=linenos data-linenos=" 6 "></span></a><span class=sd>    1. Preserve all test method signatures</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7></a><a href=#__codelineno-6-7><span class=linenos data-linenos=" 7 "></span></a><span class=sd>    2. Preserve all assertions</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8></a><a href=#__codelineno-6-8><span class=linenos data-linenos=" 8 "></span></a><span class=sd>    3. Compress setup/teardown code</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9></a><a href=#__codelineno-6-9><span class=linenos data-linenos=" 9 "></span></a><span class=sd>    4. Summarize test data and mocks</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10></a><a href=#__codelineno-6-10><span class=linenos data-linenos="10 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11></a><a href=#__codelineno-6-11><span class=linenos data-linenos="11 "></span></a>    
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12></a><a href=#__codelineno-6-12><span class=linenos data-linenos="12 "></span></a>    <span class=n>original_tokens</span> <span class=o>=</span> <span class=n>estimate_tokens</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13></a><a href=#__codelineno-6-13><span class=linenos data-linenos="13 "></span></a>    
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14></a><a href=#__codelineno-6-14><span class=linenos data-linenos="14 "></span></a>    <span class=k>if</span> <span class=n>original_tokens</span> <span class=o>&lt;=</span> <span class=n>target_tokens</span><span class=p>:</span>
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15></a><a href=#__codelineno-6-15><span class=linenos data-linenos="15 "></span></a>        <span class=k>return</span> <span class=n>CompressionResult</span><span class=p>(</span>
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16></a><a href=#__codelineno-6-16><span class=linenos data-linenos="16 "></span></a>            <span class=n>compressed_content</span><span class=o>=</span><span class=n>content</span><span class=p>,</span>
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17></a><a href=#__codelineno-6-17><span class=linenos data-linenos="17 "></span></a>            <span class=n>original_tokens</span><span class=o>=</span><span class=n>original_tokens</span><span class=p>,</span>
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18></a><a href=#__codelineno-6-18><span class=linenos data-linenos="18 "></span></a>            <span class=n>compressed_tokens</span><span class=o>=</span><span class=n>original_tokens</span><span class=p>,</span>
</span><span id=__span-6-19><a id=__codelineno-6-19 name=__codelineno-6-19></a><a href=#__codelineno-6-19><span class=linenos data-linenos="19 "></span></a>            <span class=n>compression_ratio</span><span class=o>=</span><span class=mf>1.0</span>
</span><span id=__span-6-20><a id=__codelineno-6-20 name=__codelineno-6-20></a><a href=#__codelineno-6-20><span class=linenos data-linenos="20 "></span></a>        <span class=p>)</span>
</span><span id=__span-6-21><a id=__codelineno-6-21 name=__codelineno-6-21></a><a href=#__codelineno-6-21><span class=linenos data-linenos="21 "></span></a>    
</span><span id=__span-6-22><a id=__codelineno-6-22 name=__codelineno-6-22></a><a href=#__codelineno-6-22><span class=linenos data-linenos="22 "></span></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-6-23><a id=__codelineno-6-23 name=__codelineno-6-23></a><a href=#__codelineno-6-23><span class=linenos data-linenos="23 "></span></a>        <span class=n>tree</span> <span class=o>=</span> <span class=n>ast</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-6-24><a id=__codelineno-6-24 name=__codelineno-6-24></a><a href=#__codelineno-6-24><span class=linenos data-linenos="24 "></span></a>    <span class=k>except</span> <span class=ne>SyntaxError</span><span class=p>:</span>
</span><span id=__span-6-25><a id=__codelineno-6-25 name=__codelineno-6-25></a><a href=#__codelineno-6-25><span class=linenos data-linenos="25 "></span></a>        <span class=k>return</span> <span class=n>compress_test_lines</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=n>target_tokens</span><span class=p>)</span>
</span><span id=__span-6-26><a id=__codelineno-6-26 name=__codelineno-6-26></a><a href=#__codelineno-6-26><span class=linenos data-linenos="26 "></span></a>    
</span><span id=__span-6-27><a id=__codelineno-6-27 name=__codelineno-6-27></a><a href=#__codelineno-6-27><span class=linenos data-linenos="27 "></span></a>    <span class=c1># Identify test structure</span>
</span><span id=__span-6-28><a id=__codelineno-6-28 name=__codelineno-6-28></a><a href=#__codelineno-6-28><span class=linenos data-linenos="28 "></span></a>    <span class=n>test_structure</span> <span class=o>=</span> <span class=n>analyze_test_structure</span><span class=p>(</span><span class=n>tree</span><span class=p>)</span>
</span><span id=__span-6-29><a id=__codelineno-6-29 name=__codelineno-6-29></a><a href=#__codelineno-6-29><span class=linenos data-linenos="29 "></span></a>    
</span><span id=__span-6-30><a id=__codelineno-6-30 name=__codelineno-6-30></a><a href=#__codelineno-6-30><span class=linenos data-linenos="30 "></span></a>    <span class=c1># Compress based on test elements</span>
</span><span id=__span-6-31><a id=__codelineno-6-31 name=__codelineno-6-31></a><a href=#__codelineno-6-31><span class=linenos data-linenos="31 "></span></a>    <span class=n>compressed_tree</span> <span class=o>=</span> <span class=n>compress_test_elements</span><span class=p>(</span><span class=n>tree</span><span class=p>,</span> <span class=n>test_structure</span><span class=p>,</span> <span class=n>target_tokens</span><span class=p>)</span>
</span><span id=__span-6-32><a id=__codelineno-6-32 name=__codelineno-6-32></a><a href=#__codelineno-6-32><span class=linenos data-linenos="32 "></span></a>    
</span><span id=__span-6-33><a id=__codelineno-6-33 name=__codelineno-6-33></a><a href=#__codelineno-6-33><span class=linenos data-linenos="33 "></span></a>    <span class=n>compressed_content</span> <span class=o>=</span> <span class=n>ast</span><span class=o>.</span><span class=n>unparse</span><span class=p>(</span><span class=n>compressed_tree</span><span class=p>)</span>
</span><span id=__span-6-34><a id=__codelineno-6-34 name=__codelineno-6-34></a><a href=#__codelineno-6-34><span class=linenos data-linenos="34 "></span></a>    <span class=n>compressed_tokens</span> <span class=o>=</span> <span class=n>estimate_tokens</span><span class=p>(</span><span class=n>compressed_content</span><span class=p>)</span>
</span><span id=__span-6-35><a id=__codelineno-6-35 name=__codelineno-6-35></a><a href=#__codelineno-6-35><span class=linenos data-linenos="35 "></span></a>    
</span><span id=__span-6-36><a id=__codelineno-6-36 name=__codelineno-6-36></a><a href=#__codelineno-6-36><span class=linenos data-linenos="36 "></span></a>    <span class=k>return</span> <span class=n>CompressionResult</span><span class=p>(</span>
</span><span id=__span-6-37><a id=__codelineno-6-37 name=__codelineno-6-37></a><a href=#__codelineno-6-37><span class=linenos data-linenos="37 "></span></a>        <span class=n>compressed_content</span><span class=o>=</span><span class=n>compressed_content</span><span class=p>,</span>
</span><span id=__span-6-38><a id=__codelineno-6-38 name=__codelineno-6-38></a><a href=#__codelineno-6-38><span class=linenos data-linenos="38 "></span></a>        <span class=n>original_tokens</span><span class=o>=</span><span class=n>original_tokens</span><span class=p>,</span>
</span><span id=__span-6-39><a id=__codelineno-6-39 name=__codelineno-6-39></a><a href=#__codelineno-6-39><span class=linenos data-linenos="39 "></span></a>        <span class=n>compressed_tokens</span><span class=o>=</span><span class=n>compressed_tokens</span><span class=p>,</span>
</span><span id=__span-6-40><a id=__codelineno-6-40 name=__codelineno-6-40></a><a href=#__codelineno-6-40><span class=linenos data-linenos="40 "></span></a>        <span class=n>compression_ratio</span><span class=o>=</span><span class=n>original_tokens</span> <span class=o>/</span> <span class=n>compressed_tokens</span>
</span><span id=__span-6-41><a id=__codelineno-6-41 name=__codelineno-6-41></a><a href=#__codelineno-6-41><span class=linenos data-linenos="41 "></span></a>    <span class=p>)</span>
</span><span id=__span-6-42><a id=__codelineno-6-42 name=__codelineno-6-42></a><a href=#__codelineno-6-42><span class=linenos data-linenos="42 "></span></a>
</span><span id=__span-6-43><a id=__codelineno-6-43 name=__codelineno-6-43></a><a href=#__codelineno-6-43><span class=linenos data-linenos="43 "></span></a><span class=k>def</span> <span class=nf>analyze_test_structure</span><span class=p>(</span><span class=n>tree</span><span class=p>:</span> <span class=n>ast</span><span class=o>.</span><span class=n>AST</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-6-44><a id=__codelineno-6-44 name=__codelineno-6-44></a><a href=#__codelineno-6-44><span class=linenos data-linenos="44 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Analyze test file structure and categorize elements&quot;&quot;&quot;</span>
</span><span id=__span-6-45><a id=__codelineno-6-45 name=__codelineno-6-45></a><a href=#__codelineno-6-45><span class=linenos data-linenos="45 "></span></a>    <span class=n>structure</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-6-46><a id=__codelineno-6-46 name=__codelineno-6-46></a><a href=#__codelineno-6-46><span class=linenos data-linenos="46 "></span></a>        <span class=s1>&#39;test_methods&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-6-47><a id=__codelineno-6-47 name=__codelineno-6-47></a><a href=#__codelineno-6-47><span class=linenos data-linenos="47 "></span></a>        <span class=s1>&#39;setup_methods&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-6-48><a id=__codelineno-6-48 name=__codelineno-6-48></a><a href=#__codelineno-6-48><span class=linenos data-linenos="48 "></span></a>        <span class=s1>&#39;helper_methods&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-6-49><a id=__codelineno-6-49 name=__codelineno-6-49></a><a href=#__codelineno-6-49><span class=linenos data-linenos="49 "></span></a>        <span class=s1>&#39;assertions&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-6-50><a id=__codelineno-6-50 name=__codelineno-6-50></a><a href=#__codelineno-6-50><span class=linenos data-linenos="50 "></span></a>        <span class=s1>&#39;test_data&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-6-51><a id=__codelineno-6-51 name=__codelineno-6-51></a><a href=#__codelineno-6-51><span class=linenos data-linenos="51 "></span></a>        <span class=s1>&#39;imports&#39;</span><span class=p>:</span> <span class=p>[]</span>
</span><span id=__span-6-52><a id=__codelineno-6-52 name=__codelineno-6-52></a><a href=#__codelineno-6-52><span class=linenos data-linenos="52 "></span></a>    <span class=p>}</span>
</span><span id=__span-6-53><a id=__codelineno-6-53 name=__codelineno-6-53></a><a href=#__codelineno-6-53><span class=linenos data-linenos="53 "></span></a>    
</span><span id=__span-6-54><a id=__codelineno-6-54 name=__codelineno-6-54></a><a href=#__codelineno-6-54><span class=linenos data-linenos="54 "></span></a>    <span class=k>for</span> <span class=n>node</span> <span class=ow>in</span> <span class=n>ast</span><span class=o>.</span><span class=n>walk</span><span class=p>(</span><span class=n>tree</span><span class=p>):</span>
</span><span id=__span-6-55><a id=__codelineno-6-55 name=__codelineno-6-55></a><a href=#__codelineno-6-55><span class=linenos data-linenos="55 "></span></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>ast</span><span class=o>.</span><span class=n>FunctionDef</span><span class=p>):</span>
</span><span id=__span-6-56><a id=__codelineno-6-56 name=__codelineno-6-56></a><a href=#__codelineno-6-56><span class=linenos data-linenos="56 "></span></a>            <span class=k>if</span> <span class=n>node</span><span class=o>.</span><span class=n>name</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;test_&#39;</span><span class=p>):</span>
</span><span id=__span-6-57><a id=__codelineno-6-57 name=__codelineno-6-57></a><a href=#__codelineno-6-57><span class=linenos data-linenos="57 "></span></a>                <span class=n>structure</span><span class=p>[</span><span class=s1>&#39;test_methods&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span><span id=__span-6-58><a id=__codelineno-6-58 name=__codelineno-6-58></a><a href=#__codelineno-6-58><span class=linenos data-linenos="58 "></span></a>                <span class=c1># Extract assertions from test method</span>
</span><span id=__span-6-59><a id=__codelineno-6-59 name=__codelineno-6-59></a><a href=#__codelineno-6-59><span class=linenos data-linenos="59 "></span></a>                <span class=n>assertions</span> <span class=o>=</span> <span class=n>extract_assertions</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span><span id=__span-6-60><a id=__codelineno-6-60 name=__codelineno-6-60></a><a href=#__codelineno-6-60><span class=linenos data-linenos="60 "></span></a>                <span class=n>structure</span><span class=p>[</span><span class=s1>&#39;assertions&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>assertions</span><span class=p>)</span>
</span><span id=__span-6-61><a id=__codelineno-6-61 name=__codelineno-6-61></a><a href=#__codelineno-6-61><span class=linenos data-linenos="61 "></span></a>            <span class=k>elif</span> <span class=n>node</span><span class=o>.</span><span class=n>name</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;setUp&#39;</span><span class=p>,</span> <span class=s1>&#39;tearDown&#39;</span><span class=p>,</span> <span class=s1>&#39;setUpClass&#39;</span><span class=p>,</span> <span class=s1>&#39;tearDownClass&#39;</span><span class=p>]:</span>
</span><span id=__span-6-62><a id=__codelineno-6-62 name=__codelineno-6-62></a><a href=#__codelineno-6-62><span class=linenos data-linenos="62 "></span></a>                <span class=n>structure</span><span class=p>[</span><span class=s1>&#39;setup_methods&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span><span id=__span-6-63><a id=__codelineno-6-63 name=__codelineno-6-63></a><a href=#__codelineno-6-63><span class=linenos data-linenos="63 "></span></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-6-64><a id=__codelineno-6-64 name=__codelineno-6-64></a><a href=#__codelineno-6-64><span class=linenos data-linenos="64 "></span></a>                <span class=n>structure</span><span class=p>[</span><span class=s1>&#39;helper_methods&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span><span id=__span-6-65><a id=__codelineno-6-65 name=__codelineno-6-65></a><a href=#__codelineno-6-65><span class=linenos data-linenos="65 "></span></a>    
</span><span id=__span-6-66><a id=__codelineno-6-66 name=__codelineno-6-66></a><a href=#__codelineno-6-66><span class=linenos data-linenos="66 "></span></a>    <span class=k>return</span> <span class=n>structure</span>
</span><span id=__span-6-67><a id=__codelineno-6-67 name=__codelineno-6-67></a><a href=#__codelineno-6-67><span class=linenos data-linenos="67 "></span></a>
</span><span id=__span-6-68><a id=__codelineno-6-68 name=__codelineno-6-68></a><a href=#__codelineno-6-68><span class=linenos data-linenos="68 "></span></a><span class=k>def</span> <span class=nf>extract_assertions</span><span class=p>(</span><span class=n>test_method</span><span class=p>:</span> <span class=n>ast</span><span class=o>.</span><span class=n>FunctionDef</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>ast</span><span class=o>.</span><span class=n>stmt</span><span class=p>]:</span>
</span><span id=__span-6-69><a id=__codelineno-6-69 name=__codelineno-6-69></a><a href=#__codelineno-6-69><span class=linenos data-linenos="69 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Extract assertion statements from test method&quot;&quot;&quot;</span>
</span><span id=__span-6-70><a id=__codelineno-6-70 name=__codelineno-6-70></a><a href=#__codelineno-6-70><span class=linenos data-linenos="70 "></span></a>    <span class=n>assertions</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-6-71><a id=__codelineno-6-71 name=__codelineno-6-71></a><a href=#__codelineno-6-71><span class=linenos data-linenos="71 "></span></a>    
</span><span id=__span-6-72><a id=__codelineno-6-72 name=__codelineno-6-72></a><a href=#__codelineno-6-72><span class=linenos data-linenos="72 "></span></a>    <span class=k>for</span> <span class=n>node</span> <span class=ow>in</span> <span class=n>ast</span><span class=o>.</span><span class=n>walk</span><span class=p>(</span><span class=n>test_method</span><span class=p>):</span>
</span><span id=__span-6-73><a id=__codelineno-6-73 name=__codelineno-6-73></a><a href=#__codelineno-6-73><span class=linenos data-linenos="73 "></span></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>ast</span><span class=o>.</span><span class=n>Call</span><span class=p>):</span>
</span><span id=__span-6-74><a id=__codelineno-6-74 name=__codelineno-6-74></a><a href=#__codelineno-6-74><span class=linenos data-linenos="74 "></span></a>            <span class=k>if</span> <span class=p>(</span><span class=nb>isinstance</span><span class=p>(</span><span class=n>node</span><span class=o>.</span><span class=n>func</span><span class=p>,</span> <span class=n>ast</span><span class=o>.</span><span class=n>Attribute</span><span class=p>)</span> <span class=ow>and</span> 
</span><span id=__span-6-75><a id=__codelineno-6-75 name=__codelineno-6-75></a><a href=#__codelineno-6-75><span class=linenos data-linenos="75 "></span></a>                <span class=n>node</span><span class=o>.</span><span class=n>func</span><span class=o>.</span><span class=n>attr</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;assert&#39;</span><span class=p>)):</span>
</span><span id=__span-6-76><a id=__codelineno-6-76 name=__codelineno-6-76></a><a href=#__codelineno-6-76><span class=linenos data-linenos="76 "></span></a>                <span class=n>assertions</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span><span id=__span-6-77><a id=__codelineno-6-77 name=__codelineno-6-77></a><a href=#__codelineno-6-77><span class=linenos data-linenos="77 "></span></a>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>ast</span><span class=o>.</span><span class=n>Assert</span><span class=p>):</span>
</span><span id=__span-6-78><a id=__codelineno-6-78 name=__codelineno-6-78></a><a href=#__codelineno-6-78><span class=linenos data-linenos="78 "></span></a>            <span class=n>assertions</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span><span id=__span-6-79><a id=__codelineno-6-79 name=__codelineno-6-79></a><a href=#__codelineno-6-79><span class=linenos data-linenos="79 "></span></a>    
</span><span id=__span-6-80><a id=__codelineno-6-80 name=__codelineno-6-80></a><a href=#__codelineno-6-80><span class=linenos data-linenos="80 "></span></a>    <span class=k>return</span> <span class=n>assertions</span>
</span></code></pre></div><h2 id=token-budget-allocation-algorithm>Token Budget Allocation Algorithm<a class=headerlink href=#token-budget-allocation-algorithm title="Permanent link">&para;</a></h2><h3 id=dynamic-budget-allocation>Dynamic Budget Allocation<a class=headerlink href=#dynamic-budget-allocation title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1></a><a href=#__codelineno-7-1><span class=linenos data-linenos="  1 "></span></a><span class=k>def</span> <span class=nf>calculate_optimal_budget</span><span class=p>(</span><span class=n>total_tokens</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> 
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2></a><a href=#__codelineno-7-2><span class=linenos data-linenos="  2 "></span></a>                           <span class=n>context_components</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3></a><a href=#__codelineno-7-3><span class=linenos data-linenos="  3 "></span></a>                           <span class=n>agent_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4></a><a href=#__codelineno-7-4><span class=linenos data-linenos="  4 "></span></a>                           <span class=n>tdd_phase</span><span class=p>:</span> <span class=n>TDDState</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>TokenBudget</span><span class=p>:</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5></a><a href=#__codelineno-7-5><span class=linenos data-linenos="  5 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6></a><a href=#__codelineno-7-6><span class=linenos data-linenos="  6 "></span></a><span class=sd>    Calculate optimal token budget allocation based on:</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7></a><a href=#__codelineno-7-7><span class=linenos data-linenos="  7 "></span></a><span class=sd>    - Available content in each category</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8></a><a href=#__codelineno-7-8><span class=linenos data-linenos="  8 "></span></a><span class=sd>    - Agent type preferences</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9></a><a href=#__codelineno-7-9><span class=linenos data-linenos="  9 "></span></a><span class=sd>    - TDD phase requirements</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10></a><a href=#__codelineno-7-10><span class=linenos data-linenos=" 10 "></span></a><span class=sd>    - Historical usage patterns</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11></a><a href=#__codelineno-7-11><span class=linenos data-linenos=" 11 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12></a><a href=#__codelineno-7-12><span class=linenos data-linenos=" 12 "></span></a>    
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13></a><a href=#__codelineno-7-13><span class=linenos data-linenos=" 13 "></span></a>    <span class=c1># Base allocation percentages by agent type</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14></a><a href=#__codelineno-7-14><span class=linenos data-linenos=" 14 "></span></a>    <span class=n>base_allocations</span> <span class=o>=</span> <span class=n>get_agent_base_allocations</span><span class=p>(</span><span class=n>agent_type</span><span class=p>)</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15></a><a href=#__codelineno-7-15><span class=linenos data-linenos=" 15 "></span></a>    
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16></a><a href=#__codelineno-7-16><span class=linenos data-linenos=" 16 "></span></a>    <span class=c1># Adjust allocations based on TDD phase</span>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17></a><a href=#__codelineno-7-17><span class=linenos data-linenos=" 17 "></span></a>    <span class=n>phase_adjustments</span> <span class=o>=</span> <span class=n>get_phase_adjustments</span><span class=p>(</span><span class=n>tdd_phase</span><span class=p>)</span>
</span><span id=__span-7-18><a id=__codelineno-7-18 name=__codelineno-7-18></a><a href=#__codelineno-7-18><span class=linenos data-linenos=" 18 "></span></a>    
</span><span id=__span-7-19><a id=__codelineno-7-19 name=__codelineno-7-19></a><a href=#__codelineno-7-19><span class=linenos data-linenos=" 19 "></span></a>    <span class=c1># Apply adjustments</span>
</span><span id=__span-7-20><a id=__codelineno-7-20 name=__codelineno-7-20></a><a href=#__codelineno-7-20><span class=linenos data-linenos=" 20 "></span></a>    <span class=n>adjusted_allocations</span> <span class=o>=</span> <span class=n>apply_allocation_adjustments</span><span class=p>(</span><span class=n>base_allocations</span><span class=p>,</span> <span class=n>phase_adjustments</span><span class=p>)</span>
</span><span id=__span-7-21><a id=__codelineno-7-21 name=__codelineno-7-21></a><a href=#__codelineno-7-21><span class=linenos data-linenos=" 21 "></span></a>    
</span><span id=__span-7-22><a id=__codelineno-7-22 name=__codelineno-7-22></a><a href=#__codelineno-7-22><span class=linenos data-linenos=" 22 "></span></a>    <span class=c1># Calculate actual needs vs available content</span>
</span><span id=__span-7-23><a id=__codelineno-7-23 name=__codelineno-7-23></a><a href=#__codelineno-7-23><span class=linenos data-linenos=" 23 "></span></a>    <span class=n>component_needs</span> <span class=o>=</span> <span class=n>calculate_component_needs</span><span class=p>(</span><span class=n>context_components</span><span class=p>)</span>
</span><span id=__span-7-24><a id=__codelineno-7-24 name=__codelineno-7-24></a><a href=#__codelineno-7-24><span class=linenos data-linenos=" 24 "></span></a>    
</span><span id=__span-7-25><a id=__codelineno-7-25 name=__codelineno-7-25></a><a href=#__codelineno-7-25><span class=linenos data-linenos=" 25 "></span></a>    <span class=c1># Optimize allocation based on needs</span>
</span><span id=__span-7-26><a id=__codelineno-7-26 name=__codelineno-7-26></a><a href=#__codelineno-7-26><span class=linenos data-linenos=" 26 "></span></a>    <span class=n>optimized_budget</span> <span class=o>=</span> <span class=n>optimize_budget_allocation</span><span class=p>(</span>
</span><span id=__span-7-27><a id=__codelineno-7-27 name=__codelineno-7-27></a><a href=#__codelineno-7-27><span class=linenos data-linenos=" 27 "></span></a>        <span class=n>total_tokens</span><span class=p>,</span> <span class=n>adjusted_allocations</span><span class=p>,</span> <span class=n>component_needs</span>
</span><span id=__span-7-28><a id=__codelineno-7-28 name=__codelineno-7-28></a><a href=#__codelineno-7-28><span class=linenos data-linenos=" 28 "></span></a>    <span class=p>)</span>
</span><span id=__span-7-29><a id=__codelineno-7-29 name=__codelineno-7-29></a><a href=#__codelineno-7-29><span class=linenos data-linenos=" 29 "></span></a>    
</span><span id=__span-7-30><a id=__codelineno-7-30 name=__codelineno-7-30></a><a href=#__codelineno-7-30><span class=linenos data-linenos=" 30 "></span></a>    <span class=k>return</span> <span class=n>optimized_budget</span>
</span><span id=__span-7-31><a id=__codelineno-7-31 name=__codelineno-7-31></a><a href=#__codelineno-7-31><span class=linenos data-linenos=" 31 "></span></a>
</span><span id=__span-7-32><a id=__codelineno-7-32 name=__codelineno-7-32></a><a href=#__codelineno-7-32><span class=linenos data-linenos=" 32 "></span></a><span class=k>def</span> <span class=nf>get_agent_base_allocations</span><span class=p>(</span><span class=n>agent_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>]:</span>
</span><span id=__span-7-33><a id=__codelineno-7-33 name=__codelineno-7-33></a><a href=#__codelineno-7-33><span class=linenos data-linenos=" 33 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get base allocation percentages for different agent types&quot;&quot;&quot;</span>
</span><span id=__span-7-34><a id=__codelineno-7-34 name=__codelineno-7-34></a><a href=#__codelineno-7-34><span class=linenos data-linenos=" 34 "></span></a>    <span class=n>allocations</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-7-35><a id=__codelineno-7-35 name=__codelineno-7-35></a><a href=#__codelineno-7-35><span class=linenos data-linenos=" 35 "></span></a>        <span class=s1>&#39;DesignAgent&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-7-36><a id=__codelineno-7-36 name=__codelineno-7-36></a><a href=#__codelineno-7-36><span class=linenos data-linenos=" 36 "></span></a>            <span class=s1>&#39;core_context&#39;</span><span class=p>:</span> <span class=mf>0.30</span><span class=p>,</span>
</span><span id=__span-7-37><a id=__codelineno-7-37 name=__codelineno-7-37></a><a href=#__codelineno-7-37><span class=linenos data-linenos=" 37 "></span></a>            <span class=s1>&#39;dependencies&#39;</span><span class=p>:</span> <span class=mf>0.15</span><span class=p>,</span>
</span><span id=__span-7-38><a id=__codelineno-7-38 name=__codelineno-7-38></a><a href=#__codelineno-7-38><span class=linenos data-linenos=" 38 "></span></a>            <span class=s1>&#39;historical&#39;</span><span class=p>:</span> <span class=mf>0.25</span><span class=p>,</span>
</span><span id=__span-7-39><a id=__codelineno-7-39 name=__codelineno-7-39></a><a href=#__codelineno-7-39><span class=linenos data-linenos=" 39 "></span></a>            <span class=s1>&#39;agent_memory&#39;</span><span class=p>:</span> <span class=mf>0.15</span><span class=p>,</span>
</span><span id=__span-7-40><a id=__codelineno-7-40 name=__codelineno-7-40></a><a href=#__codelineno-7-40><span class=linenos data-linenos=" 40 "></span></a>            <span class=s1>&#39;documentation&#39;</span><span class=p>:</span> <span class=mf>0.10</span><span class=p>,</span>
</span><span id=__span-7-41><a id=__codelineno-7-41 name=__codelineno-7-41></a><a href=#__codelineno-7-41><span class=linenos data-linenos=" 41 "></span></a>            <span class=s1>&#39;buffer&#39;</span><span class=p>:</span> <span class=mf>0.05</span>
</span><span id=__span-7-42><a id=__codelineno-7-42 name=__codelineno-7-42></a><a href=#__codelineno-7-42><span class=linenos data-linenos=" 42 "></span></a>        <span class=p>},</span>
</span><span id=__span-7-43><a id=__codelineno-7-43 name=__codelineno-7-43></a><a href=#__codelineno-7-43><span class=linenos data-linenos=" 43 "></span></a>        <span class=s1>&#39;QAAgent&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-7-44><a id=__codelineno-7-44 name=__codelineno-7-44></a><a href=#__codelineno-7-44><span class=linenos data-linenos=" 44 "></span></a>            <span class=s1>&#39;core_context&#39;</span><span class=p>:</span> <span class=mf>0.45</span><span class=p>,</span>  <span class=c1># Tests need more specific context</span>
</span><span id=__span-7-45><a id=__codelineno-7-45 name=__codelineno-7-45></a><a href=#__codelineno-7-45><span class=linenos data-linenos=" 45 "></span></a>            <span class=s1>&#39;dependencies&#39;</span><span class=p>:</span> <span class=mf>0.20</span><span class=p>,</span>
</span><span id=__span-7-46><a id=__codelineno-7-46 name=__codelineno-7-46></a><a href=#__codelineno-7-46><span class=linenos data-linenos=" 46 "></span></a>            <span class=s1>&#39;historical&#39;</span><span class=p>:</span> <span class=mf>0.15</span><span class=p>,</span>
</span><span id=__span-7-47><a id=__codelineno-7-47 name=__codelineno-7-47></a><a href=#__codelineno-7-47><span class=linenos data-linenos=" 47 "></span></a>            <span class=s1>&#39;agent_memory&#39;</span><span class=p>:</span> <span class=mf>0.10</span><span class=p>,</span>
</span><span id=__span-7-48><a id=__codelineno-7-48 name=__codelineno-7-48></a><a href=#__codelineno-7-48><span class=linenos data-linenos=" 48 "></span></a>            <span class=s1>&#39;documentation&#39;</span><span class=p>:</span> <span class=mf>0.05</span><span class=p>,</span>
</span><span id=__span-7-49><a id=__codelineno-7-49 name=__codelineno-7-49></a><a href=#__codelineno-7-49><span class=linenos data-linenos=" 49 "></span></a>            <span class=s1>&#39;buffer&#39;</span><span class=p>:</span> <span class=mf>0.05</span>
</span><span id=__span-7-50><a id=__codelineno-7-50 name=__codelineno-7-50></a><a href=#__codelineno-7-50><span class=linenos data-linenos=" 50 "></span></a>        <span class=p>},</span>
</span><span id=__span-7-51><a id=__codelineno-7-51 name=__codelineno-7-51></a><a href=#__codelineno-7-51><span class=linenos data-linenos=" 51 "></span></a>        <span class=s1>&#39;CodeAgent&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-7-52><a id=__codelineno-7-52 name=__codelineno-7-52></a><a href=#__codelineno-7-52><span class=linenos data-linenos=" 52 "></span></a>            <span class=s1>&#39;core_context&#39;</span><span class=p>:</span> <span class=mf>0.40</span><span class=p>,</span>
</span><span id=__span-7-53><a id=__codelineno-7-53 name=__codelineno-7-53></a><a href=#__codelineno-7-53><span class=linenos data-linenos=" 53 "></span></a>            <span class=s1>&#39;dependencies&#39;</span><span class=p>:</span> <span class=mf>0.25</span><span class=p>,</span>  <span class=c1># Code needs more dependency context</span>
</span><span id=__span-7-54><a id=__codelineno-7-54 name=__codelineno-7-54></a><a href=#__codelineno-7-54><span class=linenos data-linenos=" 54 "></span></a>            <span class=s1>&#39;historical&#39;</span><span class=p>:</span> <span class=mf>0.15</span><span class=p>,</span>
</span><span id=__span-7-55><a id=__codelineno-7-55 name=__codelineno-7-55></a><a href=#__codelineno-7-55><span class=linenos data-linenos=" 55 "></span></a>            <span class=s1>&#39;agent_memory&#39;</span><span class=p>:</span> <span class=mf>0.10</span><span class=p>,</span>
</span><span id=__span-7-56><a id=__codelineno-7-56 name=__codelineno-7-56></a><a href=#__codelineno-7-56><span class=linenos data-linenos=" 56 "></span></a>            <span class=s1>&#39;documentation&#39;</span><span class=p>:</span> <span class=mf>0.05</span><span class=p>,</span>
</span><span id=__span-7-57><a id=__codelineno-7-57 name=__codelineno-7-57></a><a href=#__codelineno-7-57><span class=linenos data-linenos=" 57 "></span></a>            <span class=s1>&#39;buffer&#39;</span><span class=p>:</span> <span class=mf>0.05</span>
</span><span id=__span-7-58><a id=__codelineno-7-58 name=__codelineno-7-58></a><a href=#__codelineno-7-58><span class=linenos data-linenos=" 58 "></span></a>        <span class=p>},</span>
</span><span id=__span-7-59><a id=__codelineno-7-59 name=__codelineno-7-59></a><a href=#__codelineno-7-59><span class=linenos data-linenos=" 59 "></span></a>        <span class=s1>&#39;DataAgent&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-7-60><a id=__codelineno-7-60 name=__codelineno-7-60></a><a href=#__codelineno-7-60><span class=linenos data-linenos=" 60 "></span></a>            <span class=s1>&#39;core_context&#39;</span><span class=p>:</span> <span class=mf>0.35</span><span class=p>,</span>
</span><span id=__span-7-61><a id=__codelineno-7-61 name=__codelineno-7-61></a><a href=#__codelineno-7-61><span class=linenos data-linenos=" 61 "></span></a>            <span class=s1>&#39;dependencies&#39;</span><span class=p>:</span> <span class=mf>0.10</span><span class=p>,</span>
</span><span id=__span-7-62><a id=__codelineno-7-62 name=__codelineno-7-62></a><a href=#__codelineno-7-62><span class=linenos data-linenos=" 62 "></span></a>            <span class=s1>&#39;historical&#39;</span><span class=p>:</span> <span class=mf>0.30</span><span class=p>,</span>    <span class=c1># Data analysis benefits from historical patterns</span>
</span><span id=__span-7-63><a id=__codelineno-7-63 name=__codelineno-7-63></a><a href=#__codelineno-7-63><span class=linenos data-linenos=" 63 "></span></a>            <span class=s1>&#39;agent_memory&#39;</span><span class=p>:</span> <span class=mf>0.15</span><span class=p>,</span>
</span><span id=__span-7-64><a id=__codelineno-7-64 name=__codelineno-7-64></a><a href=#__codelineno-7-64><span class=linenos data-linenos=" 64 "></span></a>            <span class=s1>&#39;documentation&#39;</span><span class=p>:</span> <span class=mf>0.05</span><span class=p>,</span>
</span><span id=__span-7-65><a id=__codelineno-7-65 name=__codelineno-7-65></a><a href=#__codelineno-7-65><span class=linenos data-linenos=" 65 "></span></a>            <span class=s1>&#39;buffer&#39;</span><span class=p>:</span> <span class=mf>0.05</span>
</span><span id=__span-7-66><a id=__codelineno-7-66 name=__codelineno-7-66></a><a href=#__codelineno-7-66><span class=linenos data-linenos=" 66 "></span></a>        <span class=p>}</span>
</span><span id=__span-7-67><a id=__codelineno-7-67 name=__codelineno-7-67></a><a href=#__codelineno-7-67><span class=linenos data-linenos=" 67 "></span></a>    <span class=p>}</span>
</span><span id=__span-7-68><a id=__codelineno-7-68 name=__codelineno-7-68></a><a href=#__codelineno-7-68><span class=linenos data-linenos=" 68 "></span></a>    
</span><span id=__span-7-69><a id=__codelineno-7-69 name=__codelineno-7-69></a><a href=#__codelineno-7-69><span class=linenos data-linenos=" 69 "></span></a>    <span class=k>return</span> <span class=n>allocations</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>agent_type</span><span class=p>,</span> <span class=n>allocations</span><span class=p>[</span><span class=s1>&#39;CodeAgent&#39;</span><span class=p>])</span>
</span><span id=__span-7-70><a id=__codelineno-7-70 name=__codelineno-7-70></a><a href=#__codelineno-7-70><span class=linenos data-linenos=" 70 "></span></a>
</span><span id=__span-7-71><a id=__codelineno-7-71 name=__codelineno-7-71></a><a href=#__codelineno-7-71><span class=linenos data-linenos=" 71 "></span></a><span class=k>def</span> <span class=nf>get_phase_adjustments</span><span class=p>(</span><span class=n>tdd_phase</span><span class=p>:</span> <span class=n>TDDState</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>]:</span>
</span><span id=__span-7-72><a id=__codelineno-7-72 name=__codelineno-7-72></a><a href=#__codelineno-7-72><span class=linenos data-linenos=" 72 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get allocation adjustments based on TDD phase&quot;&quot;&quot;</span>
</span><span id=__span-7-73><a id=__codelineno-7-73 name=__codelineno-7-73></a><a href=#__codelineno-7-73><span class=linenos data-linenos=" 73 "></span></a>    <span class=n>adjustments</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-7-74><a id=__codelineno-7-74 name=__codelineno-7-74></a><a href=#__codelineno-7-74><span class=linenos data-linenos=" 74 "></span></a>        <span class=n>TDDState</span><span class=o>.</span><span class=n>DESIGN</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-7-75><a id=__codelineno-7-75 name=__codelineno-7-75></a><a href=#__codelineno-7-75><span class=linenos data-linenos=" 75 "></span></a>            <span class=s1>&#39;documentation&#39;</span><span class=p>:</span> <span class=mf>1.5</span><span class=p>,</span>  <span class=c1># Boost documentation for design</span>
</span><span id=__span-7-76><a id=__codelineno-7-76 name=__codelineno-7-76></a><a href=#__codelineno-7-76><span class=linenos data-linenos=" 76 "></span></a>            <span class=s1>&#39;historical&#39;</span><span class=p>:</span> <span class=mf>1.3</span><span class=p>,</span>     <span class=c1># Boost historical patterns</span>
</span><span id=__span-7-77><a id=__codelineno-7-77 name=__codelineno-7-77></a><a href=#__codelineno-7-77><span class=linenos data-linenos=" 77 "></span></a>            <span class=s1>&#39;dependencies&#39;</span><span class=p>:</span> <span class=mf>0.8</span>    <span class=c1># Reduce dependency focus</span>
</span><span id=__span-7-78><a id=__codelineno-7-78 name=__codelineno-7-78></a><a href=#__codelineno-7-78><span class=linenos data-linenos=" 78 "></span></a>        <span class=p>},</span>
</span><span id=__span-7-79><a id=__codelineno-7-79 name=__codelineno-7-79></a><a href=#__codelineno-7-79><span class=linenos data-linenos=" 79 "></span></a>        <span class=n>TDDState</span><span class=o>.</span><span class=n>TEST_RED</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-7-80><a id=__codelineno-7-80 name=__codelineno-7-80></a><a href=#__codelineno-7-80><span class=linenos data-linenos=" 80 "></span></a>            <span class=s1>&#39;core_context&#39;</span><span class=p>:</span> <span class=mf>1.4</span><span class=p>,</span>   <span class=c1># Boost current context for test writing</span>
</span><span id=__span-7-81><a id=__codelineno-7-81 name=__codelineno-7-81></a><a href=#__codelineno-7-81><span class=linenos data-linenos=" 81 "></span></a>            <span class=s1>&#39;agent_memory&#39;</span><span class=p>:</span> <span class=mf>1.2</span><span class=p>,</span>   <span class=c1># Boost memory for test patterns</span>
</span><span id=__span-7-82><a id=__codelineno-7-82 name=__codelineno-7-82></a><a href=#__codelineno-7-82><span class=linenos data-linenos=" 82 "></span></a>            <span class=s1>&#39;dependencies&#39;</span><span class=p>:</span> <span class=mf>0.9</span>    <span class=c1># Slight reduction in dependencies</span>
</span><span id=__span-7-83><a id=__codelineno-7-83 name=__codelineno-7-83></a><a href=#__codelineno-7-83><span class=linenos data-linenos=" 83 "></span></a>        <span class=p>},</span>
</span><span id=__span-7-84><a id=__codelineno-7-84 name=__codelineno-7-84></a><a href=#__codelineno-7-84><span class=linenos data-linenos=" 84 "></span></a>        <span class=n>TDDState</span><span class=o>.</span><span class=n>CODE_GREEN</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-7-85><a id=__codelineno-7-85 name=__codelineno-7-85></a><a href=#__codelineno-7-85><span class=linenos data-linenos=" 85 "></span></a>            <span class=s1>&#39;dependencies&#39;</span><span class=p>:</span> <span class=mf>1.4</span><span class=p>,</span>   <span class=c1># Boost dependencies for implementation</span>
</span><span id=__span-7-86><a id=__codelineno-7-86 name=__codelineno-7-86></a><a href=#__codelineno-7-86><span class=linenos data-linenos=" 86 "></span></a>            <span class=s1>&#39;core_context&#39;</span><span class=p>:</span> <span class=mf>1.2</span><span class=p>,</span>   <span class=c1># Boost current context</span>
</span><span id=__span-7-87><a id=__codelineno-7-87 name=__codelineno-7-87></a><a href=#__codelineno-7-87><span class=linenos data-linenos=" 87 "></span></a>            <span class=s1>&#39;historical&#39;</span><span class=p>:</span> <span class=mf>0.8</span>      <span class=c1># Reduce historical patterns</span>
</span><span id=__span-7-88><a id=__codelineno-7-88 name=__codelineno-7-88></a><a href=#__codelineno-7-88><span class=linenos data-linenos=" 88 "></span></a>        <span class=p>},</span>
</span><span id=__span-7-89><a id=__codelineno-7-89 name=__codelineno-7-89></a><a href=#__codelineno-7-89><span class=linenos data-linenos=" 89 "></span></a>        <span class=n>TDDState</span><span class=o>.</span><span class=n>REFACTOR</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-7-90><a id=__codelineno-7-90 name=__codelineno-7-90></a><a href=#__codelineno-7-90><span class=linenos data-linenos=" 90 "></span></a>            <span class=s1>&#39;historical&#39;</span><span class=p>:</span> <span class=mf>1.5</span><span class=p>,</span>     <span class=c1># Boost historical patterns for best practices</span>
</span><span id=__span-7-91><a id=__codelineno-7-91 name=__codelineno-7-91></a><a href=#__codelineno-7-91><span class=linenos data-linenos=" 91 "></span></a>            <span class=s1>&#39;agent_memory&#39;</span><span class=p>:</span> <span class=mf>1.3</span><span class=p>,</span>   <span class=c1># Boost memory for refactoring patterns</span>
</span><span id=__span-7-92><a id=__codelineno-7-92 name=__codelineno-7-92></a><a href=#__codelineno-7-92><span class=linenos data-linenos=" 92 "></span></a>            <span class=s1>&#39;core_context&#39;</span><span class=p>:</span> <span class=mf>1.1</span>    <span class=c1># Slight boost to current context</span>
</span><span id=__span-7-93><a id=__codelineno-7-93 name=__codelineno-7-93></a><a href=#__codelineno-7-93><span class=linenos data-linenos=" 93 "></span></a>        <span class=p>},</span>
</span><span id=__span-7-94><a id=__codelineno-7-94 name=__codelineno-7-94></a><a href=#__codelineno-7-94><span class=linenos data-linenos=" 94 "></span></a>        <span class=n>TDDState</span><span class=o>.</span><span class=n>COMMIT</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-7-95><a id=__codelineno-7-95 name=__codelineno-7-95></a><a href=#__codelineno-7-95><span class=linenos data-linenos=" 95 "></span></a>            <span class=s1>&#39;core_context&#39;</span><span class=p>:</span> <span class=mf>1.3</span><span class=p>,</span>   <span class=c1># Boost current context for commit validation</span>
</span><span id=__span-7-96><a id=__codelineno-7-96 name=__codelineno-7-96></a><a href=#__codelineno-7-96><span class=linenos data-linenos=" 96 "></span></a>            <span class=s1>&#39;dependencies&#39;</span><span class=p>:</span> <span class=mf>1.1</span><span class=p>,</span>   <span class=c1># Slight boost for integration validation</span>
</span><span id=__span-7-97><a id=__codelineno-7-97 name=__codelineno-7-97></a><a href=#__codelineno-7-97><span class=linenos data-linenos=" 97 "></span></a>            <span class=s1>&#39;agent_memory&#39;</span><span class=p>:</span> <span class=mf>0.9</span>    <span class=c1># Slight reduction in memory</span>
</span><span id=__span-7-98><a id=__codelineno-7-98 name=__codelineno-7-98></a><a href=#__codelineno-7-98><span class=linenos data-linenos=" 98 "></span></a>        <span class=p>}</span>
</span><span id=__span-7-99><a id=__codelineno-7-99 name=__codelineno-7-99></a><a href=#__codelineno-7-99><span class=linenos data-linenos=" 99 "></span></a>    <span class=p>}</span>
</span><span id=__span-7-100><a id=__codelineno-7-100 name=__codelineno-7-100></a><a href=#__codelineno-7-100><span class=linenos data-linenos="100 "></span></a>    
</span><span id=__span-7-101><a id=__codelineno-7-101 name=__codelineno-7-101></a><a href=#__codelineno-7-101><span class=linenos data-linenos="101 "></span></a>    <span class=k>return</span> <span class=n>adjustments</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>tdd_phase</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-7-102><a id=__codelineno-7-102 name=__codelineno-7-102></a><a href=#__codelineno-7-102><span class=linenos data-linenos="102 "></span></a>
</span><span id=__span-7-103><a id=__codelineno-7-103 name=__codelineno-7-103></a><a href=#__codelineno-7-103><span class=linenos data-linenos="103 "></span></a><span class=k>def</span> <span class=nf>optimize_budget_allocation</span><span class=p>(</span><span class=n>total_tokens</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> 
</span><span id=__span-7-104><a id=__codelineno-7-104 name=__codelineno-7-104></a><a href=#__codelineno-7-104><span class=linenos data-linenos="104 "></span></a>                             <span class=n>base_allocations</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>],</span>
</span><span id=__span-7-105><a id=__codelineno-7-105 name=__codelineno-7-105></a><a href=#__codelineno-7-105><span class=linenos data-linenos="105 "></span></a>                             <span class=n>component_needs</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>TokenBudget</span><span class=p>:</span>
</span><span id=__span-7-106><a id=__codelineno-7-106 name=__codelineno-7-106></a><a href=#__codelineno-7-106><span class=linenos data-linenos="106 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-7-107><a id=__codelineno-7-107 name=__codelineno-7-107></a><a href=#__codelineno-7-107><span class=linenos data-linenos="107 "></span></a><span class=sd>    Optimize budget allocation by redistributing unused allocations</span>
</span><span id=__span-7-108><a id=__codelineno-7-108 name=__codelineno-7-108></a><a href=#__codelineno-7-108><span class=linenos data-linenos="108 "></span></a><span class=sd>    and handling over-allocations</span>
</span><span id=__span-7-109><a id=__codelineno-7-109 name=__codelineno-7-109></a><a href=#__codelineno-7-109><span class=linenos data-linenos="109 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-7-110><a id=__codelineno-7-110 name=__codelineno-7-110></a><a href=#__codelineno-7-110><span class=linenos data-linenos="110 "></span></a>    
</span><span id=__span-7-111><a id=__codelineno-7-111 name=__codelineno-7-111></a><a href=#__codelineno-7-111><span class=linenos data-linenos="111 "></span></a>    <span class=c1># Calculate initial allocations</span>
</span><span id=__span-7-112><a id=__codelineno-7-112 name=__codelineno-7-112></a><a href=#__codelineno-7-112><span class=linenos data-linenos="112 "></span></a>    <span class=n>initial_budget</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-7-113><a id=__codelineno-7-113 name=__codelineno-7-113></a><a href=#__codelineno-7-113><span class=linenos data-linenos="113 "></span></a>    <span class=k>for</span> <span class=n>component</span><span class=p>,</span> <span class=n>percentage</span> <span class=ow>in</span> <span class=n>base_allocations</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-7-114><a id=__codelineno-7-114 name=__codelineno-7-114></a><a href=#__codelineno-7-114><span class=linenos data-linenos="114 "></span></a>        <span class=n>initial_budget</span><span class=p>[</span><span class=n>component</span><span class=p>]</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>total_tokens</span> <span class=o>*</span> <span class=n>percentage</span><span class=p>)</span>
</span><span id=__span-7-115><a id=__codelineno-7-115 name=__codelineno-7-115></a><a href=#__codelineno-7-115><span class=linenos data-linenos="115 "></span></a>    
</span><span id=__span-7-116><a id=__codelineno-7-116 name=__codelineno-7-116></a><a href=#__codelineno-7-116><span class=linenos data-linenos="116 "></span></a>    <span class=c1># Identify over and under allocations</span>
</span><span id=__span-7-117><a id=__codelineno-7-117 name=__codelineno-7-117></a><a href=#__codelineno-7-117><span class=linenos data-linenos="117 "></span></a>    <span class=n>adjustments</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-7-118><a id=__codelineno-7-118 name=__codelineno-7-118></a><a href=#__codelineno-7-118><span class=linenos data-linenos="118 "></span></a>    <span class=n>unused_tokens</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-7-119><a id=__codelineno-7-119 name=__codelineno-7-119></a><a href=#__codelineno-7-119><span class=linenos data-linenos="119 "></span></a>    <span class=n>needed_tokens</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-7-120><a id=__codelineno-7-120 name=__codelineno-7-120></a><a href=#__codelineno-7-120><span class=linenos data-linenos="120 "></span></a>    
</span><span id=__span-7-121><a id=__codelineno-7-121 name=__codelineno-7-121></a><a href=#__codelineno-7-121><span class=linenos data-linenos="121 "></span></a>    <span class=k>for</span> <span class=n>component</span><span class=p>,</span> <span class=n>allocated</span> <span class=ow>in</span> <span class=n>initial_budget</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-7-122><a id=__codelineno-7-122 name=__codelineno-7-122></a><a href=#__codelineno-7-122><span class=linenos data-linenos="122 "></span></a>        <span class=n>needed</span> <span class=o>=</span> <span class=n>component_needs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>component</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span><span id=__span-7-123><a id=__codelineno-7-123 name=__codelineno-7-123></a><a href=#__codelineno-7-123><span class=linenos data-linenos="123 "></span></a>        
</span><span id=__span-7-124><a id=__codelineno-7-124 name=__codelineno-7-124></a><a href=#__codelineno-7-124><span class=linenos data-linenos="124 "></span></a>        <span class=k>if</span> <span class=n>needed</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-7-125><a id=__codelineno-7-125 name=__codelineno-7-125></a><a href=#__codelineno-7-125><span class=linenos data-linenos="125 "></span></a>            <span class=c1># No content available, free up allocation</span>
</span><span id=__span-7-126><a id=__codelineno-7-126 name=__codelineno-7-126></a><a href=#__codelineno-7-126><span class=linenos data-linenos="126 "></span></a>            <span class=n>unused_tokens</span> <span class=o>+=</span> <span class=n>allocated</span>
</span><span id=__span-7-127><a id=__codelineno-7-127 name=__codelineno-7-127></a><a href=#__codelineno-7-127><span class=linenos data-linenos="127 "></span></a>            <span class=n>adjustments</span><span class=p>[</span><span class=n>component</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-7-128><a id=__codelineno-7-128 name=__codelineno-7-128></a><a href=#__codelineno-7-128><span class=linenos data-linenos="128 "></span></a>        <span class=k>elif</span> <span class=n>needed</span> <span class=o>&lt;</span> <span class=n>allocated</span><span class=p>:</span>
</span><span id=__span-7-129><a id=__codelineno-7-129 name=__codelineno-7-129></a><a href=#__codelineno-7-129><span class=linenos data-linenos="129 "></span></a>            <span class=c1># Less content than allocation, free up excess</span>
</span><span id=__span-7-130><a id=__codelineno-7-130 name=__codelineno-7-130></a><a href=#__codelineno-7-130><span class=linenos data-linenos="130 "></span></a>            <span class=n>excess</span> <span class=o>=</span> <span class=n>allocated</span> <span class=o>-</span> <span class=n>needed</span>
</span><span id=__span-7-131><a id=__codelineno-7-131 name=__codelineno-7-131></a><a href=#__codelineno-7-131><span class=linenos data-linenos="131 "></span></a>            <span class=n>unused_tokens</span> <span class=o>+=</span> <span class=n>excess</span>
</span><span id=__span-7-132><a id=__codelineno-7-132 name=__codelineno-7-132></a><a href=#__codelineno-7-132><span class=linenos data-linenos="132 "></span></a>            <span class=n>adjustments</span><span class=p>[</span><span class=n>component</span><span class=p>]</span> <span class=o>=</span> <span class=n>needed</span>
</span><span id=__span-7-133><a id=__codelineno-7-133 name=__codelineno-7-133></a><a href=#__codelineno-7-133><span class=linenos data-linenos="133 "></span></a>        <span class=k>elif</span> <span class=n>needed</span> <span class=o>&gt;</span> <span class=n>allocated</span><span class=p>:</span>
</span><span id=__span-7-134><a id=__codelineno-7-134 name=__codelineno-7-134></a><a href=#__codelineno-7-134><span class=linenos data-linenos="134 "></span></a>            <span class=c1># More content than allocation, track need</span>
</span><span id=__span-7-135><a id=__codelineno-7-135 name=__codelineno-7-135></a><a href=#__codelineno-7-135><span class=linenos data-linenos="135 "></span></a>            <span class=n>deficit</span> <span class=o>=</span> <span class=n>needed</span> <span class=o>-</span> <span class=n>allocated</span>
</span><span id=__span-7-136><a id=__codelineno-7-136 name=__codelineno-7-136></a><a href=#__codelineno-7-136><span class=linenos data-linenos="136 "></span></a>            <span class=n>needed_tokens</span> <span class=o>+=</span> <span class=n>deficit</span>
</span><span id=__span-7-137><a id=__codelineno-7-137 name=__codelineno-7-137></a><a href=#__codelineno-7-137><span class=linenos data-linenos="137 "></span></a>            <span class=n>adjustments</span><span class=p>[</span><span class=n>component</span><span class=p>]</span> <span class=o>=</span> <span class=n>allocated</span>
</span><span id=__span-7-138><a id=__codelineno-7-138 name=__codelineno-7-138></a><a href=#__codelineno-7-138><span class=linenos data-linenos="138 "></span></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-7-139><a id=__codelineno-7-139 name=__codelineno-7-139></a><a href=#__codelineno-7-139><span class=linenos data-linenos="139 "></span></a>            <span class=c1># Perfect match</span>
</span><span id=__span-7-140><a id=__codelineno-7-140 name=__codelineno-7-140></a><a href=#__codelineno-7-140><span class=linenos data-linenos="140 "></span></a>            <span class=n>adjustments</span><span class=p>[</span><span class=n>component</span><span class=p>]</span> <span class=o>=</span> <span class=n>allocated</span>
</span><span id=__span-7-141><a id=__codelineno-7-141 name=__codelineno-7-141></a><a href=#__codelineno-7-141><span class=linenos data-linenos="141 "></span></a>    
</span><span id=__span-7-142><a id=__codelineno-7-142 name=__codelineno-7-142></a><a href=#__codelineno-7-142><span class=linenos data-linenos="142 "></span></a>    <span class=c1># Redistribute unused tokens to components that need more</span>
</span><span id=__span-7-143><a id=__codelineno-7-143 name=__codelineno-7-143></a><a href=#__codelineno-7-143><span class=linenos data-linenos="143 "></span></a>    <span class=k>if</span> <span class=n>unused_tokens</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>needed_tokens</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-7-144><a id=__codelineno-7-144 name=__codelineno-7-144></a><a href=#__codelineno-7-144><span class=linenos data-linenos="144 "></span></a>        <span class=n>redistribution_ratio</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>unused_tokens</span> <span class=o>/</span> <span class=n>needed_tokens</span><span class=p>)</span>
</span><span id=__span-7-145><a id=__codelineno-7-145 name=__codelineno-7-145></a><a href=#__codelineno-7-145><span class=linenos data-linenos="145 "></span></a>        
</span><span id=__span-7-146><a id=__codelineno-7-146 name=__codelineno-7-146></a><a href=#__codelineno-7-146><span class=linenos data-linenos="146 "></span></a>        <span class=k>for</span> <span class=n>component</span><span class=p>,</span> <span class=n>allocated</span> <span class=ow>in</span> <span class=n>adjustments</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-7-147><a id=__codelineno-7-147 name=__codelineno-7-147></a><a href=#__codelineno-7-147><span class=linenos data-linenos="147 "></span></a>            <span class=n>needed</span> <span class=o>=</span> <span class=n>component_needs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>component</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span><span id=__span-7-148><a id=__codelineno-7-148 name=__codelineno-7-148></a><a href=#__codelineno-7-148><span class=linenos data-linenos="148 "></span></a>            <span class=k>if</span> <span class=n>needed</span> <span class=o>&gt;</span> <span class=n>allocated</span><span class=p>:</span>
</span><span id=__span-7-149><a id=__codelineno-7-149 name=__codelineno-7-149></a><a href=#__codelineno-7-149><span class=linenos data-linenos="149 "></span></a>                <span class=n>additional</span> <span class=o>=</span> <span class=nb>int</span><span class=p>((</span><span class=n>needed</span> <span class=o>-</span> <span class=n>allocated</span><span class=p>)</span> <span class=o>*</span> <span class=n>redistribution_ratio</span><span class=p>)</span>
</span><span id=__span-7-150><a id=__codelineno-7-150 name=__codelineno-7-150></a><a href=#__codelineno-7-150><span class=linenos data-linenos="150 "></span></a>                <span class=n>adjustments</span><span class=p>[</span><span class=n>component</span><span class=p>]</span> <span class=o>+=</span> <span class=n>additional</span>
</span><span id=__span-7-151><a id=__codelineno-7-151 name=__codelineno-7-151></a><a href=#__codelineno-7-151><span class=linenos data-linenos="151 "></span></a>                <span class=n>unused_tokens</span> <span class=o>-=</span> <span class=n>additional</span>
</span><span id=__span-7-152><a id=__codelineno-7-152 name=__codelineno-7-152></a><a href=#__codelineno-7-152><span class=linenos data-linenos="152 "></span></a>    
</span><span id=__span-7-153><a id=__codelineno-7-153 name=__codelineno-7-153></a><a href=#__codelineno-7-153><span class=linenos data-linenos="153 "></span></a>    <span class=c1># Any remaining unused tokens go to buffer</span>
</span><span id=__span-7-154><a id=__codelineno-7-154 name=__codelineno-7-154></a><a href=#__codelineno-7-154><span class=linenos data-linenos="154 "></span></a>    <span class=n>adjustments</span><span class=p>[</span><span class=s1>&#39;buffer&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>adjustments</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;buffer&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>unused_tokens</span>
</span><span id=__span-7-155><a id=__codelineno-7-155 name=__codelineno-7-155></a><a href=#__codelineno-7-155><span class=linenos data-linenos="155 "></span></a>    
</span><span id=__span-7-156><a id=__codelineno-7-156 name=__codelineno-7-156></a><a href=#__codelineno-7-156><span class=linenos data-linenos="156 "></span></a>    <span class=k>return</span> <span class=n>TokenBudget</span><span class=p>(</span>
</span><span id=__span-7-157><a id=__codelineno-7-157 name=__codelineno-7-157></a><a href=#__codelineno-7-157><span class=linenos data-linenos="157 "></span></a>        <span class=n>total_budget</span><span class=o>=</span><span class=n>total_tokens</span><span class=p>,</span>
</span><span id=__span-7-158><a id=__codelineno-7-158 name=__codelineno-7-158></a><a href=#__codelineno-7-158><span class=linenos data-linenos="158 "></span></a>        <span class=n>core_context</span><span class=o>=</span><span class=n>adjustments</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;core_context&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span><span id=__span-7-159><a id=__codelineno-7-159 name=__codelineno-7-159></a><a href=#__codelineno-7-159><span class=linenos data-linenos="159 "></span></a>        <span class=n>dependencies</span><span class=o>=</span><span class=n>adjustments</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;dependencies&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span><span id=__span-7-160><a id=__codelineno-7-160 name=__codelineno-7-160></a><a href=#__codelineno-7-160><span class=linenos data-linenos="160 "></span></a>        <span class=n>agent_memory</span><span class=o>=</span><span class=n>adjustments</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;agent_memory&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span><span id=__span-7-161><a id=__codelineno-7-161 name=__codelineno-7-161></a><a href=#__codelineno-7-161><span class=linenos data-linenos="161 "></span></a>        <span class=n>metadata</span><span class=o>=</span><span class=n>adjustments</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;documentation&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span><span id=__span-7-162><a id=__codelineno-7-162 name=__codelineno-7-162></a><a href=#__codelineno-7-162><span class=linenos data-linenos="162 "></span></a>        <span class=n>buffer</span><span class=o>=</span><span class=n>adjustments</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;buffer&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span><span id=__span-7-163><a id=__codelineno-7-163 name=__codelineno-7-163></a><a href=#__codelineno-7-163><span class=linenos data-linenos="163 "></span></a>    <span class=p>)</span>
</span></code></pre></div><h2 id=dependency-analysis-algorithm>Dependency Analysis Algorithm<a class=headerlink href=#dependency-analysis-algorithm title="Permanent link">&para;</a></h2><h3 id=static-dependency-analysis>Static Dependency Analysis<a class=headerlink href=#static-dependency-analysis title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1></a><a href=#__codelineno-8-1><span class=linenos data-linenos="  1 "></span></a><span class=k>def</span> <span class=nf>build_dependency_graph</span><span class=p>(</span><span class=n>project_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Set</span><span class=p>[</span><span class=nb>str</span><span class=p>]]:</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2></a><a href=#__codelineno-8-2><span class=linenos data-linenos="  2 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3></a><a href=#__codelineno-8-3><span class=linenos data-linenos="  3 "></span></a><span class=sd>    Build comprehensive dependency graph for project</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4></a><a href=#__codelineno-8-4><span class=linenos data-linenos="  4 "></span></a><span class=sd>    </span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5></a><a href=#__codelineno-8-5><span class=linenos data-linenos="  5 "></span></a><span class=sd>    Returns:</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6></a><a href=#__codelineno-8-6><span class=linenos data-linenos="  6 "></span></a><span class=sd>        Dict mapping file paths to sets of their dependencies</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7></a><a href=#__codelineno-8-7><span class=linenos data-linenos="  7 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8></a><a href=#__codelineno-8-8><span class=linenos data-linenos="  8 "></span></a>    
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9></a><a href=#__codelineno-8-9><span class=linenos data-linenos="  9 "></span></a>    <span class=n>dependency_graph</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10></a><a href=#__codelineno-8-10><span class=linenos data-linenos=" 10 "></span></a>    
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11></a><a href=#__codelineno-8-11><span class=linenos data-linenos=" 11 "></span></a>    <span class=c1># Find all Python files</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12></a><a href=#__codelineno-8-12><span class=linenos data-linenos=" 12 "></span></a>    <span class=n>python_files</span> <span class=o>=</span> <span class=n>find_python_files</span><span class=p>(</span><span class=n>project_path</span><span class=p>)</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13></a><a href=#__codelineno-8-13><span class=linenos data-linenos=" 13 "></span></a>    
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14></a><a href=#__codelineno-8-14><span class=linenos data-linenos=" 14 "></span></a>    <span class=k>for</span> <span class=n>file_path</span> <span class=ow>in</span> <span class=n>python_files</span><span class=p>:</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15></a><a href=#__codelineno-8-15><span class=linenos data-linenos=" 15 "></span></a>        <span class=n>dependencies</span> <span class=o>=</span> <span class=n>extract_file_dependencies</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>project_path</span><span class=p>)</span>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16></a><a href=#__codelineno-8-16><span class=linenos data-linenos=" 16 "></span></a>        <span class=n>dependency_graph</span><span class=p>[</span><span class=n>file_path</span><span class=p>]</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>dependencies</span><span class=p>)</span>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17></a><a href=#__codelineno-8-17><span class=linenos data-linenos=" 17 "></span></a>    
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18></a><a href=#__codelineno-8-18><span class=linenos data-linenos=" 18 "></span></a>    <span class=c1># Add reverse dependencies</span>
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19></a><a href=#__codelineno-8-19><span class=linenos data-linenos=" 19 "></span></a>    <span class=n>reverse_graph</span> <span class=o>=</span> <span class=n>build_reverse_dependencies</span><span class=p>(</span><span class=n>dependency_graph</span><span class=p>)</span>
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20></a><a href=#__codelineno-8-20><span class=linenos data-linenos=" 20 "></span></a>    
</span><span id=__span-8-21><a id=__codelineno-8-21 name=__codelineno-8-21></a><a href=#__codelineno-8-21><span class=linenos data-linenos=" 21 "></span></a>    <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-8-22><a id=__codelineno-8-22 name=__codelineno-8-22></a><a href=#__codelineno-8-22><span class=linenos data-linenos=" 22 "></span></a>        <span class=s1>&#39;forward&#39;</span><span class=p>:</span> <span class=n>dependency_graph</span><span class=p>,</span>
</span><span id=__span-8-23><a id=__codelineno-8-23 name=__codelineno-8-23></a><a href=#__codelineno-8-23><span class=linenos data-linenos=" 23 "></span></a>        <span class=s1>&#39;reverse&#39;</span><span class=p>:</span> <span class=n>reverse_graph</span>
</span><span id=__span-8-24><a id=__codelineno-8-24 name=__codelineno-8-24></a><a href=#__codelineno-8-24><span class=linenos data-linenos=" 24 "></span></a>    <span class=p>}</span>
</span><span id=__span-8-25><a id=__codelineno-8-25 name=__codelineno-8-25></a><a href=#__codelineno-8-25><span class=linenos data-linenos=" 25 "></span></a>
</span><span id=__span-8-26><a id=__codelineno-8-26 name=__codelineno-8-26></a><a href=#__codelineno-8-26><span class=linenos data-linenos=" 26 "></span></a><span class=k>def</span> <span class=nf>extract_file_dependencies</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>project_root</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-8-27><a id=__codelineno-8-27 name=__codelineno-8-27></a><a href=#__codelineno-8-27><span class=linenos data-linenos=" 27 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Extract dependencies from a single Python file&quot;&quot;&quot;</span>
</span><span id=__span-8-28><a id=__codelineno-8-28 name=__codelineno-8-28></a><a href=#__codelineno-8-28><span class=linenos data-linenos=" 28 "></span></a>    
</span><span id=__span-8-29><a id=__codelineno-8-29 name=__codelineno-8-29></a><a href=#__codelineno-8-29><span class=linenos data-linenos=" 29 "></span></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-8-30><a id=__codelineno-8-30 name=__codelineno-8-30></a><a href=#__codelineno-8-30><span class=linenos data-linenos=" 30 "></span></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-8-31><a id=__codelineno-8-31 name=__codelineno-8-31></a><a href=#__codelineno-8-31><span class=linenos data-linenos=" 31 "></span></a>            <span class=n>content</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span><span id=__span-8-32><a id=__codelineno-8-32 name=__codelineno-8-32></a><a href=#__codelineno-8-32><span class=linenos data-linenos=" 32 "></span></a>        
</span><span id=__span-8-33><a id=__codelineno-8-33 name=__codelineno-8-33></a><a href=#__codelineno-8-33><span class=linenos data-linenos=" 33 "></span></a>        <span class=n>tree</span> <span class=o>=</span> <span class=n>ast</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-8-34><a id=__codelineno-8-34 name=__codelineno-8-34></a><a href=#__codelineno-8-34><span class=linenos data-linenos=" 34 "></span></a>        <span class=n>dependencies</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-8-35><a id=__codelineno-8-35 name=__codelineno-8-35></a><a href=#__codelineno-8-35><span class=linenos data-linenos=" 35 "></span></a>        
</span><span id=__span-8-36><a id=__codelineno-8-36 name=__codelineno-8-36></a><a href=#__codelineno-8-36><span class=linenos data-linenos=" 36 "></span></a>        <span class=k>for</span> <span class=n>node</span> <span class=ow>in</span> <span class=n>ast</span><span class=o>.</span><span class=n>walk</span><span class=p>(</span><span class=n>tree</span><span class=p>):</span>
</span><span id=__span-8-37><a id=__codelineno-8-37 name=__codelineno-8-37></a><a href=#__codelineno-8-37><span class=linenos data-linenos=" 37 "></span></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>ast</span><span class=o>.</span><span class=n>Import</span><span class=p>):</span>
</span><span id=__span-8-38><a id=__codelineno-8-38 name=__codelineno-8-38></a><a href=#__codelineno-8-38><span class=linenos data-linenos=" 38 "></span></a>                <span class=k>for</span> <span class=n>alias</span> <span class=ow>in</span> <span class=n>node</span><span class=o>.</span><span class=n>names</span><span class=p>:</span>
</span><span id=__span-8-39><a id=__codelineno-8-39 name=__codelineno-8-39></a><a href=#__codelineno-8-39><span class=linenos data-linenos=" 39 "></span></a>                    <span class=n>dep_path</span> <span class=o>=</span> <span class=n>resolve_import_path</span><span class=p>(</span><span class=n>alias</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>file_path</span><span class=p>,</span> <span class=n>project_root</span><span class=p>)</span>
</span><span id=__span-8-40><a id=__codelineno-8-40 name=__codelineno-8-40></a><a href=#__codelineno-8-40><span class=linenos data-linenos=" 40 "></span></a>                    <span class=k>if</span> <span class=n>dep_path</span><span class=p>:</span>
</span><span id=__span-8-41><a id=__codelineno-8-41 name=__codelineno-8-41></a><a href=#__codelineno-8-41><span class=linenos data-linenos=" 41 "></span></a>                        <span class=n>dependencies</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>dep_path</span><span class=p>)</span>
</span><span id=__span-8-42><a id=__codelineno-8-42 name=__codelineno-8-42></a><a href=#__codelineno-8-42><span class=linenos data-linenos=" 42 "></span></a>            
</span><span id=__span-8-43><a id=__codelineno-8-43 name=__codelineno-8-43></a><a href=#__codelineno-8-43><span class=linenos data-linenos=" 43 "></span></a>            <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>ast</span><span class=o>.</span><span class=n>ImportFrom</span><span class=p>):</span>
</span><span id=__span-8-44><a id=__codelineno-8-44 name=__codelineno-8-44></a><a href=#__codelineno-8-44><span class=linenos data-linenos=" 44 "></span></a>                <span class=k>if</span> <span class=n>node</span><span class=o>.</span><span class=n>module</span><span class=p>:</span>
</span><span id=__span-8-45><a id=__codelineno-8-45 name=__codelineno-8-45></a><a href=#__codelineno-8-45><span class=linenos data-linenos=" 45 "></span></a>                    <span class=n>dep_path</span> <span class=o>=</span> <span class=n>resolve_import_path</span><span class=p>(</span><span class=n>node</span><span class=o>.</span><span class=n>module</span><span class=p>,</span> <span class=n>file_path</span><span class=p>,</span> <span class=n>project_root</span><span class=p>)</span>
</span><span id=__span-8-46><a id=__codelineno-8-46 name=__codelineno-8-46></a><a href=#__codelineno-8-46><span class=linenos data-linenos=" 46 "></span></a>                    <span class=k>if</span> <span class=n>dep_path</span><span class=p>:</span>
</span><span id=__span-8-47><a id=__codelineno-8-47 name=__codelineno-8-47></a><a href=#__codelineno-8-47><span class=linenos data-linenos=" 47 "></span></a>                        <span class=n>dependencies</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>dep_path</span><span class=p>)</span>
</span><span id=__span-8-48><a id=__codelineno-8-48 name=__codelineno-8-48></a><a href=#__codelineno-8-48><span class=linenos data-linenos=" 48 "></span></a>        
</span><span id=__span-8-49><a id=__codelineno-8-49 name=__codelineno-8-49></a><a href=#__codelineno-8-49><span class=linenos data-linenos=" 49 "></span></a>        <span class=k>return</span> <span class=n>dependencies</span>
</span><span id=__span-8-50><a id=__codelineno-8-50 name=__codelineno-8-50></a><a href=#__codelineno-8-50><span class=linenos data-linenos=" 50 "></span></a>        
</span><span id=__span-8-51><a id=__codelineno-8-51 name=__codelineno-8-51></a><a href=#__codelineno-8-51><span class=linenos data-linenos=" 51 "></span></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-8-52><a id=__codelineno-8-52 name=__codelineno-8-52></a><a href=#__codelineno-8-52><span class=linenos data-linenos=" 52 "></span></a>        <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Could not analyze dependencies for </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-8-53><a id=__codelineno-8-53 name=__codelineno-8-53></a><a href=#__codelineno-8-53><span class=linenos data-linenos=" 53 "></span></a>        <span class=k>return</span> <span class=p>[]</span>
</span><span id=__span-8-54><a id=__codelineno-8-54 name=__codelineno-8-54></a><a href=#__codelineno-8-54><span class=linenos data-linenos=" 54 "></span></a>
</span><span id=__span-8-55><a id=__codelineno-8-55 name=__codelineno-8-55></a><a href=#__codelineno-8-55><span class=linenos data-linenos=" 55 "></span></a><span class=k>def</span> <span class=nf>resolve_import_path</span><span class=p>(</span><span class=n>module_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>source_file</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>project_root</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-8-56><a id=__codelineno-8-56 name=__codelineno-8-56></a><a href=#__codelineno-8-56><span class=linenos data-linenos=" 56 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Resolve import module name to actual file path&quot;&quot;&quot;</span>
</span><span id=__span-8-57><a id=__codelineno-8-57 name=__codelineno-8-57></a><a href=#__codelineno-8-57><span class=linenos data-linenos=" 57 "></span></a>    
</span><span id=__span-8-58><a id=__codelineno-8-58 name=__codelineno-8-58></a><a href=#__codelineno-8-58><span class=linenos data-linenos=" 58 "></span></a>    <span class=c1># Handle relative imports</span>
</span><span id=__span-8-59><a id=__codelineno-8-59 name=__codelineno-8-59></a><a href=#__codelineno-8-59><span class=linenos data-linenos=" 59 "></span></a>    <span class=k>if</span> <span class=n>module_name</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>):</span>
</span><span id=__span-8-60><a id=__codelineno-8-60 name=__codelineno-8-60></a><a href=#__codelineno-8-60><span class=linenos data-linenos=" 60 "></span></a>        <span class=k>return</span> <span class=n>resolve_relative_import</span><span class=p>(</span><span class=n>module_name</span><span class=p>,</span> <span class=n>source_file</span><span class=p>,</span> <span class=n>project_root</span><span class=p>)</span>
</span><span id=__span-8-61><a id=__codelineno-8-61 name=__codelineno-8-61></a><a href=#__codelineno-8-61><span class=linenos data-linenos=" 61 "></span></a>    
</span><span id=__span-8-62><a id=__codelineno-8-62 name=__codelineno-8-62></a><a href=#__codelineno-8-62><span class=linenos data-linenos=" 62 "></span></a>    <span class=c1># Handle absolute imports within project</span>
</span><span id=__span-8-63><a id=__codelineno-8-63 name=__codelineno-8-63></a><a href=#__codelineno-8-63><span class=linenos data-linenos=" 63 "></span></a>    <span class=k>if</span> <span class=n>is_project_module</span><span class=p>(</span><span class=n>module_name</span><span class=p>,</span> <span class=n>project_root</span><span class=p>):</span>
</span><span id=__span-8-64><a id=__codelineno-8-64 name=__codelineno-8-64></a><a href=#__codelineno-8-64><span class=linenos data-linenos=" 64 "></span></a>        <span class=k>return</span> <span class=n>resolve_project_import</span><span class=p>(</span><span class=n>module_name</span><span class=p>,</span> <span class=n>project_root</span><span class=p>)</span>
</span><span id=__span-8-65><a id=__codelineno-8-65 name=__codelineno-8-65></a><a href=#__codelineno-8-65><span class=linenos data-linenos=" 65 "></span></a>    
</span><span id=__span-8-66><a id=__codelineno-8-66 name=__codelineno-8-66></a><a href=#__codelineno-8-66><span class=linenos data-linenos=" 66 "></span></a>    <span class=c1># External dependencies (not resolved to file paths)</span>
</span><span id=__span-8-67><a id=__codelineno-8-67 name=__codelineno-8-67></a><a href=#__codelineno-8-67><span class=linenos data-linenos=" 67 "></span></a>    <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-8-68><a id=__codelineno-8-68 name=__codelineno-8-68></a><a href=#__codelineno-8-68><span class=linenos data-linenos=" 68 "></span></a>
</span><span id=__span-8-69><a id=__codelineno-8-69 name=__codelineno-8-69></a><a href=#__codelineno-8-69><span class=linenos data-linenos=" 69 "></span></a><span class=k>def</span> <span class=nf>calculate_transitive_dependencies</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span><span id=__span-8-70><a id=__codelineno-8-70 name=__codelineno-8-70></a><a href=#__codelineno-8-70><span class=linenos data-linenos=" 70 "></span></a>                                    <span class=n>dependency_graph</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Set</span><span class=p>[</span><span class=nb>str</span><span class=p>]],</span> 
</span><span id=__span-8-71><a id=__codelineno-8-71 name=__codelineno-8-71></a><a href=#__codelineno-8-71><span class=linenos data-linenos=" 71 "></span></a>                                    <span class=n>max_depth</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Set</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-8-72><a id=__codelineno-8-72 name=__codelineno-8-72></a><a href=#__codelineno-8-72><span class=linenos data-linenos=" 72 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Calculate transitive dependencies up to max_depth&quot;&quot;&quot;</span>
</span><span id=__span-8-73><a id=__codelineno-8-73 name=__codelineno-8-73></a><a href=#__codelineno-8-73><span class=linenos data-linenos=" 73 "></span></a>    
</span><span id=__span-8-74><a id=__codelineno-8-74 name=__codelineno-8-74></a><a href=#__codelineno-8-74><span class=linenos data-linenos=" 74 "></span></a>    <span class=n>visited</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span><span id=__span-8-75><a id=__codelineno-8-75 name=__codelineno-8-75></a><a href=#__codelineno-8-75><span class=linenos data-linenos=" 75 "></span></a>    <span class=n>to_visit</span> <span class=o>=</span> <span class=p>[(</span><span class=n>file_path</span><span class=p>,</span> <span class=mi>0</span><span class=p>)]</span>
</span><span id=__span-8-76><a id=__codelineno-8-76 name=__codelineno-8-76></a><a href=#__codelineno-8-76><span class=linenos data-linenos=" 76 "></span></a>    <span class=n>transitive_deps</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span><span id=__span-8-77><a id=__codelineno-8-77 name=__codelineno-8-77></a><a href=#__codelineno-8-77><span class=linenos data-linenos=" 77 "></span></a>    
</span><span id=__span-8-78><a id=__codelineno-8-78 name=__codelineno-8-78></a><a href=#__codelineno-8-78><span class=linenos data-linenos=" 78 "></span></a>    <span class=k>while</span> <span class=n>to_visit</span><span class=p>:</span>
</span><span id=__span-8-79><a id=__codelineno-8-79 name=__codelineno-8-79></a><a href=#__codelineno-8-79><span class=linenos data-linenos=" 79 "></span></a>        <span class=n>current_file</span><span class=p>,</span> <span class=n>depth</span> <span class=o>=</span> <span class=n>to_visit</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-8-80><a id=__codelineno-8-80 name=__codelineno-8-80></a><a href=#__codelineno-8-80><span class=linenos data-linenos=" 80 "></span></a>        
</span><span id=__span-8-81><a id=__codelineno-8-81 name=__codelineno-8-81></a><a href=#__codelineno-8-81><span class=linenos data-linenos=" 81 "></span></a>        <span class=k>if</span> <span class=n>current_file</span> <span class=ow>in</span> <span class=n>visited</span> <span class=ow>or</span> <span class=n>depth</span> <span class=o>&gt;=</span> <span class=n>max_depth</span><span class=p>:</span>
</span><span id=__span-8-82><a id=__codelineno-8-82 name=__codelineno-8-82></a><a href=#__codelineno-8-82><span class=linenos data-linenos=" 82 "></span></a>            <span class=k>continue</span>
</span><span id=__span-8-83><a id=__codelineno-8-83 name=__codelineno-8-83></a><a href=#__codelineno-8-83><span class=linenos data-linenos=" 83 "></span></a>        
</span><span id=__span-8-84><a id=__codelineno-8-84 name=__codelineno-8-84></a><a href=#__codelineno-8-84><span class=linenos data-linenos=" 84 "></span></a>        <span class=n>visited</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>current_file</span><span class=p>)</span>
</span><span id=__span-8-85><a id=__codelineno-8-85 name=__codelineno-8-85></a><a href=#__codelineno-8-85><span class=linenos data-linenos=" 85 "></span></a>        
</span><span id=__span-8-86><a id=__codelineno-8-86 name=__codelineno-8-86></a><a href=#__codelineno-8-86><span class=linenos data-linenos=" 86 "></span></a>        <span class=c1># Get direct dependencies</span>
</span><span id=__span-8-87><a id=__codelineno-8-87 name=__codelineno-8-87></a><a href=#__codelineno-8-87><span class=linenos data-linenos=" 87 "></span></a>        <span class=n>direct_deps</span> <span class=o>=</span> <span class=n>dependency_graph</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>current_file</span><span class=p>,</span> <span class=nb>set</span><span class=p>())</span>
</span><span id=__span-8-88><a id=__codelineno-8-88 name=__codelineno-8-88></a><a href=#__codelineno-8-88><span class=linenos data-linenos=" 88 "></span></a>        
</span><span id=__span-8-89><a id=__codelineno-8-89 name=__codelineno-8-89></a><a href=#__codelineno-8-89><span class=linenos data-linenos=" 89 "></span></a>        <span class=k>for</span> <span class=n>dep</span> <span class=ow>in</span> <span class=n>direct_deps</span><span class=p>:</span>
</span><span id=__span-8-90><a id=__codelineno-8-90 name=__codelineno-8-90></a><a href=#__codelineno-8-90><span class=linenos data-linenos=" 90 "></span></a>            <span class=k>if</span> <span class=n>dep</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>visited</span><span class=p>:</span>
</span><span id=__span-8-91><a id=__codelineno-8-91 name=__codelineno-8-91></a><a href=#__codelineno-8-91><span class=linenos data-linenos=" 91 "></span></a>                <span class=n>transitive_deps</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>dep</span><span class=p>)</span>
</span><span id=__span-8-92><a id=__codelineno-8-92 name=__codelineno-8-92></a><a href=#__codelineno-8-92><span class=linenos data-linenos=" 92 "></span></a>                <span class=n>to_visit</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>dep</span><span class=p>,</span> <span class=n>depth</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span>
</span><span id=__span-8-93><a id=__codelineno-8-93 name=__codelineno-8-93></a><a href=#__codelineno-8-93><span class=linenos data-linenos=" 93 "></span></a>    
</span><span id=__span-8-94><a id=__codelineno-8-94 name=__codelineno-8-94></a><a href=#__codelineno-8-94><span class=linenos data-linenos=" 94 "></span></a>    <span class=k>return</span> <span class=n>transitive_deps</span>
</span><span id=__span-8-95><a id=__codelineno-8-95 name=__codelineno-8-95></a><a href=#__codelineno-8-95><span class=linenos data-linenos=" 95 "></span></a>
</span><span id=__span-8-96><a id=__codelineno-8-96 name=__codelineno-8-96></a><a href=#__codelineno-8-96><span class=linenos data-linenos=" 96 "></span></a><span class=k>def</span> <span class=nf>calculate_dependency_impact_score</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span><span id=__span-8-97><a id=__codelineno-8-97 name=__codelineno-8-97></a><a href=#__codelineno-8-97><span class=linenos data-linenos=" 97 "></span></a>                                    <span class=n>dependency_graph</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Set</span><span class=p>[</span><span class=nb>str</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span><span id=__span-8-98><a id=__codelineno-8-98 name=__codelineno-8-98></a><a href=#__codelineno-8-98><span class=linenos data-linenos=" 98 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-8-99><a id=__codelineno-8-99 name=__codelineno-8-99></a><a href=#__codelineno-8-99><span class=linenos data-linenos=" 99 "></span></a><span class=sd>    Calculate impact score based on how many files depend on this file</span>
</span><span id=__span-8-100><a id=__codelineno-8-100 name=__codelineno-8-100></a><a href=#__codelineno-8-100><span class=linenos data-linenos="100 "></span></a><span class=sd>    Higher score = more files depend on this file</span>
</span><span id=__span-8-101><a id=__codelineno-8-101 name=__codelineno-8-101></a><a href=#__codelineno-8-101><span class=linenos data-linenos="101 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-8-102><a id=__codelineno-8-102 name=__codelineno-8-102></a><a href=#__codelineno-8-102><span class=linenos data-linenos="102 "></span></a>    
</span><span id=__span-8-103><a id=__codelineno-8-103 name=__codelineno-8-103></a><a href=#__codelineno-8-103><span class=linenos data-linenos="103 "></span></a>    <span class=n>reverse_deps</span> <span class=o>=</span> <span class=n>dependency_graph</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;reverse&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=nb>set</span><span class=p>())</span>
</span><span id=__span-8-104><a id=__codelineno-8-104 name=__codelineno-8-104></a><a href=#__codelineno-8-104><span class=linenos data-linenos="104 "></span></a>    
</span><span id=__span-8-105><a id=__codelineno-8-105 name=__codelineno-8-105></a><a href=#__codelineno-8-105><span class=linenos data-linenos="105 "></span></a>    <span class=c1># Calculate direct impact</span>
</span><span id=__span-8-106><a id=__codelineno-8-106 name=__codelineno-8-106></a><a href=#__codelineno-8-106><span class=linenos data-linenos="106 "></span></a>    <span class=n>direct_impact</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>reverse_deps</span><span class=p>)</span>
</span><span id=__span-8-107><a id=__codelineno-8-107 name=__codelineno-8-107></a><a href=#__codelineno-8-107><span class=linenos data-linenos="107 "></span></a>    
</span><span id=__span-8-108><a id=__codelineno-8-108 name=__codelineno-8-108></a><a href=#__codelineno-8-108><span class=linenos data-linenos="108 "></span></a>    <span class=c1># Calculate transitive impact (files that depend on dependents)</span>
</span><span id=__span-8-109><a id=__codelineno-8-109 name=__codelineno-8-109></a><a href=#__codelineno-8-109><span class=linenos data-linenos="109 "></span></a>    <span class=n>transitive_impact</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-8-110><a id=__codelineno-8-110 name=__codelineno-8-110></a><a href=#__codelineno-8-110><span class=linenos data-linenos="110 "></span></a>    <span class=k>for</span> <span class=n>dep_file</span> <span class=ow>in</span> <span class=n>reverse_deps</span><span class=p>:</span>
</span><span id=__span-8-111><a id=__codelineno-8-111 name=__codelineno-8-111></a><a href=#__codelineno-8-111><span class=linenos data-linenos="111 "></span></a>        <span class=n>transitive_deps</span> <span class=o>=</span> <span class=n>dependency_graph</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;reverse&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>dep_file</span><span class=p>,</span> <span class=nb>set</span><span class=p>())</span>
</span><span id=__span-8-112><a id=__codelineno-8-112 name=__codelineno-8-112></a><a href=#__codelineno-8-112><span class=linenos data-linenos="112 "></span></a>        <span class=n>transitive_impact</span> <span class=o>+=</span> <span class=nb>len</span><span class=p>(</span><span class=n>transitive_deps</span><span class=p>)</span>
</span><span id=__span-8-113><a id=__codelineno-8-113 name=__codelineno-8-113></a><a href=#__codelineno-8-113><span class=linenos data-linenos="113 "></span></a>    
</span><span id=__span-8-114><a id=__codelineno-8-114 name=__codelineno-8-114></a><a href=#__codelineno-8-114><span class=linenos data-linenos="114 "></span></a>    <span class=c1># Normalize impact score</span>
</span><span id=__span-8-115><a id=__codelineno-8-115 name=__codelineno-8-115></a><a href=#__codelineno-8-115><span class=linenos data-linenos="115 "></span></a>    <span class=n>max_files</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>dependency_graph</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;forward&#39;</span><span class=p>,</span> <span class=p>{}))</span>
</span><span id=__span-8-116><a id=__codelineno-8-116 name=__codelineno-8-116></a><a href=#__codelineno-8-116><span class=linenos data-linenos="116 "></span></a>    <span class=k>if</span> <span class=n>max_files</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-8-117><a id=__codelineno-8-117 name=__codelineno-8-117></a><a href=#__codelineno-8-117><span class=linenos data-linenos="117 "></span></a>        <span class=k>return</span> <span class=mf>0.0</span>
</span><span id=__span-8-118><a id=__codelineno-8-118 name=__codelineno-8-118></a><a href=#__codelineno-8-118><span class=linenos data-linenos="118 "></span></a>    
</span><span id=__span-8-119><a id=__codelineno-8-119 name=__codelineno-8-119></a><a href=#__codelineno-8-119><span class=linenos data-linenos="119 "></span></a>    <span class=c1># Weight direct impact more heavily than transitive</span>
</span><span id=__span-8-120><a id=__codelineno-8-120 name=__codelineno-8-120></a><a href=#__codelineno-8-120><span class=linenos data-linenos="120 "></span></a>    <span class=n>total_impact</span> <span class=o>=</span> <span class=n>direct_impact</span> <span class=o>+</span> <span class=p>(</span><span class=mf>0.5</span> <span class=o>*</span> <span class=n>transitive_impact</span><span class=p>)</span>
</span><span id=__span-8-121><a id=__codelineno-8-121 name=__codelineno-8-121></a><a href=#__codelineno-8-121><span class=linenos data-linenos="121 "></span></a>    <span class=n>normalized_score</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>total_impact</span> <span class=o>/</span> <span class=n>max_files</span><span class=p>)</span>
</span><span id=__span-8-122><a id=__codelineno-8-122 name=__codelineno-8-122></a><a href=#__codelineno-8-122><span class=linenos data-linenos="122 "></span></a>    
</span><span id=__span-8-123><a id=__codelineno-8-123 name=__codelineno-8-123></a><a href=#__codelineno-8-123><span class=linenos data-linenos="123 "></span></a>    <span class=k>return</span> <span class=n>normalized_score</span>
</span></code></pre></div><h2 id=caching-and-performance-algorithms>Caching and Performance Algorithms<a class=headerlink href=#caching-and-performance-algorithms title="Permanent link">&para;</a></h2><h3 id=intelligent-cache-management>Intelligent Cache Management<a class=headerlink href=#intelligent-cache-management title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1></a><a href=#__codelineno-9-1><span class=linenos data-linenos="  1 "></span></a><span class=k>class</span> <span class=nc>IntelligentCache</span><span class=p>:</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2></a><a href=#__codelineno-9-2><span class=linenos data-linenos="  2 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3></a><a href=#__codelineno-9-3><span class=linenos data-linenos="  3 "></span></a><span class=sd>    Intelligent caching system with predictive pre-loading and adaptive eviction</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4></a><a href=#__codelineno-9-4><span class=linenos data-linenos="  4 "></span></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5></a><a href=#__codelineno-9-5><span class=linenos data-linenos="  5 "></span></a>    
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6></a><a href=#__codelineno-9-6><span class=linenos data-linenos="  6 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>max_size_mb</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1000</span><span class=p>):</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7></a><a href=#__codelineno-9-7><span class=linenos data-linenos="  7 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>max_size_mb</span> <span class=o>=</span> <span class=n>max_size_mb</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8></a><a href=#__codelineno-9-8><span class=linenos data-linenos="  8 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>cache</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9></a><a href=#__codelineno-9-9><span class=linenos data-linenos="  9 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>access_patterns</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10></a><a href=#__codelineno-9-10><span class=linenos data-linenos=" 10 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>prediction_model</span> <span class=o>=</span> <span class=n>CachePredictor</span><span class=p>()</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11></a><a href=#__codelineno-9-11><span class=linenos data-linenos=" 11 "></span></a>    
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12></a><a href=#__codelineno-9-12><span class=linenos data-linenos=" 12 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_context</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>:</span> <span class=n>ContextRequest</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>AgentContext</span><span class=p>]:</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13></a><a href=#__codelineno-9-13><span class=linenos data-linenos=" 13 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get context from cache with pattern learning&quot;&quot;&quot;</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14></a><a href=#__codelineno-9-14><span class=linenos data-linenos=" 14 "></span></a>        
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15></a><a href=#__codelineno-9-15><span class=linenos data-linenos=" 15 "></span></a>        <span class=n>cache_key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_cache_key</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16></a><a href=#__codelineno-9-16><span class=linenos data-linenos=" 16 "></span></a>        
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17></a><a href=#__codelineno-9-17><span class=linenos data-linenos=" 17 "></span></a>        <span class=c1># Record access pattern</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18></a><a href=#__codelineno-9-18><span class=linenos data-linenos=" 18 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>record_access_pattern</span><span class=p>(</span><span class=n>cache_key</span><span class=p>,</span> <span class=n>request</span><span class=p>)</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19></a><a href=#__codelineno-9-19><span class=linenos data-linenos=" 19 "></span></a>        
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20></a><a href=#__codelineno-9-20><span class=linenos data-linenos=" 20 "></span></a>        <span class=c1># Check cache</span>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21></a><a href=#__codelineno-9-21><span class=linenos data-linenos=" 21 "></span></a>        <span class=k>if</span> <span class=n>cache_key</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=p>:</span>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22></a><a href=#__codelineno-9-22><span class=linenos data-linenos=" 22 "></span></a>            <span class=n>context</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=p>[</span><span class=n>cache_key</span><span class=p>]</span>
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23></a><a href=#__codelineno-9-23><span class=linenos data-linenos=" 23 "></span></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_context_valid</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>request</span><span class=p>):</span>
</span><span id=__span-9-24><a id=__codelineno-9-24 name=__codelineno-9-24></a><a href=#__codelineno-9-24><span class=linenos data-linenos=" 24 "></span></a>                <span class=bp>self</span><span class=o>.</span><span class=n>update_access_time</span><span class=p>(</span><span class=n>cache_key</span><span class=p>)</span>
</span><span id=__span-9-25><a id=__codelineno-9-25 name=__codelineno-9-25></a><a href=#__codelineno-9-25><span class=linenos data-linenos=" 25 "></span></a>                <span class=k>return</span> <span class=n>context</span>
</span><span id=__span-9-26><a id=__codelineno-9-26 name=__codelineno-9-26></a><a href=#__codelineno-9-26><span class=linenos data-linenos=" 26 "></span></a>        
</span><span id=__span-9-27><a id=__codelineno-9-27 name=__codelineno-9-27></a><a href=#__codelineno-9-27><span class=linenos data-linenos=" 27 "></span></a>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-9-28><a id=__codelineno-9-28 name=__codelineno-9-28></a><a href=#__codelineno-9-28><span class=linenos data-linenos=" 28 "></span></a>    
</span><span id=__span-9-29><a id=__codelineno-9-29 name=__codelineno-9-29></a><a href=#__codelineno-9-29><span class=linenos data-linenos=" 29 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>store_context</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>:</span> <span class=n>ContextRequest</span><span class=p>,</span> <span class=n>context</span><span class=p>:</span> <span class=n>AgentContext</span><span class=p>):</span>
</span><span id=__span-9-30><a id=__codelineno-9-30 name=__codelineno-9-30></a><a href=#__codelineno-9-30><span class=linenos data-linenos=" 30 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Store context with intelligent eviction&quot;&quot;&quot;</span>
</span><span id=__span-9-31><a id=__codelineno-9-31 name=__codelineno-9-31></a><a href=#__codelineno-9-31><span class=linenos data-linenos=" 31 "></span></a>        
</span><span id=__span-9-32><a id=__codelineno-9-32 name=__codelineno-9-32></a><a href=#__codelineno-9-32><span class=linenos data-linenos=" 32 "></span></a>        <span class=n>cache_key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_cache_key</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span><span id=__span-9-33><a id=__codelineno-9-33 name=__codelineno-9-33></a><a href=#__codelineno-9-33><span class=linenos data-linenos=" 33 "></span></a>        
</span><span id=__span-9-34><a id=__codelineno-9-34 name=__codelineno-9-34></a><a href=#__codelineno-9-34><span class=linenos data-linenos=" 34 "></span></a>        <span class=c1># Check if we need to evict items</span>
</span><span id=__span-9-35><a id=__codelineno-9-35 name=__codelineno-9-35></a><a href=#__codelineno-9-35><span class=linenos data-linenos=" 35 "></span></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>should_evict</span><span class=p>():</span>
</span><span id=__span-9-36><a id=__codelineno-9-36 name=__codelineno-9-36></a><a href=#__codelineno-9-36><span class=linenos data-linenos=" 36 "></span></a>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>intelligent_eviction</span><span class=p>()</span>
</span><span id=__span-9-37><a id=__codelineno-9-37 name=__codelineno-9-37></a><a href=#__codelineno-9-37><span class=linenos data-linenos=" 37 "></span></a>        
</span><span id=__span-9-38><a id=__codelineno-9-38 name=__codelineno-9-38></a><a href=#__codelineno-9-38><span class=linenos data-linenos=" 38 "></span></a>        <span class=c1># Store context</span>
</span><span id=__span-9-39><a id=__codelineno-9-39 name=__codelineno-9-39></a><a href=#__codelineno-9-39><span class=linenos data-linenos=" 39 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=p>[</span><span class=n>cache_key</span><span class=p>]</span> <span class=o>=</span> <span class=n>context</span>
</span><span id=__span-9-40><a id=__codelineno-9-40 name=__codelineno-9-40></a><a href=#__codelineno-9-40><span class=linenos data-linenos=" 40 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>update_cache_metadata</span><span class=p>(</span><span class=n>cache_key</span><span class=p>,</span> <span class=n>context</span><span class=p>)</span>
</span><span id=__span-9-41><a id=__codelineno-9-41 name=__codelineno-9-41></a><a href=#__codelineno-9-41><span class=linenos data-linenos=" 41 "></span></a>        
</span><span id=__span-9-42><a id=__codelineno-9-42 name=__codelineno-9-42></a><a href=#__codelineno-9-42><span class=linenos data-linenos=" 42 "></span></a>        <span class=c1># Trigger predictive caching</span>
</span><span id=__span-9-43><a id=__codelineno-9-43 name=__codelineno-9-43></a><a href=#__codelineno-9-43><span class=linenos data-linenos=" 43 "></span></a>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>predictive_cache_warming</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span><span id=__span-9-44><a id=__codelineno-9-44 name=__codelineno-9-44></a><a href=#__codelineno-9-44><span class=linenos data-linenos=" 44 "></span></a>    
</span><span id=__span-9-45><a id=__codelineno-9-45 name=__codelineno-9-45></a><a href=#__codelineno-9-45><span class=linenos data-linenos=" 45 "></span></a>    <span class=k>def</span> <span class=nf>generate_cache_key</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>:</span> <span class=n>ContextRequest</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-9-46><a id=__codelineno-9-46 name=__codelineno-9-46></a><a href=#__codelineno-9-46><span class=linenos data-linenos=" 46 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Generate cache key considering context factors&quot;&quot;&quot;</span>
</span><span id=__span-9-47><a id=__codelineno-9-47 name=__codelineno-9-47></a><a href=#__codelineno-9-47><span class=linenos data-linenos=" 47 "></span></a>        
</span><span id=__span-9-48><a id=__codelineno-9-48 name=__codelineno-9-48></a><a href=#__codelineno-9-48><span class=linenos data-linenos=" 48 "></span></a>        <span class=c1># Include factors that affect context relevance</span>
</span><span id=__span-9-49><a id=__codelineno-9-49 name=__codelineno-9-49></a><a href=#__codelineno-9-49><span class=linenos data-linenos=" 49 "></span></a>        <span class=n>factors</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-9-50><a id=__codelineno-9-50 name=__codelineno-9-50></a><a href=#__codelineno-9-50><span class=linenos data-linenos=" 50 "></span></a>            <span class=n>request</span><span class=o>.</span><span class=n>agent_type</span><span class=p>,</span>
</span><span id=__span-9-51><a id=__codelineno-9-51 name=__codelineno-9-51></a><a href=#__codelineno-9-51><span class=linenos data-linenos=" 51 "></span></a>            <span class=n>request</span><span class=o>.</span><span class=n>story_id</span><span class=p>,</span>
</span><span id=__span-9-52><a id=__codelineno-9-52 name=__codelineno-9-52></a><a href=#__codelineno-9-52><span class=linenos data-linenos=" 52 "></span></a>            <span class=n>request</span><span class=o>.</span><span class=n>task</span><span class=o>.</span><span class=n>current_state</span><span class=o>.</span><span class=n>value</span><span class=p>,</span>
</span><span id=__span-9-53><a id=__codelineno-9-53 name=__codelineno-9-53></a><a href=#__codelineno-9-53><span class=linenos data-linenos=" 53 "></span></a>            <span class=nb>hash</span><span class=p>(</span><span class=nb>tuple</span><span class=p>(</span><span class=nb>sorted</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>task</span><span class=o>.</span><span class=n>source_files</span><span class=p>))),</span>
</span><span id=__span-9-54><a id=__codelineno-9-54 name=__codelineno-9-54></a><a href=#__codelineno-9-54><span class=linenos data-linenos=" 54 "></span></a>            <span class=nb>hash</span><span class=p>(</span><span class=nb>tuple</span><span class=p>(</span><span class=nb>sorted</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>task</span><span class=o>.</span><span class=n>test_files</span><span class=p>))),</span>
</span><span id=__span-9-55><a id=__codelineno-9-55 name=__codelineno-9-55></a><a href=#__codelineno-9-55><span class=linenos data-linenos=" 55 "></span></a>            <span class=n>request</span><span class=o>.</span><span class=n>compression_level</span>
</span><span id=__span-9-56><a id=__codelineno-9-56 name=__codelineno-9-56></a><a href=#__codelineno-9-56><span class=linenos data-linenos=" 56 "></span></a>        <span class=p>]</span>
</span><span id=__span-9-57><a id=__codelineno-9-57 name=__codelineno-9-57></a><a href=#__codelineno-9-57><span class=linenos data-linenos=" 57 "></span></a>        
</span><span id=__span-9-58><a id=__codelineno-9-58 name=__codelineno-9-58></a><a href=#__codelineno-9-58><span class=linenos data-linenos=" 58 "></span></a>        <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>factors</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span><span id=__span-9-59><a id=__codelineno-9-59 name=__codelineno-9-59></a><a href=#__codelineno-9-59><span class=linenos data-linenos=" 59 "></span></a>    
</span><span id=__span-9-60><a id=__codelineno-9-60 name=__codelineno-9-60></a><a href=#__codelineno-9-60><span class=linenos data-linenos=" 60 "></span></a>    <span class=k>def</span> <span class=nf>is_context_valid</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context</span><span class=p>:</span> <span class=n>AgentContext</span><span class=p>,</span> <span class=n>request</span><span class=p>:</span> <span class=n>ContextRequest</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span><span id=__span-9-61><a id=__codelineno-9-61 name=__codelineno-9-61></a><a href=#__codelineno-9-61><span class=linenos data-linenos=" 61 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Check if cached context is still valid&quot;&quot;&quot;</span>
</span><span id=__span-9-62><a id=__codelineno-9-62 name=__codelineno-9-62></a><a href=#__codelineno-9-62><span class=linenos data-linenos=" 62 "></span></a>        
</span><span id=__span-9-63><a id=__codelineno-9-63 name=__codelineno-9-63></a><a href=#__codelineno-9-63><span class=linenos data-linenos=" 63 "></span></a>        <span class=c1># Check context age</span>
</span><span id=__span-9-64><a id=__codelineno-9-64 name=__codelineno-9-64></a><a href=#__codelineno-9-64><span class=linenos data-linenos=" 64 "></span></a>        <span class=n>context_age</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span> <span class=o>-</span> <span class=n>context</span><span class=o>.</span><span class=n>created_at</span>
</span><span id=__span-9-65><a id=__codelineno-9-65 name=__codelineno-9-65></a><a href=#__codelineno-9-65><span class=linenos data-linenos=" 65 "></span></a>        <span class=k>if</span> <span class=n>context_age</span> <span class=o>&gt;</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>hours</span><span class=o>=</span><span class=mi>24</span><span class=p>):</span>
</span><span id=__span-9-66><a id=__codelineno-9-66 name=__codelineno-9-66></a><a href=#__codelineno-9-66><span class=linenos data-linenos=" 66 "></span></a>            <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-9-67><a id=__codelineno-9-67 name=__codelineno-9-67></a><a href=#__codelineno-9-67><span class=linenos data-linenos=" 67 "></span></a>        
</span><span id=__span-9-68><a id=__codelineno-9-68 name=__codelineno-9-68></a><a href=#__codelineno-9-68><span class=linenos data-linenos=" 68 "></span></a>        <span class=c1># Check if source files have changed</span>
</span><span id=__span-9-69><a id=__codelineno-9-69 name=__codelineno-9-69></a><a href=#__codelineno-9-69><span class=linenos data-linenos=" 69 "></span></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>have_files_changed</span><span class=p>(</span><span class=n>context</span><span class=o>.</span><span class=n>source_files</span><span class=p>):</span>
</span><span id=__span-9-70><a id=__codelineno-9-70 name=__codelineno-9-70></a><a href=#__codelineno-9-70><span class=linenos data-linenos=" 70 "></span></a>            <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-9-71><a id=__codelineno-9-71 name=__codelineno-9-71></a><a href=#__codelineno-9-71><span class=linenos data-linenos=" 71 "></span></a>        
</span><span id=__span-9-72><a id=__codelineno-9-72 name=__codelineno-9-72></a><a href=#__codelineno-9-72><span class=linenos data-linenos=" 72 "></span></a>        <span class=c1># Check if task requirements have significantly changed</span>
</span><span id=__span-9-73><a id=__codelineno-9-73 name=__codelineno-9-73></a><a href=#__codelineno-9-73><span class=linenos data-linenos=" 73 "></span></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>has_task_changed_significantly</span><span class=p>(</span><span class=n>context</span><span class=o>.</span><span class=n>task_hash</span><span class=p>,</span> <span class=n>request</span><span class=o>.</span><span class=n>task</span><span class=p>):</span>
</span><span id=__span-9-74><a id=__codelineno-9-74 name=__codelineno-9-74></a><a href=#__codelineno-9-74><span class=linenos data-linenos=" 74 "></span></a>            <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-9-75><a id=__codelineno-9-75 name=__codelineno-9-75></a><a href=#__codelineno-9-75><span class=linenos data-linenos=" 75 "></span></a>        
</span><span id=__span-9-76><a id=__codelineno-9-76 name=__codelineno-9-76></a><a href=#__codelineno-9-76><span class=linenos data-linenos=" 76 "></span></a>        <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-9-77><a id=__codelineno-9-77 name=__codelineno-9-77></a><a href=#__codelineno-9-77><span class=linenos data-linenos=" 77 "></span></a>    
</span><span id=__span-9-78><a id=__codelineno-9-78 name=__codelineno-9-78></a><a href=#__codelineno-9-78><span class=linenos data-linenos=" 78 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>intelligent_eviction</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-9-79><a id=__codelineno-9-79 name=__codelineno-9-79></a><a href=#__codelineno-9-79><span class=linenos data-linenos=" 79 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Evict cache items using intelligent strategy&quot;&quot;&quot;</span>
</span><span id=__span-9-80><a id=__codelineno-9-80 name=__codelineno-9-80></a><a href=#__codelineno-9-80><span class=linenos data-linenos=" 80 "></span></a>        
</span><span id=__span-9-81><a id=__codelineno-9-81 name=__codelineno-9-81></a><a href=#__codelineno-9-81><span class=linenos data-linenos=" 81 "></span></a>        <span class=c1># Calculate eviction scores for all cached items</span>
</span><span id=__span-9-82><a id=__codelineno-9-82 name=__codelineno-9-82></a><a href=#__codelineno-9-82><span class=linenos data-linenos=" 82 "></span></a>        <span class=n>eviction_scores</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-9-83><a id=__codelineno-9-83 name=__codelineno-9-83></a><a href=#__codelineno-9-83><span class=linenos data-linenos=" 83 "></span></a>        
</span><span id=__span-9-84><a id=__codelineno-9-84 name=__codelineno-9-84></a><a href=#__codelineno-9-84><span class=linenos data-linenos=" 84 "></span></a>        <span class=k>for</span> <span class=n>cache_key</span><span class=p>,</span> <span class=n>context</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-9-85><a id=__codelineno-9-85 name=__codelineno-9-85></a><a href=#__codelineno-9-85><span class=linenos data-linenos=" 85 "></span></a>            <span class=n>score</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_eviction_score</span><span class=p>(</span><span class=n>cache_key</span><span class=p>,</span> <span class=n>context</span><span class=p>)</span>
</span><span id=__span-9-86><a id=__codelineno-9-86 name=__codelineno-9-86></a><a href=#__codelineno-9-86><span class=linenos data-linenos=" 86 "></span></a>            <span class=n>eviction_scores</span><span class=p>[</span><span class=n>cache_key</span><span class=p>]</span> <span class=o>=</span> <span class=n>score</span>
</span><span id=__span-9-87><a id=__codelineno-9-87 name=__codelineno-9-87></a><a href=#__codelineno-9-87><span class=linenos data-linenos=" 87 "></span></a>        
</span><span id=__span-9-88><a id=__codelineno-9-88 name=__codelineno-9-88></a><a href=#__codelineno-9-88><span class=linenos data-linenos=" 88 "></span></a>        <span class=c1># Sort by eviction score (higher = more likely to evict)</span>
</span><span id=__span-9-89><a id=__codelineno-9-89 name=__codelineno-9-89></a><a href=#__codelineno-9-89><span class=linenos data-linenos=" 89 "></span></a>        <span class=n>sorted_items</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>eviction_scores</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-9-90><a id=__codelineno-9-90 name=__codelineno-9-90></a><a href=#__codelineno-9-90><span class=linenos data-linenos=" 90 "></span></a>        
</span><span id=__span-9-91><a id=__codelineno-9-91 name=__codelineno-9-91></a><a href=#__codelineno-9-91><span class=linenos data-linenos=" 91 "></span></a>        <span class=c1># Evict items until we&#39;re under the size limit</span>
</span><span id=__span-9-92><a id=__codelineno-9-92 name=__codelineno-9-92></a><a href=#__codelineno-9-92><span class=linenos data-linenos=" 92 "></span></a>        <span class=n>current_size</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_cache_size_mb</span><span class=p>()</span>
</span><span id=__span-9-93><a id=__codelineno-9-93 name=__codelineno-9-93></a><a href=#__codelineno-9-93><span class=linenos data-linenos=" 93 "></span></a>        <span class=n>target_size</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_size_mb</span> <span class=o>*</span> <span class=mf>0.8</span>  <span class=c1># Leave 20% buffer</span>
</span><span id=__span-9-94><a id=__codelineno-9-94 name=__codelineno-9-94></a><a href=#__codelineno-9-94><span class=linenos data-linenos=" 94 "></span></a>        
</span><span id=__span-9-95><a id=__codelineno-9-95 name=__codelineno-9-95></a><a href=#__codelineno-9-95><span class=linenos data-linenos=" 95 "></span></a>        <span class=k>for</span> <span class=n>cache_key</span><span class=p>,</span> <span class=n>score</span> <span class=ow>in</span> <span class=n>sorted_items</span><span class=p>:</span>
</span><span id=__span-9-96><a id=__codelineno-9-96 name=__codelineno-9-96></a><a href=#__codelineno-9-96><span class=linenos data-linenos=" 96 "></span></a>            <span class=k>if</span> <span class=n>current_size</span> <span class=o>&lt;=</span> <span class=n>target_size</span><span class=p>:</span>
</span><span id=__span-9-97><a id=__codelineno-9-97 name=__codelineno-9-97></a><a href=#__codelineno-9-97><span class=linenos data-linenos=" 97 "></span></a>                <span class=k>break</span>
</span><span id=__span-9-98><a id=__codelineno-9-98 name=__codelineno-9-98></a><a href=#__codelineno-9-98><span class=linenos data-linenos=" 98 "></span></a>            
</span><span id=__span-9-99><a id=__codelineno-9-99 name=__codelineno-9-99></a><a href=#__codelineno-9-99><span class=linenos data-linenos=" 99 "></span></a>            <span class=n>context</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>cache_key</span><span class=p>)</span>
</span><span id=__span-9-100><a id=__codelineno-9-100 name=__codelineno-9-100></a><a href=#__codelineno-9-100><span class=linenos data-linenos="100 "></span></a>            <span class=n>current_size</span> <span class=o>-=</span> <span class=bp>self</span><span class=o>.</span><span class=n>estimate_context_size_mb</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>
</span><span id=__span-9-101><a id=__codelineno-9-101 name=__codelineno-9-101></a><a href=#__codelineno-9-101><span class=linenos data-linenos="101 "></span></a>            
</span><span id=__span-9-102><a id=__codelineno-9-102 name=__codelineno-9-102></a><a href=#__codelineno-9-102><span class=linenos data-linenos="102 "></span></a>            <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Evicted cache item </span><span class=si>{</span><span class=n>cache_key</span><span class=si>}</span><span class=s2> (score: </span><span class=si>{</span><span class=n>score</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>)&quot;</span><span class=p>)</span>
</span><span id=__span-9-103><a id=__codelineno-9-103 name=__codelineno-9-103></a><a href=#__codelineno-9-103><span class=linenos data-linenos="103 "></span></a>    
</span><span id=__span-9-104><a id=__codelineno-9-104 name=__codelineno-9-104></a><a href=#__codelineno-9-104><span class=linenos data-linenos="104 "></span></a>    <span class=k>def</span> <span class=nf>calculate_eviction_score</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cache_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>context</span><span class=p>:</span> <span class=n>AgentContext</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span><span id=__span-9-105><a id=__codelineno-9-105 name=__codelineno-9-105></a><a href=#__codelineno-9-105><span class=linenos data-linenos="105 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculate eviction score (higher = more likely to evict)&quot;&quot;&quot;</span>
</span><span id=__span-9-106><a id=__codelineno-9-106 name=__codelineno-9-106></a><a href=#__codelineno-9-106><span class=linenos data-linenos="106 "></span></a>        
</span><span id=__span-9-107><a id=__codelineno-9-107 name=__codelineno-9-107></a><a href=#__codelineno-9-107><span class=linenos data-linenos="107 "></span></a>        <span class=c1># Factor 1: Age (older = higher eviction score)</span>
</span><span id=__span-9-108><a id=__codelineno-9-108 name=__codelineno-9-108></a><a href=#__codelineno-9-108><span class=linenos data-linenos="108 "></span></a>        <span class=n>age_hours</span> <span class=o>=</span> <span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span> <span class=o>-</span> <span class=n>context</span><span class=o>.</span><span class=n>created_at</span><span class=p>)</span><span class=o>.</span><span class=n>total_seconds</span><span class=p>()</span> <span class=o>/</span> <span class=mi>3600</span>
</span><span id=__span-9-109><a id=__codelineno-9-109 name=__codelineno-9-109></a><a href=#__codelineno-9-109><span class=linenos data-linenos="109 "></span></a>        <span class=n>age_score</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>age_hours</span> <span class=o>/</span> <span class=mi>24</span><span class=p>)</span>  <span class=c1># Normalize to 24 hours</span>
</span><span id=__span-9-110><a id=__codelineno-9-110 name=__codelineno-9-110></a><a href=#__codelineno-9-110><span class=linenos data-linenos="110 "></span></a>        
</span><span id=__span-9-111><a id=__codelineno-9-111 name=__codelineno-9-111></a><a href=#__codelineno-9-111><span class=linenos data-linenos="111 "></span></a>        <span class=c1># Factor 2: Access frequency (less frequent = higher eviction score)</span>
</span><span id=__span-9-112><a id=__codelineno-9-112 name=__codelineno-9-112></a><a href=#__codelineno-9-112><span class=linenos data-linenos="112 "></span></a>        <span class=n>access_count</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>access_patterns</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>cache_key</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span><span id=__span-9-113><a id=__codelineno-9-113 name=__codelineno-9-113></a><a href=#__codelineno-9-113><span class=linenos data-linenos="113 "></span></a>        <span class=n>max_access</span> <span class=o>=</span> <span class=nb>max</span><span class=p>((</span><span class=n>p</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>access_patterns</span><span class=o>.</span><span class=n>values</span><span class=p>()),</span> <span class=n>default</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-9-114><a id=__codelineno-9-114 name=__codelineno-9-114></a><a href=#__codelineno-9-114><span class=linenos data-linenos="114 "></span></a>        <span class=n>frequency_score</span> <span class=o>=</span> <span class=mf>1.0</span> <span class=o>-</span> <span class=p>(</span><span class=n>access_count</span> <span class=o>/</span> <span class=n>max_access</span><span class=p>)</span>
</span><span id=__span-9-115><a id=__codelineno-9-115 name=__codelineno-9-115></a><a href=#__codelineno-9-115><span class=linenos data-linenos="115 "></span></a>        
</span><span id=__span-9-116><a id=__codelineno-9-116 name=__codelineno-9-116></a><a href=#__codelineno-9-116><span class=linenos data-linenos="116 "></span></a>        <span class=c1># Factor 3: Size (larger = higher eviction score for equal other factors)</span>
</span><span id=__span-9-117><a id=__codelineno-9-117 name=__codelineno-9-117></a><a href=#__codelineno-9-117><span class=linenos data-linenos="117 "></span></a>        <span class=n>size_mb</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>estimate_context_size_mb</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>
</span><span id=__span-9-118><a id=__codelineno-9-118 name=__codelineno-9-118></a><a href=#__codelineno-9-118><span class=linenos data-linenos="118 "></span></a>        <span class=n>max_size</span> <span class=o>=</span> <span class=nb>max</span><span class=p>((</span><span class=bp>self</span><span class=o>.</span><span class=n>estimate_context_size_mb</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span><span class=o>.</span><span class=n>values</span><span class=p>()),</span> <span class=n>default</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-9-119><a id=__codelineno-9-119 name=__codelineno-9-119></a><a href=#__codelineno-9-119><span class=linenos data-linenos="119 "></span></a>        <span class=n>size_score</span> <span class=o>=</span> <span class=n>size_mb</span> <span class=o>/</span> <span class=n>max_size</span>
</span><span id=__span-9-120><a id=__codelineno-9-120 name=__codelineno-9-120></a><a href=#__codelineno-9-120><span class=linenos data-linenos="120 "></span></a>        
</span><span id=__span-9-121><a id=__codelineno-9-121 name=__codelineno-9-121></a><a href=#__codelineno-9-121><span class=linenos data-linenos="121 "></span></a>        <span class=c1># Factor 4: Prediction score (less likely to be accessed = higher eviction score)</span>
</span><span id=__span-9-122><a id=__codelineno-9-122 name=__codelineno-9-122></a><a href=#__codelineno-9-122><span class=linenos data-linenos="122 "></span></a>        <span class=n>prediction_score</span> <span class=o>=</span> <span class=mf>1.0</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>prediction_model</span><span class=o>.</span><span class=n>predict_access_probability</span><span class=p>(</span><span class=n>cache_key</span><span class=p>)</span>
</span><span id=__span-9-123><a id=__codelineno-9-123 name=__codelineno-9-123></a><a href=#__codelineno-9-123><span class=linenos data-linenos="123 "></span></a>        
</span><span id=__span-9-124><a id=__codelineno-9-124 name=__codelineno-9-124></a><a href=#__codelineno-9-124><span class=linenos data-linenos="124 "></span></a>        <span class=c1># Weighted combination</span>
</span><span id=__span-9-125><a id=__codelineno-9-125 name=__codelineno-9-125></a><a href=#__codelineno-9-125><span class=linenos data-linenos="125 "></span></a>        <span class=n>eviction_score</span> <span class=o>=</span> <span class=p>(</span>
</span><span id=__span-9-126><a id=__codelineno-9-126 name=__codelineno-9-126></a><a href=#__codelineno-9-126><span class=linenos data-linenos="126 "></span></a>            <span class=mf>0.3</span> <span class=o>*</span> <span class=n>age_score</span> <span class=o>+</span>
</span><span id=__span-9-127><a id=__codelineno-9-127 name=__codelineno-9-127></a><a href=#__codelineno-9-127><span class=linenos data-linenos="127 "></span></a>            <span class=mf>0.3</span> <span class=o>*</span> <span class=n>frequency_score</span> <span class=o>+</span>
</span><span id=__span-9-128><a id=__codelineno-9-128 name=__codelineno-9-128></a><a href=#__codelineno-9-128><span class=linenos data-linenos="128 "></span></a>            <span class=mf>0.2</span> <span class=o>*</span> <span class=n>size_score</span> <span class=o>+</span>
</span><span id=__span-9-129><a id=__codelineno-9-129 name=__codelineno-9-129></a><a href=#__codelineno-9-129><span class=linenos data-linenos="129 "></span></a>            <span class=mf>0.2</span> <span class=o>*</span> <span class=n>prediction_score</span>
</span><span id=__span-9-130><a id=__codelineno-9-130 name=__codelineno-9-130></a><a href=#__codelineno-9-130><span class=linenos data-linenos="130 "></span></a>        <span class=p>)</span>
</span><span id=__span-9-131><a id=__codelineno-9-131 name=__codelineno-9-131></a><a href=#__codelineno-9-131><span class=linenos data-linenos="131 "></span></a>        
</span><span id=__span-9-132><a id=__codelineno-9-132 name=__codelineno-9-132></a><a href=#__codelineno-9-132><span class=linenos data-linenos="132 "></span></a>        <span class=k>return</span> <span class=n>eviction_score</span>
</span><span id=__span-9-133><a id=__codelineno-9-133 name=__codelineno-9-133></a><a href=#__codelineno-9-133><span class=linenos data-linenos="133 "></span></a>    
</span><span id=__span-9-134><a id=__codelineno-9-134 name=__codelineno-9-134></a><a href=#__codelineno-9-134><span class=linenos data-linenos="134 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>predictive_cache_warming</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>:</span> <span class=n>ContextRequest</span><span class=p>):</span>
</span><span id=__span-9-135><a id=__codelineno-9-135 name=__codelineno-9-135></a><a href=#__codelineno-9-135><span class=linenos data-linenos="135 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Pre-warm cache with likely future requests&quot;&quot;&quot;</span>
</span><span id=__span-9-136><a id=__codelineno-9-136 name=__codelineno-9-136></a><a href=#__codelineno-9-136><span class=linenos data-linenos="136 "></span></a>        
</span><span id=__span-9-137><a id=__codelineno-9-137 name=__codelineno-9-137></a><a href=#__codelineno-9-137><span class=linenos data-linenos="137 "></span></a>        <span class=c1># Predict likely next requests based on current request</span>
</span><span id=__span-9-138><a id=__codelineno-9-138 name=__codelineno-9-138></a><a href=#__codelineno-9-138><span class=linenos data-linenos="138 "></span></a>        <span class=n>predicted_requests</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>prediction_model</span><span class=o>.</span><span class=n>predict_next_requests</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span><span id=__span-9-139><a id=__codelineno-9-139 name=__codelineno-9-139></a><a href=#__codelineno-9-139><span class=linenos data-linenos="139 "></span></a>        
</span><span id=__span-9-140><a id=__codelineno-9-140 name=__codelineno-9-140></a><a href=#__codelineno-9-140><span class=linenos data-linenos="140 "></span></a>        <span class=k>for</span> <span class=n>predicted_request</span> <span class=ow>in</span> <span class=n>predicted_requests</span><span class=p>:</span>
</span><span id=__span-9-141><a id=__codelineno-9-141 name=__codelineno-9-141></a><a href=#__codelineno-9-141><span class=linenos data-linenos="141 "></span></a>            <span class=n>cache_key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_cache_key</span><span class=p>(</span><span class=n>predicted_request</span><span class=p>)</span>
</span><span id=__span-9-142><a id=__codelineno-9-142 name=__codelineno-9-142></a><a href=#__codelineno-9-142><span class=linenos data-linenos="142 "></span></a>            
</span><span id=__span-9-143><a id=__codelineno-9-143 name=__codelineno-9-143></a><a href=#__codelineno-9-143><span class=linenos data-linenos="143 "></span></a>            <span class=c1># Only pre-warm if not already cached and high confidence</span>
</span><span id=__span-9-144><a id=__codelineno-9-144 name=__codelineno-9-144></a><a href=#__codelineno-9-144><span class=linenos data-linenos="144 "></span></a>            <span class=k>if</span> <span class=n>cache_key</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache</span> <span class=ow>and</span> <span class=n>predicted_request</span><span class=o>.</span><span class=n>confidence</span> <span class=o>&gt;</span> <span class=mf>0.7</span><span class=p>:</span>
</span><span id=__span-9-145><a id=__codelineno-9-145 name=__codelineno-9-145></a><a href=#__codelineno-9-145><span class=linenos data-linenos="145 "></span></a>                <span class=k>try</span><span class=p>:</span>
</span><span id=__span-9-146><a id=__codelineno-9-146 name=__codelineno-9-146></a><a href=#__codelineno-9-146><span class=linenos data-linenos="146 "></span></a>                    <span class=c1># Prepare context in background</span>
</span><span id=__span-9-147><a id=__codelineno-9-147 name=__codelineno-9-147></a><a href=#__codelineno-9-147><span class=linenos data-linenos="147 "></span></a>                    <span class=n>context</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>context_manager</span><span class=o>.</span><span class=n>prepare_context</span><span class=p>(</span><span class=n>predicted_request</span><span class=p>)</span>
</span><span id=__span-9-148><a id=__codelineno-9-148 name=__codelineno-9-148></a><a href=#__codelineno-9-148><span class=linenos data-linenos="148 "></span></a>                    <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>store_context</span><span class=p>(</span><span class=n>predicted_request</span><span class=p>,</span> <span class=n>context</span><span class=p>)</span>
</span><span id=__span-9-149><a id=__codelineno-9-149 name=__codelineno-9-149></a><a href=#__codelineno-9-149><span class=linenos data-linenos="149 "></span></a>                    
</span><span id=__span-9-150><a id=__codelineno-9-150 name=__codelineno-9-150></a><a href=#__codelineno-9-150><span class=linenos data-linenos="150 "></span></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Pre-warmed cache for predicted request: </span><span class=si>{</span><span class=n>cache_key</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-9-151><a id=__codelineno-9-151 name=__codelineno-9-151></a><a href=#__codelineno-9-151><span class=linenos data-linenos="151 "></span></a>                    
</span><span id=__span-9-152><a id=__codelineno-9-152 name=__codelineno-9-152></a><a href=#__codelineno-9-152><span class=linenos data-linenos="152 "></span></a>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-9-153><a id=__codelineno-9-153 name=__codelineno-9-153></a><a href=#__codelineno-9-153><span class=linenos data-linenos="153 "></span></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to pre-warm cache: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-9-154><a id=__codelineno-9-154 name=__codelineno-9-154></a><a href=#__codelineno-9-154><span class=linenos data-linenos="154 "></span></a>
</span><span id=__span-9-155><a id=__codelineno-9-155 name=__codelineno-9-155></a><a href=#__codelineno-9-155><span class=linenos data-linenos="155 "></span></a><span class=k>class</span> <span class=nc>CachePredictor</span><span class=p>:</span>
</span><span id=__span-9-156><a id=__codelineno-9-156 name=__codelineno-9-156></a><a href=#__codelineno-9-156><span class=linenos data-linenos="156 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Predict future cache access patterns&quot;&quot;&quot;</span>
</span><span id=__span-9-157><a id=__codelineno-9-157 name=__codelineno-9-157></a><a href=#__codelineno-9-157><span class=linenos data-linenos="157 "></span></a>    
</span><span id=__span-9-158><a id=__codelineno-9-158 name=__codelineno-9-158></a><a href=#__codelineno-9-158><span class=linenos data-linenos="158 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-9-159><a id=__codelineno-9-159 name=__codelineno-9-159></a><a href=#__codelineno-9-159><span class=linenos data-linenos="159 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>pattern_history</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-9-160><a id=__codelineno-9-160 name=__codelineno-9-160></a><a href=#__codelineno-9-160><span class=linenos data-linenos="160 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>transition_matrix</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-9-161><a id=__codelineno-9-161 name=__codelineno-9-161></a><a href=#__codelineno-9-161><span class=linenos data-linenos="161 "></span></a>    
</span><span id=__span-9-162><a id=__codelineno-9-162 name=__codelineno-9-162></a><a href=#__codelineno-9-162><span class=linenos data-linenos="162 "></span></a>    <span class=k>def</span> <span class=nf>predict_access_probability</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cache_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span><span id=__span-9-163><a id=__codelineno-9-163 name=__codelineno-9-163></a><a href=#__codelineno-9-163><span class=linenos data-linenos="163 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Predict probability that cache_key will be accessed soon&quot;&quot;&quot;</span>
</span><span id=__span-9-164><a id=__codelineno-9-164 name=__codelineno-9-164></a><a href=#__codelineno-9-164><span class=linenos data-linenos="164 "></span></a>        
</span><span id=__span-9-165><a id=__codelineno-9-165 name=__codelineno-9-165></a><a href=#__codelineno-9-165><span class=linenos data-linenos="165 "></span></a>        <span class=c1># Use simple frequency-based prediction for now</span>
</span><span id=__span-9-166><a id=__codelineno-9-166 name=__codelineno-9-166></a><a href=#__codelineno-9-166><span class=linenos data-linenos="166 "></span></a>        <span class=c1># Can be enhanced with ML models</span>
</span><span id=__span-9-167><a id=__codelineno-9-167 name=__codelineno-9-167></a><a href=#__codelineno-9-167><span class=linenos data-linenos="167 "></span></a>        
</span><span id=__span-9-168><a id=__codelineno-9-168 name=__codelineno-9-168></a><a href=#__codelineno-9-168><span class=linenos data-linenos="168 "></span></a>        <span class=n>recent_accesses</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_recent_access_patterns</span><span class=p>()</span>
</span><span id=__span-9-169><a id=__codelineno-9-169 name=__codelineno-9-169></a><a href=#__codelineno-9-169><span class=linenos data-linenos="169 "></span></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>recent_accesses</span><span class=p>:</span>
</span><span id=__span-9-170><a id=__codelineno-9-170 name=__codelineno-9-170></a><a href=#__codelineno-9-170><span class=linenos data-linenos="170 "></span></a>            <span class=k>return</span> <span class=mf>0.5</span>  <span class=c1># Default probability</span>
</span><span id=__span-9-171><a id=__codelineno-9-171 name=__codelineno-9-171></a><a href=#__codelineno-9-171><span class=linenos data-linenos="171 "></span></a>        
</span><span id=__span-9-172><a id=__codelineno-9-172 name=__codelineno-9-172></a><a href=#__codelineno-9-172><span class=linenos data-linenos="172 "></span></a>        <span class=c1># Count how often this key appears in recent patterns</span>
</span><span id=__span-9-173><a id=__codelineno-9-173 name=__codelineno-9-173></a><a href=#__codelineno-9-173><span class=linenos data-linenos="173 "></span></a>        <span class=n>appearances</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=mi>1</span> <span class=k>for</span> <span class=n>pattern</span> <span class=ow>in</span> <span class=n>recent_accesses</span> <span class=k>if</span> <span class=n>cache_key</span> <span class=ow>in</span> <span class=n>pattern</span><span class=p>)</span>
</span><span id=__span-9-174><a id=__codelineno-9-174 name=__codelineno-9-174></a><a href=#__codelineno-9-174><span class=linenos data-linenos="174 "></span></a>        <span class=n>probability</span> <span class=o>=</span> <span class=n>appearances</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>recent_accesses</span><span class=p>)</span>
</span><span id=__span-9-175><a id=__codelineno-9-175 name=__codelineno-9-175></a><a href=#__codelineno-9-175><span class=linenos data-linenos="175 "></span></a>        
</span><span id=__span-9-176><a id=__codelineno-9-176 name=__codelineno-9-176></a><a href=#__codelineno-9-176><span class=linenos data-linenos="176 "></span></a>        <span class=k>return</span> <span class=n>probability</span>
</span><span id=__span-9-177><a id=__codelineno-9-177 name=__codelineno-9-177></a><a href=#__codelineno-9-177><span class=linenos data-linenos="177 "></span></a>    
</span><span id=__span-9-178><a id=__codelineno-9-178 name=__codelineno-9-178></a><a href=#__codelineno-9-178><span class=linenos data-linenos="178 "></span></a>    <span class=k>def</span> <span class=nf>predict_next_requests</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>current_request</span><span class=p>:</span> <span class=n>ContextRequest</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>ContextRequest</span><span class=p>]:</span>
</span><span id=__span-9-179><a id=__codelineno-9-179 name=__codelineno-9-179></a><a href=#__codelineno-9-179><span class=linenos data-linenos="179 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Predict likely next context requests&quot;&quot;&quot;</span>
</span><span id=__span-9-180><a id=__codelineno-9-180 name=__codelineno-9-180></a><a href=#__codelineno-9-180><span class=linenos data-linenos="180 "></span></a>        
</span><span id=__span-9-181><a id=__codelineno-9-181 name=__codelineno-9-181></a><a href=#__codelineno-9-181><span class=linenos data-linenos="181 "></span></a>        <span class=n>predictions</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-9-182><a id=__codelineno-9-182 name=__codelineno-9-182></a><a href=#__codelineno-9-182><span class=linenos data-linenos="182 "></span></a>        
</span><span id=__span-9-183><a id=__codelineno-9-183 name=__codelineno-9-183></a><a href=#__codelineno-9-183><span class=linenos data-linenos="183 "></span></a>        <span class=c1># Pattern 1: Same agent, next TDD phase</span>
</span><span id=__span-9-184><a id=__codelineno-9-184 name=__codelineno-9-184></a><a href=#__codelineno-9-184><span class=linenos data-linenos="184 "></span></a>        <span class=n>next_phase</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_next_tdd_phase</span><span class=p>(</span><span class=n>current_request</span><span class=o>.</span><span class=n>task</span><span class=o>.</span><span class=n>current_state</span><span class=p>)</span>
</span><span id=__span-9-185><a id=__codelineno-9-185 name=__codelineno-9-185></a><a href=#__codelineno-9-185><span class=linenos data-linenos="185 "></span></a>        <span class=k>if</span> <span class=n>next_phase</span><span class=p>:</span>
</span><span id=__span-9-186><a id=__codelineno-9-186 name=__codelineno-9-186></a><a href=#__codelineno-9-186><span class=linenos data-linenos="186 "></span></a>            <span class=n>predicted_request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_predicted_request</span><span class=p>(</span>
</span><span id=__span-9-187><a id=__codelineno-9-187 name=__codelineno-9-187></a><a href=#__codelineno-9-187><span class=linenos data-linenos="187 "></span></a>                <span class=n>current_request</span><span class=p>,</span> <span class=n>tdd_phase</span><span class=o>=</span><span class=n>next_phase</span><span class=p>,</span> <span class=n>confidence</span><span class=o>=</span><span class=mf>0.8</span>
</span><span id=__span-9-188><a id=__codelineno-9-188 name=__codelineno-9-188></a><a href=#__codelineno-9-188><span class=linenos data-linenos="188 "></span></a>            <span class=p>)</span>
</span><span id=__span-9-189><a id=__codelineno-9-189 name=__codelineno-9-189></a><a href=#__codelineno-9-189><span class=linenos data-linenos="189 "></span></a>            <span class=n>predictions</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>predicted_request</span><span class=p>)</span>
</span><span id=__span-9-190><a id=__codelineno-9-190 name=__codelineno-9-190></a><a href=#__codelineno-9-190><span class=linenos data-linenos="190 "></span></a>        
</span><span id=__span-9-191><a id=__codelineno-9-191 name=__codelineno-9-191></a><a href=#__codelineno-9-191><span class=linenos data-linenos="191 "></span></a>        <span class=c1># Pattern 2: Different agent, same phase (parallel work)</span>
</span><span id=__span-9-192><a id=__codelineno-9-192 name=__codelineno-9-192></a><a href=#__codelineno-9-192><span class=linenos data-linenos="192 "></span></a>        <span class=k>for</span> <span class=n>agent_type</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;DesignAgent&#39;</span><span class=p>,</span> <span class=s1>&#39;QAAgent&#39;</span><span class=p>,</span> <span class=s1>&#39;CodeAgent&#39;</span><span class=p>,</span> <span class=s1>&#39;DataAgent&#39;</span><span class=p>]:</span>
</span><span id=__span-9-193><a id=__codelineno-9-193 name=__codelineno-9-193></a><a href=#__codelineno-9-193><span class=linenos data-linenos="193 "></span></a>            <span class=k>if</span> <span class=n>agent_type</span> <span class=o>!=</span> <span class=n>current_request</span><span class=o>.</span><span class=n>agent_type</span><span class=p>:</span>
</span><span id=__span-9-194><a id=__codelineno-9-194 name=__codelineno-9-194></a><a href=#__codelineno-9-194><span class=linenos data-linenos="194 "></span></a>                <span class=n>predicted_request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_predicted_request</span><span class=p>(</span>
</span><span id=__span-9-195><a id=__codelineno-9-195 name=__codelineno-9-195></a><a href=#__codelineno-9-195><span class=linenos data-linenos="195 "></span></a>                    <span class=n>current_request</span><span class=p>,</span> <span class=n>agent_type</span><span class=o>=</span><span class=n>agent_type</span><span class=p>,</span> <span class=n>confidence</span><span class=o>=</span><span class=mf>0.6</span>
</span><span id=__span-9-196><a id=__codelineno-9-196 name=__codelineno-9-196></a><a href=#__codelineno-9-196><span class=linenos data-linenos="196 "></span></a>                <span class=p>)</span>
</span><span id=__span-9-197><a id=__codelineno-9-197 name=__codelineno-9-197></a><a href=#__codelineno-9-197><span class=linenos data-linenos="197 "></span></a>                <span class=n>predictions</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>predicted_request</span><span class=p>)</span>
</span><span id=__span-9-198><a id=__codelineno-9-198 name=__codelineno-9-198></a><a href=#__codelineno-9-198><span class=linenos data-linenos="198 "></span></a>        
</span><span id=__span-9-199><a id=__codelineno-9-199 name=__codelineno-9-199></a><a href=#__codelineno-9-199><span class=linenos data-linenos="199 "></span></a>        <span class=c1># Pattern 3: Same agent, related story</span>
</span><span id=__span-9-200><a id=__codelineno-9-200 name=__codelineno-9-200></a><a href=#__codelineno-9-200><span class=linenos data-linenos="200 "></span></a>        <span class=n>related_stories</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_related_stories</span><span class=p>(</span><span class=n>current_request</span><span class=o>.</span><span class=n>story_id</span><span class=p>)</span>
</span><span id=__span-9-201><a id=__codelineno-9-201 name=__codelineno-9-201></a><a href=#__codelineno-9-201><span class=linenos data-linenos="201 "></span></a>        <span class=k>for</span> <span class=n>story_id</span> <span class=ow>in</span> <span class=n>related_stories</span><span class=p>[:</span><span class=mi>2</span><span class=p>]:</span>  <span class=c1># Limit to top 2 related</span>
</span><span id=__span-9-202><a id=__codelineno-9-202 name=__codelineno-9-202></a><a href=#__codelineno-9-202><span class=linenos data-linenos="202 "></span></a>            <span class=n>predicted_request</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_predicted_request</span><span class=p>(</span>
</span><span id=__span-9-203><a id=__codelineno-9-203 name=__codelineno-9-203></a><a href=#__codelineno-9-203><span class=linenos data-linenos="203 "></span></a>                <span class=n>current_request</span><span class=p>,</span> <span class=n>story_id</span><span class=o>=</span><span class=n>story_id</span><span class=p>,</span> <span class=n>confidence</span><span class=o>=</span><span class=mf>0.4</span>
</span><span id=__span-9-204><a id=__codelineno-9-204 name=__codelineno-9-204></a><a href=#__codelineno-9-204><span class=linenos data-linenos="204 "></span></a>            <span class=p>)</span>
</span><span id=__span-9-205><a id=__codelineno-9-205 name=__codelineno-9-205></a><a href=#__codelineno-9-205><span class=linenos data-linenos="205 "></span></a>            <span class=n>predictions</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>predicted_request</span><span class=p>)</span>
</span><span id=__span-9-206><a id=__codelineno-9-206 name=__codelineno-9-206></a><a href=#__codelineno-9-206><span class=linenos data-linenos="206 "></span></a>        
</span><span id=__span-9-207><a id=__codelineno-9-207 name=__codelineno-9-207></a><a href=#__codelineno-9-207><span class=linenos data-linenos="207 "></span></a>        <span class=k>return</span> <span class=n>predictions</span>
</span></code></pre></div><p>This comprehensive set of algorithms provides the foundation for intelligent context management, covering relevance scoring, content compression, dependency analysis, and caching strategies. Each algorithm is designed to be configurable and extensible, allowing for continuous improvement based on real-world usage patterns.</p><aside class=md-source-file><span class=md-source-file__fact><span class=md-icon title="Last update"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="June 17, 2025 21:28:50 UTC">June 17, 2025 21:28:50</span></span><span class=md-source-file__fact><span class=md-icon title=Created><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="June 17, 2025 21:28:50 UTC">June 17, 2025 21:28:50</span></span></aside><form class=md-feedback name=feedback hidden><fieldset><legend class=md-feedback__title> Was this page helpful? </legend><div class=md-feedback__inner><div class=md-feedback__list><button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg></button><button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg></button></div><div class=md-feedback__note><div data-md-value=1 hidden> Thanks for your feedback! </div><div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by <a href="https://github.com/jmontp/agent-workflow/issues/new/?title=[Feedback]+Context%20Algorithms+-+/architecture/context-algorithms/" target=_blank rel=noopener>telling us what you found confusing</a>. </div></div></div></fieldset></form></article></div><script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script><script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script></div><button type=button class="md-top md-icon" data-md-component=top hidden><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button></main><footer class=md-footer><nav class="md-footer__inner md-grid" aria-label=Footer><a href=../context-api-specification/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Context API Specification"><div class="md-footer__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M15.41 16.58 10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg></div><div class=md-footer__title><span class=md-footer__direction> Previous </span><div class=md-ellipsis> Context API Specification </div></div></a><a href=../context-evaluation-framework/ class="md-footer__link md-footer__link--next" aria-label="Next: Context Evaluation Framework"><div class=md-footer__title><span class=md-footer__direction> Next </span><div class=md-ellipsis> Context Evaluation Framework </div></div><div class="md-footer__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg></div></a></nav><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-copyright></div><div class=md-social><a href=https://github.com/jmontp/agent-workflow target=_blank rel=noopener title="GitHub Repository" class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg></a><a href=https://jmontp.github.io/agent-workflow/ target=_blank rel=noopener title="Documentation Site" class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg></a><a href=https://discord.gg/your-discord-server target=_blank rel=noopener title="Discord Community" class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3c5.5 0 10 3.58 10 8s-4.5 8-10 8c-1.24 0-2.43-.18-3.53-.5C5.55 21 2 21 2 21c2.33-2.33 2.7-3.9 2.75-4.5C3.05 15.07 2 13.13 2 11c0-4.42 4.5-8 10-8"/></svg></a><a href=https://github.com/sponsors/jmontp target=_blank rel=noopener title=Sponsor class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12 21.35-1.45-1.32C5.4 15.36 2 12.27 2 8.5 2 5.41 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.08C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53z"/></svg></a></div></div></div></footer></div><div class=md-dialog data-md-component=dialog><div class="md-dialog__inner md-typeset"></div></div><div class=md-progress data-md-component=progress role=progressbar></div><div class=md-consent data-md-component=consent id=__consent hidden><div class=md-consent__overlay></div><aside class=md-consent__inner><form class="md-consent__form md-grid md-typeset" name=consent><h4>Cookie consent</h4><p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p><input class=md-toggle type=checkbox id=__settings><div class=md-consent__settings><ul class=task-list><li class=task-list-item><label class=task-list-control><input type=checkbox name=analytics checked><span class=task-list-indicator></span> Google Analytics </label></li><li class=task-list-item><label class=task-list-control><input type=checkbox name=github checked><span class=task-list-indicator></span> GitHub </label></li></ul></div><div class=md-consent__controls><button class="md-button md-button--primary">Accept</button><button type=reset class="md-button md-button--primary">Reject</button><label class=md-button for=__settings>Manage settings</label></div></form></aside></div><script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script><script id=__config type=application/json>{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.footnote.tooltips", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": {"API": "api", "Architecture": "architecture", "CSS": "css", "Discord": "discord", "HTML5": "html", "JavaScript": "js", "Python": "python", "Scrum": "scrum", "TDD": "tdd"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script><script src=../../assets/javascripts/bundle.13a4f30d.min.js></script><script src=https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mtml-chtml.js></script><script src=../../js/mermaid-zoom.js></script><script src=../../js/universal-search.js></script><script src=../../js/enhanced-navigation.js></script><script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body></html>