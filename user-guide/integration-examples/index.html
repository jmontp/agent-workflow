<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Complete AI agent orchestration framework with Discord integration, Test-Driven Development, and human-in-the-loop control for automated software development"><meta name=author content="AI Agent Workflow Team"><link href=https://jmontp.github.io/agent-workflow/user-guide/integration-examples/ rel=canonical><link href=../health-monitoring/ rel=prev><link href=../ui-portal-guide/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.14"><title>🔌 Integration Examples - AI Agent TDD-Scrum Workflow - Complete Guide</title><link rel=stylesheet href=../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><style>:root{.md-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M5.5%207A1.5%201.5%200%200%201%204%205.5%201.5%201.5%200%200%201%205.5%204%201.5%201.5%200%200%201%207%205.5%201.5%201.5%200%200%201%205.5%207m15.91%204.58-9-9C12.05%202.22%2011.55%202%2011%202H4c-1.11%200-2%20.89-2%202v7c0%20.55.22%201.05.59%201.41l8.99%209c.37.36.87.59%201.42.59s1.05-.23%201.41-.59l7-7c.37-.36.59-.86.59-1.41%200-.56-.23-1.06-.59-1.42%22/%3E%3C/svg%3E');}.md-tag.md-tag--html{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22m12%2017.56%204.07-1.13.55-6.1H9.38L9.2%208.3h7.6l.2-1.99H7l.56%206.01h6.89l-.23%202.58-2.22.6-2.22-.6-.14-1.66h-2l.29%203.19zM4.07%203h15.86L18.5%2019.2%2012%2021l-6.5-1.8z%22/%3E%3C/svg%3E');}.md-tag.md-tag--js{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M3%203h18v18H3zm4.73%2015.04c.4.85%201.19%201.55%202.54%201.55%201.5%200%202.53-.8%202.53-2.55v-5.78h-1.7V17c0%20.86-.35%201.08-.9%201.08-.58%200-.82-.4-1.09-.87zm5.98-.18c.5.98%201.51%201.73%203.09%201.73%201.6%200%202.8-.83%202.8-2.36%200-1.41-.81-2.04-2.25-2.66l-.42-.18c-.73-.31-1.04-.52-1.04-1.02%200-.41.31-.73.81-.73.48%200%20.8.21%201.09.73l1.31-.87c-.55-.96-1.33-1.33-2.4-1.33-1.51%200-2.48.96-2.48%202.23%200%201.38.81%202.03%202.03%202.55l.42.18c.78.34%201.24.55%201.24%201.13%200%20.48-.45.83-1.15.83-.83%200-1.31-.43-1.67-1.03z%22/%3E%3C/svg%3E');}.md-tag.md-tag--css{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22m5%203-.65%203.34h13.59L17.5%208.5H3.92l-.66%203.33h13.59l-.76%203.81-5.48%201.81-4.75-1.81.33-1.64H2.85l-.79%204%207.85%203%209.05-3%201.2-6.03.24-1.21L21.94%203z%22/%3E%3C/svg%3E');}.md-tag.md-tag--python{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M19.14%207.5A2.86%202.86%200%200%201%2022%2010.36v3.78A2.86%202.86%200%200%201%2019.14%2017H12c0%20.39.32.96.71.96H17v1.68a2.86%202.86%200%200%201-2.86%202.86H9.86A2.86%202.86%200%200%201%207%2019.64v-3.75a2.85%202.85%200%200%201%202.86-2.85h5.25a2.85%202.85%200%200%200%202.85-2.86V7.5zm-4.28%2011.79c-.4%200-.72.3-.72.89s.32.71.72.71a.71.71%200%200%200%20.71-.71c0-.59-.32-.89-.71-.89m-10-1.79A2.86%202.86%200%200%201%202%2014.64v-3.78A2.86%202.86%200%200%201%204.86%208H12c0-.39-.32-.96-.71-.96H7V5.36A2.86%202.86%200%200%201%209.86%202.5h4.28A2.86%202.86%200%200%201%2017%205.36v3.75a2.85%202.85%200%200%201-2.86%202.85H8.89a2.85%202.85%200%200%200-2.85%202.86v2.68zM9.14%205.71c.4%200%20.72-.3.72-.89s-.32-.71-.72-.71c-.39%200-.71.12-.71.71s.32.89.71.89%22/%3E%3C/svg%3E');}}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><link rel=stylesheet href=../../stylesheets/enhanced-navigation.css><link rel=stylesheet href=../../stylesheets/color-schemes.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script> <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head><body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=black><input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off><input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off><label class=md-overlay for=__drawer></label><div data-md-component=skip><a href=#integration-examples-complete-project-walkthroughs class=md-skip> Skip to content </a></div><div data-md-component=announce></div><div data-md-color-scheme=default data-md-component=outdated hidden></div><header class="md-header md-header--shadow md-header--lifted" data-md-component=header><nav class="md-header__inner md-grid" aria-label=Header><a href=../.. title="AI Agent TDD-Scrum Workflow - Complete Guide" class="md-header__button md-logo" aria-label="AI Agent TDD-Scrum Workflow - Complete Guide" data-md-component=logo><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg></a><label class="md-header__button md-icon" for=__drawer><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg></label><div class=md-header__title data-md-component=header-title><div class=md-header__ellipsis><div class=md-header__topic><span class=md-ellipsis> AI Agent TDD-Scrum Workflow - Complete Guide </span></div><div class=md-header__topic data-md-component=header-topic><span class=md-ellipsis> 🔌 Integration Examples </span></div></div></div><label class="md-header__button md-icon" for=__search><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required><label class="md-search__icon md-icon" for=__search><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M15.41 16.58 10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg></label><nav class=md-search__options aria-label=Search><a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg></a><button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button></nav><div class=md-search__suggest data-md-component=search-suggest></div></form><div class=md-search__output><div class=md-search__scrollwrap tabindex=0 data-md-scrollfix><div class=md-search-result data-md-component=search-result><div class=md-search-result__meta> Initializing search </div><ol class=md-search-result__list role=presentation></ol></div></div></div></div></div><div class=md-header__source><a href=https://github.com/jmontp/agent-workflow title="Go to repository" class=md-source data-md-component=source><div class="md-source__icon md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg></div><div class=md-source__repository> jmontp/agent-workflow </div></a></div></nav><nav class=md-tabs aria-label=Tabs data-md-component=tabs><div class=md-grid><ul class=md-tabs__list><li class=md-tabs__item><a href=../.. class=md-tabs__link> 🏠 Home </a></li><li class=md-tabs__item><a href=../../getting-started/ class=md-tabs__link> ⚡ Getting Started </a></li><li class="md-tabs__item md-tabs__item--active"><a href=../ class=md-tabs__link> 📚 User Guide </a></li><li class=md-tabs__item><a href=../../concepts/ class=md-tabs__link> 🎯 Core Concepts </a></li><li class=md-tabs__item><a href=../../architecture/ class=md-tabs__link> 🏗️ Architecture </a></li><li class=md-tabs__item><a href=../../advanced/ class=md-tabs__link> 🔬 Advanced Topics </a></li><li class=md-tabs__item><a href=../../planning/ class=md-tabs__link> 🎨 Planning & Design </a></li><li class=md-tabs__item><a href=../../development/ class=md-tabs__link> 🛠️ Development </a></li><li class=md-tabs__item><a href=../../deployment/ class=md-tabs__link> 🚀 Deployment </a></li><li class=md-tabs__item><a href=../../templates/ class=md-tabs__link> 📋 Templates </a></li><li class=md-tabs__item><a href=../../theme-integration-guide/ class=md-tabs__link> 🎨 Theme Integration </a></li><li class=md-tabs__item><a href=../../archive/compliance/ class=md-tabs__link> 📁 Archive </a></li></ul></div></nav></header><div class=md-container data-md-component=container><main class=md-main data-md-component=main><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0><label class=md-nav__title for=__drawer><a href=../.. title="AI Agent TDD-Scrum Workflow - Complete Guide" class="md-nav__button md-logo" aria-label="AI Agent TDD-Scrum Workflow - Complete Guide" data-md-component=logo><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg></a> AI Agent TDD-Scrum Workflow - Complete Guide </label><div class=md-nav__source><a href=https://github.com/jmontp/agent-workflow title="Go to repository" class=md-source data-md-component=source><div class="md-source__icon md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg></div><div class=md-source__repository> jmontp/agent-workflow </div></a></div><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../.. class=md-nav__link><span class=md-ellipsis> 🏠 Home </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../getting-started/ class=md-nav__link><span class=md-ellipsis> ⚡ Getting Started </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked><div class="md-nav__link md-nav__container"><a href=../ class="md-nav__link "><span class=md-ellipsis> 📚 User Guide </span></a><label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex><span class="md-nav__icon md-icon"></span></label></div><nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true><label class=md-nav__title for=__nav_3><span class="md-nav__icon md-icon"></span> 📚 User Guide </label><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_2><label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex><span class=md-ellipsis> 🚀 Core Workflows </span><span class="md-nav__icon md-icon"></span></label><nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false><label class=md-nav__title for=__nav_3_2><span class="md-nav__icon md-icon"></span> 🚀 Core Workflows </label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../hitl-commands/ class=md-nav__link><span class=md-ellipsis> 🎮 HITL Commands </span></a></li><li class=md-nav__item><a href=../state-machine/ class=md-nav__link><span class=md-ellipsis> 🔄 State Machine </span></a></li><li class=md-nav__item><a href=../tdd-workflow/ class=md-nav__link><span class=md-ellipsis> 🧪 TDD Workflow </span></a></li><li class=md-nav__item><a href=../workflow-sequences/ class=md-nav__link><span class=md-ellipsis> 🔗 Workflow Sequences </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_3><label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex><span class=md-ellipsis> 🛠️ System Management </span><span class="md-nav__icon md-icon"></span></label><nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false><label class=md-nav__title for=__nav_3_3><span class="md-nav__icon md-icon"></span> 🛠️ System Management </label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../cli-reference/ class=md-nav__link><span class=md-ellipsis> 💻 CLI Reference </span></a></li><li class=md-nav__item><a href=../project-setup/ class=md-nav__link><span class=md-ellipsis> 📂 Project Setup </span></a></li><li class=md-nav__item><a href=../multi-project-orchestration/ class=md-nav__link><span class=md-ellipsis> 🎯 Multi-Project Orchestration </span></a></li><li class=md-nav__item><a href=../agent-interface-management/ class=md-nav__link><span class=md-ellipsis> 🤖 Agent Interface Management </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4 checked><label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex><span class=md-ellipsis> 🔧 Advanced Features </span><span class="md-nav__icon md-icon"></span></label><nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=true><label class=md-nav__title for=__nav_3_4><span class="md-nav__icon md-icon"></span> 🔧 Advanced Features </label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../context-management/ class=md-nav__link><span class=md-ellipsis> 🧠 Context Management </span></a></li><li class=md-nav__item><a href=../testing/ class=md-nav__link><span class=md-ellipsis> ✅ Testing </span></a></li><li class=md-nav__item><a href=../performance-monitoring/ class=md-nav__link><span class=md-ellipsis> 📊 Performance Monitoring </span></a></li><li class=md-nav__item><a href=../performance-optimization/ class=md-nav__link><span class=md-ellipsis> ⚡ Performance Optimization </span></a></li><li class=md-nav__item><a href=../health-monitoring/ class=md-nav__link><span class=md-ellipsis> 🏥 Health Monitoring </span></a></li><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle" type=checkbox id=__toc><label class="md-nav__link md-nav__link--active" for=__toc><span class=md-ellipsis> 🔌 Integration Examples </span><span class="md-nav__icon md-icon"></span></label><a href=./ class="md-nav__link md-nav__link--active"><span class=md-ellipsis> 🔌 Integration Examples </span></a><nav class="md-nav md-nav--secondary" aria-label="On this page"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> On this page </label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a href=#table-of-contents class=md-nav__link><span class=md-ellipsis> Table of Contents </span></a></li><li class=md-nav__item><a href=#sample-projects class=md-nav__link><span class=md-ellipsis> Sample Projects </span></a><nav class=md-nav aria-label="Sample Projects"><ul class=md-nav__list><li class=md-nav__item><a href=#web-api-project class=md-nav__link><span class=md-ellipsis> Web API Project </span></a></li></ul></nav></li></ul></nav></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_5><label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex><span class=md-ellipsis> 🎨 Interface & Support </span><span class="md-nav__icon md-icon"></span></label><nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false><label class=md-nav__title for=__nav_3_5><span class="md-nav__icon md-icon"></span> 🎨 Interface & Support </label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../ui-portal-guide/ class=md-nav__link><span class=md-ellipsis> 🎨 UI Portal Guide </span></a></li><li class=md-nav__item><a href=../user-profile/ class=md-nav__link><span class=md-ellipsis> 👤 User Profile </span></a></li><li class=md-nav__item><a href=../troubleshooting/ class=md-nav__link><span class=md-ellipsis> 🔧 Troubleshooting </span></a></li><li class=md-nav__item><a href=../faq/ class=md-nav__link><span class=md-ellipsis> ❓ FAQ </span></a></li></ul></nav></li></ul></nav></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../concepts/ class=md-nav__link><span class=md-ellipsis> 🎯 Core Concepts </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../architecture/ class=md-nav__link><span class=md-ellipsis> 🏗️ Architecture </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../advanced/ class=md-nav__link><span class=md-ellipsis> 🔬 Advanced Topics </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../planning/ class=md-nav__link><span class=md-ellipsis> 🎨 Planning & Design </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../development/ class=md-nav__link><span class=md-ellipsis> 🛠️ Development </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../deployment/ class=md-nav__link><span class=md-ellipsis> 🚀 Deployment </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../templates/ class=md-nav__link><span class=md-ellipsis> 📋 Templates </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../theme-integration-guide/ class=md-nav__link><span class=md-ellipsis> 🎨 Theme Integration </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../archive/compliance/ class=md-nav__link><span class=md-ellipsis> 📁 Archive </span><span class="md-nav__icon md-icon"></span></a></li></ul></nav></div></div></div><div class=md-content data-md-component=content><article class="md-content__inner md-typeset"><a href=https://github.com/jmontp/agent-workflow/edit/master/docs/user-guide/integration-examples.md title="Edit this page" class="md-content__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg></a><a href=https://github.com/jmontp/agent-workflow/raw/master/docs/user-guide/integration-examples.md title="View source of this page" class="md-content__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg></a><h1 id=integration-examples-complete-project-walkthroughs>Integration Examples &amp; Complete Project Walkthroughs<a class=headerlink href=#integration-examples-complete-project-walkthroughs title="Permanent link">&para;</a></h1><p>Comprehensive examples and step-by-step walkthroughs for implementing the AI Agent TDD-Scrum workflow system in real-world projects. Each example includes complete code, configuration files, and learning outcomes.</p><h2 id=table-of-contents>Table of Contents<a class=headerlink href=#table-of-contents title="Permanent link">&para;</a></h2><ol><li><a href=#sample-projects>Sample Projects</a></li><li><a href=#web-api-project>Web API with TDD Workflow</a></li><li><a href=#cli-tool-project>CLI Tool Development</a></li><li><a href=#data-pipeline-project>Data Pipeline Creation</a></li><li><p><a href=#microservice-project>Microservice Architecture</a></p></li><li><p><a href=#step-by-step-guides>Step-by-Step Guides</a></p></li><li><a href=#project-initialization>Project Initialization</a></li><li><a href=#first-tdd-cycle>First TDD Cycle</a></li><li><a href=#multi-agent-coordination>Multi-Agent Coordination</a></li><li><a href=#cicd-integration>CI/CD Integration</a></li><li><p><a href=#production-deployment>Production Deployment</a></p></li><li><p><a href=#video-tutorials>Video Tutorials</a></p></li><li><a href=#learning-outcomes>Learning Outcomes</a></li><li><a href=#performance-benchmarks>Performance Benchmarks</a></li></ol><h2 id=sample-projects>Sample Projects<a class=headerlink href=#sample-projects title="Permanent link">&para;</a></h2><h3 id=web-api-project>Web API Project<a class=headerlink href=#web-api-project title="Permanent link">&para;</a></h3><h4 id=expressjs-rest-api-with-tdd-workflow>Express.js REST API with TDD Workflow<a class=headerlink href=#expressjs-rest-api-with-tdd-workflow title="Permanent link">&para;</a></h4><p>A complete example of building a production-ready REST API using Express.js with the AI Agent TDD-Scrum workflow. This project demonstrates test-driven development, multi-agent coordination, and CI/CD integration.</p><p><strong>Project Repository:</strong> <a href=https://github.com/agent-workflow-examples/express-api-tdd>github.com/agent-workflow-examples/express-api-tdd</a></p><h5 id=project-structure>Project Structure<a class=headerlink href=#project-structure title="Permanent link">&para;</a></h5><div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1></a><a href=#__codelineno-0-1><span class=linenos data-linenos=" 1 "></span></a>express-api-tdd/
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2></a><a href=#__codelineno-0-2><span class=linenos data-linenos=" 2 "></span></a>├── .github/
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3></a><a href=#__codelineno-0-3><span class=linenos data-linenos=" 3 "></span></a>│   └── workflows/
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4></a><a href=#__codelineno-0-4><span class=linenos data-linenos=" 4 "></span></a>│       ├── agent-workflow.yml      # GitHub Actions CI/CD
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5></a><a href=#__codelineno-0-5><span class=linenos data-linenos=" 5 "></span></a>│       └── tdd-validation.yml      # TDD cycle validation
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6></a><a href=#__codelineno-0-6><span class=linenos data-linenos=" 6 "></span></a>├── .orch-state/                    # Agent workflow state
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7></a><a href=#__codelineno-0-7><span class=linenos data-linenos=" 7 "></span></a>│   ├── status.json
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8></a><a href=#__codelineno-0-8><span class=linenos data-linenos=" 8 "></span></a>│   ├── epics/
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a><a href=#__codelineno-0-9><span class=linenos data-linenos=" 9 "></span></a>│   ├── stories/
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10></a><a href=#__codelineno-0-10><span class=linenos data-linenos="10 "></span></a>│   └── sprints/
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11></a><a href=#__codelineno-0-11><span class=linenos data-linenos="11 "></span></a>├── src/
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a><a href=#__codelineno-0-12><span class=linenos data-linenos="12 "></span></a>│   ├── controllers/                # API controllers
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a><a href=#__codelineno-0-13><span class=linenos data-linenos="13 "></span></a>│   ├── models/                     # Data models
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a><a href=#__codelineno-0-14><span class=linenos data-linenos="14 "></span></a>│   ├── routes/                     # Express routes
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a><a href=#__codelineno-0-15><span class=linenos data-linenos="15 "></span></a>│   ├── middleware/                 # Custom middleware
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a><a href=#__codelineno-0-16><span class=linenos data-linenos="16 "></span></a>│   └── services/                   # Business logic
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a><a href=#__codelineno-0-17><span class=linenos data-linenos="17 "></span></a>├── tests/
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a><a href=#__codelineno-0-18><span class=linenos data-linenos="18 "></span></a>│   ├── unit/                       # Unit tests
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a><a href=#__codelineno-0-19><span class=linenos data-linenos="19 "></span></a>│   ├── integration/                # Integration tests
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a><a href=#__codelineno-0-20><span class=linenos data-linenos="20 "></span></a>│   └── tdd/                        # TDD cycle tests
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a><a href=#__codelineno-0-21><span class=linenos data-linenos="21 "></span></a>│       ├── USER-001/               # User creation story
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a><a href=#__codelineno-0-22><span class=linenos data-linenos="22 "></span></a>│       ├── USER-002/               # User authentication
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a><a href=#__codelineno-0-23><span class=linenos data-linenos="23 "></span></a>│       └── USER-003/               # User profile management
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a><a href=#__codelineno-0-24><span class=linenos data-linenos="24 "></span></a>├── config/
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a><a href=#__codelineno-0-25><span class=linenos data-linenos="25 "></span></a>│   ├── agent-workflow.yml          # Orchestrator configuration
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a><a href=#__codelineno-0-26><span class=linenos data-linenos="26 "></span></a>│   └── database.js                 # Database configuration
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a><a href=#__codelineno-0-27><span class=linenos data-linenos="27 "></span></a>├── docker-compose.yml              # Local development environment
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a><a href=#__codelineno-0-28><span class=linenos data-linenos="28 "></span></a>├── Dockerfile                      # Production container
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a><a href=#__codelineno-0-29><span class=linenos data-linenos="29 "></span></a>└── package.json                    # Node.js dependencies
</span></code></pre></div><h5 id=complete-configuration>Complete Configuration<a class=headerlink href=#complete-configuration title="Permanent link">&para;</a></h5><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1></a><a href=#__codelineno-1-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># config/agent-workflow.yml</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2></a><a href=#__codelineno-1-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>orchestrator</span><span class=p>:</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3></a><a href=#__codelineno-1-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>  </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">partial</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4></a><a href=#__codelineno-1-4><span class=linenos data-linenos=" 4 "></span></a><span class=w>  </span><span class=nt>project_path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/workspace/express-api-tdd&quot;</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5></a><a href=#__codelineno-1-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span><span class=nt>github_repo</span><span class=p>:</span><span class=w> </span><span class=s>&quot;agent-workflow-examples/express-api-tdd&quot;</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6></a><a href=#__codelineno-1-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>  </span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7></a><a href=#__codelineno-1-7><span class=linenos data-linenos=" 7 "></span></a><span class=nt>tdd</span><span class=p>:</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8></a><a href=#__codelineno-1-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9></a><a href=#__codelineno-1-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>  </span><span class=nt>test_execution</span><span class=p>:</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10></a><a href=#__codelineno-1-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span><span class=nt>runner</span><span class=p>:</span><span class=w> </span><span class=s>&quot;npm</span><span class=nv> </span><span class=s>test&quot;</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11></a><a href=#__codelineno-1-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span><span class=nt>coverage_threshold</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">85</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12></a><a href=#__codelineno-1-12><span class=linenos data-linenos="12 "></span></a><span class=w>    </span><span class=nt>parallel_jobs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13></a><a href=#__codelineno-1-13><span class=linenos data-linenos="13 "></span></a><span class=w>    </span><span class=nt>test_timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30000</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14></a><a href=#__codelineno-1-14><span class=linenos data-linenos="14 "></span></a><span class=w>    </span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15></a><a href=#__codelineno-1-15><span class=linenos data-linenos="15 "></span></a><span class=w>  </span><span class=nt>quality_gates</span><span class=p>:</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16></a><a href=#__codelineno-1-16><span class=linenos data-linenos="16 "></span></a><span class=w>    </span><span class=nt>code_green_phase</span><span class=p>:</span>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17></a><a href=#__codelineno-1-17><span class=linenos data-linenos="17 "></span></a><span class=w>      </span><span class=nt>require_all_tests_pass</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18></a><a href=#__codelineno-1-18><span class=linenos data-linenos="18 "></span></a><span class=w>      </span><span class=nt>minimum_coverage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">85</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19></a><a href=#__codelineno-1-19><span class=linenos data-linenos="19 "></span></a><span class=w>      </span><span class=nt>lint_check</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20></a><a href=#__codelineno-1-20><span class=linenos data-linenos="20 "></span></a><span class=w>      </span><span class=nt>security_scan</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21></a><a href=#__codelineno-1-21><span class=linenos data-linenos="21 "></span></a><span class=w>    </span>
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22></a><a href=#__codelineno-1-22><span class=linenos data-linenos="22 "></span></a><span class=w>  </span><span class=nt>test_preservation</span><span class=p>:</span>
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23></a><a href=#__codelineno-1-23><span class=linenos data-linenos="23 "></span></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-1-24><a id=__codelineno-1-24 name=__codelineno-1-24></a><a href=#__codelineno-1-24><span class=linenos data-linenos="24 "></span></a><span class=w>    </span><span class=nt>backup_strategy</span><span class=p>:</span><span class=w> </span><span class=s>&quot;git&quot;</span>
</span><span id=__span-1-25><a id=__codelineno-1-25 name=__codelineno-1-25></a><a href=#__codelineno-1-25><span class=linenos data-linenos="25 "></span></a><span class=w>    </span>
</span><span id=__span-1-26><a id=__codelineno-1-26 name=__codelineno-1-26></a><a href=#__codelineno-1-26><span class=linenos data-linenos="26 "></span></a><span class=nt>agents</span><span class=p>:</span>
</span><span id=__span-1-27><a id=__codelineno-1-27 name=__codelineno-1-27></a><a href=#__codelineno-1-27><span class=linenos data-linenos="27 "></span></a><span class=w>  </span><span class=nt>design_agent</span><span class=p>:</span>
</span><span id=__span-1-28><a id=__codelineno-1-28 name=__codelineno-1-28></a><a href=#__codelineno-1-28><span class=linenos data-linenos="28 "></span></a><span class=w>    </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Express.js</span><span class=nv> </span><span class=s>REST</span><span class=nv> </span><span class=s>API</span><span class=nv> </span><span class=s>with</span><span class=nv> </span><span class=s>PostgreSQL</span><span class=nv> </span><span class=s>for</span><span class=nv> </span><span class=s>user</span><span class=nv> </span><span class=s>management&quot;</span>
</span><span id=__span-1-29><a id=__codelineno-1-29 name=__codelineno-1-29></a><a href=#__codelineno-1-29><span class=linenos data-linenos="29 "></span></a><span class=w>    </span><span class=nt>architecture_style</span><span class=p>:</span><span class=w> </span><span class=s>&quot;clean&quot;</span>
</span><span id=__span-1-30><a id=__codelineno-1-30 name=__codelineno-1-30></a><a href=#__codelineno-1-30><span class=linenos data-linenos="30 "></span></a><span class=w>    </span><span class=nt>documentation_level</span><span class=p>:</span><span class=w> </span><span class=s>&quot;comprehensive&quot;</span>
</span><span id=__span-1-31><a id=__codelineno-1-31 name=__codelineno-1-31></a><a href=#__codelineno-1-31><span class=linenos data-linenos="31 "></span></a><span class=w>    </span>
</span><span id=__span-1-32><a id=__codelineno-1-32 name=__codelineno-1-32></a><a href=#__codelineno-1-32><span class=linenos data-linenos="32 "></span></a><span class=w>  </span><span class=nt>code_agent</span><span class=p>:</span>
</span><span id=__span-1-33><a id=__codelineno-1-33 name=__codelineno-1-33></a><a href=#__codelineno-1-33><span class=linenos data-linenos="33 "></span></a><span class=w>    </span><span class=nt>implementation_style</span><span class=p>:</span><span class=w> </span><span class=s>&quot;minimal&quot;</span>
</span><span id=__span-1-34><a id=__codelineno-1-34 name=__codelineno-1-34></a><a href=#__codelineno-1-34><span class=linenos data-linenos="34 "></span></a><span class=w>    </span><span class=nt>coding_standards</span><span class=p>:</span><span class=w> </span><span class=s>&quot;airbnb&quot;</span>
</span><span id=__span-1-35><a id=__codelineno-1-35 name=__codelineno-1-35></a><a href=#__codelineno-1-35><span class=linenos data-linenos="35 "></span></a><span class=w>    </span><span class=nt>error_handling</span><span class=p>:</span><span class=w> </span><span class=s>&quot;comprehensive&quot;</span>
</span><span id=__span-1-36><a id=__codelineno-1-36 name=__codelineno-1-36></a><a href=#__codelineno-1-36><span class=linenos data-linenos="36 "></span></a><span class=w>    </span>
</span><span id=__span-1-37><a id=__codelineno-1-37 name=__codelineno-1-37></a><a href=#__codelineno-1-37><span class=linenos data-linenos="37 "></span></a><span class=w>  </span><span class=nt>qa_agent</span><span class=p>:</span>
</span><span id=__span-1-38><a id=__codelineno-1-38 name=__codelineno-1-38></a><a href=#__codelineno-1-38><span class=linenos data-linenos="38 "></span></a><span class=w>    </span><span class=nt>test_types</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;unit&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;integration&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;api&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;security&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-1-39><a id=__codelineno-1-39 name=__codelineno-1-39></a><a href=#__codelineno-1-39><span class=linenos data-linenos="39 "></span></a><span class=w>    </span><span class=nt>test_framework</span><span class=p>:</span><span class=w> </span><span class=s>&quot;jest&quot;</span>
</span><span id=__span-1-40><a id=__codelineno-1-40 name=__codelineno-1-40></a><a href=#__codelineno-1-40><span class=linenos data-linenos="40 "></span></a><span class=w>    </span><span class=nt>coverage_tool</span><span class=p>:</span><span class=w> </span><span class=s>&quot;nyc&quot;</span>
</span><span id=__span-1-41><a id=__codelineno-1-41 name=__codelineno-1-41></a><a href=#__codelineno-1-41><span class=linenos data-linenos="41 "></span></a><span class=w>    </span>
</span><span id=__span-1-42><a id=__codelineno-1-42 name=__codelineno-1-42></a><a href=#__codelineno-1-42><span class=linenos data-linenos="42 "></span></a><span class=w>  </span><span class=nt>data_agent</span><span class=p>:</span>
</span><span id=__span-1-43><a id=__codelineno-1-43 name=__codelineno-1-43></a><a href=#__codelineno-1-43><span class=linenos data-linenos="43 "></span></a><span class=w>    </span><span class=nt>analytics_enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-1-44><a id=__codelineno-1-44 name=__codelineno-1-44></a><a href=#__codelineno-1-44><span class=linenos data-linenos="44 "></span></a><span class=w>    </span><span class=nt>performance_monitoring</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-1-45><a id=__codelineno-1-45 name=__codelineno-1-45></a><a href=#__codelineno-1-45><span class=linenos data-linenos="45 "></span></a><span class=w>    </span>
</span><span id=__span-1-46><a id=__codelineno-1-46 name=__codelineno-1-46></a><a href=#__codelineno-1-46><span class=linenos data-linenos="46 "></span></a><span class=nt>integrations</span><span class=p>:</span>
</span><span id=__span-1-47><a id=__codelineno-1-47 name=__codelineno-1-47></a><a href=#__codelineno-1-47><span class=linenos data-linenos="47 "></span></a><span class=w>  </span><span class=nt>ci</span><span class=p>:</span>
</span><span id=__span-1-48><a id=__codelineno-1-48 name=__codelineno-1-48></a><a href=#__codelineno-1-48><span class=linenos data-linenos="48 "></span></a><span class=w>    </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=s>&quot;github_actions&quot;</span>
</span><span id=__span-1-49><a id=__codelineno-1-49 name=__codelineno-1-49></a><a href=#__codelineno-1-49><span class=linenos data-linenos="49 "></span></a><span class=w>    </span><span class=nt>auto_merge</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-1-50><a id=__codelineno-1-50 name=__codelineno-1-50></a><a href=#__codelineno-1-50><span class=linenos data-linenos="50 "></span></a><span class=w>    </span>
</span><span id=__span-1-51><a id=__codelineno-1-51 name=__codelineno-1-51></a><a href=#__codelineno-1-51><span class=linenos data-linenos="51 "></span></a><span class=w>  </span><span class=nt>monitoring</span><span class=p>:</span>
</span><span id=__span-1-52><a id=__codelineno-1-52 name=__codelineno-1-52></a><a href=#__codelineno-1-52><span class=linenos data-linenos="52 "></span></a><span class=w>    </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=s>&quot;prometheus&quot;</span>
</span><span id=__span-1-53><a id=__codelineno-1-53 name=__codelineno-1-53></a><a href=#__codelineno-1-53><span class=linenos data-linenos="53 "></span></a><span class=w>    </span><span class=nt>metrics_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">9090</span>
</span><span id=__span-1-54><a id=__codelineno-1-54 name=__codelineno-1-54></a><a href=#__codelineno-1-54><span class=linenos data-linenos="54 "></span></a><span class=w>    </span>
</span><span id=__span-1-55><a id=__codelineno-1-55 name=__codelineno-1-55></a><a href=#__codelineno-1-55><span class=linenos data-linenos="55 "></span></a><span class=w>  </span><span class=nt>notifications</span><span class=p>:</span>
</span><span id=__span-1-56><a id=__codelineno-1-56 name=__codelineno-1-56></a><a href=#__codelineno-1-56><span class=linenos data-linenos="56 "></span></a><span class=w>    </span><span class=nt>discord</span><span class=p>:</span>
</span><span id=__span-1-57><a id=__codelineno-1-57 name=__codelineno-1-57></a><a href=#__codelineno-1-57><span class=linenos data-linenos="57 "></span></a><span class=w>      </span><span class=nt>webhook_url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${DISCORD_WEBHOOK}&quot;</span>
</span><span id=__span-1-58><a id=__codelineno-1-58 name=__codelineno-1-58></a><a href=#__codelineno-1-58><span class=linenos data-linenos="58 "></span></a><span class=w>    </span><span class=nt>slack</span><span class=p>:</span>
</span><span id=__span-1-59><a id=__codelineno-1-59 name=__codelineno-1-59></a><a href=#__codelineno-1-59><span class=linenos data-linenos="59 "></span></a><span class=w>      </span><span class=nt>webhook_url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${SLACK_WEBHOOK}&quot;</span>
</span></code></pre></div><h5 id=step-by-step-project-walkthrough>Step-by-Step Project Walkthrough<a class=headerlink href=#step-by-step-project-walkthrough title="Permanent link">&para;</a></h5><blockquote><p><strong>New to Discord commands?</strong> See the <a href=../cli-reference/ >CLI Reference</a> for all available commands and their usage patterns.</p></blockquote><h6 id=1-project-initialization>1. Project Initialization<a class=headerlink href=#1-project-initialization title="Permanent link">&para;</a></h6><p><strong>Discord Commands:</strong><div class="language-bash highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1></a><a href=#__codelineno-2-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># Register the project</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2></a><a href=#__codelineno-2-2><span class=linenos data-linenos=" 2 "></span></a>/project<span class=w> </span>register<span class=w> </span>/workspace/express-api-tdd<span class=w> </span><span class=s2>&quot;Express API TDD&quot;</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3></a><a href=#__codelineno-2-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4></a><a href=#__codelineno-2-4><span class=linenos data-linenos=" 4 "></span></a><span class=c1># Define the epic</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5></a><a href=#__codelineno-2-5><span class=linenos data-linenos=" 5 "></span></a>/epic<span class=w> </span><span class=s2>&quot;Build a production-ready user management REST API with authentication&quot;</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6></a><a href=#__codelineno-2-6><span class=linenos data-linenos=" 6 "></span></a>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7></a><a href=#__codelineno-2-7><span class=linenos data-linenos=" 7 "></span></a><span class=c1># Add detailed stories to backlog</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8></a><a href=#__codelineno-2-8><span class=linenos data-linenos=" 8 "></span></a>/backlog<span class=w> </span>add_story<span class=w> </span><span class=s2>&quot;USER-001: Create POST /api/users endpoint with validation and error handling&quot;</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9></a><a href=#__codelineno-2-9><span class=linenos data-linenos=" 9 "></span></a>/backlog<span class=w> </span>add_story<span class=w> </span><span class=s2>&quot;USER-002: Implement JWT authentication with refresh tokens&quot;</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10></a><a href=#__codelineno-2-10><span class=linenos data-linenos="10 "></span></a>/backlog<span class=w> </span>add_story<span class=w> </span><span class=s2>&quot;USER-003: Add user profile management endpoints (GET, PUT, DELETE)&quot;</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11></a><a href=#__codelineno-2-11><span class=linenos data-linenos="11 "></span></a>/backlog<span class=w> </span>add_story<span class=w> </span><span class=s2>&quot;USER-004: Implement role-based access control (RBAC)&quot;</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12></a><a href=#__codelineno-2-12><span class=linenos data-linenos="12 "></span></a>/backlog<span class=w> </span>add_story<span class=w> </span><span class=s2>&quot;USER-005: Add rate limiting and security headers&quot;</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13></a><a href=#__codelineno-2-13><span class=linenos data-linenos="13 "></span></a>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14></a><a href=#__codelineno-2-14><span class=linenos data-linenos="14 "></span></a><span class=c1># Check the created stories and their state</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15></a><a href=#__codelineno-2-15><span class=linenos data-linenos="15 "></span></a>/state
</span></code></pre></div></p><blockquote><p><strong>Understanding the workflow?</strong> These commands follow the <a href=../state-machine/ >State Machine</a> transitions from IDLE → BACKLOG_READY → SPRINT_PLANNED.</p></blockquote><h1 id=prioritize-the-backlog>Prioritize the backlog<a class=headerlink href=#prioritize-the-backlog title="Permanent link">&para;</a></h1><p>/backlog prioritize <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1></a><a href=#__codelineno-3-1><span class=linenos data-linenos=" 1 "></span></a>**Initial Setup Script:**
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2></a><a href=#__codelineno-3-2><span class=linenos data-linenos=" 2 "></span></a>```bash
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3></a><a href=#__codelineno-3-3><span class=linenos data-linenos=" 3 "></span></a>#!/bin/bash
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4></a><a href=#__codelineno-3-4><span class=linenos data-linenos=" 4 "></span></a># setup.sh - Initialize Express API project
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5></a><a href=#__codelineno-3-5><span class=linenos data-linenos=" 5 "></span></a>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6></a><a href=#__codelineno-3-6><span class=linenos data-linenos=" 6 "></span></a># Create project directory
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7></a><a href=#__codelineno-3-7><span class=linenos data-linenos=" 7 "></span></a>mkdir -p express-api-tdd
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8></a><a href=#__codelineno-3-8><span class=linenos data-linenos=" 8 "></span></a>cd express-api-tdd
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9></a><a href=#__codelineno-3-9><span class=linenos data-linenos=" 9 "></span></a>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10></a><a href=#__codelineno-3-10><span class=linenos data-linenos="10 "></span></a># Initialize npm project
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11></a><a href=#__codelineno-3-11><span class=linenos data-linenos="11 "></span></a>npm init -y
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12></a><a href=#__codelineno-3-12><span class=linenos data-linenos="12 "></span></a>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13></a><a href=#__codelineno-3-13><span class=linenos data-linenos="13 "></span></a># Install dependencies
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14></a><a href=#__codelineno-3-14><span class=linenos data-linenos="14 "></span></a>npm install express cors helmet morgan compression dotenv
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15></a><a href=#__codelineno-3-15><span class=linenos data-linenos="15 "></span></a>npm install bcrypt jsonwebtoken validator
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16></a><a href=#__codelineno-3-16><span class=linenos data-linenos="16 "></span></a>npm install pg sequelize sequelize-cli
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17></a><a href=#__codelineno-3-17><span class=linenos data-linenos="17 "></span></a>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18></a><a href=#__codelineno-3-18><span class=linenos data-linenos="18 "></span></a># Install dev dependencies
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19></a><a href=#__codelineno-3-19><span class=linenos data-linenos="19 "></span></a>npm install -D jest supertest @types/jest
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20></a><a href=#__codelineno-3-20><span class=linenos data-linenos="20 "></span></a>npm install -D eslint prettier eslint-config-airbnb
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21></a><a href=#__codelineno-3-21><span class=linenos data-linenos="21 "></span></a>npm install -D nodemon concurrently
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22></a><a href=#__codelineno-3-22><span class=linenos data-linenos="22 "></span></a>npm install -D nyc @istanbuljs/nyc-config-typescript
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23></a><a href=#__codelineno-3-23><span class=linenos data-linenos="23 "></span></a>
</span><span id=__span-3-24><a id=__codelineno-3-24 name=__codelineno-3-24></a><a href=#__codelineno-3-24><span class=linenos data-linenos="24 "></span></a># Create directory structure
</span><span id=__span-3-25><a id=__codelineno-3-25 name=__codelineno-3-25></a><a href=#__codelineno-3-25><span class=linenos data-linenos="25 "></span></a>mkdir -p src/{controllers,models,routes,middleware,services,utils}
</span><span id=__span-3-26><a id=__codelineno-3-26 name=__codelineno-3-26></a><a href=#__codelineno-3-26><span class=linenos data-linenos="26 "></span></a>mkdir -p tests/{unit,integration,tdd}
</span><span id=__span-3-27><a id=__codelineno-3-27 name=__codelineno-3-27></a><a href=#__codelineno-3-27><span class=linenos data-linenos="27 "></span></a>mkdir -p config scripts docs
</span><span id=__span-3-28><a id=__codelineno-3-28 name=__codelineno-3-28></a><a href=#__codelineno-3-28><span class=linenos data-linenos="28 "></span></a>
</span><span id=__span-3-29><a id=__codelineno-3-29 name=__codelineno-3-29></a><a href=#__codelineno-3-29><span class=linenos data-linenos="29 "></span></a># Initialize git repository
</span><span id=__span-3-30><a id=__codelineno-3-30 name=__codelineno-3-30></a><a href=#__codelineno-3-30><span class=linenos data-linenos="30 "></span></a>git init
</span><span id=__span-3-31><a id=__codelineno-3-31 name=__codelineno-3-31></a><a href=#__codelineno-3-31><span class=linenos data-linenos="31 "></span></a>echo &quot;node_modules/&quot; &gt; .gitignore
</span><span id=__span-3-32><a id=__codelineno-3-32 name=__codelineno-3-32></a><a href=#__codelineno-3-32><span class=linenos data-linenos="32 "></span></a>echo &quot;.env&quot; &gt;&gt; .gitignore
</span><span id=__span-3-33><a id=__codelineno-3-33 name=__codelineno-3-33></a><a href=#__codelineno-3-33><span class=linenos data-linenos="33 "></span></a>echo &quot;coverage/&quot; &gt;&gt; .gitignore
</span><span id=__span-3-34><a id=__codelineno-3-34 name=__codelineno-3-34></a><a href=#__codelineno-3-34><span class=linenos data-linenos="34 "></span></a>echo &quot;.nyc_output/&quot; &gt;&gt; .gitignore
</span><span id=__span-3-35><a id=__codelineno-3-35 name=__codelineno-3-35></a><a href=#__codelineno-3-35><span class=linenos data-linenos="35 "></span></a>
</span><span id=__span-3-36><a id=__codelineno-3-36 name=__codelineno-3-36></a><a href=#__codelineno-3-36><span class=linenos data-linenos="36 "></span></a># Create initial configuration files
</span><span id=__span-3-37><a id=__codelineno-3-37 name=__codelineno-3-37></a><a href=#__codelineno-3-37><span class=linenos data-linenos="37 "></span></a>cat &gt; .env.example &lt;&lt; EOF
</span><span id=__span-3-38><a id=__codelineno-3-38 name=__codelineno-3-38></a><a href=#__codelineno-3-38><span class=linenos data-linenos="38 "></span></a>NODE_ENV=development
</span><span id=__span-3-39><a id=__codelineno-3-39 name=__codelineno-3-39></a><a href=#__codelineno-3-39><span class=linenos data-linenos="39 "></span></a>PORT=3000
</span><span id=__span-3-40><a id=__codelineno-3-40 name=__codelineno-3-40></a><a href=#__codelineno-3-40><span class=linenos data-linenos="40 "></span></a>DATABASE_URL=postgresql://user:password@localhost:5432/express_api
</span><span id=__span-3-41><a id=__codelineno-3-41 name=__codelineno-3-41></a><a href=#__codelineno-3-41><span class=linenos data-linenos="41 "></span></a>JWT_SECRET=your-secret-key
</span><span id=__span-3-42><a id=__codelineno-3-42 name=__codelineno-3-42></a><a href=#__codelineno-3-42><span class=linenos data-linenos="42 "></span></a>JWT_EXPIRES_IN=1h
</span><span id=__span-3-43><a id=__codelineno-3-43 name=__codelineno-3-43></a><a href=#__codelineno-3-43><span class=linenos data-linenos="43 "></span></a>REFRESH_TOKEN_EXPIRES_IN=7d
</span><span id=__span-3-44><a id=__codelineno-3-44 name=__codelineno-3-44></a><a href=#__codelineno-3-44><span class=linenos data-linenos="44 "></span></a>EOF
</span><span id=__span-3-45><a id=__codelineno-3-45 name=__codelineno-3-45></a><a href=#__codelineno-3-45><span class=linenos data-linenos="45 "></span></a>
</span><span id=__span-3-46><a id=__codelineno-3-46 name=__codelineno-3-46></a><a href=#__codelineno-3-46><span class=linenos data-linenos="46 "></span></a>cp .env.example .env
</span></code></pre></div></p><h6 id=2-first-tdd-cycle-user-creation-endpoint>2. First TDD Cycle - User Creation Endpoint<a class=headerlink href=#2-first-tdd-cycle-user-creation-endpoint title="Permanent link">&para;</a></h6><p><strong>Discord TDD Workflow:</strong><div class="language-bash highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1></a><a href=#__codelineno-4-1><span class=linenos data-linenos="1 "></span></a><span class=c1># Start sprint</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2></a><a href=#__codelineno-4-2><span class=linenos data-linenos="2 "></span></a>/sprint<span class=w> </span>plan
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3></a><a href=#__codelineno-4-3><span class=linenos data-linenos="3 "></span></a>/sprint<span class=w> </span>start
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4></a><a href=#__codelineno-4-4><span class=linenos data-linenos="4 "></span></a>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5></a><a href=#__codelineno-4-5><span class=linenos data-linenos="5 "></span></a><span class=c1># Begin TDD cycle for user creation</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6></a><a href=#__codelineno-4-6><span class=linenos data-linenos="6 "></span></a>/tdd<span class=w> </span>start<span class=w> </span>USER-001<span class=w> </span><span class=s2>&quot;Create POST /api/users endpoint&quot;</span>
</span></code></pre></div></p><h6 id=3-tdd-design-phase-output>3. TDD Design Phase Output<a class=headerlink href=#3-tdd-design-phase-output title="Permanent link">&para;</a></h6><p><strong>Generated by Design Agent:</strong><div class="language-markdown highlight"><span class=filename>Markdown</span><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1></a><a href=#__codelineno-5-1><span class=linenos data-linenos=" 1 "></span></a><span class=gh># USER-001: POST /api/users Endpoint Design</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2></a><a href=#__codelineno-5-2><span class=linenos data-linenos=" 2 "></span></a>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3></a><a href=#__codelineno-5-3><span class=linenos data-linenos=" 3 "></span></a><span class=gu>## API Specification</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4></a><a href=#__codelineno-5-4><span class=linenos data-linenos=" 4 "></span></a>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5></a><a href=#__codelineno-5-5><span class=linenos data-linenos=" 5 "></span></a><span class=gu>### Endpoint</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6></a><a href=#__codelineno-5-6><span class=linenos data-linenos=" 6 "></span></a><span class=sb>`POST /api/users`</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7></a><a href=#__codelineno-5-7><span class=linenos data-linenos=" 7 "></span></a>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8></a><a href=#__codelineno-5-8><span class=linenos data-linenos=" 8 "></span></a><span class=gu>### Request Body</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9></a><a href=#__codelineno-5-9><span class=linenos data-linenos=" 9 "></span></a>```json
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10></a><a href=#__codelineno-5-10><span class=linenos data-linenos="10 "></span></a>{
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11></a><a href=#__codelineno-5-11><span class=linenos data-linenos="11 "></span></a>  &quot;email&quot;: &quot;user@example.com&quot;,
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12></a><a href=#__codelineno-5-12><span class=linenos data-linenos="12 "></span></a>  &quot;password&quot;: &quot;SecurePass123!&quot;,
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13></a><a href=#__codelineno-5-13><span class=linenos data-linenos="13 "></span></a>  &quot;firstName&quot;: &quot;John&quot;,
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14></a><a href=#__codelineno-5-14><span class=linenos data-linenos="14 "></span></a>  &quot;lastName&quot;: &quot;Doe&quot;,
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15></a><a href=#__codelineno-5-15><span class=linenos data-linenos="15 "></span></a>  &quot;role&quot;: &quot;user&quot;
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16></a><a href=#__codelineno-5-16><span class=linenos data-linenos="16 "></span></a>}
</span></code></pre></div></p><h3 id=validation-rules>Validation Rules<a class=headerlink href=#validation-rules title="Permanent link">&para;</a></h3><ul><li>Email: Valid email format, unique in database</li><li>Password: Min 8 chars, 1 uppercase, 1 lowercase, 1 number, 1 special char</li><li>FirstName/LastName: 2-50 characters, alphabetic only</li><li>Role: Must be 'user', 'admin', or 'moderator'</li></ul><h3 id=success-response-201-created>Success Response (201 Created)<a class=headerlink href=#success-response-201-created title="Permanent link">&para;</a></h3><div class="language-json highlight"><span class=filename>JSON</span><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1></a><a href=#__codelineno-6-1><span class=linenos data-linenos="1 "></span></a><span class=p>{</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2></a><a href=#__codelineno-6-2><span class=linenos data-linenos="2 "></span></a><span class=w>  </span><span class=nt>&quot;id&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;123e4567-e89b-12d3-a456-426614174000&quot;</span><span class=p>,</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3></a><a href=#__codelineno-6-3><span class=linenos data-linenos="3 "></span></a><span class=w>  </span><span class=nt>&quot;email&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;user@example.com&quot;</span><span class=p>,</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4></a><a href=#__codelineno-6-4><span class=linenos data-linenos="4 "></span></a><span class=w>  </span><span class=nt>&quot;firstName&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;John&quot;</span><span class=p>,</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5></a><a href=#__codelineno-6-5><span class=linenos data-linenos="5 "></span></a><span class=w>  </span><span class=nt>&quot;lastName&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Doe&quot;</span><span class=p>,</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6></a><a href=#__codelineno-6-6><span class=linenos data-linenos="6 "></span></a><span class=w>  </span><span class=nt>&quot;role&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;user&quot;</span><span class=p>,</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7></a><a href=#__codelineno-6-7><span class=linenos data-linenos="7 "></span></a><span class=w>  </span><span class=nt>&quot;createdAt&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2024-01-15T10:30:00Z&quot;</span><span class=p>,</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8></a><a href=#__codelineno-6-8><span class=linenos data-linenos="8 "></span></a><span class=w>  </span><span class=nt>&quot;updatedAt&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2024-01-15T10:30:00Z&quot;</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9></a><a href=#__codelineno-6-9><span class=linenos data-linenos="9 "></span></a><span class=p>}</span>
</span></code></pre></div><h3 id=error-responses>Error Responses<a class=headerlink href=#error-responses title="Permanent link">&para;</a></h3><ul><li>400 Bad Request: Validation errors</li><li>409 Conflict: Email already exists</li><li>500 Internal Server Error: Database errors</li></ul><h2 id=implementation-plan>Implementation Plan<a class=headerlink href=#implementation-plan title="Permanent link">&para;</a></h2><ol><li>Create User model with Sequelize</li><li>Add validation middleware</li><li>Implement password hashing with bcrypt</li><li>Create controller with error handling</li><li>Add integration tests <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1></a><a href=#__codelineno-7-1><span class=linenos data-linenos="  1 "></span></a>###### 4. TDD Test Phase - Generated Tests
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2></a><a href=#__codelineno-7-2><span class=linenos data-linenos="  2 "></span></a>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3></a><a href=#__codelineno-7-3><span class=linenos data-linenos="  3 "></span></a>**tests/tdd/USER-001/user-creation.test.js:**
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4></a><a href=#__codelineno-7-4><span class=linenos data-linenos="  4 "></span></a>```javascript
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5></a><a href=#__codelineno-7-5><span class=linenos data-linenos="  5 "></span></a>const request = require(&#39;supertest&#39;);
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6></a><a href=#__codelineno-7-6><span class=linenos data-linenos="  6 "></span></a>const app = require(&#39;../../../src/app&#39;);
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7></a><a href=#__codelineno-7-7><span class=linenos data-linenos="  7 "></span></a>const { User } = require(&#39;../../../src/models&#39;);
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8></a><a href=#__codelineno-7-8><span class=linenos data-linenos="  8 "></span></a>const { sequelize } = require(&#39;../../../src/config/database&#39;);
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9></a><a href=#__codelineno-7-9><span class=linenos data-linenos="  9 "></span></a>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10></a><a href=#__codelineno-7-10><span class=linenos data-linenos=" 10 "></span></a>describe(&#39;POST /api/users - User Creation Endpoint&#39;, () =&gt; {
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11></a><a href=#__codelineno-7-11><span class=linenos data-linenos=" 11 "></span></a>  beforeAll(async () =&gt; {
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12></a><a href=#__codelineno-7-12><span class=linenos data-linenos=" 12 "></span></a>    await sequelize.sync({ force: true });
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13></a><a href=#__codelineno-7-13><span class=linenos data-linenos=" 13 "></span></a>  });
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14></a><a href=#__codelineno-7-14><span class=linenos data-linenos=" 14 "></span></a>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15></a><a href=#__codelineno-7-15><span class=linenos data-linenos=" 15 "></span></a>  afterEach(async () =&gt; {
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16></a><a href=#__codelineno-7-16><span class=linenos data-linenos=" 16 "></span></a>    await User.destroy({ where: {} });
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17></a><a href=#__codelineno-7-17><span class=linenos data-linenos=" 17 "></span></a>  });
</span><span id=__span-7-18><a id=__codelineno-7-18 name=__codelineno-7-18></a><a href=#__codelineno-7-18><span class=linenos data-linenos=" 18 "></span></a>
</span><span id=__span-7-19><a id=__codelineno-7-19 name=__codelineno-7-19></a><a href=#__codelineno-7-19><span class=linenos data-linenos=" 19 "></span></a>  afterAll(async () =&gt; {
</span><span id=__span-7-20><a id=__codelineno-7-20 name=__codelineno-7-20></a><a href=#__codelineno-7-20><span class=linenos data-linenos=" 20 "></span></a>    await sequelize.close();
</span><span id=__span-7-21><a id=__codelineno-7-21 name=__codelineno-7-21></a><a href=#__codelineno-7-21><span class=linenos data-linenos=" 21 "></span></a>  });
</span><span id=__span-7-22><a id=__codelineno-7-22 name=__codelineno-7-22></a><a href=#__codelineno-7-22><span class=linenos data-linenos=" 22 "></span></a>
</span><span id=__span-7-23><a id=__codelineno-7-23 name=__codelineno-7-23></a><a href=#__codelineno-7-23><span class=linenos data-linenos=" 23 "></span></a>  describe(&#39;Successful user creation&#39;, () =&gt; {
</span><span id=__span-7-24><a id=__codelineno-7-24 name=__codelineno-7-24></a><a href=#__codelineno-7-24><span class=linenos data-linenos=" 24 "></span></a>    test(&#39;should create a new user with valid data&#39;, async () =&gt; {
</span><span id=__span-7-25><a id=__codelineno-7-25 name=__codelineno-7-25></a><a href=#__codelineno-7-25><span class=linenos data-linenos=" 25 "></span></a>      const userData = {
</span><span id=__span-7-26><a id=__codelineno-7-26 name=__codelineno-7-26></a><a href=#__codelineno-7-26><span class=linenos data-linenos=" 26 "></span></a>        email: &#39;test@example.com&#39;,
</span><span id=__span-7-27><a id=__codelineno-7-27 name=__codelineno-7-27></a><a href=#__codelineno-7-27><span class=linenos data-linenos=" 27 "></span></a>        password: &#39;SecurePass123!&#39;,
</span><span id=__span-7-28><a id=__codelineno-7-28 name=__codelineno-7-28></a><a href=#__codelineno-7-28><span class=linenos data-linenos=" 28 "></span></a>        firstName: &#39;John&#39;,
</span><span id=__span-7-29><a id=__codelineno-7-29 name=__codelineno-7-29></a><a href=#__codelineno-7-29><span class=linenos data-linenos=" 29 "></span></a>        lastName: &#39;Doe&#39;,
</span><span id=__span-7-30><a id=__codelineno-7-30 name=__codelineno-7-30></a><a href=#__codelineno-7-30><span class=linenos data-linenos=" 30 "></span></a>        role: &#39;user&#39;
</span><span id=__span-7-31><a id=__codelineno-7-31 name=__codelineno-7-31></a><a href=#__codelineno-7-31><span class=linenos data-linenos=" 31 "></span></a>      };
</span><span id=__span-7-32><a id=__codelineno-7-32 name=__codelineno-7-32></a><a href=#__codelineno-7-32><span class=linenos data-linenos=" 32 "></span></a>
</span><span id=__span-7-33><a id=__codelineno-7-33 name=__codelineno-7-33></a><a href=#__codelineno-7-33><span class=linenos data-linenos=" 33 "></span></a>      const response = await request(app)
</span><span id=__span-7-34><a id=__codelineno-7-34 name=__codelineno-7-34></a><a href=#__codelineno-7-34><span class=linenos data-linenos=" 34 "></span></a>        .post(&#39;/api/users&#39;)
</span><span id=__span-7-35><a id=__codelineno-7-35 name=__codelineno-7-35></a><a href=#__codelineno-7-35><span class=linenos data-linenos=" 35 "></span></a>        .send(userData)
</span><span id=__span-7-36><a id=__codelineno-7-36 name=__codelineno-7-36></a><a href=#__codelineno-7-36><span class=linenos data-linenos=" 36 "></span></a>        .expect(201);
</span><span id=__span-7-37><a id=__codelineno-7-37 name=__codelineno-7-37></a><a href=#__codelineno-7-37><span class=linenos data-linenos=" 37 "></span></a>
</span><span id=__span-7-38><a id=__codelineno-7-38 name=__codelineno-7-38></a><a href=#__codelineno-7-38><span class=linenos data-linenos=" 38 "></span></a>      expect(response.body).toMatchObject({
</span><span id=__span-7-39><a id=__codelineno-7-39 name=__codelineno-7-39></a><a href=#__codelineno-7-39><span class=linenos data-linenos=" 39 "></span></a>        id: expect.any(String),
</span><span id=__span-7-40><a id=__codelineno-7-40 name=__codelineno-7-40></a><a href=#__codelineno-7-40><span class=linenos data-linenos=" 40 "></span></a>        email: userData.email,
</span><span id=__span-7-41><a id=__codelineno-7-41 name=__codelineno-7-41></a><a href=#__codelineno-7-41><span class=linenos data-linenos=" 41 "></span></a>        firstName: userData.firstName,
</span><span id=__span-7-42><a id=__codelineno-7-42 name=__codelineno-7-42></a><a href=#__codelineno-7-42><span class=linenos data-linenos=" 42 "></span></a>        lastName: userData.lastName,
</span><span id=__span-7-43><a id=__codelineno-7-43 name=__codelineno-7-43></a><a href=#__codelineno-7-43><span class=linenos data-linenos=" 43 "></span></a>        role: userData.role,
</span><span id=__span-7-44><a id=__codelineno-7-44 name=__codelineno-7-44></a><a href=#__codelineno-7-44><span class=linenos data-linenos=" 44 "></span></a>        createdAt: expect.any(String),
</span><span id=__span-7-45><a id=__codelineno-7-45 name=__codelineno-7-45></a><a href=#__codelineno-7-45><span class=linenos data-linenos=" 45 "></span></a>        updatedAt: expect.any(String)
</span><span id=__span-7-46><a id=__codelineno-7-46 name=__codelineno-7-46></a><a href=#__codelineno-7-46><span class=linenos data-linenos=" 46 "></span></a>      });
</span><span id=__span-7-47><a id=__codelineno-7-47 name=__codelineno-7-47></a><a href=#__codelineno-7-47><span class=linenos data-linenos=" 47 "></span></a>
</span><span id=__span-7-48><a id=__codelineno-7-48 name=__codelineno-7-48></a><a href=#__codelineno-7-48><span class=linenos data-linenos=" 48 "></span></a>      // Verify password is not returned
</span><span id=__span-7-49><a id=__codelineno-7-49 name=__codelineno-7-49></a><a href=#__codelineno-7-49><span class=linenos data-linenos=" 49 "></span></a>      expect(response.body.password).toBeUndefined();
</span><span id=__span-7-50><a id=__codelineno-7-50 name=__codelineno-7-50></a><a href=#__codelineno-7-50><span class=linenos data-linenos=" 50 "></span></a>
</span><span id=__span-7-51><a id=__codelineno-7-51 name=__codelineno-7-51></a><a href=#__codelineno-7-51><span class=linenos data-linenos=" 51 "></span></a>      // Verify user exists in database
</span><span id=__span-7-52><a id=__codelineno-7-52 name=__codelineno-7-52></a><a href=#__codelineno-7-52><span class=linenos data-linenos=" 52 "></span></a>      const user = await User.findOne({ where: { email: userData.email } });
</span><span id=__span-7-53><a id=__codelineno-7-53 name=__codelineno-7-53></a><a href=#__codelineno-7-53><span class=linenos data-linenos=" 53 "></span></a>      expect(user).toBeTruthy();
</span><span id=__span-7-54><a id=__codelineno-7-54 name=__codelineno-7-54></a><a href=#__codelineno-7-54><span class=linenos data-linenos=" 54 "></span></a>      expect(user.email).toBe(userData.email);
</span><span id=__span-7-55><a id=__codelineno-7-55 name=__codelineno-7-55></a><a href=#__codelineno-7-55><span class=linenos data-linenos=" 55 "></span></a>    });
</span><span id=__span-7-56><a id=__codelineno-7-56 name=__codelineno-7-56></a><a href=#__codelineno-7-56><span class=linenos data-linenos=" 56 "></span></a>
</span><span id=__span-7-57><a id=__codelineno-7-57 name=__codelineno-7-57></a><a href=#__codelineno-7-57><span class=linenos data-linenos=" 57 "></span></a>    test(&#39;should hash password before storing&#39;, async () =&gt; {
</span><span id=__span-7-58><a id=__codelineno-7-58 name=__codelineno-7-58></a><a href=#__codelineno-7-58><span class=linenos data-linenos=" 58 "></span></a>      const userData = {
</span><span id=__span-7-59><a id=__codelineno-7-59 name=__codelineno-7-59></a><a href=#__codelineno-7-59><span class=linenos data-linenos=" 59 "></span></a>        email: &#39;hash@example.com&#39;,
</span><span id=__span-7-60><a id=__codelineno-7-60 name=__codelineno-7-60></a><a href=#__codelineno-7-60><span class=linenos data-linenos=" 60 "></span></a>        password: &#39;PlainTextPass123!&#39;,
</span><span id=__span-7-61><a id=__codelineno-7-61 name=__codelineno-7-61></a><a href=#__codelineno-7-61><span class=linenos data-linenos=" 61 "></span></a>        firstName: &#39;Jane&#39;,
</span><span id=__span-7-62><a id=__codelineno-7-62 name=__codelineno-7-62></a><a href=#__codelineno-7-62><span class=linenos data-linenos=" 62 "></span></a>        lastName: &#39;Smith&#39;,
</span><span id=__span-7-63><a id=__codelineno-7-63 name=__codelineno-7-63></a><a href=#__codelineno-7-63><span class=linenos data-linenos=" 63 "></span></a>        role: &#39;user&#39;
</span><span id=__span-7-64><a id=__codelineno-7-64 name=__codelineno-7-64></a><a href=#__codelineno-7-64><span class=linenos data-linenos=" 64 "></span></a>      };
</span><span id=__span-7-65><a id=__codelineno-7-65 name=__codelineno-7-65></a><a href=#__codelineno-7-65><span class=linenos data-linenos=" 65 "></span></a>
</span><span id=__span-7-66><a id=__codelineno-7-66 name=__codelineno-7-66></a><a href=#__codelineno-7-66><span class=linenos data-linenos=" 66 "></span></a>      await request(app)
</span><span id=__span-7-67><a id=__codelineno-7-67 name=__codelineno-7-67></a><a href=#__codelineno-7-67><span class=linenos data-linenos=" 67 "></span></a>        .post(&#39;/api/users&#39;)
</span><span id=__span-7-68><a id=__codelineno-7-68 name=__codelineno-7-68></a><a href=#__codelineno-7-68><span class=linenos data-linenos=" 68 "></span></a>        .send(userData)
</span><span id=__span-7-69><a id=__codelineno-7-69 name=__codelineno-7-69></a><a href=#__codelineno-7-69><span class=linenos data-linenos=" 69 "></span></a>        .expect(201);
</span><span id=__span-7-70><a id=__codelineno-7-70 name=__codelineno-7-70></a><a href=#__codelineno-7-70><span class=linenos data-linenos=" 70 "></span></a>
</span><span id=__span-7-71><a id=__codelineno-7-71 name=__codelineno-7-71></a><a href=#__codelineno-7-71><span class=linenos data-linenos=" 71 "></span></a>      const user = await User.findOne({ where: { email: userData.email } });
</span><span id=__span-7-72><a id=__codelineno-7-72 name=__codelineno-7-72></a><a href=#__codelineno-7-72><span class=linenos data-linenos=" 72 "></span></a>      expect(user.password).not.toBe(userData.password);
</span><span id=__span-7-73><a id=__codelineno-7-73 name=__codelineno-7-73></a><a href=#__codelineno-7-73><span class=linenos data-linenos=" 73 "></span></a>      expect(user.password).toMatch(/^\$2[aby]\$/);
</span><span id=__span-7-74><a id=__codelineno-7-74 name=__codelineno-7-74></a><a href=#__codelineno-7-74><span class=linenos data-linenos=" 74 "></span></a>    });
</span><span id=__span-7-75><a id=__codelineno-7-75 name=__codelineno-7-75></a><a href=#__codelineno-7-75><span class=linenos data-linenos=" 75 "></span></a>  });
</span><span id=__span-7-76><a id=__codelineno-7-76 name=__codelineno-7-76></a><a href=#__codelineno-7-76><span class=linenos data-linenos=" 76 "></span></a>
</span><span id=__span-7-77><a id=__codelineno-7-77 name=__codelineno-7-77></a><a href=#__codelineno-7-77><span class=linenos data-linenos=" 77 "></span></a>  describe(&#39;Validation errors&#39;, () =&gt; {
</span><span id=__span-7-78><a id=__codelineno-7-78 name=__codelineno-7-78></a><a href=#__codelineno-7-78><span class=linenos data-linenos=" 78 "></span></a>    test(&#39;should return 400 for invalid email format&#39;, async () =&gt; {
</span><span id=__span-7-79><a id=__codelineno-7-79 name=__codelineno-7-79></a><a href=#__codelineno-7-79><span class=linenos data-linenos=" 79 "></span></a>      const response = await request(app)
</span><span id=__span-7-80><a id=__codelineno-7-80 name=__codelineno-7-80></a><a href=#__codelineno-7-80><span class=linenos data-linenos=" 80 "></span></a>        .post(&#39;/api/users&#39;)
</span><span id=__span-7-81><a id=__codelineno-7-81 name=__codelineno-7-81></a><a href=#__codelineno-7-81><span class=linenos data-linenos=" 81 "></span></a>        .send({
</span><span id=__span-7-82><a id=__codelineno-7-82 name=__codelineno-7-82></a><a href=#__codelineno-7-82><span class=linenos data-linenos=" 82 "></span></a>          email: &#39;invalid-email&#39;,
</span><span id=__span-7-83><a id=__codelineno-7-83 name=__codelineno-7-83></a><a href=#__codelineno-7-83><span class=linenos data-linenos=" 83 "></span></a>          password: &#39;SecurePass123!&#39;,
</span><span id=__span-7-84><a id=__codelineno-7-84 name=__codelineno-7-84></a><a href=#__codelineno-7-84><span class=linenos data-linenos=" 84 "></span></a>          firstName: &#39;John&#39;,
</span><span id=__span-7-85><a id=__codelineno-7-85 name=__codelineno-7-85></a><a href=#__codelineno-7-85><span class=linenos data-linenos=" 85 "></span></a>          lastName: &#39;Doe&#39;,
</span><span id=__span-7-86><a id=__codelineno-7-86 name=__codelineno-7-86></a><a href=#__codelineno-7-86><span class=linenos data-linenos=" 86 "></span></a>          role: &#39;user&#39;
</span><span id=__span-7-87><a id=__codelineno-7-87 name=__codelineno-7-87></a><a href=#__codelineno-7-87><span class=linenos data-linenos=" 87 "></span></a>        })
</span><span id=__span-7-88><a id=__codelineno-7-88 name=__codelineno-7-88></a><a href=#__codelineno-7-88><span class=linenos data-linenos=" 88 "></span></a>        .expect(400);
</span><span id=__span-7-89><a id=__codelineno-7-89 name=__codelineno-7-89></a><a href=#__codelineno-7-89><span class=linenos data-linenos=" 89 "></span></a>
</span><span id=__span-7-90><a id=__codelineno-7-90 name=__codelineno-7-90></a><a href=#__codelineno-7-90><span class=linenos data-linenos=" 90 "></span></a>      expect(response.body.error).toBe(&#39;Validation failed&#39;);
</span><span id=__span-7-91><a id=__codelineno-7-91 name=__codelineno-7-91></a><a href=#__codelineno-7-91><span class=linenos data-linenos=" 91 "></span></a>      expect(response.body.details).toContainEqual(
</span><span id=__span-7-92><a id=__codelineno-7-92 name=__codelineno-7-92></a><a href=#__codelineno-7-92><span class=linenos data-linenos=" 92 "></span></a>        expect.objectContaining({
</span><span id=__span-7-93><a id=__codelineno-7-93 name=__codelineno-7-93></a><a href=#__codelineno-7-93><span class=linenos data-linenos=" 93 "></span></a>          field: &#39;email&#39;,
</span><span id=__span-7-94><a id=__codelineno-7-94 name=__codelineno-7-94></a><a href=#__codelineno-7-94><span class=linenos data-linenos=" 94 "></span></a>          message: &#39;Invalid email format&#39;
</span><span id=__span-7-95><a id=__codelineno-7-95 name=__codelineno-7-95></a><a href=#__codelineno-7-95><span class=linenos data-linenos=" 95 "></span></a>        })
</span><span id=__span-7-96><a id=__codelineno-7-96 name=__codelineno-7-96></a><a href=#__codelineno-7-96><span class=linenos data-linenos=" 96 "></span></a>      );
</span><span id=__span-7-97><a id=__codelineno-7-97 name=__codelineno-7-97></a><a href=#__codelineno-7-97><span class=linenos data-linenos=" 97 "></span></a>    });
</span><span id=__span-7-98><a id=__codelineno-7-98 name=__codelineno-7-98></a><a href=#__codelineno-7-98><span class=linenos data-linenos=" 98 "></span></a>
</span><span id=__span-7-99><a id=__codelineno-7-99 name=__codelineno-7-99></a><a href=#__codelineno-7-99><span class=linenos data-linenos=" 99 "></span></a>    test(&#39;should return 400 for weak password&#39;, async () =&gt; {
</span><span id=__span-7-100><a id=__codelineno-7-100 name=__codelineno-7-100></a><a href=#__codelineno-7-100><span class=linenos data-linenos="100 "></span></a>      const response = await request(app)
</span><span id=__span-7-101><a id=__codelineno-7-101 name=__codelineno-7-101></a><a href=#__codelineno-7-101><span class=linenos data-linenos="101 "></span></a>        .post(&#39;/api/users&#39;)
</span><span id=__span-7-102><a id=__codelineno-7-102 name=__codelineno-7-102></a><a href=#__codelineno-7-102><span class=linenos data-linenos="102 "></span></a>        .send({
</span><span id=__span-7-103><a id=__codelineno-7-103 name=__codelineno-7-103></a><a href=#__codelineno-7-103><span class=linenos data-linenos="103 "></span></a>          email: &#39;test@example.com&#39;,
</span><span id=__span-7-104><a id=__codelineno-7-104 name=__codelineno-7-104></a><a href=#__codelineno-7-104><span class=linenos data-linenos="104 "></span></a>          password: &#39;weak&#39;,
</span><span id=__span-7-105><a id=__codelineno-7-105 name=__codelineno-7-105></a><a href=#__codelineno-7-105><span class=linenos data-linenos="105 "></span></a>          firstName: &#39;John&#39;,
</span><span id=__span-7-106><a id=__codelineno-7-106 name=__codelineno-7-106></a><a href=#__codelineno-7-106><span class=linenos data-linenos="106 "></span></a>          lastName: &#39;Doe&#39;,
</span><span id=__span-7-107><a id=__codelineno-7-107 name=__codelineno-7-107></a><a href=#__codelineno-7-107><span class=linenos data-linenos="107 "></span></a>          role: &#39;user&#39;
</span><span id=__span-7-108><a id=__codelineno-7-108 name=__codelineno-7-108></a><a href=#__codelineno-7-108><span class=linenos data-linenos="108 "></span></a>        })
</span><span id=__span-7-109><a id=__codelineno-7-109 name=__codelineno-7-109></a><a href=#__codelineno-7-109><span class=linenos data-linenos="109 "></span></a>        .expect(400);
</span><span id=__span-7-110><a id=__codelineno-7-110 name=__codelineno-7-110></a><a href=#__codelineno-7-110><span class=linenos data-linenos="110 "></span></a>
</span><span id=__span-7-111><a id=__codelineno-7-111 name=__codelineno-7-111></a><a href=#__codelineno-7-111><span class=linenos data-linenos="111 "></span></a>      expect(response.body.error).toBe(&#39;Validation failed&#39;);
</span><span id=__span-7-112><a id=__codelineno-7-112 name=__codelineno-7-112></a><a href=#__codelineno-7-112><span class=linenos data-linenos="112 "></span></a>      expect(response.body.details).toContainEqual(
</span><span id=__span-7-113><a id=__codelineno-7-113 name=__codelineno-7-113></a><a href=#__codelineno-7-113><span class=linenos data-linenos="113 "></span></a>        expect.objectContaining({
</span><span id=__span-7-114><a id=__codelineno-7-114 name=__codelineno-7-114></a><a href=#__codelineno-7-114><span class=linenos data-linenos="114 "></span></a>          field: &#39;password&#39;,
</span><span id=__span-7-115><a id=__codelineno-7-115 name=__codelineno-7-115></a><a href=#__codelineno-7-115><span class=linenos data-linenos="115 "></span></a>          message: expect.stringContaining(&#39;Password must&#39;)
</span><span id=__span-7-116><a id=__codelineno-7-116 name=__codelineno-7-116></a><a href=#__codelineno-7-116><span class=linenos data-linenos="116 "></span></a>        })
</span><span id=__span-7-117><a id=__codelineno-7-117 name=__codelineno-7-117></a><a href=#__codelineno-7-117><span class=linenos data-linenos="117 "></span></a>      );
</span><span id=__span-7-118><a id=__codelineno-7-118 name=__codelineno-7-118></a><a href=#__codelineno-7-118><span class=linenos data-linenos="118 "></span></a>    });
</span><span id=__span-7-119><a id=__codelineno-7-119 name=__codelineno-7-119></a><a href=#__codelineno-7-119><span class=linenos data-linenos="119 "></span></a>
</span><span id=__span-7-120><a id=__codelineno-7-120 name=__codelineno-7-120></a><a href=#__codelineno-7-120><span class=linenos data-linenos="120 "></span></a>    test(&#39;should return 400 for missing required fields&#39;, async () =&gt; {
</span><span id=__span-7-121><a id=__codelineno-7-121 name=__codelineno-7-121></a><a href=#__codelineno-7-121><span class=linenos data-linenos="121 "></span></a>      const response = await request(app)
</span><span id=__span-7-122><a id=__codelineno-7-122 name=__codelineno-7-122></a><a href=#__codelineno-7-122><span class=linenos data-linenos="122 "></span></a>        .post(&#39;/api/users&#39;)
</span><span id=__span-7-123><a id=__codelineno-7-123 name=__codelineno-7-123></a><a href=#__codelineno-7-123><span class=linenos data-linenos="123 "></span></a>        .send({
</span><span id=__span-7-124><a id=__codelineno-7-124 name=__codelineno-7-124></a><a href=#__codelineno-7-124><span class=linenos data-linenos="124 "></span></a>          email: &#39;test@example.com&#39;
</span><span id=__span-7-125><a id=__codelineno-7-125 name=__codelineno-7-125></a><a href=#__codelineno-7-125><span class=linenos data-linenos="125 "></span></a>        })
</span><span id=__span-7-126><a id=__codelineno-7-126 name=__codelineno-7-126></a><a href=#__codelineno-7-126><span class=linenos data-linenos="126 "></span></a>        .expect(400);
</span><span id=__span-7-127><a id=__codelineno-7-127 name=__codelineno-7-127></a><a href=#__codelineno-7-127><span class=linenos data-linenos="127 "></span></a>
</span><span id=__span-7-128><a id=__codelineno-7-128 name=__codelineno-7-128></a><a href=#__codelineno-7-128><span class=linenos data-linenos="128 "></span></a>      expect(response.body.error).toBe(&#39;Validation failed&#39;);
</span><span id=__span-7-129><a id=__codelineno-7-129 name=__codelineno-7-129></a><a href=#__codelineno-7-129><span class=linenos data-linenos="129 "></span></a>      expect(response.body.details).toHaveLength(4);
</span><span id=__span-7-130><a id=__codelineno-7-130 name=__codelineno-7-130></a><a href=#__codelineno-7-130><span class=linenos data-linenos="130 "></span></a>    });
</span><span id=__span-7-131><a id=__codelineno-7-131 name=__codelineno-7-131></a><a href=#__codelineno-7-131><span class=linenos data-linenos="131 "></span></a>
</span><span id=__span-7-132><a id=__codelineno-7-132 name=__codelineno-7-132></a><a href=#__codelineno-7-132><span class=linenos data-linenos="132 "></span></a>    test(&#39;should return 409 for duplicate email&#39;, async () =&gt; {
</span><span id=__span-7-133><a id=__codelineno-7-133 name=__codelineno-7-133></a><a href=#__codelineno-7-133><span class=linenos data-linenos="133 "></span></a>      const userData = {
</span><span id=__span-7-134><a id=__codelineno-7-134 name=__codelineno-7-134></a><a href=#__codelineno-7-134><span class=linenos data-linenos="134 "></span></a>        email: &#39;duplicate@example.com&#39;,
</span><span id=__span-7-135><a id=__codelineno-7-135 name=__codelineno-7-135></a><a href=#__codelineno-7-135><span class=linenos data-linenos="135 "></span></a>        password: &#39;SecurePass123!&#39;,
</span><span id=__span-7-136><a id=__codelineno-7-136 name=__codelineno-7-136></a><a href=#__codelineno-7-136><span class=linenos data-linenos="136 "></span></a>        firstName: &#39;John&#39;,
</span><span id=__span-7-137><a id=__codelineno-7-137 name=__codelineno-7-137></a><a href=#__codelineno-7-137><span class=linenos data-linenos="137 "></span></a>        lastName: &#39;Doe&#39;,
</span><span id=__span-7-138><a id=__codelineno-7-138 name=__codelineno-7-138></a><a href=#__codelineno-7-138><span class=linenos data-linenos="138 "></span></a>        role: &#39;user&#39;
</span><span id=__span-7-139><a id=__codelineno-7-139 name=__codelineno-7-139></a><a href=#__codelineno-7-139><span class=linenos data-linenos="139 "></span></a>      };
</span><span id=__span-7-140><a id=__codelineno-7-140 name=__codelineno-7-140></a><a href=#__codelineno-7-140><span class=linenos data-linenos="140 "></span></a>
</span><span id=__span-7-141><a id=__codelineno-7-141 name=__codelineno-7-141></a><a href=#__codelineno-7-141><span class=linenos data-linenos="141 "></span></a>      // Create first user
</span><span id=__span-7-142><a id=__codelineno-7-142 name=__codelineno-7-142></a><a href=#__codelineno-7-142><span class=linenos data-linenos="142 "></span></a>      await request(app)
</span><span id=__span-7-143><a id=__codelineno-7-143 name=__codelineno-7-143></a><a href=#__codelineno-7-143><span class=linenos data-linenos="143 "></span></a>        .post(&#39;/api/users&#39;)
</span><span id=__span-7-144><a id=__codelineno-7-144 name=__codelineno-7-144></a><a href=#__codelineno-7-144><span class=linenos data-linenos="144 "></span></a>        .send(userData)
</span><span id=__span-7-145><a id=__codelineno-7-145 name=__codelineno-7-145></a><a href=#__codelineno-7-145><span class=linenos data-linenos="145 "></span></a>        .expect(201);
</span><span id=__span-7-146><a id=__codelineno-7-146 name=__codelineno-7-146></a><a href=#__codelineno-7-146><span class=linenos data-linenos="146 "></span></a>
</span><span id=__span-7-147><a id=__codelineno-7-147 name=__codelineno-7-147></a><a href=#__codelineno-7-147><span class=linenos data-linenos="147 "></span></a>      // Attempt to create duplicate
</span><span id=__span-7-148><a id=__codelineno-7-148 name=__codelineno-7-148></a><a href=#__codelineno-7-148><span class=linenos data-linenos="148 "></span></a>      const response = await request(app)
</span><span id=__span-7-149><a id=__codelineno-7-149 name=__codelineno-7-149></a><a href=#__codelineno-7-149><span class=linenos data-linenos="149 "></span></a>        .post(&#39;/api/users&#39;)
</span><span id=__span-7-150><a id=__codelineno-7-150 name=__codelineno-7-150></a><a href=#__codelineno-7-150><span class=linenos data-linenos="150 "></span></a>        .send(userData)
</span><span id=__span-7-151><a id=__codelineno-7-151 name=__codelineno-7-151></a><a href=#__codelineno-7-151><span class=linenos data-linenos="151 "></span></a>        .expect(409);
</span><span id=__span-7-152><a id=__codelineno-7-152 name=__codelineno-7-152></a><a href=#__codelineno-7-152><span class=linenos data-linenos="152 "></span></a>
</span><span id=__span-7-153><a id=__codelineno-7-153 name=__codelineno-7-153></a><a href=#__codelineno-7-153><span class=linenos data-linenos="153 "></span></a>      expect(response.body.error).toBe(&#39;Email already exists&#39;);
</span><span id=__span-7-154><a id=__codelineno-7-154 name=__codelineno-7-154></a><a href=#__codelineno-7-154><span class=linenos data-linenos="154 "></span></a>    });
</span><span id=__span-7-155><a id=__codelineno-7-155 name=__codelineno-7-155></a><a href=#__codelineno-7-155><span class=linenos data-linenos="155 "></span></a>  });
</span><span id=__span-7-156><a id=__codelineno-7-156 name=__codelineno-7-156></a><a href=#__codelineno-7-156><span class=linenos data-linenos="156 "></span></a>
</span><span id=__span-7-157><a id=__codelineno-7-157 name=__codelineno-7-157></a><a href=#__codelineno-7-157><span class=linenos data-linenos="157 "></span></a>  describe(&#39;Security tests&#39;, () =&gt; {
</span><span id=__span-7-158><a id=__codelineno-7-158 name=__codelineno-7-158></a><a href=#__codelineno-7-158><span class=linenos data-linenos="158 "></span></a>    test(&#39;should sanitize input to prevent SQL injection&#39;, async () =&gt; {
</span><span id=__span-7-159><a id=__codelineno-7-159 name=__codelineno-7-159></a><a href=#__codelineno-7-159><span class=linenos data-linenos="159 "></span></a>      const maliciousData = {
</span><span id=__span-7-160><a id=__codelineno-7-160 name=__codelineno-7-160></a><a href=#__codelineno-7-160><span class=linenos data-linenos="160 "></span></a>        email: &#39;test@example.com&#39;,
</span><span id=__span-7-161><a id=__codelineno-7-161 name=__codelineno-7-161></a><a href=#__codelineno-7-161><span class=linenos data-linenos="161 "></span></a>        password: &#39;SecurePass123!&#39;,
</span><span id=__span-7-162><a id=__codelineno-7-162 name=__codelineno-7-162></a><a href=#__codelineno-7-162><span class=linenos data-linenos="162 "></span></a>        firstName: &quot;John&#39;; DROP TABLE users; --&quot;,
</span><span id=__span-7-163><a id=__codelineno-7-163 name=__codelineno-7-163></a><a href=#__codelineno-7-163><span class=linenos data-linenos="163 "></span></a>        lastName: &#39;Doe&#39;,
</span><span id=__span-7-164><a id=__codelineno-7-164 name=__codelineno-7-164></a><a href=#__codelineno-7-164><span class=linenos data-linenos="164 "></span></a>        role: &#39;user&#39;
</span><span id=__span-7-165><a id=__codelineno-7-165 name=__codelineno-7-165></a><a href=#__codelineno-7-165><span class=linenos data-linenos="165 "></span></a>      };
</span><span id=__span-7-166><a id=__codelineno-7-166 name=__codelineno-7-166></a><a href=#__codelineno-7-166><span class=linenos data-linenos="166 "></span></a>
</span><span id=__span-7-167><a id=__codelineno-7-167 name=__codelineno-7-167></a><a href=#__codelineno-7-167><span class=linenos data-linenos="167 "></span></a>      const response = await request(app)
</span><span id=__span-7-168><a id=__codelineno-7-168 name=__codelineno-7-168></a><a href=#__codelineno-7-168><span class=linenos data-linenos="168 "></span></a>        .post(&#39;/api/users&#39;)
</span><span id=__span-7-169><a id=__codelineno-7-169 name=__codelineno-7-169></a><a href=#__codelineno-7-169><span class=linenos data-linenos="169 "></span></a>        .send(maliciousData)
</span><span id=__span-7-170><a id=__codelineno-7-170 name=__codelineno-7-170></a><a href=#__codelineno-7-170><span class=linenos data-linenos="170 "></span></a>        .expect(201);
</span><span id=__span-7-171><a id=__codelineno-7-171 name=__codelineno-7-171></a><a href=#__codelineno-7-171><span class=linenos data-linenos="171 "></span></a>
</span><span id=__span-7-172><a id=__codelineno-7-172 name=__codelineno-7-172></a><a href=#__codelineno-7-172><span class=linenos data-linenos="172 "></span></a>      // Verify the malicious input was stored safely
</span><span id=__span-7-173><a id=__codelineno-7-173 name=__codelineno-7-173></a><a href=#__codelineno-7-173><span class=linenos data-linenos="173 "></span></a>      const user = await User.findOne({ where: { email: maliciousData.email } });
</span><span id=__span-7-174><a id=__codelineno-7-174 name=__codelineno-7-174></a><a href=#__codelineno-7-174><span class=linenos data-linenos="174 "></span></a>      expect(user.firstName).toBe(maliciousData.firstName);
</span><span id=__span-7-175><a id=__codelineno-7-175 name=__codelineno-7-175></a><a href=#__codelineno-7-175><span class=linenos data-linenos="175 "></span></a>    });
</span><span id=__span-7-176><a id=__codelineno-7-176 name=__codelineno-7-176></a><a href=#__codelineno-7-176><span class=linenos data-linenos="176 "></span></a>
</span><span id=__span-7-177><a id=__codelineno-7-177 name=__codelineno-7-177></a><a href=#__codelineno-7-177><span class=linenos data-linenos="177 "></span></a>    test(&#39;should rate limit requests&#39;, async () =&gt; {
</span><span id=__span-7-178><a id=__codelineno-7-178 name=__codelineno-7-178></a><a href=#__codelineno-7-178><span class=linenos data-linenos="178 "></span></a>      const userData = {
</span><span id=__span-7-179><a id=__codelineno-7-179 name=__codelineno-7-179></a><a href=#__codelineno-7-179><span class=linenos data-linenos="179 "></span></a>        email: &#39;ratelimit@example.com&#39;,
</span><span id=__span-7-180><a id=__codelineno-7-180 name=__codelineno-7-180></a><a href=#__codelineno-7-180><span class=linenos data-linenos="180 "></span></a>        password: &#39;SecurePass123!&#39;,
</span><span id=__span-7-181><a id=__codelineno-7-181 name=__codelineno-7-181></a><a href=#__codelineno-7-181><span class=linenos data-linenos="181 "></span></a>        firstName: &#39;John&#39;,
</span><span id=__span-7-182><a id=__codelineno-7-182 name=__codelineno-7-182></a><a href=#__codelineno-7-182><span class=linenos data-linenos="182 "></span></a>        lastName: &#39;Doe&#39;,
</span><span id=__span-7-183><a id=__codelineno-7-183 name=__codelineno-7-183></a><a href=#__codelineno-7-183><span class=linenos data-linenos="183 "></span></a>        role: &#39;user&#39;
</span><span id=__span-7-184><a id=__codelineno-7-184 name=__codelineno-7-184></a><a href=#__codelineno-7-184><span class=linenos data-linenos="184 "></span></a>      };
</span><span id=__span-7-185><a id=__codelineno-7-185 name=__codelineno-7-185></a><a href=#__codelineno-7-185><span class=linenos data-linenos="185 "></span></a>
</span><span id=__span-7-186><a id=__codelineno-7-186 name=__codelineno-7-186></a><a href=#__codelineno-7-186><span class=linenos data-linenos="186 "></span></a>      // Make 10 requests quickly
</span><span id=__span-7-187><a id=__codelineno-7-187 name=__codelineno-7-187></a><a href=#__codelineno-7-187><span class=linenos data-linenos="187 "></span></a>      const requests = [];
</span><span id=__span-7-188><a id=__codelineno-7-188 name=__codelineno-7-188></a><a href=#__codelineno-7-188><span class=linenos data-linenos="188 "></span></a>      for (let i = 0; i &lt; 10; i++) {
</span><span id=__span-7-189><a id=__codelineno-7-189 name=__codelineno-7-189></a><a href=#__codelineno-7-189><span class=linenos data-linenos="189 "></span></a>        requests.push(
</span><span id=__span-7-190><a id=__codelineno-7-190 name=__codelineno-7-190></a><a href=#__codelineno-7-190><span class=linenos data-linenos="190 "></span></a>          request(app)
</span><span id=__span-7-191><a id=__codelineno-7-191 name=__codelineno-7-191></a><a href=#__codelineno-7-191><span class=linenos data-linenos="191 "></span></a>            .post(&#39;/api/users&#39;)
</span><span id=__span-7-192><a id=__codelineno-7-192 name=__codelineno-7-192></a><a href=#__codelineno-7-192><span class=linenos data-linenos="192 "></span></a>            .send({ ...userData, email: `test${i}@example.com` })
</span><span id=__span-7-193><a id=__codelineno-7-193 name=__codelineno-7-193></a><a href=#__codelineno-7-193><span class=linenos data-linenos="193 "></span></a>        );
</span><span id=__span-7-194><a id=__codelineno-7-194 name=__codelineno-7-194></a><a href=#__codelineno-7-194><span class=linenos data-linenos="194 "></span></a>      }
</span><span id=__span-7-195><a id=__codelineno-7-195 name=__codelineno-7-195></a><a href=#__codelineno-7-195><span class=linenos data-linenos="195 "></span></a>
</span><span id=__span-7-196><a id=__codelineno-7-196 name=__codelineno-7-196></a><a href=#__codelineno-7-196><span class=linenos data-linenos="196 "></span></a>      const responses = await Promise.all(requests);
</span><span id=__span-7-197><a id=__codelineno-7-197 name=__codelineno-7-197></a><a href=#__codelineno-7-197><span class=linenos data-linenos="197 "></span></a>      const tooManyRequests = responses.filter(r =&gt; r.status === 429);
</span><span id=__span-7-198><a id=__codelineno-7-198 name=__codelineno-7-198></a><a href=#__codelineno-7-198><span class=linenos data-linenos="198 "></span></a>      expect(tooManyRequests.length).toBeGreaterThan(0);
</span><span id=__span-7-199><a id=__codelineno-7-199 name=__codelineno-7-199></a><a href=#__codelineno-7-199><span class=linenos data-linenos="199 "></span></a>    });
</span><span id=__span-7-200><a id=__codelineno-7-200 name=__codelineno-7-200></a><a href=#__codelineno-7-200><span class=linenos data-linenos="200 "></span></a>  });
</span><span id=__span-7-201><a id=__codelineno-7-201 name=__codelineno-7-201></a><a href=#__codelineno-7-201><span class=linenos data-linenos="201 "></span></a>});
</span></code></pre></div></li></ol><h6 id=5-tdd-code-phase-implementation>5. TDD Code Phase - Implementation<a class=headerlink href=#5-tdd-code-phase-implementation title="Permanent link">&para;</a></h6><p><strong>src/models/User.js:</strong><div class="language-javascript highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1></a><a href=#__codelineno-8-1><span class=linenos data-linenos=" 1 "></span></a><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>DataTypes</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;sequelize&#39;</span><span class=p>);</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2></a><a href=#__codelineno-8-2><span class=linenos data-linenos=" 2 "></span></a><span class=kd>const</span><span class=w> </span><span class=nx>bcrypt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;bcrypt&#39;</span><span class=p>);</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3></a><a href=#__codelineno-8-3><span class=linenos data-linenos=" 3 "></span></a><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>v4</span><span class=o>:</span><span class=w> </span><span class=nx>uuidv4</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;uuid&#39;</span><span class=p>);</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4></a><a href=#__codelineno-8-4><span class=linenos data-linenos=" 4 "></span></a>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5></a><a href=#__codelineno-8-5><span class=linenos data-linenos=" 5 "></span></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>sequelize</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6></a><a href=#__codelineno-8-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>User</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>sequelize</span><span class=p>.</span><span class=nx>define</span><span class=p>(</span><span class=s1>&#39;User&#39;</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7></a><a href=#__codelineno-8-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>    </span><span class=nx>id</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8></a><a href=#__codelineno-8-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>      </span><span class=nx>type</span><span class=o>:</span><span class=w> </span><span class=nx>DataTypes</span><span class=p>.</span><span class=nx>UUID</span><span class=p>,</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9></a><a href=#__codelineno-8-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>      </span><span class=nx>defaultValue</span><span class=o>:</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>uuidv4</span><span class=p>(),</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10></a><a href=#__codelineno-8-10><span class=linenos data-linenos="10 "></span></a><span class=w>      </span><span class=nx>primaryKey</span><span class=o>:</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11></a><a href=#__codelineno-8-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12></a><a href=#__codelineno-8-12><span class=linenos data-linenos="12 "></span></a><span class=w>    </span><span class=nx>email</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13></a><a href=#__codelineno-8-13><span class=linenos data-linenos="13 "></span></a><span class=w>      </span><span class=nx>type</span><span class=o>:</span><span class=w> </span><span class=nx>DataTypes</span><span class=p>.</span><span class=nx>STRING</span><span class=p>,</span>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14></a><a href=#__codelineno-8-14><span class=linenos data-linenos="14 "></span></a><span class=w>      </span><span class=nx>allowNull</span><span class=o>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15></a><a href=#__codelineno-8-15><span class=linenos data-linenos="15 "></span></a><span class=w>      </span><span class=nx>unique</span><span class=o>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16></a><a href=#__codelineno-8-16><span class=linenos data-linenos="16 "></span></a><span class=w>      </span><span class=nx>validate</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17></a><a href=#__codelineno-8-17><span class=linenos data-linenos="17 "></span></a><span class=w>        </span><span class=nx>isEmail</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18></a><a href=#__codelineno-8-18><span class=linenos data-linenos="18 "></span></a><span class=w>          </span><span class=nx>msg</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Invalid email format&#39;</span>
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19></a><a href=#__codelineno-8-19><span class=linenos data-linenos="19 "></span></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20></a><a href=#__codelineno-8-20><span class=linenos data-linenos="20 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-8-21><a id=__codelineno-8-21 name=__codelineno-8-21></a><a href=#__codelineno-8-21><span class=linenos data-linenos="21 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-8-22><a id=__codelineno-8-22 name=__codelineno-8-22></a><a href=#__codelineno-8-22><span class=linenos data-linenos="22 "></span></a><span class=w>    </span><span class=nx>password</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-23><a id=__codelineno-8-23 name=__codelineno-8-23></a><a href=#__codelineno-8-23><span class=linenos data-linenos="23 "></span></a><span class=w>      </span><span class=nx>type</span><span class=o>:</span><span class=w> </span><span class=nx>DataTypes</span><span class=p>.</span><span class=nx>STRING</span><span class=p>,</span>
</span><span id=__span-8-24><a id=__codelineno-8-24 name=__codelineno-8-24></a><a href=#__codelineno-8-24><span class=linenos data-linenos="24 "></span></a><span class=w>      </span><span class=nx>allowNull</span><span class=o>:</span><span class=w> </span><span class=kc>false</span>
</span><span id=__span-8-25><a id=__codelineno-8-25 name=__codelineno-8-25></a><a href=#__codelineno-8-25><span class=linenos data-linenos="25 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-8-26><a id=__codelineno-8-26 name=__codelineno-8-26></a><a href=#__codelineno-8-26><span class=linenos data-linenos="26 "></span></a><span class=w>    </span><span class=nx>firstName</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-27><a id=__codelineno-8-27 name=__codelineno-8-27></a><a href=#__codelineno-8-27><span class=linenos data-linenos="27 "></span></a><span class=w>      </span><span class=nx>type</span><span class=o>:</span><span class=w> </span><span class=nx>DataTypes</span><span class=p>.</span><span class=nx>STRING</span><span class=p>,</span>
</span><span id=__span-8-28><a id=__codelineno-8-28 name=__codelineno-8-28></a><a href=#__codelineno-8-28><span class=linenos data-linenos="28 "></span></a><span class=w>      </span><span class=nx>allowNull</span><span class=o>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
</span><span id=__span-8-29><a id=__codelineno-8-29 name=__codelineno-8-29></a><a href=#__codelineno-8-29><span class=linenos data-linenos="29 "></span></a><span class=w>      </span><span class=nx>validate</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-30><a id=__codelineno-8-30 name=__codelineno-8-30></a><a href=#__codelineno-8-30><span class=linenos data-linenos="30 "></span></a><span class=w>        </span><span class=nx>len</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-31><a id=__codelineno-8-31 name=__codelineno-8-31></a><a href=#__codelineno-8-31><span class=linenos data-linenos="31 "></span></a><span class=w>          </span><span class=nx>args</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=mf>2</span><span class=p>,</span><span class=w> </span><span class=mf>50</span><span class=p>],</span>
</span><span id=__span-8-32><a id=__codelineno-8-32 name=__codelineno-8-32></a><a href=#__codelineno-8-32><span class=linenos data-linenos="32 "></span></a><span class=w>          </span><span class=nx>msg</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;First name must be between 2 and 50 characters&#39;</span>
</span><span id=__span-8-33><a id=__codelineno-8-33 name=__codelineno-8-33></a><a href=#__codelineno-8-33><span class=linenos data-linenos="33 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-8-34><a id=__codelineno-8-34 name=__codelineno-8-34></a><a href=#__codelineno-8-34><span class=linenos data-linenos="34 "></span></a><span class=w>        </span><span class=nx>isAlpha</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-35><a id=__codelineno-8-35 name=__codelineno-8-35></a><a href=#__codelineno-8-35><span class=linenos data-linenos="35 "></span></a><span class=w>          </span><span class=nx>msg</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;First name must contain only letters&#39;</span>
</span><span id=__span-8-36><a id=__codelineno-8-36 name=__codelineno-8-36></a><a href=#__codelineno-8-36><span class=linenos data-linenos="36 "></span></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-8-37><a id=__codelineno-8-37 name=__codelineno-8-37></a><a href=#__codelineno-8-37><span class=linenos data-linenos="37 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-8-38><a id=__codelineno-8-38 name=__codelineno-8-38></a><a href=#__codelineno-8-38><span class=linenos data-linenos="38 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-8-39><a id=__codelineno-8-39 name=__codelineno-8-39></a><a href=#__codelineno-8-39><span class=linenos data-linenos="39 "></span></a><span class=w>    </span><span class=nx>lastName</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-40><a id=__codelineno-8-40 name=__codelineno-8-40></a><a href=#__codelineno-8-40><span class=linenos data-linenos="40 "></span></a><span class=w>      </span><span class=nx>type</span><span class=o>:</span><span class=w> </span><span class=nx>DataTypes</span><span class=p>.</span><span class=nx>STRING</span><span class=p>,</span>
</span><span id=__span-8-41><a id=__codelineno-8-41 name=__codelineno-8-41></a><a href=#__codelineno-8-41><span class=linenos data-linenos="41 "></span></a><span class=w>      </span><span class=nx>allowNull</span><span class=o>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
</span><span id=__span-8-42><a id=__codelineno-8-42 name=__codelineno-8-42></a><a href=#__codelineno-8-42><span class=linenos data-linenos="42 "></span></a><span class=w>      </span><span class=nx>validate</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-43><a id=__codelineno-8-43 name=__codelineno-8-43></a><a href=#__codelineno-8-43><span class=linenos data-linenos="43 "></span></a><span class=w>        </span><span class=nx>len</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-44><a id=__codelineno-8-44 name=__codelineno-8-44></a><a href=#__codelineno-8-44><span class=linenos data-linenos="44 "></span></a><span class=w>          </span><span class=nx>args</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=mf>2</span><span class=p>,</span><span class=w> </span><span class=mf>50</span><span class=p>],</span>
</span><span id=__span-8-45><a id=__codelineno-8-45 name=__codelineno-8-45></a><a href=#__codelineno-8-45><span class=linenos data-linenos="45 "></span></a><span class=w>          </span><span class=nx>msg</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Last name must be between 2 and 50 characters&#39;</span>
</span><span id=__span-8-46><a id=__codelineno-8-46 name=__codelineno-8-46></a><a href=#__codelineno-8-46><span class=linenos data-linenos="46 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-8-47><a id=__codelineno-8-47 name=__codelineno-8-47></a><a href=#__codelineno-8-47><span class=linenos data-linenos="47 "></span></a><span class=w>        </span><span class=nx>isAlpha</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-48><a id=__codelineno-8-48 name=__codelineno-8-48></a><a href=#__codelineno-8-48><span class=linenos data-linenos="48 "></span></a><span class=w>          </span><span class=nx>msg</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Last name must contain only letters&#39;</span>
</span><span id=__span-8-49><a id=__codelineno-8-49 name=__codelineno-8-49></a><a href=#__codelineno-8-49><span class=linenos data-linenos="49 "></span></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-8-50><a id=__codelineno-8-50 name=__codelineno-8-50></a><a href=#__codelineno-8-50><span class=linenos data-linenos="50 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-8-51><a id=__codelineno-8-51 name=__codelineno-8-51></a><a href=#__codelineno-8-51><span class=linenos data-linenos="51 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-8-52><a id=__codelineno-8-52 name=__codelineno-8-52></a><a href=#__codelineno-8-52><span class=linenos data-linenos="52 "></span></a><span class=w>    </span><span class=nx>role</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-53><a id=__codelineno-8-53 name=__codelineno-8-53></a><a href=#__codelineno-8-53><span class=linenos data-linenos="53 "></span></a><span class=w>      </span><span class=nx>type</span><span class=o>:</span><span class=w> </span><span class=nx>DataTypes</span><span class=p>.</span><span class=nx>ENUM</span><span class=p>(</span><span class=s1>&#39;user&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;moderator&#39;</span><span class=p>),</span>
</span><span id=__span-8-54><a id=__codelineno-8-54 name=__codelineno-8-54></a><a href=#__codelineno-8-54><span class=linenos data-linenos="54 "></span></a><span class=w>      </span><span class=nx>defaultValue</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;user&#39;</span><span class=p>,</span>
</span><span id=__span-8-55><a id=__codelineno-8-55 name=__codelineno-8-55></a><a href=#__codelineno-8-55><span class=linenos data-linenos="55 "></span></a><span class=w>      </span><span class=nx>allowNull</span><span class=o>:</span><span class=w> </span><span class=kc>false</span>
</span><span id=__span-8-56><a id=__codelineno-8-56 name=__codelineno-8-56></a><a href=#__codelineno-8-56><span class=linenos data-linenos="56 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-8-57><a id=__codelineno-8-57 name=__codelineno-8-57></a><a href=#__codelineno-8-57><span class=linenos data-linenos="57 "></span></a><span class=w>  </span><span class=p>},</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-58><a id=__codelineno-8-58 name=__codelineno-8-58></a><a href=#__codelineno-8-58><span class=linenos data-linenos="58 "></span></a><span class=w>    </span><span class=nx>hooks</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-59><a id=__codelineno-8-59 name=__codelineno-8-59></a><a href=#__codelineno-8-59><span class=linenos data-linenos="59 "></span></a><span class=w>      </span><span class=nx>beforeCreate</span><span class=o>:</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>(</span><span class=nx>user</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-60><a id=__codelineno-8-60 name=__codelineno-8-60></a><a href=#__codelineno-8-60><span class=linenos data-linenos="60 "></span></a><span class=w>        </span><span class=nx>user</span><span class=p>.</span><span class=nx>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>bcrypt</span><span class=p>.</span><span class=nx>hash</span><span class=p>(</span><span class=nx>user</span><span class=p>.</span><span class=nx>password</span><span class=p>,</span><span class=w> </span><span class=mf>10</span><span class=p>);</span>
</span><span id=__span-8-61><a id=__codelineno-8-61 name=__codelineno-8-61></a><a href=#__codelineno-8-61><span class=linenos data-linenos="61 "></span></a><span class=w>      </span><span class=p>},</span>
</span><span id=__span-8-62><a id=__codelineno-8-62 name=__codelineno-8-62></a><a href=#__codelineno-8-62><span class=linenos data-linenos="62 "></span></a><span class=w>      </span><span class=nx>beforeUpdate</span><span class=o>:</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>(</span><span class=nx>user</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-63><a id=__codelineno-8-63 name=__codelineno-8-63></a><a href=#__codelineno-8-63><span class=linenos data-linenos="63 "></span></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>user</span><span class=p>.</span><span class=nx>changed</span><span class=p>(</span><span class=s1>&#39;password&#39;</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-64><a id=__codelineno-8-64 name=__codelineno-8-64></a><a href=#__codelineno-8-64><span class=linenos data-linenos="64 "></span></a><span class=w>          </span><span class=nx>user</span><span class=p>.</span><span class=nx>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>bcrypt</span><span class=p>.</span><span class=nx>hash</span><span class=p>(</span><span class=nx>user</span><span class=p>.</span><span class=nx>password</span><span class=p>,</span><span class=w> </span><span class=mf>10</span><span class=p>);</span>
</span><span id=__span-8-65><a id=__codelineno-8-65 name=__codelineno-8-65></a><a href=#__codelineno-8-65><span class=linenos data-linenos="65 "></span></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-8-66><a id=__codelineno-8-66 name=__codelineno-8-66></a><a href=#__codelineno-8-66><span class=linenos data-linenos="66 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-8-67><a id=__codelineno-8-67 name=__codelineno-8-67></a><a href=#__codelineno-8-67><span class=linenos data-linenos="67 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-8-68><a id=__codelineno-8-68 name=__codelineno-8-68></a><a href=#__codelineno-8-68><span class=linenos data-linenos="68 "></span></a><span class=w>    </span><span class=nx>defaultScope</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-69><a id=__codelineno-8-69 name=__codelineno-8-69></a><a href=#__codelineno-8-69><span class=linenos data-linenos="69 "></span></a><span class=w>      </span><span class=nx>attributes</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>exclude</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>]</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-8-70><a id=__codelineno-8-70 name=__codelineno-8-70></a><a href=#__codelineno-8-70><span class=linenos data-linenos="70 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-8-71><a id=__codelineno-8-71 name=__codelineno-8-71></a><a href=#__codelineno-8-71><span class=linenos data-linenos="71 "></span></a><span class=w>    </span><span class=nx>scopes</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-72><a id=__codelineno-8-72 name=__codelineno-8-72></a><a href=#__codelineno-8-72><span class=linenos data-linenos="72 "></span></a><span class=w>      </span><span class=nx>withPassword</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-73><a id=__codelineno-8-73 name=__codelineno-8-73></a><a href=#__codelineno-8-73><span class=linenos data-linenos="73 "></span></a><span class=w>        </span><span class=nx>attributes</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>include</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>]</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-8-74><a id=__codelineno-8-74 name=__codelineno-8-74></a><a href=#__codelineno-8-74><span class=linenos data-linenos="74 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-8-75><a id=__codelineno-8-75 name=__codelineno-8-75></a><a href=#__codelineno-8-75><span class=linenos data-linenos="75 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-8-76><a id=__codelineno-8-76 name=__codelineno-8-76></a><a href=#__codelineno-8-76><span class=linenos data-linenos="76 "></span></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-8-77><a id=__codelineno-8-77 name=__codelineno-8-77></a><a href=#__codelineno-8-77><span class=linenos data-linenos="77 "></span></a>
</span><span id=__span-8-78><a id=__codelineno-8-78 name=__codelineno-8-78></a><a href=#__codelineno-8-78><span class=linenos data-linenos="78 "></span></a><span class=w>  </span><span class=nx>User</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>comparePassword</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=p>(</span><span class=nx>password</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-79><a id=__codelineno-8-79 name=__codelineno-8-79></a><a href=#__codelineno-8-79><span class=linenos data-linenos="79 "></span></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>bcrypt</span><span class=p>.</span><span class=nx>compare</span><span class=p>(</span><span class=nx>password</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>password</span><span class=p>);</span>
</span><span id=__span-8-80><a id=__codelineno-8-80 name=__codelineno-8-80></a><a href=#__codelineno-8-80><span class=linenos data-linenos="80 "></span></a><span class=w>  </span><span class=p>};</span>
</span><span id=__span-8-81><a id=__codelineno-8-81 name=__codelineno-8-81></a><a href=#__codelineno-8-81><span class=linenos data-linenos="81 "></span></a>
</span><span id=__span-8-82><a id=__codelineno-8-82 name=__codelineno-8-82></a><a href=#__codelineno-8-82><span class=linenos data-linenos="82 "></span></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>User</span><span class=p>;</span>
</span><span id=__span-8-83><a id=__codelineno-8-83 name=__codelineno-8-83></a><a href=#__codelineno-8-83><span class=linenos data-linenos="83 "></span></a><span class=p>};</span>
</span></code></pre></div></p><p><strong>src/controllers/userController.js:</strong><div class="language-javascript highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1></a><a href=#__codelineno-9-1><span class=linenos data-linenos="  1 "></span></a><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>User</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../models&#39;</span><span class=p>);</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2></a><a href=#__codelineno-9-2><span class=linenos data-linenos="  2 "></span></a><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>validateUserInput</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../middleware/validation&#39;</span><span class=p>);</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3></a><a href=#__codelineno-9-3><span class=linenos data-linenos="  3 "></span></a><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>AppError</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../utils/errors&#39;</span><span class=p>);</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4></a><a href=#__codelineno-9-4><span class=linenos data-linenos="  4 "></span></a><span class=kd>const</span><span class=w> </span><span class=nx>logger</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../utils/logger&#39;</span><span class=p>);</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5></a><a href=#__codelineno-9-5><span class=linenos data-linenos="  5 "></span></a>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6></a><a href=#__codelineno-9-6><span class=linenos data-linenos="  6 "></span></a><span class=kd>class</span><span class=w> </span><span class=nx>UserController</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7></a><a href=#__codelineno-9-7><span class=linenos data-linenos="  7 "></span></a><span class=w>  </span><span class=k>async</span><span class=w> </span><span class=nx>createUser</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>,</span><span class=w> </span><span class=nx>next</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8></a><a href=#__codelineno-9-8><span class=linenos data-linenos="  8 "></span></a><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9></a><a href=#__codelineno-9-9><span class=linenos data-linenos="  9 "></span></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>email</span><span class=p>,</span><span class=w> </span><span class=nx>password</span><span class=p>,</span><span class=w> </span><span class=nx>firstName</span><span class=p>,</span><span class=w> </span><span class=nx>lastName</span><span class=p>,</span><span class=w> </span><span class=nx>role</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>;</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10></a><a href=#__codelineno-9-10><span class=linenos data-linenos=" 10 "></span></a>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11></a><a href=#__codelineno-9-11><span class=linenos data-linenos=" 11 "></span></a><span class=w>      </span><span class=c1>// Check if user already exists</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12></a><a href=#__codelineno-9-12><span class=linenos data-linenos=" 12 "></span></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>existingUser</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>User</span><span class=p>.</span><span class=nx>findOne</span><span class=p>({</span><span class=w> </span><span class=nx>where</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>email</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13></a><a href=#__codelineno-9-13><span class=linenos data-linenos=" 13 "></span></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>existingUser</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14></a><a href=#__codelineno-9-14><span class=linenos data-linenos=" 14 "></span></a><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>AppError</span><span class=p>(</span><span class=s1>&#39;Email already exists&#39;</span><span class=p>,</span><span class=w> </span><span class=mf>409</span><span class=p>);</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15></a><a href=#__codelineno-9-15><span class=linenos data-linenos=" 15 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16></a><a href=#__codelineno-9-16><span class=linenos data-linenos=" 16 "></span></a>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17></a><a href=#__codelineno-9-17><span class=linenos data-linenos=" 17 "></span></a><span class=w>      </span><span class=c1>// Create new user</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18></a><a href=#__codelineno-9-18><span class=linenos data-linenos=" 18 "></span></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>User</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19></a><a href=#__codelineno-9-19><span class=linenos data-linenos=" 19 "></span></a><span class=w>        </span><span class=nx>email</span><span class=p>,</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20></a><a href=#__codelineno-9-20><span class=linenos data-linenos=" 20 "></span></a><span class=w>        </span><span class=nx>password</span><span class=p>,</span>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21></a><a href=#__codelineno-9-21><span class=linenos data-linenos=" 21 "></span></a><span class=w>        </span><span class=nx>firstName</span><span class=p>,</span>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22></a><a href=#__codelineno-9-22><span class=linenos data-linenos=" 22 "></span></a><span class=w>        </span><span class=nx>lastName</span><span class=p>,</span>
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23></a><a href=#__codelineno-9-23><span class=linenos data-linenos=" 23 "></span></a><span class=w>        </span><span class=nx>role</span>
</span><span id=__span-9-24><a id=__codelineno-9-24 name=__codelineno-9-24></a><a href=#__codelineno-9-24><span class=linenos data-linenos=" 24 "></span></a><span class=w>      </span><span class=p>});</span>
</span><span id=__span-9-25><a id=__codelineno-9-25 name=__codelineno-9-25></a><a href=#__codelineno-9-25><span class=linenos data-linenos=" 25 "></span></a>
</span><span id=__span-9-26><a id=__codelineno-9-26 name=__codelineno-9-26></a><a href=#__codelineno-9-26><span class=linenos data-linenos=" 26 "></span></a><span class=w>      </span><span class=c1>// Log user creation</span>
</span><span id=__span-9-27><a id=__codelineno-9-27 name=__codelineno-9-27></a><a href=#__codelineno-9-27><span class=linenos data-linenos=" 27 "></span></a><span class=w>      </span><span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;User created&#39;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>userId</span><span class=o>:</span><span class=w> </span><span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span><span class=w> </span><span class=nx>email</span><span class=o>:</span><span class=w> </span><span class=nx>user</span><span class=p>.</span><span class=nx>email</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-9-28><a id=__codelineno-9-28 name=__codelineno-9-28></a><a href=#__codelineno-9-28><span class=linenos data-linenos=" 28 "></span></a>
</span><span id=__span-9-29><a id=__codelineno-9-29 name=__codelineno-9-29></a><a href=#__codelineno-9-29><span class=linenos data-linenos=" 29 "></span></a><span class=w>      </span><span class=c1>// Return user without password</span>
</span><span id=__span-9-30><a id=__codelineno-9-30 name=__codelineno-9-30></a><a href=#__codelineno-9-30><span class=linenos data-linenos=" 30 "></span></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>userResponse</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>user</span><span class=p>.</span><span class=nx>toJSON</span><span class=p>();</span>
</span><span id=__span-9-31><a id=__codelineno-9-31 name=__codelineno-9-31></a><a href=#__codelineno-9-31><span class=linenos data-linenos=" 31 "></span></a><span class=w>      </span><span class=ow>delete</span><span class=w> </span><span class=nx>userResponse</span><span class=p>.</span><span class=nx>password</span><span class=p>;</span>
</span><span id=__span-9-32><a id=__codelineno-9-32 name=__codelineno-9-32></a><a href=#__codelineno-9-32><span class=linenos data-linenos=" 32 "></span></a>
</span><span id=__span-9-33><a id=__codelineno-9-33 name=__codelineno-9-33></a><a href=#__codelineno-9-33><span class=linenos data-linenos=" 33 "></span></a><span class=w>      </span><span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mf>201</span><span class=p>).</span><span class=nx>json</span><span class=p>(</span><span class=nx>userResponse</span><span class=p>);</span>
</span><span id=__span-9-34><a id=__codelineno-9-34 name=__codelineno-9-34></a><a href=#__codelineno-9-34><span class=linenos data-linenos=" 34 "></span></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-35><a id=__codelineno-9-35 name=__codelineno-9-35></a><a href=#__codelineno-9-35><span class=linenos data-linenos=" 35 "></span></a><span class=w>      </span><span class=nx>next</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span><span id=__span-9-36><a id=__codelineno-9-36 name=__codelineno-9-36></a><a href=#__codelineno-9-36><span class=linenos data-linenos=" 36 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-9-37><a id=__codelineno-9-37 name=__codelineno-9-37></a><a href=#__codelineno-9-37><span class=linenos data-linenos=" 37 "></span></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-9-38><a id=__codelineno-9-38 name=__codelineno-9-38></a><a href=#__codelineno-9-38><span class=linenos data-linenos=" 38 "></span></a>
</span><span id=__span-9-39><a id=__codelineno-9-39 name=__codelineno-9-39></a><a href=#__codelineno-9-39><span class=linenos data-linenos=" 39 "></span></a><span class=w>  </span><span class=k>async</span><span class=w> </span><span class=nx>getUser</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>,</span><span class=w> </span><span class=nx>next</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-40><a id=__codelineno-9-40 name=__codelineno-9-40></a><a href=#__codelineno-9-40><span class=linenos data-linenos=" 40 "></span></a><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-41><a id=__codelineno-9-41 name=__codelineno-9-41></a><a href=#__codelineno-9-41><span class=linenos data-linenos=" 41 "></span></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>id</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>;</span>
</span><span id=__span-9-42><a id=__codelineno-9-42 name=__codelineno-9-42></a><a href=#__codelineno-9-42><span class=linenos data-linenos=" 42 "></span></a>
</span><span id=__span-9-43><a id=__codelineno-9-43 name=__codelineno-9-43></a><a href=#__codelineno-9-43><span class=linenos data-linenos=" 43 "></span></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>User</span><span class=p>.</span><span class=nx>findByPk</span><span class=p>(</span><span class=nx>id</span><span class=p>);</span>
</span><span id=__span-9-44><a id=__codelineno-9-44 name=__codelineno-9-44></a><a href=#__codelineno-9-44><span class=linenos data-linenos=" 44 "></span></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>user</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-45><a id=__codelineno-9-45 name=__codelineno-9-45></a><a href=#__codelineno-9-45><span class=linenos data-linenos=" 45 "></span></a><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>AppError</span><span class=p>(</span><span class=s1>&#39;User not found&#39;</span><span class=p>,</span><span class=w> </span><span class=mf>404</span><span class=p>);</span>
</span><span id=__span-9-46><a id=__codelineno-9-46 name=__codelineno-9-46></a><a href=#__codelineno-9-46><span class=linenos data-linenos=" 46 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-9-47><a id=__codelineno-9-47 name=__codelineno-9-47></a><a href=#__codelineno-9-47><span class=linenos data-linenos=" 47 "></span></a>
</span><span id=__span-9-48><a id=__codelineno-9-48 name=__codelineno-9-48></a><a href=#__codelineno-9-48><span class=linenos data-linenos=" 48 "></span></a><span class=w>      </span><span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span><span class=nx>user</span><span class=p>);</span>
</span><span id=__span-9-49><a id=__codelineno-9-49 name=__codelineno-9-49></a><a href=#__codelineno-9-49><span class=linenos data-linenos=" 49 "></span></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-50><a id=__codelineno-9-50 name=__codelineno-9-50></a><a href=#__codelineno-9-50><span class=linenos data-linenos=" 50 "></span></a><span class=w>      </span><span class=nx>next</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span><span id=__span-9-51><a id=__codelineno-9-51 name=__codelineno-9-51></a><a href=#__codelineno-9-51><span class=linenos data-linenos=" 51 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-9-52><a id=__codelineno-9-52 name=__codelineno-9-52></a><a href=#__codelineno-9-52><span class=linenos data-linenos=" 52 "></span></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-9-53><a id=__codelineno-9-53 name=__codelineno-9-53></a><a href=#__codelineno-9-53><span class=linenos data-linenos=" 53 "></span></a>
</span><span id=__span-9-54><a id=__codelineno-9-54 name=__codelineno-9-54></a><a href=#__codelineno-9-54><span class=linenos data-linenos=" 54 "></span></a><span class=w>  </span><span class=k>async</span><span class=w> </span><span class=nx>updateUser</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>,</span><span class=w> </span><span class=nx>next</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-55><a id=__codelineno-9-55 name=__codelineno-9-55></a><a href=#__codelineno-9-55><span class=linenos data-linenos=" 55 "></span></a><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-56><a id=__codelineno-9-56 name=__codelineno-9-56></a><a href=#__codelineno-9-56><span class=linenos data-linenos=" 56 "></span></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>id</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>;</span>
</span><span id=__span-9-57><a id=__codelineno-9-57 name=__codelineno-9-57></a><a href=#__codelineno-9-57><span class=linenos data-linenos=" 57 "></span></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>updates</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>;</span>
</span><span id=__span-9-58><a id=__codelineno-9-58 name=__codelineno-9-58></a><a href=#__codelineno-9-58><span class=linenos data-linenos=" 58 "></span></a>
</span><span id=__span-9-59><a id=__codelineno-9-59 name=__codelineno-9-59></a><a href=#__codelineno-9-59><span class=linenos data-linenos=" 59 "></span></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>User</span><span class=p>.</span><span class=nx>findByPk</span><span class=p>(</span><span class=nx>id</span><span class=p>);</span>
</span><span id=__span-9-60><a id=__codelineno-9-60 name=__codelineno-9-60></a><a href=#__codelineno-9-60><span class=linenos data-linenos=" 60 "></span></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>user</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-61><a id=__codelineno-9-61 name=__codelineno-9-61></a><a href=#__codelineno-9-61><span class=linenos data-linenos=" 61 "></span></a><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>AppError</span><span class=p>(</span><span class=s1>&#39;User not found&#39;</span><span class=p>,</span><span class=w> </span><span class=mf>404</span><span class=p>);</span>
</span><span id=__span-9-62><a id=__codelineno-9-62 name=__codelineno-9-62></a><a href=#__codelineno-9-62><span class=linenos data-linenos=" 62 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-9-63><a id=__codelineno-9-63 name=__codelineno-9-63></a><a href=#__codelineno-9-63><span class=linenos data-linenos=" 63 "></span></a>
</span><span id=__span-9-64><a id=__codelineno-9-64 name=__codelineno-9-64></a><a href=#__codelineno-9-64><span class=linenos data-linenos=" 64 "></span></a><span class=w>      </span><span class=c1>// Check authorization</span>
</span><span id=__span-9-65><a id=__codelineno-9-65 name=__codelineno-9-65></a><a href=#__codelineno-9-65><span class=linenos data-linenos=" 65 "></span></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=nx>id</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>.</span><span class=nx>role</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-66><a id=__codelineno-9-66 name=__codelineno-9-66></a><a href=#__codelineno-9-66><span class=linenos data-linenos=" 66 "></span></a><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>AppError</span><span class=p>(</span><span class=s1>&#39;Unauthorized&#39;</span><span class=p>,</span><span class=w> </span><span class=mf>403</span><span class=p>);</span>
</span><span id=__span-9-67><a id=__codelineno-9-67 name=__codelineno-9-67></a><a href=#__codelineno-9-67><span class=linenos data-linenos=" 67 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-9-68><a id=__codelineno-9-68 name=__codelineno-9-68></a><a href=#__codelineno-9-68><span class=linenos data-linenos=" 68 "></span></a>
</span><span id=__span-9-69><a id=__codelineno-9-69 name=__codelineno-9-69></a><a href=#__codelineno-9-69><span class=linenos data-linenos=" 69 "></span></a><span class=w>      </span><span class=c1>// Update user</span>
</span><span id=__span-9-70><a id=__codelineno-9-70 name=__codelineno-9-70></a><a href=#__codelineno-9-70><span class=linenos data-linenos=" 70 "></span></a><span class=w>      </span><span class=k>await</span><span class=w> </span><span class=nx>user</span><span class=p>.</span><span class=nx>update</span><span class=p>(</span><span class=nx>updates</span><span class=p>);</span>
</span><span id=__span-9-71><a id=__codelineno-9-71 name=__codelineno-9-71></a><a href=#__codelineno-9-71><span class=linenos data-linenos=" 71 "></span></a>
</span><span id=__span-9-72><a id=__codelineno-9-72 name=__codelineno-9-72></a><a href=#__codelineno-9-72><span class=linenos data-linenos=" 72 "></span></a><span class=w>      </span><span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span><span class=nx>user</span><span class=p>);</span>
</span><span id=__span-9-73><a id=__codelineno-9-73 name=__codelineno-9-73></a><a href=#__codelineno-9-73><span class=linenos data-linenos=" 73 "></span></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-74><a id=__codelineno-9-74 name=__codelineno-9-74></a><a href=#__codelineno-9-74><span class=linenos data-linenos=" 74 "></span></a><span class=w>      </span><span class=nx>next</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span><span id=__span-9-75><a id=__codelineno-9-75 name=__codelineno-9-75></a><a href=#__codelineno-9-75><span class=linenos data-linenos=" 75 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-9-76><a id=__codelineno-9-76 name=__codelineno-9-76></a><a href=#__codelineno-9-76><span class=linenos data-linenos=" 76 "></span></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-9-77><a id=__codelineno-9-77 name=__codelineno-9-77></a><a href=#__codelineno-9-77><span class=linenos data-linenos=" 77 "></span></a>
</span><span id=__span-9-78><a id=__codelineno-9-78 name=__codelineno-9-78></a><a href=#__codelineno-9-78><span class=linenos data-linenos=" 78 "></span></a><span class=w>  </span><span class=k>async</span><span class=w> </span><span class=nx>deleteUser</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>,</span><span class=w> </span><span class=nx>next</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-79><a id=__codelineno-9-79 name=__codelineno-9-79></a><a href=#__codelineno-9-79><span class=linenos data-linenos=" 79 "></span></a><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-80><a id=__codelineno-9-80 name=__codelineno-9-80></a><a href=#__codelineno-9-80><span class=linenos data-linenos=" 80 "></span></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>id</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>;</span>
</span><span id=__span-9-81><a id=__codelineno-9-81 name=__codelineno-9-81></a><a href=#__codelineno-9-81><span class=linenos data-linenos=" 81 "></span></a>
</span><span id=__span-9-82><a id=__codelineno-9-82 name=__codelineno-9-82></a><a href=#__codelineno-9-82><span class=linenos data-linenos=" 82 "></span></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>User</span><span class=p>.</span><span class=nx>findByPk</span><span class=p>(</span><span class=nx>id</span><span class=p>);</span>
</span><span id=__span-9-83><a id=__codelineno-9-83 name=__codelineno-9-83></a><a href=#__codelineno-9-83><span class=linenos data-linenos=" 83 "></span></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>user</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-84><a id=__codelineno-9-84 name=__codelineno-9-84></a><a href=#__codelineno-9-84><span class=linenos data-linenos=" 84 "></span></a><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>AppError</span><span class=p>(</span><span class=s1>&#39;User not found&#39;</span><span class=p>,</span><span class=w> </span><span class=mf>404</span><span class=p>);</span>
</span><span id=__span-9-85><a id=__codelineno-9-85 name=__codelineno-9-85></a><a href=#__codelineno-9-85><span class=linenos data-linenos=" 85 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-9-86><a id=__codelineno-9-86 name=__codelineno-9-86></a><a href=#__codelineno-9-86><span class=linenos data-linenos=" 86 "></span></a>
</span><span id=__span-9-87><a id=__codelineno-9-87 name=__codelineno-9-87></a><a href=#__codelineno-9-87><span class=linenos data-linenos=" 87 "></span></a><span class=w>      </span><span class=c1>// Check authorization</span>
</span><span id=__span-9-88><a id=__codelineno-9-88 name=__codelineno-9-88></a><a href=#__codelineno-9-88><span class=linenos data-linenos=" 88 "></span></a><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>.</span><span class=nx>role</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-89><a id=__codelineno-9-89 name=__codelineno-9-89></a><a href=#__codelineno-9-89><span class=linenos data-linenos=" 89 "></span></a><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>AppError</span><span class=p>(</span><span class=s1>&#39;Unauthorized&#39;</span><span class=p>,</span><span class=w> </span><span class=mf>403</span><span class=p>);</span>
</span><span id=__span-9-90><a id=__codelineno-9-90 name=__codelineno-9-90></a><a href=#__codelineno-9-90><span class=linenos data-linenos=" 90 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-9-91><a id=__codelineno-9-91 name=__codelineno-9-91></a><a href=#__codelineno-9-91><span class=linenos data-linenos=" 91 "></span></a>
</span><span id=__span-9-92><a id=__codelineno-9-92 name=__codelineno-9-92></a><a href=#__codelineno-9-92><span class=linenos data-linenos=" 92 "></span></a><span class=w>      </span><span class=k>await</span><span class=w> </span><span class=nx>user</span><span class=p>.</span><span class=nx>destroy</span><span class=p>();</span>
</span><span id=__span-9-93><a id=__codelineno-9-93 name=__codelineno-9-93></a><a href=#__codelineno-9-93><span class=linenos data-linenos=" 93 "></span></a>
</span><span id=__span-9-94><a id=__codelineno-9-94 name=__codelineno-9-94></a><a href=#__codelineno-9-94><span class=linenos data-linenos=" 94 "></span></a><span class=w>      </span><span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mf>204</span><span class=p>).</span><span class=nx>send</span><span class=p>();</span>
</span><span id=__span-9-95><a id=__codelineno-9-95 name=__codelineno-9-95></a><a href=#__codelineno-9-95><span class=linenos data-linenos=" 95 "></span></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-96><a id=__codelineno-9-96 name=__codelineno-9-96></a><a href=#__codelineno-9-96><span class=linenos data-linenos=" 96 "></span></a><span class=w>      </span><span class=nx>next</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span><span id=__span-9-97><a id=__codelineno-9-97 name=__codelineno-9-97></a><a href=#__codelineno-9-97><span class=linenos data-linenos=" 97 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-9-98><a id=__codelineno-9-98 name=__codelineno-9-98></a><a href=#__codelineno-9-98><span class=linenos data-linenos=" 98 "></span></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-9-99><a id=__codelineno-9-99 name=__codelineno-9-99></a><a href=#__codelineno-9-99><span class=linenos data-linenos=" 99 "></span></a><span class=p>}</span>
</span><span id=__span-9-100><a id=__codelineno-9-100 name=__codelineno-9-100></a><a href=#__codelineno-9-100><span class=linenos data-linenos="100 "></span></a>
</span><span id=__span-9-101><a id=__codelineno-9-101 name=__codelineno-9-101></a><a href=#__codelineno-9-101><span class=linenos data-linenos="101 "></span></a><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>UserController</span><span class=p>();</span>
</span></code></pre></div></p><h6 id=6-github-actions-cicd-integration>6. GitHub Actions CI/CD Integration<a class=headerlink href=#6-github-actions-cicd-integration title="Permanent link">&para;</a></h6><p><strong>.github/workflows/agent-workflow.yml:</strong><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1></a><a href=#__codelineno-10-1><span class=linenos data-linenos="  1 "></span></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AI Agent TDD Workflow</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2></a><a href=#__codelineno-10-2><span class=linenos data-linenos="  2 "></span></a>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3></a><a href=#__codelineno-10-3><span class=linenos data-linenos="  3 "></span></a><span class=nt>on</span><span class=p>:</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4></a><a href=#__codelineno-10-4><span class=linenos data-linenos="  4 "></span></a><span class=w>  </span><span class=nt>push</span><span class=p>:</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5></a><a href=#__codelineno-10-5><span class=linenos data-linenos="  5 "></span></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=nv>main</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>develop</span><span class=w> </span><span class="p p-Indicator">]</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6></a><a href=#__codelineno-10-6><span class=linenos data-linenos="  6 "></span></a><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7></a><a href=#__codelineno-10-7><span class=linenos data-linenos="  7 "></span></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=nv>main</span><span class=w> </span><span class="p p-Indicator">]</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8></a><a href=#__codelineno-10-8><span class=linenos data-linenos="  8 "></span></a>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9></a><a href=#__codelineno-10-9><span class=linenos data-linenos="  9 "></span></a><span class=nt>env</span><span class=p>:</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10></a><a href=#__codelineno-10-10><span class=linenos data-linenos=" 10 "></span></a><span class=w>  </span><span class=nt>NODE_ENV</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11></a><a href=#__codelineno-10-11><span class=linenos data-linenos=" 11 "></span></a><span class=w>  </span><span class=nt>DATABASE_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://postgres:postgres@localhost:5432/test_db</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12></a><a href=#__codelineno-10-12><span class=linenos data-linenos=" 12 "></span></a>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13></a><a href=#__codelineno-10-13><span class=linenos data-linenos=" 13 "></span></a><span class=nt>jobs</span><span class=p>:</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14></a><a href=#__codelineno-10-14><span class=linenos data-linenos=" 14 "></span></a><span class=w>  </span><span class=nt>tdd-validation</span><span class=p>:</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15></a><a href=#__codelineno-10-15><span class=linenos data-linenos=" 15 "></span></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16></a><a href=#__codelineno-10-16><span class=linenos data-linenos=" 16 "></span></a><span class=w>    </span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17></a><a href=#__codelineno-10-17><span class=linenos data-linenos=" 17 "></span></a><span class=w>    </span><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18></a><a href=#__codelineno-10-18><span class=linenos data-linenos=" 18 "></span></a><span class=w>      </span><span class=nt>postgres</span><span class=p>:</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19></a><a href=#__codelineno-10-19><span class=linenos data-linenos=" 19 "></span></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:14</span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20></a><a href=#__codelineno-10-20><span class=linenos data-linenos=" 20 "></span></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21></a><a href=#__codelineno-10-21><span class=linenos data-linenos=" 21 "></span></a><span class=w>          </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22></a><a href=#__codelineno-10-22><span class=linenos data-linenos=" 22 "></span></a><span class=w>          </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test_db</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23></a><a href=#__codelineno-10-23><span class=linenos data-linenos=" 23 "></span></a><span class=w>        </span><span class=nt>options</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">&gt;-</span>
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24></a><a href=#__codelineno-10-24><span class=linenos data-linenos=" 24 "></span></a><span class=w>          </span><span class=no>--health-cmd pg_isready</span>
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25></a><a href=#__codelineno-10-25><span class=linenos data-linenos=" 25 "></span></a><span class=w>          </span><span class=no>--health-interval 10s</span>
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26></a><a href=#__codelineno-10-26><span class=linenos data-linenos=" 26 "></span></a><span class=w>          </span><span class=no>--health-timeout 5s</span>
</span><span id=__span-10-27><a id=__codelineno-10-27 name=__codelineno-10-27></a><a href=#__codelineno-10-27><span class=linenos data-linenos=" 27 "></span></a><span class=w>          </span><span class=no>--health-retries 5</span>
</span><span id=__span-10-28><a id=__codelineno-10-28 name=__codelineno-10-28></a><a href=#__codelineno-10-28><span class=linenos data-linenos=" 28 "></span></a><span class=w>        </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-10-29><a id=__codelineno-10-29 name=__codelineno-10-29></a><a href=#__codelineno-10-29><span class=linenos data-linenos=" 29 "></span></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5432:5432</span>
</span><span id=__span-10-30><a id=__codelineno-10-30 name=__codelineno-10-30></a><a href=#__codelineno-10-30><span class=linenos data-linenos=" 30 "></span></a><span class=w>    </span>
</span><span id=__span-10-31><a id=__codelineno-10-31 name=__codelineno-10-31></a><a href=#__codelineno-10-31><span class=linenos data-linenos=" 31 "></span></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-10-32><a id=__codelineno-10-32 name=__codelineno-10-32></a><a href=#__codelineno-10-32><span class=linenos data-linenos=" 32 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id=__span-10-33><a id=__codelineno-10-33 name=__codelineno-10-33></a><a href=#__codelineno-10-33><span class=linenos data-linenos=" 33 "></span></a><span class=w>    </span>
</span><span id=__span-10-34><a id=__codelineno-10-34 name=__codelineno-10-34></a><a href=#__codelineno-10-34><span class=linenos data-linenos=" 34 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Setup Node.js</span>
</span><span id=__span-10-35><a id=__codelineno-10-35 name=__codelineno-10-35></a><a href=#__codelineno-10-35><span class=linenos data-linenos=" 35 "></span></a><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-node@v3</span>
</span><span id=__span-10-36><a id=__codelineno-10-36 name=__codelineno-10-36></a><a href=#__codelineno-10-36><span class=linenos data-linenos=" 36 "></span></a><span class=w>      </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-10-37><a id=__codelineno-10-37 name=__codelineno-10-37></a><a href=#__codelineno-10-37><span class=linenos data-linenos=" 37 "></span></a><span class=w>        </span><span class=nt>node-version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;18&#39;</span>
</span><span id=__span-10-38><a id=__codelineno-10-38 name=__codelineno-10-38></a><a href=#__codelineno-10-38><span class=linenos data-linenos=" 38 "></span></a><span class=w>        </span><span class=nt>cache</span><span class=p>:</span><span class=w> </span><span class=s>&#39;npm&#39;</span>
</span><span id=__span-10-39><a id=__codelineno-10-39 name=__codelineno-10-39></a><a href=#__codelineno-10-39><span class=linenos data-linenos=" 39 "></span></a><span class=w>        </span>
</span><span id=__span-10-40><a id=__codelineno-10-40 name=__codelineno-10-40></a><a href=#__codelineno-10-40><span class=linenos data-linenos=" 40 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
</span><span id=__span-10-41><a id=__codelineno-10-41 name=__codelineno-10-41></a><a href=#__codelineno-10-41><span class=linenos data-linenos=" 41 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">npm ci</span>
</span><span id=__span-10-42><a id=__codelineno-10-42 name=__codelineno-10-42></a><a href=#__codelineno-10-42><span class=linenos data-linenos=" 42 "></span></a><span class=w>      </span>
</span><span id=__span-10-43><a id=__codelineno-10-43 name=__codelineno-10-43></a><a href=#__codelineno-10-43><span class=linenos data-linenos=" 43 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run database migrations</span>
</span><span id=__span-10-44><a id=__codelineno-10-44 name=__codelineno-10-44></a><a href=#__codelineno-10-44><span class=linenos data-linenos=" 44 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">npm run migrate:test</span>
</span><span id=__span-10-45><a id=__codelineno-10-45 name=__codelineno-10-45></a><a href=#__codelineno-10-45><span class=linenos data-linenos=" 45 "></span></a><span class=w>      </span>
</span><span id=__span-10-46><a id=__codelineno-10-46 name=__codelineno-10-46></a><a href=#__codelineno-10-46><span class=linenos data-linenos=" 46 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Validate TDD cycles</span>
</span><span id=__span-10-47><a id=__codelineno-10-47 name=__codelineno-10-47></a><a href=#__codelineno-10-47><span class=linenos data-linenos=" 47 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-48><a id=__codelineno-10-48 name=__codelineno-10-48></a><a href=#__codelineno-10-48><span class=linenos data-linenos=" 48 "></span></a><span class=w>        </span><span class=no>npx agent-workflow validate --config config/agent-workflow.yml</span>
</span><span id=__span-10-49><a id=__codelineno-10-49 name=__codelineno-10-49></a><a href=#__codelineno-10-49><span class=linenos data-linenos=" 49 "></span></a><span class=w>        </span>
</span><span id=__span-10-50><a id=__codelineno-10-50 name=__codelineno-10-50></a><a href=#__codelineno-10-50><span class=linenos data-linenos=" 50 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run TDD tests with coverage</span>
</span><span id=__span-10-51><a id=__codelineno-10-51 name=__codelineno-10-51></a><a href=#__codelineno-10-51><span class=linenos data-linenos=" 51 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-52><a id=__codelineno-10-52 name=__codelineno-10-52></a><a href=#__codelineno-10-52><span class=linenos data-linenos=" 52 "></span></a><span class=w>        </span><span class=no>npm run test:tdd -- --coverage --coverageDirectory=coverage/tdd</span>
</span><span id=__span-10-53><a id=__codelineno-10-53 name=__codelineno-10-53></a><a href=#__codelineno-10-53><span class=linenos data-linenos=" 53 "></span></a><span class=w>        </span>
</span><span id=__span-10-54><a id=__codelineno-10-54 name=__codelineno-10-54></a><a href=#__codelineno-10-54><span class=linenos data-linenos=" 54 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run all tests</span>
</span><span id=__span-10-55><a id=__codelineno-10-55 name=__codelineno-10-55></a><a href=#__codelineno-10-55><span class=linenos data-linenos=" 55 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-56><a id=__codelineno-10-56 name=__codelineno-10-56></a><a href=#__codelineno-10-56><span class=linenos data-linenos=" 56 "></span></a><span class=w>        </span><span class=no>npm test -- --coverage --coverageReporters=json,lcov,text</span>
</span><span id=__span-10-57><a id=__codelineno-10-57 name=__codelineno-10-57></a><a href=#__codelineno-10-57><span class=linenos data-linenos=" 57 "></span></a><span class=w>        </span>
</span><span id=__span-10-58><a id=__codelineno-10-58 name=__codelineno-10-58></a><a href=#__codelineno-10-58><span class=linenos data-linenos=" 58 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Upload coverage to Codecov</span>
</span><span id=__span-10-59><a id=__codelineno-10-59 name=__codelineno-10-59></a><a href=#__codelineno-10-59><span class=linenos data-linenos=" 59 "></span></a><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">codecov/codecov-action@v3</span>
</span><span id=__span-10-60><a id=__codelineno-10-60 name=__codelineno-10-60></a><a href=#__codelineno-10-60><span class=linenos data-linenos=" 60 "></span></a><span class=w>      </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-10-61><a id=__codelineno-10-61 name=__codelineno-10-61></a><a href=#__codelineno-10-61><span class=linenos data-linenos=" 61 "></span></a><span class=w>        </span><span class=nt>files</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./coverage/lcov.info</span>
</span><span id=__span-10-62><a id=__codelineno-10-62 name=__codelineno-10-62></a><a href=#__codelineno-10-62><span class=linenos data-linenos=" 62 "></span></a><span class=w>        </span><span class=nt>flags</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">unittests</span>
</span><span id=__span-10-63><a id=__codelineno-10-63 name=__codelineno-10-63></a><a href=#__codelineno-10-63><span class=linenos data-linenos=" 63 "></span></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">codecov-umbrella</span>
</span><span id=__span-10-64><a id=__codelineno-10-64 name=__codelineno-10-64></a><a href=#__codelineno-10-64><span class=linenos data-linenos=" 64 "></span></a><span class=w>        </span>
</span><span id=__span-10-65><a id=__codelineno-10-65 name=__codelineno-10-65></a><a href=#__codelineno-10-65><span class=linenos data-linenos=" 65 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Check coverage thresholds</span>
</span><span id=__span-10-66><a id=__codelineno-10-66 name=__codelineno-10-66></a><a href=#__codelineno-10-66><span class=linenos data-linenos=" 66 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-67><a id=__codelineno-10-67 name=__codelineno-10-67></a><a href=#__codelineno-10-67><span class=linenos data-linenos=" 67 "></span></a><span class=w>        </span><span class=no>npx nyc check-coverage --lines 85 --functions 85 --branches 80</span>
</span><span id=__span-10-68><a id=__codelineno-10-68 name=__codelineno-10-68></a><a href=#__codelineno-10-68><span class=linenos data-linenos=" 68 "></span></a><span class=w>        </span>
</span><span id=__span-10-69><a id=__codelineno-10-69 name=__codelineno-10-69></a><a href=#__codelineno-10-69><span class=linenos data-linenos=" 69 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Lint code</span>
</span><span id=__span-10-70><a id=__codelineno-10-70 name=__codelineno-10-70></a><a href=#__codelineno-10-70><span class=linenos data-linenos=" 70 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">npm run lint</span>
</span><span id=__span-10-71><a id=__codelineno-10-71 name=__codelineno-10-71></a><a href=#__codelineno-10-71><span class=linenos data-linenos=" 71 "></span></a><span class=w>      </span>
</span><span id=__span-10-72><a id=__codelineno-10-72 name=__codelineno-10-72></a><a href=#__codelineno-10-72><span class=linenos data-linenos=" 72 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Security audit</span>
</span><span id=__span-10-73><a id=__codelineno-10-73 name=__codelineno-10-73></a><a href=#__codelineno-10-73><span class=linenos data-linenos=" 73 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">npm audit --audit-level=moderate</span>
</span><span id=__span-10-74><a id=__codelineno-10-74 name=__codelineno-10-74></a><a href=#__codelineno-10-74><span class=linenos data-linenos=" 74 "></span></a>
</span><span id=__span-10-75><a id=__codelineno-10-75 name=__codelineno-10-75></a><a href=#__codelineno-10-75><span class=linenos data-linenos=" 75 "></span></a><span class=w>  </span><span class=nt>integration-tests</span><span class=p>:</span>
</span><span id=__span-10-76><a id=__codelineno-10-76 name=__codelineno-10-76></a><a href=#__codelineno-10-76><span class=linenos data-linenos=" 76 "></span></a><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tdd-validation</span>
</span><span id=__span-10-77><a id=__codelineno-10-77 name=__codelineno-10-77></a><a href=#__codelineno-10-77><span class=linenos data-linenos=" 77 "></span></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-10-78><a id=__codelineno-10-78 name=__codelineno-10-78></a><a href=#__codelineno-10-78><span class=linenos data-linenos=" 78 "></span></a><span class=w>    </span>
</span><span id=__span-10-79><a id=__codelineno-10-79 name=__codelineno-10-79></a><a href=#__codelineno-10-79><span class=linenos data-linenos=" 79 "></span></a><span class=w>    </span><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-10-80><a id=__codelineno-10-80 name=__codelineno-10-80></a><a href=#__codelineno-10-80><span class=linenos data-linenos=" 80 "></span></a><span class=w>      </span><span class=nt>postgres</span><span class=p>:</span>
</span><span id=__span-10-81><a id=__codelineno-10-81 name=__codelineno-10-81></a><a href=#__codelineno-10-81><span class=linenos data-linenos=" 81 "></span></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:14</span>
</span><span id=__span-10-82><a id=__codelineno-10-82 name=__codelineno-10-82></a><a href=#__codelineno-10-82><span class=linenos data-linenos=" 82 "></span></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span>
</span><span id=__span-10-83><a id=__codelineno-10-83 name=__codelineno-10-83></a><a href=#__codelineno-10-83><span class=linenos data-linenos=" 83 "></span></a><span class=w>          </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span id=__span-10-84><a id=__codelineno-10-84 name=__codelineno-10-84></a><a href=#__codelineno-10-84><span class=linenos data-linenos=" 84 "></span></a><span class=w>          </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test_db</span>
</span><span id=__span-10-85><a id=__codelineno-10-85 name=__codelineno-10-85></a><a href=#__codelineno-10-85><span class=linenos data-linenos=" 85 "></span></a><span class=w>        </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-10-86><a id=__codelineno-10-86 name=__codelineno-10-86></a><a href=#__codelineno-10-86><span class=linenos data-linenos=" 86 "></span></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5432:5432</span>
</span><span id=__span-10-87><a id=__codelineno-10-87 name=__codelineno-10-87></a><a href=#__codelineno-10-87><span class=linenos data-linenos=" 87 "></span></a><span class=w>      </span>
</span><span id=__span-10-88><a id=__codelineno-10-88 name=__codelineno-10-88></a><a href=#__codelineno-10-88><span class=linenos data-linenos=" 88 "></span></a><span class=w>      </span><span class=nt>redis</span><span class=p>:</span>
</span><span id=__span-10-89><a id=__codelineno-10-89 name=__codelineno-10-89></a><a href=#__codelineno-10-89><span class=linenos data-linenos=" 89 "></span></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis:7</span>
</span><span id=__span-10-90><a id=__codelineno-10-90 name=__codelineno-10-90></a><a href=#__codelineno-10-90><span class=linenos data-linenos=" 90 "></span></a><span class=w>        </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-10-91><a id=__codelineno-10-91 name=__codelineno-10-91></a><a href=#__codelineno-10-91><span class=linenos data-linenos=" 91 "></span></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">6379:6379</span>
</span><span id=__span-10-92><a id=__codelineno-10-92 name=__codelineno-10-92></a><a href=#__codelineno-10-92><span class=linenos data-linenos=" 92 "></span></a><span class=w>    </span>
</span><span id=__span-10-93><a id=__codelineno-10-93 name=__codelineno-10-93></a><a href=#__codelineno-10-93><span class=linenos data-linenos=" 93 "></span></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-10-94><a id=__codelineno-10-94 name=__codelineno-10-94></a><a href=#__codelineno-10-94><span class=linenos data-linenos=" 94 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id=__span-10-95><a id=__codelineno-10-95 name=__codelineno-10-95></a><a href=#__codelineno-10-95><span class=linenos data-linenos=" 95 "></span></a><span class=w>    </span>
</span><span id=__span-10-96><a id=__codelineno-10-96 name=__codelineno-10-96></a><a href=#__codelineno-10-96><span class=linenos data-linenos=" 96 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Setup Node.js</span>
</span><span id=__span-10-97><a id=__codelineno-10-97 name=__codelineno-10-97></a><a href=#__codelineno-10-97><span class=linenos data-linenos=" 97 "></span></a><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-node@v3</span>
</span><span id=__span-10-98><a id=__codelineno-10-98 name=__codelineno-10-98></a><a href=#__codelineno-10-98><span class=linenos data-linenos=" 98 "></span></a><span class=w>      </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-10-99><a id=__codelineno-10-99 name=__codelineno-10-99></a><a href=#__codelineno-10-99><span class=linenos data-linenos=" 99 "></span></a><span class=w>        </span><span class=nt>node-version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;18&#39;</span>
</span><span id=__span-10-100><a id=__codelineno-10-100 name=__codelineno-10-100></a><a href=#__codelineno-10-100><span class=linenos data-linenos="100 "></span></a><span class=w>        </span>
</span><span id=__span-10-101><a id=__codelineno-10-101 name=__codelineno-10-101></a><a href=#__codelineno-10-101><span class=linenos data-linenos="101 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
</span><span id=__span-10-102><a id=__codelineno-10-102 name=__codelineno-10-102></a><a href=#__codelineno-10-102><span class=linenos data-linenos="102 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">npm ci</span>
</span><span id=__span-10-103><a id=__codelineno-10-103 name=__codelineno-10-103></a><a href=#__codelineno-10-103><span class=linenos data-linenos="103 "></span></a><span class=w>      </span>
</span><span id=__span-10-104><a id=__codelineno-10-104 name=__codelineno-10-104></a><a href=#__codelineno-10-104><span class=linenos data-linenos="104 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run integration tests</span>
</span><span id=__span-10-105><a id=__codelineno-10-105 name=__codelineno-10-105></a><a href=#__codelineno-10-105><span class=linenos data-linenos="105 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">npm run test:integration</span>
</span><span id=__span-10-106><a id=__codelineno-10-106 name=__codelineno-10-106></a><a href=#__codelineno-10-106><span class=linenos data-linenos="106 "></span></a><span class=w>      </span><span class=nt>env</span><span class=p>:</span>
</span><span id=__span-10-107><a id=__codelineno-10-107 name=__codelineno-10-107></a><a href=#__codelineno-10-107><span class=linenos data-linenos="107 "></span></a><span class=w>        </span><span class=nt>REDIS_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis://localhost:6379</span>
</span><span id=__span-10-108><a id=__codelineno-10-108 name=__codelineno-10-108></a><a href=#__codelineno-10-108><span class=linenos data-linenos="108 "></span></a><span class=w>        </span>
</span><span id=__span-10-109><a id=__codelineno-10-109 name=__codelineno-10-109></a><a href=#__codelineno-10-109><span class=linenos data-linenos="109 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run E2E tests</span>
</span><span id=__span-10-110><a id=__codelineno-10-110 name=__codelineno-10-110></a><a href=#__codelineno-10-110><span class=linenos data-linenos="110 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">npm run test:e2e</span>
</span><span id=__span-10-111><a id=__codelineno-10-111 name=__codelineno-10-111></a><a href=#__codelineno-10-111><span class=linenos data-linenos="111 "></span></a><span class=w>      </span>
</span><span id=__span-10-112><a id=__codelineno-10-112 name=__codelineno-10-112></a><a href=#__codelineno-10-112><span class=linenos data-linenos="112 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Performance benchmarks</span>
</span><span id=__span-10-113><a id=__codelineno-10-113 name=__codelineno-10-113></a><a href=#__codelineno-10-113><span class=linenos data-linenos="113 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">npm run test:performance</span>
</span><span id=__span-10-114><a id=__codelineno-10-114 name=__codelineno-10-114></a><a href=#__codelineno-10-114><span class=linenos data-linenos="114 "></span></a><span class=w>      </span>
</span><span id=__span-10-115><a id=__codelineno-10-115 name=__codelineno-10-115></a><a href=#__codelineno-10-115><span class=linenos data-linenos="115 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Upload test results</span>
</span><span id=__span-10-116><a id=__codelineno-10-116 name=__codelineno-10-116></a><a href=#__codelineno-10-116><span class=linenos data-linenos="116 "></span></a><span class=w>      </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">always()</span>
</span><span id=__span-10-117><a id=__codelineno-10-117 name=__codelineno-10-117></a><a href=#__codelineno-10-117><span class=linenos data-linenos="117 "></span></a><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/upload-artifact@v3</span>
</span><span id=__span-10-118><a id=__codelineno-10-118 name=__codelineno-10-118></a><a href=#__codelineno-10-118><span class=linenos data-linenos="118 "></span></a><span class=w>      </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-10-119><a id=__codelineno-10-119 name=__codelineno-10-119></a><a href=#__codelineno-10-119><span class=linenos data-linenos="119 "></span></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-results</span>
</span><span id=__span-10-120><a id=__codelineno-10-120 name=__codelineno-10-120></a><a href=#__codelineno-10-120><span class=linenos data-linenos="120 "></span></a><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-121><a id=__codelineno-10-121 name=__codelineno-10-121></a><a href=#__codelineno-10-121><span class=linenos data-linenos="121 "></span></a><span class=w>          </span><span class=no>coverage/</span>
</span><span id=__span-10-122><a id=__codelineno-10-122 name=__codelineno-10-122></a><a href=#__codelineno-10-122><span class=linenos data-linenos="122 "></span></a><span class=w>          </span><span class=no>test-results/</span>
</span><span id=__span-10-123><a id=__codelineno-10-123 name=__codelineno-10-123></a><a href=#__codelineno-10-123><span class=linenos data-linenos="123 "></span></a><span class=w>          </span><span class=no>performance-results.json</span>
</span><span id=__span-10-124><a id=__codelineno-10-124 name=__codelineno-10-124></a><a href=#__codelineno-10-124><span class=linenos data-linenos="124 "></span></a>
</span><span id=__span-10-125><a id=__codelineno-10-125 name=__codelineno-10-125></a><a href=#__codelineno-10-125><span class=linenos data-linenos="125 "></span></a><span class=w>  </span><span class=nt>build-and-deploy</span><span class=p>:</span>
</span><span id=__span-10-126><a id=__codelineno-10-126 name=__codelineno-10-126></a><a href=#__codelineno-10-126><span class=linenos data-linenos="126 "></span></a><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>tdd-validation</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>integration-tests</span><span class="p p-Indicator">]</span>
</span><span id=__span-10-127><a id=__codelineno-10-127 name=__codelineno-10-127></a><a href=#__codelineno-10-127><span class=linenos data-linenos="127 "></span></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-10-128><a id=__codelineno-10-128 name=__codelineno-10-128></a><a href=#__codelineno-10-128><span class=linenos data-linenos="128 "></span></a><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">github.ref == &#39;refs/heads/main&#39;</span>
</span><span id=__span-10-129><a id=__codelineno-10-129 name=__codelineno-10-129></a><a href=#__codelineno-10-129><span class=linenos data-linenos="129 "></span></a><span class=w>    </span>
</span><span id=__span-10-130><a id=__codelineno-10-130 name=__codelineno-10-130></a><a href=#__codelineno-10-130><span class=linenos data-linenos="130 "></span></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-10-131><a id=__codelineno-10-131 name=__codelineno-10-131></a><a href=#__codelineno-10-131><span class=linenos data-linenos="131 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id=__span-10-132><a id=__codelineno-10-132 name=__codelineno-10-132></a><a href=#__codelineno-10-132><span class=linenos data-linenos="132 "></span></a><span class=w>    </span>
</span><span id=__span-10-133><a id=__codelineno-10-133 name=__codelineno-10-133></a><a href=#__codelineno-10-133><span class=linenos data-linenos="133 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Build Docker image</span>
</span><span id=__span-10-134><a id=__codelineno-10-134 name=__codelineno-10-134></a><a href=#__codelineno-10-134><span class=linenos data-linenos="134 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-135><a id=__codelineno-10-135 name=__codelineno-10-135></a><a href=#__codelineno-10-135><span class=linenos data-linenos="135 "></span></a><span class=w>        </span><span class=no>docker build -t express-api-tdd:${{ github.sha }} .</span>
</span><span id=__span-10-136><a id=__codelineno-10-136 name=__codelineno-10-136></a><a href=#__codelineno-10-136><span class=linenos data-linenos="136 "></span></a><span class=w>        </span>
</span><span id=__span-10-137><a id=__codelineno-10-137 name=__codelineno-10-137></a><a href=#__codelineno-10-137><span class=linenos data-linenos="137 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Push to registry</span>
</span><span id=__span-10-138><a id=__codelineno-10-138 name=__codelineno-10-138></a><a href=#__codelineno-10-138><span class=linenos data-linenos="138 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-139><a id=__codelineno-10-139 name=__codelineno-10-139></a><a href=#__codelineno-10-139><span class=linenos data-linenos="139 "></span></a><span class=w>        </span><span class=no>echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin</span>
</span><span id=__span-10-140><a id=__codelineno-10-140 name=__codelineno-10-140></a><a href=#__codelineno-10-140><span class=linenos data-linenos="140 "></span></a><span class=w>        </span><span class=no>docker tag express-api-tdd:${{ github.sha }} ${{ secrets.DOCKER_USERNAME }}/express-api-tdd:latest</span>
</span><span id=__span-10-141><a id=__codelineno-10-141 name=__codelineno-10-141></a><a href=#__codelineno-10-141><span class=linenos data-linenos="141 "></span></a><span class=w>        </span><span class=no>docker push ${{ secrets.DOCKER_USERNAME }}/express-api-tdd:latest</span>
</span><span id=__span-10-142><a id=__codelineno-10-142 name=__codelineno-10-142></a><a href=#__codelineno-10-142><span class=linenos data-linenos="142 "></span></a><span class=w>        </span>
</span><span id=__span-10-143><a id=__codelineno-10-143 name=__codelineno-10-143></a><a href=#__codelineno-10-143><span class=linenos data-linenos="143 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deploy to production</span>
</span><span id=__span-10-144><a id=__codelineno-10-144 name=__codelineno-10-144></a><a href=#__codelineno-10-144><span class=linenos data-linenos="144 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-145><a id=__codelineno-10-145 name=__codelineno-10-145></a><a href=#__codelineno-10-145><span class=linenos data-linenos="145 "></span></a><span class=w>        </span><span class=no># Deploy to your cloud provider</span>
</span><span id=__span-10-146><a id=__codelineno-10-146 name=__codelineno-10-146></a><a href=#__codelineno-10-146><span class=linenos data-linenos="146 "></span></a><span class=w>        </span><span class=no>echo &quot;Deploying to production...&quot;</span>
</span><span id=__span-10-147><a id=__codelineno-10-147 name=__codelineno-10-147></a><a href=#__codelineno-10-147><span class=linenos data-linenos="147 "></span></a><span class=w>        </span>
</span><span id=__span-10-148><a id=__codelineno-10-148 name=__codelineno-10-148></a><a href=#__codelineno-10-148><span class=linenos data-linenos="148 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Notify Discord</span>
</span><span id=__span-10-149><a id=__codelineno-10-149 name=__codelineno-10-149></a><a href=#__codelineno-10-149><span class=linenos data-linenos="149 "></span></a><span class=w>      </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">always()</span>
</span><span id=__span-10-150><a id=__codelineno-10-150 name=__codelineno-10-150></a><a href=#__codelineno-10-150><span class=linenos data-linenos="150 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-151><a id=__codelineno-10-151 name=__codelineno-10-151></a><a href=#__codelineno-10-151><span class=linenos data-linenos="151 "></span></a><span class=w>        </span><span class=no>curl -X POST ${{ secrets.DISCORD_WEBHOOK }} \</span>
</span><span id=__span-10-152><a id=__codelineno-10-152 name=__codelineno-10-152></a><a href=#__codelineno-10-152><span class=linenos data-linenos="152 "></span></a><span class=w>          </span><span class=no>-H &quot;Content-Type: application/json&quot; \</span>
</span><span id=__span-10-153><a id=__codelineno-10-153 name=__codelineno-10-153></a><a href=#__codelineno-10-153><span class=linenos data-linenos="153 "></span></a><span class=w>          </span><span class=no>-d &#39;{</span>
</span><span id=__span-10-154><a id=__codelineno-10-154 name=__codelineno-10-154></a><a href=#__codelineno-10-154><span class=linenos data-linenos="154 "></span></a><span class=w>            </span><span class=no>&quot;content&quot;: &quot;Deployment completed for Express API TDD&quot;,</span>
</span><span id=__span-10-155><a id=__codelineno-10-155 name=__codelineno-10-155></a><a href=#__codelineno-10-155><span class=linenos data-linenos="155 "></span></a><span class=w>            </span><span class=no>&quot;embeds&quot;: [{</span>
</span><span id=__span-10-156><a id=__codelineno-10-156 name=__codelineno-10-156></a><a href=#__codelineno-10-156><span class=linenos data-linenos="156 "></span></a><span class=w>              </span><span class=no>&quot;title&quot;: &quot;Build #${{ github.run_number }}&quot;,</span>
</span><span id=__span-10-157><a id=__codelineno-10-157 name=__codelineno-10-157></a><a href=#__codelineno-10-157><span class=linenos data-linenos="157 "></span></a><span class=w>              </span><span class=no>&quot;color&quot;: 3066993,</span>
</span><span id=__span-10-158><a id=__codelineno-10-158 name=__codelineno-10-158></a><a href=#__codelineno-10-158><span class=linenos data-linenos="158 "></span></a><span class=w>              </span><span class=no>&quot;fields&quot;: [</span>
</span><span id=__span-10-159><a id=__codelineno-10-159 name=__codelineno-10-159></a><a href=#__codelineno-10-159><span class=linenos data-linenos="159 "></span></a><span class=w>                </span><span class=no>{&quot;name&quot;: &quot;Status&quot;, &quot;value&quot;: &quot;${{ job.status }}&quot;, &quot;inline&quot;: true},</span>
</span><span id=__span-10-160><a id=__codelineno-10-160 name=__codelineno-10-160></a><a href=#__codelineno-10-160><span class=linenos data-linenos="160 "></span></a><span class=w>                </span><span class=no>{&quot;name&quot;: &quot;Branch&quot;, &quot;value&quot;: &quot;${{ github.ref }}&quot;, &quot;inline&quot;: true},</span>
</span><span id=__span-10-161><a id=__codelineno-10-161 name=__codelineno-10-161></a><a href=#__codelineno-10-161><span class=linenos data-linenos="161 "></span></a><span class=w>                </span><span class=no>{&quot;name&quot;: &quot;Commit&quot;, &quot;value&quot;: &quot;${{ github.sha }}&quot;, &quot;inline&quot;: true}</span>
</span><span id=__span-10-162><a id=__codelineno-10-162 name=__codelineno-10-162></a><a href=#__codelineno-10-162><span class=linenos data-linenos="162 "></span></a><span class=w>              </span><span class=no>]</span>
</span><span id=__span-10-163><a id=__codelineno-10-163 name=__codelineno-10-163></a><a href=#__codelineno-10-163><span class=linenos data-linenos="163 "></span></a><span class=w>            </span><span class=no>}]</span>
</span><span id=__span-10-164><a id=__codelineno-10-164 name=__codelineno-10-164></a><a href=#__codelineno-10-164><span class=linenos data-linenos="164 "></span></a><span class=w>          </span><span class=no>}&#39;</span>
</span></code></pre></div></p><h6 id=7-performance-benchmarks>7. Performance Benchmarks<a class=headerlink href=#7-performance-benchmarks title="Permanent link">&para;</a></h6><p><strong>Performance test results for the Express API:</strong><div class="language-javascript highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1></a><a href=#__codelineno-11-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1>// tests/performance/api-benchmarks.js</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2></a><a href=#__codelineno-11-2><span class=linenos data-linenos=" 2 "></span></a><span class=kd>const</span><span class=w> </span><span class=nx>autocannon</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;autocannon&#39;</span><span class=p>);</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3></a><a href=#__codelineno-11-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4></a><a href=#__codelineno-11-4><span class=linenos data-linenos=" 4 "></span></a><span class=kd>const</span><span class=w> </span><span class=nx>results</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5></a><a href=#__codelineno-11-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span><span class=s1>&#39;POST /api/users&#39;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6></a><a href=#__codelineno-11-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>    </span><span class=nx>requests</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7></a><a href=#__codelineno-11-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>      </span><span class=nx>average</span><span class=o>:</span><span class=w> </span><span class=mf>850</span><span class=p>,</span><span class=w>  </span><span class=c1>// requests per second</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8></a><a href=#__codelineno-11-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>      </span><span class=nx>stddev</span><span class=o>:</span><span class=w> </span><span class=mf>45</span><span class=p>,</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9></a><a href=#__codelineno-11-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>      </span><span class=nx>max</span><span class=o>:</span><span class=w> </span><span class=mf>1200</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10></a><a href=#__codelineno-11-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11></a><a href=#__codelineno-11-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span><span class=nx>latency</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12></a><a href=#__codelineno-11-12><span class=linenos data-linenos="12 "></span></a><span class=w>      </span><span class=nx>average</span><span class=o>:</span><span class=w> </span><span class=mf>12</span><span class=p>,</span><span class=w>   </span><span class=c1>// milliseconds</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13></a><a href=#__codelineno-11-13><span class=linenos data-linenos="13 "></span></a><span class=w>      </span><span class=nx>stddev</span><span class=o>:</span><span class=w> </span><span class=mf>3.2</span><span class=p>,</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14></a><a href=#__codelineno-11-14><span class=linenos data-linenos="14 "></span></a><span class=w>      </span><span class=nx>p95</span><span class=o>:</span><span class=w> </span><span class=mf>18</span><span class=p>,</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15></a><a href=#__codelineno-11-15><span class=linenos data-linenos="15 "></span></a><span class=w>      </span><span class=nx>p99</span><span class=o>:</span><span class=w> </span><span class=mf>25</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16></a><a href=#__codelineno-11-16><span class=linenos data-linenos="16 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17></a><a href=#__codelineno-11-17><span class=linenos data-linenos="17 "></span></a><span class=w>    </span><span class=nx>throughput</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18></a><a href=#__codelineno-11-18><span class=linenos data-linenos="18 "></span></a><span class=w>      </span><span class=nx>average</span><span class=o>:</span><span class=w> </span><span class=mf>2.1</span><span class=p>,</span><span class=w>  </span><span class=c1>// MB/sec</span>
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19></a><a href=#__codelineno-11-19><span class=linenos data-linenos="19 "></span></a><span class=w>      </span><span class=nx>total</span><span class=o>:</span><span class=w> </span><span class=mf>126</span><span class=w>     </span><span class=c1>// MB</span>
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20></a><a href=#__codelineno-11-20><span class=linenos data-linenos="20 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-11-21><a id=__codelineno-11-21 name=__codelineno-11-21></a><a href=#__codelineno-11-21><span class=linenos data-linenos="21 "></span></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-11-22><a id=__codelineno-11-22 name=__codelineno-11-22></a><a href=#__codelineno-11-22><span class=linenos data-linenos="22 "></span></a><span class=w>  </span><span class=s1>&#39;GET /api/users/:id&#39;</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-23><a id=__codelineno-11-23 name=__codelineno-11-23></a><a href=#__codelineno-11-23><span class=linenos data-linenos="23 "></span></a><span class=w>    </span><span class=nx>requests</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-24><a id=__codelineno-11-24 name=__codelineno-11-24></a><a href=#__codelineno-11-24><span class=linenos data-linenos="24 "></span></a><span class=w>      </span><span class=nx>average</span><span class=o>:</span><span class=w> </span><span class=mf>2800</span><span class=p>,</span>
</span><span id=__span-11-25><a id=__codelineno-11-25 name=__codelineno-11-25></a><a href=#__codelineno-11-25><span class=linenos data-linenos="25 "></span></a><span class=w>      </span><span class=nx>stddev</span><span class=o>:</span><span class=w> </span><span class=mf>120</span><span class=p>,</span>
</span><span id=__span-11-26><a id=__codelineno-11-26 name=__codelineno-11-26></a><a href=#__codelineno-11-26><span class=linenos data-linenos="26 "></span></a><span class=w>      </span><span class=nx>max</span><span class=o>:</span><span class=w> </span><span class=mf>3500</span>
</span><span id=__span-11-27><a id=__codelineno-11-27 name=__codelineno-11-27></a><a href=#__codelineno-11-27><span class=linenos data-linenos="27 "></span></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-11-28><a id=__codelineno-11-28 name=__codelineno-11-28></a><a href=#__codelineno-11-28><span class=linenos data-linenos="28 "></span></a><span class=w>    </span><span class=nx>latency</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-29><a id=__codelineno-11-29 name=__codelineno-11-29></a><a href=#__codelineno-11-29><span class=linenos data-linenos="29 "></span></a><span class=w>      </span><span class=nx>average</span><span class=o>:</span><span class=w> </span><span class=mf>3.5</span><span class=p>,</span>
</span><span id=__span-11-30><a id=__codelineno-11-30 name=__codelineno-11-30></a><a href=#__codelineno-11-30><span class=linenos data-linenos="30 "></span></a><span class=w>      </span><span class=nx>stddev</span><span class=o>:</span><span class=w> </span><span class=mf>1.1</span><span class=p>,</span>
</span><span id=__span-11-31><a id=__codelineno-11-31 name=__codelineno-11-31></a><a href=#__codelineno-11-31><span class=linenos data-linenos="31 "></span></a><span class=w>      </span><span class=nx>p95</span><span class=o>:</span><span class=w> </span><span class=mf>5</span><span class=p>,</span>
</span><span id=__span-11-32><a id=__codelineno-11-32 name=__codelineno-11-32></a><a href=#__codelineno-11-32><span class=linenos data-linenos="32 "></span></a><span class=w>      </span><span class=nx>p99</span><span class=o>:</span><span class=w> </span><span class=mf>8</span>
</span><span id=__span-11-33><a id=__codelineno-11-33 name=__codelineno-11-33></a><a href=#__codelineno-11-33><span class=linenos data-linenos="33 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-11-34><a id=__codelineno-11-34 name=__codelineno-11-34></a><a href=#__codelineno-11-34><span class=linenos data-linenos="34 "></span></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-11-35><a id=__codelineno-11-35 name=__codelineno-11-35></a><a href=#__codelineno-11-35><span class=linenos data-linenos="35 "></span></a><span class=p>};</span>
</span></code></pre></div></p><h3 id=cli-tool-project>CLI Tool Project<a class=headerlink href=#cli-tool-project title="Permanent link">&para;</a></h3><h4 id=building-a-command-line-tool-with-tdd>Building a Command-Line Tool with TDD<a class=headerlink href=#building-a-command-line-tool-with-tdd title="Permanent link">&para;</a></h4><p>A comprehensive example of developing a CLI tool using the AI Agent TDD-Scrum workflow. This project demonstrates building a productivity tool with subcommands, configuration management, and plugin architecture.</p><p><strong>Project Repository:</strong> <a href=https://github.com/agent-workflow-examples/taskmaster-cli>github.com/agent-workflow-examples/taskmaster-cli</a></p><h5 id=project-overview>Project Overview<a class=headerlink href=#project-overview title="Permanent link">&para;</a></h5><p>TaskMaster CLI - A powerful task management tool built with TDD methodology, featuring: - Task creation, tracking, and completion - Project organization with tags and priorities - Time tracking and reporting - Plugin system for extensibility - Cloud sync capabilities</p><h5 id=project-structure_1>Project Structure<a class=headerlink href=#project-structure_1 title="Permanent link">&para;</a></h5><div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1></a><a href=#__codelineno-12-1><span class=linenos data-linenos=" 1 "></span></a>taskmaster-cli/
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2></a><a href=#__codelineno-12-2><span class=linenos data-linenos=" 2 "></span></a>├── .github/
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3></a><a href=#__codelineno-12-3><span class=linenos data-linenos=" 3 "></span></a>│   └── workflows/
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4></a><a href=#__codelineno-12-4><span class=linenos data-linenos=" 4 "></span></a>│       ├── release.yml              # Automated releases
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5></a><a href=#__codelineno-12-5><span class=linenos data-linenos=" 5 "></span></a>│       └── test.yml                 # CI/CD pipeline
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6></a><a href=#__codelineno-12-6><span class=linenos data-linenos=" 6 "></span></a>├── .orch-state/                     # Agent workflow state
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7></a><a href=#__codelineno-12-7><span class=linenos data-linenos=" 7 "></span></a>├── cmd/
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8></a><a href=#__codelineno-12-8><span class=linenos data-linenos=" 8 "></span></a>│   ├── taskmaster/                  # Main CLI entry point
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9></a><a href=#__codelineno-12-9><span class=linenos data-linenos=" 9 "></span></a>│   │   └── main.go
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10></a><a href=#__codelineno-12-10><span class=linenos data-linenos="10 "></span></a>│   └── commands/                    # Subcommands
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11></a><a href=#__codelineno-12-11><span class=linenos data-linenos="11 "></span></a>│       ├── add.go
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12></a><a href=#__codelineno-12-12><span class=linenos data-linenos="12 "></span></a>│       ├── list.go
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13></a><a href=#__codelineno-12-13><span class=linenos data-linenos="13 "></span></a>│       ├── complete.go
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14></a><a href=#__codelineno-12-14><span class=linenos data-linenos="14 "></span></a>│       ├── report.go
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15></a><a href=#__codelineno-12-15><span class=linenos data-linenos="15 "></span></a>│       └── sync.go
</span><span id=__span-12-16><a id=__codelineno-12-16 name=__codelineno-12-16></a><a href=#__codelineno-12-16><span class=linenos data-linenos="16 "></span></a>├── internal/
</span><span id=__span-12-17><a id=__codelineno-12-17 name=__codelineno-12-17></a><a href=#__codelineno-12-17><span class=linenos data-linenos="17 "></span></a>│   ├── task/                        # Task domain logic
</span><span id=__span-12-18><a id=__codelineno-12-18 name=__codelineno-12-18></a><a href=#__codelineno-12-18><span class=linenos data-linenos="18 "></span></a>│   ├── storage/                     # Data persistence
</span><span id=__span-12-19><a id=__codelineno-12-19 name=__codelineno-12-19></a><a href=#__codelineno-12-19><span class=linenos data-linenos="19 "></span></a>│   ├── config/                      # Configuration
</span><span id=__span-12-20><a id=__codelineno-12-20 name=__codelineno-12-20></a><a href=#__codelineno-12-20><span class=linenos data-linenos="20 "></span></a>│   ├── plugins/                     # Plugin system
</span><span id=__span-12-21><a id=__codelineno-12-21 name=__codelineno-12-21></a><a href=#__codelineno-12-21><span class=linenos data-linenos="21 "></span></a>│   └── sync/                        # Cloud sync
</span><span id=__span-12-22><a id=__codelineno-12-22 name=__codelineno-12-22></a><a href=#__codelineno-12-22><span class=linenos data-linenos="22 "></span></a>├── pkg/
</span><span id=__span-12-23><a id=__codelineno-12-23 name=__codelineno-12-23></a><a href=#__codelineno-12-23><span class=linenos data-linenos="23 "></span></a>│   ├── api/                         # Public API
</span><span id=__span-12-24><a id=__codelineno-12-24 name=__codelineno-12-24></a><a href=#__codelineno-12-24><span class=linenos data-linenos="24 "></span></a>│   └── utils/                       # Utilities
</span><span id=__span-12-25><a id=__codelineno-12-25 name=__codelineno-12-25></a><a href=#__codelineno-12-25><span class=linenos data-linenos="25 "></span></a>├── tests/
</span><span id=__span-12-26><a id=__codelineno-12-26 name=__codelineno-12-26></a><a href=#__codelineno-12-26><span class=linenos data-linenos="26 "></span></a>│   ├── unit/                        # Unit tests
</span><span id=__span-12-27><a id=__codelineno-12-27 name=__codelineno-12-27></a><a href=#__codelineno-12-27><span class=linenos data-linenos="27 "></span></a>│   ├── integration/                 # Integration tests
</span><span id=__span-12-28><a id=__codelineno-12-28 name=__codelineno-12-28></a><a href=#__codelineno-12-28><span class=linenos data-linenos="28 "></span></a>│   └── tdd/                         # TDD cycle tests
</span><span id=__span-12-29><a id=__codelineno-12-29 name=__codelineno-12-29></a><a href=#__codelineno-12-29><span class=linenos data-linenos="29 "></span></a>│       ├── TASK-001/                # Add task feature
</span><span id=__span-12-30><a id=__codelineno-12-30 name=__codelineno-12-30></a><a href=#__codelineno-12-30><span class=linenos data-linenos="30 "></span></a>│       ├── TASK-002/                # List tasks feature
</span><span id=__span-12-31><a id=__codelineno-12-31 name=__codelineno-12-31></a><a href=#__codelineno-12-31><span class=linenos data-linenos="31 "></span></a>│       └── TASK-003/                # Time tracking
</span><span id=__span-12-32><a id=__codelineno-12-32 name=__codelineno-12-32></a><a href=#__codelineno-12-32><span class=linenos data-linenos="32 "></span></a>├── scripts/
</span><span id=__span-12-33><a id=__codelineno-12-33 name=__codelineno-12-33></a><a href=#__codelineno-12-33><span class=linenos data-linenos="33 "></span></a>│   ├── install.sh                   # Installation script
</span><span id=__span-12-34><a id=__codelineno-12-34 name=__codelineno-12-34></a><a href=#__codelineno-12-34><span class=linenos data-linenos="34 "></span></a>│   └── build.sh                     # Build script
</span><span id=__span-12-35><a id=__codelineno-12-35 name=__codelineno-12-35></a><a href=#__codelineno-12-35><span class=linenos data-linenos="35 "></span></a>├── docs/
</span><span id=__span-12-36><a id=__codelineno-12-36 name=__codelineno-12-36></a><a href=#__codelineno-12-36><span class=linenos data-linenos="36 "></span></a>│   ├── ARCHITECTURE.md
</span><span id=__span-12-37><a id=__codelineno-12-37 name=__codelineno-12-37></a><a href=#__codelineno-12-37><span class=linenos data-linenos="37 "></span></a>│   └── PLUGIN_GUIDE.md
</span><span id=__span-12-38><a id=__codelineno-12-38 name=__codelineno-12-38></a><a href=#__codelineno-12-38><span class=linenos data-linenos="38 "></span></a>└── go.mod
</span></code></pre></div><h5 id=complete-configuration_1>Complete Configuration<a class=headerlink href=#complete-configuration_1 title="Permanent link">&para;</a></h5><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1></a><a href=#__codelineno-13-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># config/agent-workflow.yml</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2></a><a href=#__codelineno-13-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>orchestrator</span><span class=p>:</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3></a><a href=#__codelineno-13-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>  </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">partial</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4></a><a href=#__codelineno-13-4><span class=linenos data-linenos=" 4 "></span></a><span class=w>  </span><span class=nt>project_path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/workspace/taskmaster-cli&quot;</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5></a><a href=#__codelineno-13-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span><span class=nt>github_repo</span><span class=p>:</span><span class=w> </span><span class=s>&quot;agent-workflow-examples/taskmaster-cli&quot;</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6></a><a href=#__codelineno-13-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>  </span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7></a><a href=#__codelineno-13-7><span class=linenos data-linenos=" 7 "></span></a><span class=nt>tdd</span><span class=p>:</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8></a><a href=#__codelineno-13-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9></a><a href=#__codelineno-13-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>  </span><span class=nt>test_execution</span><span class=p>:</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10></a><a href=#__codelineno-13-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span><span class=nt>runner</span><span class=p>:</span><span class=w> </span><span class=s>&quot;go</span><span class=nv> </span><span class=s>test&quot;</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11></a><a href=#__codelineno-13-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span><span class=nt>coverage_threshold</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">90</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12></a><a href=#__codelineno-13-12><span class=linenos data-linenos="12 "></span></a><span class=w>    </span><span class=nt>parallel_jobs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13></a><a href=#__codelineno-13-13><span class=linenos data-linenos="13 "></span></a><span class=w>    </span><span class=nt>test_timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">60000</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14></a><a href=#__codelineno-13-14><span class=linenos data-linenos="14 "></span></a><span class=w>    </span>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15></a><a href=#__codelineno-13-15><span class=linenos data-linenos="15 "></span></a><span class=w>  </span><span class=nt>quality_gates</span><span class=p>:</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16></a><a href=#__codelineno-13-16><span class=linenos data-linenos="16 "></span></a><span class=w>    </span><span class=nt>code_green_phase</span><span class=p>:</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17></a><a href=#__codelineno-13-17><span class=linenos data-linenos="17 "></span></a><span class=w>      </span><span class=nt>require_all_tests_pass</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18></a><a href=#__codelineno-13-18><span class=linenos data-linenos="18 "></span></a><span class=w>      </span><span class=nt>minimum_coverage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">90</span>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19></a><a href=#__codelineno-13-19><span class=linenos data-linenos="19 "></span></a><span class=w>      </span><span class=nt>lint_check</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20></a><a href=#__codelineno-13-20><span class=linenos data-linenos="20 "></span></a><span class=w>      </span><span class=nt>vet_check</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-13-21><a id=__codelineno-13-21 name=__codelineno-13-21></a><a href=#__codelineno-13-21><span class=linenos data-linenos="21 "></span></a><span class=w>      </span>
</span><span id=__span-13-22><a id=__codelineno-13-22 name=__codelineno-13-22></a><a href=#__codelineno-13-22><span class=linenos data-linenos="22 "></span></a><span class=w>  </span><span class=nt>test_preservation</span><span class=p>:</span>
</span><span id=__span-13-23><a id=__codelineno-13-23 name=__codelineno-13-23></a><a href=#__codelineno-13-23><span class=linenos data-linenos="23 "></span></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-13-24><a id=__codelineno-13-24 name=__codelineno-13-24></a><a href=#__codelineno-13-24><span class=linenos data-linenos="24 "></span></a><span class=w>    </span><span class=nt>backup_strategy</span><span class=p>:</span><span class=w> </span><span class=s>&quot;git&quot;</span>
</span><span id=__span-13-25><a id=__codelineno-13-25 name=__codelineno-13-25></a><a href=#__codelineno-13-25><span class=linenos data-linenos="25 "></span></a><span class=w>    </span>
</span><span id=__span-13-26><a id=__codelineno-13-26 name=__codelineno-13-26></a><a href=#__codelineno-13-26><span class=linenos data-linenos="26 "></span></a><span class=nt>agents</span><span class=p>:</span>
</span><span id=__span-13-27><a id=__codelineno-13-27 name=__codelineno-13-27></a><a href=#__codelineno-13-27><span class=linenos data-linenos="27 "></span></a><span class=w>  </span><span class=nt>design_agent</span><span class=p>:</span>
</span><span id=__span-13-28><a id=__codelineno-13-28 name=__codelineno-13-28></a><a href=#__codelineno-13-28><span class=linenos data-linenos="28 "></span></a><span class=w>    </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=s>&quot;CLI</span><span class=nv> </span><span class=s>tool</span><span class=nv> </span><span class=s>for</span><span class=nv> </span><span class=s>task</span><span class=nv> </span><span class=s>management</span><span class=nv> </span><span class=s>with</span><span class=nv> </span><span class=s>Go,</span><span class=nv> </span><span class=s>using</span><span class=nv> </span><span class=s>cobra</span><span class=nv> </span><span class=s>framework&quot;</span>
</span><span id=__span-13-29><a id=__codelineno-13-29 name=__codelineno-13-29></a><a href=#__codelineno-13-29><span class=linenos data-linenos="29 "></span></a><span class=w>    </span><span class=nt>architecture_style</span><span class=p>:</span><span class=w> </span><span class=s>&quot;clean&quot;</span>
</span><span id=__span-13-30><a id=__codelineno-13-30 name=__codelineno-13-30></a><a href=#__codelineno-13-30><span class=linenos data-linenos="30 "></span></a><span class=w>    </span><span class=nt>cli_framework</span><span class=p>:</span><span class=w> </span><span class=s>&quot;cobra&quot;</span>
</span><span id=__span-13-31><a id=__codelineno-13-31 name=__codelineno-13-31></a><a href=#__codelineno-13-31><span class=linenos data-linenos="31 "></span></a><span class=w>    </span>
</span><span id=__span-13-32><a id=__codelineno-13-32 name=__codelineno-13-32></a><a href=#__codelineno-13-32><span class=linenos data-linenos="32 "></span></a><span class=w>  </span><span class=nt>code_agent</span><span class=p>:</span>
</span><span id=__span-13-33><a id=__codelineno-13-33 name=__codelineno-13-33></a><a href=#__codelineno-13-33><span class=linenos data-linenos="33 "></span></a><span class=w>    </span><span class=nt>implementation_style</span><span class=p>:</span><span class=w> </span><span class=s>&quot;idiomatic&quot;</span>
</span><span id=__span-13-34><a id=__codelineno-13-34 name=__codelineno-13-34></a><a href=#__codelineno-13-34><span class=linenos data-linenos="34 "></span></a><span class=w>    </span><span class=nt>error_handling</span><span class=p>:</span><span class=w> </span><span class=s>&quot;comprehensive&quot;</span>
</span><span id=__span-13-35><a id=__codelineno-13-35 name=__codelineno-13-35></a><a href=#__codelineno-13-35><span class=linenos data-linenos="35 "></span></a><span class=w>    </span><span class=nt>concurrency_model</span><span class=p>:</span><span class=w> </span><span class=s>&quot;goroutines&quot;</span>
</span><span id=__span-13-36><a id=__codelineno-13-36 name=__codelineno-13-36></a><a href=#__codelineno-13-36><span class=linenos data-linenos="36 "></span></a><span class=w>    </span>
</span><span id=__span-13-37><a id=__codelineno-13-37 name=__codelineno-13-37></a><a href=#__codelineno-13-37><span class=linenos data-linenos="37 "></span></a><span class=w>  </span><span class=nt>qa_agent</span><span class=p>:</span>
</span><span id=__span-13-38><a id=__codelineno-13-38 name=__codelineno-13-38></a><a href=#__codelineno-13-38><span class=linenos data-linenos="38 "></span></a><span class=w>    </span><span class=nt>test_types</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;unit&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;integration&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;cli&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;performance&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-13-39><a id=__codelineno-13-39 name=__codelineno-13-39></a><a href=#__codelineno-13-39><span class=linenos data-linenos="39 "></span></a><span class=w>    </span><span class=nt>test_framework</span><span class=p>:</span><span class=w> </span><span class=s>&quot;testing&quot;</span>
</span><span id=__span-13-40><a id=__codelineno-13-40 name=__codelineno-13-40></a><a href=#__codelineno-13-40><span class=linenos data-linenos="40 "></span></a><span class=w>    </span><span class=nt>mock_framework</span><span class=p>:</span><span class=w> </span><span class=s>&quot;testify&quot;</span>
</span><span id=__span-13-41><a id=__codelineno-13-41 name=__codelineno-13-41></a><a href=#__codelineno-13-41><span class=linenos data-linenos="41 "></span></a><span class=w>    </span>
</span><span id=__span-13-42><a id=__codelineno-13-42 name=__codelineno-13-42></a><a href=#__codelineno-13-42><span class=linenos data-linenos="42 "></span></a><span class=w>  </span><span class=nt>data_agent</span><span class=p>:</span>
</span><span id=__span-13-43><a id=__codelineno-13-43 name=__codelineno-13-43></a><a href=#__codelineno-13-43><span class=linenos data-linenos="43 "></span></a><span class=w>    </span><span class=nt>storage_backend</span><span class=p>:</span><span class=w> </span><span class=s>&quot;sqlite&quot;</span>
</span><span id=__span-13-44><a id=__codelineno-13-44 name=__codelineno-13-44></a><a href=#__codelineno-13-44><span class=linenos data-linenos="44 "></span></a><span class=w>    </span><span class=nt>analytics_enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-13-45><a id=__codelineno-13-45 name=__codelineno-13-45></a><a href=#__codelineno-13-45><span class=linenos data-linenos="45 "></span></a><span class=w>    </span>
</span><span id=__span-13-46><a id=__codelineno-13-46 name=__codelineno-13-46></a><a href=#__codelineno-13-46><span class=linenos data-linenos="46 "></span></a><span class=nt>integrations</span><span class=p>:</span>
</span><span id=__span-13-47><a id=__codelineno-13-47 name=__codelineno-13-47></a><a href=#__codelineno-13-47><span class=linenos data-linenos="47 "></span></a><span class=w>  </span><span class=nt>ci</span><span class=p>:</span>
</span><span id=__span-13-48><a id=__codelineno-13-48 name=__codelineno-13-48></a><a href=#__codelineno-13-48><span class=linenos data-linenos="48 "></span></a><span class=w>    </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=s>&quot;github_actions&quot;</span>
</span><span id=__span-13-49><a id=__codelineno-13-49 name=__codelineno-13-49></a><a href=#__codelineno-13-49><span class=linenos data-linenos="49 "></span></a><span class=w>    </span><span class=nt>release_automation</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-13-50><a id=__codelineno-13-50 name=__codelineno-13-50></a><a href=#__codelineno-13-50><span class=linenos data-linenos="50 "></span></a><span class=w>    </span>
</span><span id=__span-13-51><a id=__codelineno-13-51 name=__codelineno-13-51></a><a href=#__codelineno-13-51><span class=linenos data-linenos="51 "></span></a><span class=w>  </span><span class=nt>distribution</span><span class=p>:</span>
</span><span id=__span-13-52><a id=__codelineno-13-52 name=__codelineno-13-52></a><a href=#__codelineno-13-52><span class=linenos data-linenos="52 "></span></a><span class=w>    </span><span class=nt>platforms</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;linux&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;darwin&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;windows&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-13-53><a id=__codelineno-13-53 name=__codelineno-13-53></a><a href=#__codelineno-13-53><span class=linenos data-linenos="53 "></span></a><span class=w>    </span><span class=nt>package_managers</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;homebrew&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;snap&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;chocolatey&quot;</span><span class="p p-Indicator">]</span>
</span></code></pre></div><h5 id=step-by-step-cli-development>Step-by-Step CLI Development<a class=headerlink href=#step-by-step-cli-development title="Permanent link">&para;</a></h5><h6 id=1-project-initialization_1>1. Project Initialization<a class=headerlink href=#1-project-initialization_1 title="Permanent link">&para;</a></h6><div class="language-bash highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1></a><a href=#__codelineno-14-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># Discord commands</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2></a><a href=#__codelineno-14-2><span class=linenos data-linenos=" 2 "></span></a>/project<span class=w> </span>register<span class=w> </span>/workspace/taskmaster-cli<span class=w> </span><span class=s2>&quot;TaskMaster CLI&quot;</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3></a><a href=#__codelineno-14-3><span class=linenos data-linenos=" 3 "></span></a>/epic<span class=w> </span><span class=s2>&quot;Build a comprehensive task management CLI tool with plugin support&quot;</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4></a><a href=#__codelineno-14-4><span class=linenos data-linenos=" 4 "></span></a>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5></a><a href=#__codelineno-14-5><span class=linenos data-linenos=" 5 "></span></a><span class=c1># Add stories</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6></a><a href=#__codelineno-14-6><span class=linenos data-linenos=" 6 "></span></a>/backlog<span class=w> </span>add_story<span class=w> </span><span class=s2>&quot;TASK-001: Implement &#39;add&#39; command with task creation&quot;</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7></a><a href=#__codelineno-14-7><span class=linenos data-linenos=" 7 "></span></a>/backlog<span class=w> </span>add_story<span class=w> </span><span class=s2>&quot;TASK-002: Create &#39;list&#39; command with filtering options&quot;</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8></a><a href=#__codelineno-14-8><span class=linenos data-linenos=" 8 "></span></a>/backlog<span class=w> </span>add_story<span class=w> </span><span class=s2>&quot;TASK-003: Add time tracking functionality&quot;</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9></a><a href=#__codelineno-14-9><span class=linenos data-linenos=" 9 "></span></a>/backlog<span class=w> </span>add_story<span class=w> </span><span class=s2>&quot;TASK-004: Implement plugin system architecture&quot;</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10></a><a href=#__codelineno-14-10><span class=linenos data-linenos="10 "></span></a>/backlog<span class=w> </span>add_story<span class=w> </span><span class=s2>&quot;TASK-005: Add cloud sync capabilities&quot;</span>
</span></code></pre></div><h6 id=2-tdd-cycle-for-add-command>2. TDD Cycle for Add Command<a class=headerlink href=#2-tdd-cycle-for-add-command title="Permanent link">&para;</a></h6><p><strong>Design Phase Output:</strong><div class="language-go highlight"><span class=filename>Go</span><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1></a><a href=#__codelineno-15-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1>// docs/tdd/TASK-001/design.md</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2></a><a href=#__codelineno-15-2><span class=linenos data-linenos=" 2 "></span></a><span class=c1>// Command: taskmaster add &quot;Task description&quot; --project work --priority high --due tomorrow</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3></a><a href=#__codelineno-15-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4></a><a href=#__codelineno-15-4><span class=linenos data-linenos=" 4 "></span></a><span class=c1>// Task structure</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5></a><a href=#__codelineno-15-5><span class=linenos data-linenos=" 5 "></span></a><span class=kd>type</span><span class=w> </span><span class=nx>Task</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6></a><a href=#__codelineno-15-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>    </span><span class=nx>ID</span><span class=w>          </span><span class=kt>string</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7></a><a href=#__codelineno-15-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>    </span><span class=nx>Description</span><span class=w> </span><span class=kt>string</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8></a><a href=#__codelineno-15-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>    </span><span class=nx>Project</span><span class=w>     </span><span class=kt>string</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9></a><a href=#__codelineno-15-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>    </span><span class=nx>Priority</span><span class=w>    </span><span class=nx>Priority</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10></a><a href=#__codelineno-15-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span><span class=nx>Tags</span><span class=w>        </span><span class=p>[]</span><span class=kt>string</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11></a><a href=#__codelineno-15-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span><span class=nx>DueDate</span><span class=w>     </span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12></a><a href=#__codelineno-15-12><span class=linenos data-linenos="12 "></span></a><span class=w>    </span><span class=nx>CreatedAt</span><span class=w>   </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13></a><a href=#__codelineno-15-13><span class=linenos data-linenos="13 "></span></a><span class=w>    </span><span class=nx>CompletedAt</span><span class=w> </span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14></a><a href=#__codelineno-15-14><span class=linenos data-linenos="14 "></span></a><span class=p>}</span>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15></a><a href=#__codelineno-15-15><span class=linenos data-linenos="15 "></span></a>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16></a><a href=#__codelineno-15-16><span class=linenos data-linenos="16 "></span></a><span class=c1>// Command interface</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17></a><a href=#__codelineno-15-17><span class=linenos data-linenos="17 "></span></a><span class=kd>type</span><span class=w> </span><span class=nx>AddCommand</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18></a><a href=#__codelineno-15-18><span class=linenos data-linenos="18 "></span></a><span class=w>    </span><span class=nx>storage</span><span class=w> </span><span class=nx>Storage</span>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19></a><a href=#__codelineno-15-19><span class=linenos data-linenos="19 "></span></a><span class=p>}</span>
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20></a><a href=#__codelineno-15-20><span class=linenos data-linenos="20 "></span></a>
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21></a><a href=#__codelineno-15-21><span class=linenos data-linenos="21 "></span></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>AddCommand</span><span class=p>)</span><span class=w> </span><span class=nx>Execute</span><span class=p>(</span><span class=nx>args</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>flags</span><span class=w> </span><span class=nx>Flags</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22></a><a href=#__codelineno-15-22><span class=linenos data-linenos="22 "></span></a><span class=w>    </span><span class=c1>// Parse task description</span>
</span><span id=__span-15-23><a id=__codelineno-15-23 name=__codelineno-15-23></a><a href=#__codelineno-15-23><span class=linenos data-linenos="23 "></span></a><span class=w>    </span><span class=c1>// Validate inputs</span>
</span><span id=__span-15-24><a id=__codelineno-15-24 name=__codelineno-15-24></a><a href=#__codelineno-15-24><span class=linenos data-linenos="24 "></span></a><span class=w>    </span><span class=c1>// Create task</span>
</span><span id=__span-15-25><a id=__codelineno-15-25 name=__codelineno-15-25></a><a href=#__codelineno-15-25><span class=linenos data-linenos="25 "></span></a><span class=w>    </span><span class=c1>// Store task</span>
</span><span id=__span-15-26><a id=__codelineno-15-26 name=__codelineno-15-26></a><a href=#__codelineno-15-26><span class=linenos data-linenos="26 "></span></a><span class=w>    </span><span class=c1>// Return confirmation</span>
</span><span id=__span-15-27><a id=__codelineno-15-27 name=__codelineno-15-27></a><a href=#__codelineno-15-27><span class=linenos data-linenos="27 "></span></a><span class=p>}</span>
</span></code></pre></div></p><p><strong>Generated Tests:</strong><div class="language-go highlight"><span class=filename>Go</span><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1></a><a href=#__codelineno-16-1><span class=linenos data-linenos="  1 "></span></a><span class=c1>// tests/tdd/TASK-001/add_command_test.go</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2></a><a href=#__codelineno-16-2><span class=linenos data-linenos="  2 "></span></a><span class=kn>package</span><span class=w> </span><span class=nx>commands_test</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3></a><a href=#__codelineno-16-3><span class=linenos data-linenos="  3 "></span></a>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4></a><a href=#__codelineno-16-4><span class=linenos data-linenos="  4 "></span></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5></a><a href=#__codelineno-16-5><span class=linenos data-linenos="  5 "></span></a><span class=w>    </span><span class=s>&quot;testing&quot;</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6></a><a href=#__codelineno-16-6><span class=linenos data-linenos="  6 "></span></a><span class=w>    </span><span class=s>&quot;time&quot;</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7></a><a href=#__codelineno-16-7><span class=linenos data-linenos="  7 "></span></a><span class=w>    </span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8></a><a href=#__codelineno-16-8><span class=linenos data-linenos="  8 "></span></a><span class=w>    </span><span class=s>&quot;github.com/stretchr/testify/assert&quot;</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9></a><a href=#__codelineno-16-9><span class=linenos data-linenos="  9 "></span></a><span class=w>    </span><span class=s>&quot;github.com/stretchr/testify/mock&quot;</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10></a><a href=#__codelineno-16-10><span class=linenos data-linenos=" 10 "></span></a><span class=w>    </span>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11></a><a href=#__codelineno-16-11><span class=linenos data-linenos=" 11 "></span></a><span class=w>    </span><span class=s>&quot;taskmaster/cmd/commands&quot;</span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12></a><a href=#__codelineno-16-12><span class=linenos data-linenos=" 12 "></span></a><span class=w>    </span><span class=s>&quot;taskmaster/internal/task&quot;</span>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13></a><a href=#__codelineno-16-13><span class=linenos data-linenos=" 13 "></span></a><span class=w>    </span><span class=s>&quot;taskmaster/internal/storage&quot;</span>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14></a><a href=#__codelineno-16-14><span class=linenos data-linenos=" 14 "></span></a><span class=p>)</span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15></a><a href=#__codelineno-16-15><span class=linenos data-linenos=" 15 "></span></a>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16></a><a href=#__codelineno-16-16><span class=linenos data-linenos=" 16 "></span></a><span class=kd>type</span><span class=w> </span><span class=nx>MockStorage</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-17><a id=__codelineno-16-17 name=__codelineno-16-17></a><a href=#__codelineno-16-17><span class=linenos data-linenos=" 17 "></span></a><span class=w>    </span><span class=nx>mock</span><span class=p>.</span><span class=nx>Mock</span>
</span><span id=__span-16-18><a id=__codelineno-16-18 name=__codelineno-16-18></a><a href=#__codelineno-16-18><span class=linenos data-linenos=" 18 "></span></a><span class=p>}</span>
</span><span id=__span-16-19><a id=__codelineno-16-19 name=__codelineno-16-19></a><a href=#__codelineno-16-19><span class=linenos data-linenos=" 19 "></span></a>
</span><span id=__span-16-20><a id=__codelineno-16-20 name=__codelineno-16-20></a><a href=#__codelineno-16-20><span class=linenos data-linenos=" 20 "></span></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>MockStorage</span><span class=p>)</span><span class=w> </span><span class=nx>SaveTask</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>task</span><span class=p>.</span><span class=nx>Task</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-21><a id=__codelineno-16-21 name=__codelineno-16-21></a><a href=#__codelineno-16-21><span class=linenos data-linenos=" 21 "></span></a><span class=w>    </span><span class=nx>args</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>Called</span><span class=p>(</span><span class=nx>t</span><span class=p>)</span>
</span><span id=__span-16-22><a id=__codelineno-16-22 name=__codelineno-16-22></a><a href=#__codelineno-16-22><span class=linenos data-linenos=" 22 "></span></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>args</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-16-23><a id=__codelineno-16-23 name=__codelineno-16-23></a><a href=#__codelineno-16-23><span class=linenos data-linenos=" 23 "></span></a><span class=p>}</span>
</span><span id=__span-16-24><a id=__codelineno-16-24 name=__codelineno-16-24></a><a href=#__codelineno-16-24><span class=linenos data-linenos=" 24 "></span></a>
</span><span id=__span-16-25><a id=__codelineno-16-25 name=__codelineno-16-25></a><a href=#__codelineno-16-25><span class=linenos data-linenos=" 25 "></span></a><span class=kd>func</span><span class=w> </span><span class=nx>TestAddCommand_Execute</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-26><a id=__codelineno-16-26 name=__codelineno-16-26></a><a href=#__codelineno-16-26><span class=linenos data-linenos=" 26 "></span></a><span class=w>    </span><span class=nx>tests</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=p>[]</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-27><a id=__codelineno-16-27 name=__codelineno-16-27></a><a href=#__codelineno-16-27><span class=linenos data-linenos=" 27 "></span></a><span class=w>        </span><span class=nx>name</span><span class=w>        </span><span class=kt>string</span>
</span><span id=__span-16-28><a id=__codelineno-16-28 name=__codelineno-16-28></a><a href=#__codelineno-16-28><span class=linenos data-linenos=" 28 "></span></a><span class=w>        </span><span class=nx>args</span><span class=w>        </span><span class=p>[]</span><span class=kt>string</span>
</span><span id=__span-16-29><a id=__codelineno-16-29 name=__codelineno-16-29></a><a href=#__codelineno-16-29><span class=linenos data-linenos=" 29 "></span></a><span class=w>        </span><span class=nx>flags</span><span class=w>       </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span>
</span><span id=__span-16-30><a id=__codelineno-16-30 name=__codelineno-16-30></a><a href=#__codelineno-16-30><span class=linenos data-linenos=" 30 "></span></a><span class=w>        </span><span class=nx>setupMock</span><span class=w>   </span><span class=kd>func</span><span class=p>(</span><span class=o>*</span><span class=nx>MockStorage</span><span class=p>)</span>
</span><span id=__span-16-31><a id=__codelineno-16-31 name=__codelineno-16-31></a><a href=#__codelineno-16-31><span class=linenos data-linenos=" 31 "></span></a><span class=w>        </span><span class=nx>wantErr</span><span class=w>     </span><span class=kt>bool</span>
</span><span id=__span-16-32><a id=__codelineno-16-32 name=__codelineno-16-32></a><a href=#__codelineno-16-32><span class=linenos data-linenos=" 32 "></span></a><span class=w>        </span><span class=nx>errContains</span><span class=w> </span><span class=kt>string</span>
</span><span id=__span-16-33><a id=__codelineno-16-33 name=__codelineno-16-33></a><a href=#__codelineno-16-33><span class=linenos data-linenos=" 33 "></span></a><span class=w>    </span><span class=p>}{</span>
</span><span id=__span-16-34><a id=__codelineno-16-34 name=__codelineno-16-34></a><a href=#__codelineno-16-34><span class=linenos data-linenos=" 34 "></span></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-16-35><a id=__codelineno-16-35 name=__codelineno-16-35></a><a href=#__codelineno-16-35><span class=linenos data-linenos=" 35 "></span></a><span class=w>            </span><span class=nx>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;successful task creation&quot;</span><span class=p>,</span>
</span><span id=__span-16-36><a id=__codelineno-16-36 name=__codelineno-16-36></a><a href=#__codelineno-16-36><span class=linenos data-linenos=" 36 "></span></a><span class=w>            </span><span class=nx>args</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&quot;Write unit tests&quot;</span><span class=p>},</span>
</span><span id=__span-16-37><a id=__codelineno-16-37 name=__codelineno-16-37></a><a href=#__codelineno-16-37><span class=linenos data-linenos=" 37 "></span></a><span class=w>            </span><span class=nx>flags</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>{</span>
</span><span id=__span-16-38><a id=__codelineno-16-38 name=__codelineno-16-38></a><a href=#__codelineno-16-38><span class=linenos data-linenos=" 38 "></span></a><span class=w>                </span><span class=s>&quot;project&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;work&quot;</span><span class=p>,</span>
</span><span id=__span-16-39><a id=__codelineno-16-39 name=__codelineno-16-39></a><a href=#__codelineno-16-39><span class=linenos data-linenos=" 39 "></span></a><span class=w>                </span><span class=s>&quot;priority&quot;</span><span class=p>:</span><span class=w> </span><span class=s>&quot;high&quot;</span><span class=p>,</span>
</span><span id=__span-16-40><a id=__codelineno-16-40 name=__codelineno-16-40></a><a href=#__codelineno-16-40><span class=linenos data-linenos=" 40 "></span></a><span class=w>                </span><span class=s>&quot;due&quot;</span><span class=p>:</span><span class=w>      </span><span class=s>&quot;tomorrow&quot;</span><span class=p>,</span>
</span><span id=__span-16-41><a id=__codelineno-16-41 name=__codelineno-16-41></a><a href=#__codelineno-16-41><span class=linenos data-linenos=" 41 "></span></a><span class=w>            </span><span class=p>},</span>
</span><span id=__span-16-42><a id=__codelineno-16-42 name=__codelineno-16-42></a><a href=#__codelineno-16-42><span class=linenos data-linenos=" 42 "></span></a><span class=w>            </span><span class=nx>setupMock</span><span class=p>:</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>MockStorage</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-43><a id=__codelineno-16-43 name=__codelineno-16-43></a><a href=#__codelineno-16-43><span class=linenos data-linenos=" 43 "></span></a><span class=w>                </span><span class=nx>m</span><span class=p>.</span><span class=nx>On</span><span class=p>(</span><span class=s>&quot;SaveTask&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>mock</span><span class=p>.</span><span class=nx>MatchedBy</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>task</span><span class=p>.</span><span class=nx>Task</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-44><a id=__codelineno-16-44 name=__codelineno-16-44></a><a href=#__codelineno-16-44><span class=linenos data-linenos=" 44 "></span></a><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=nx>t</span><span class=p>.</span><span class=nx>Description</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;Write unit tests&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span>
</span><span id=__span-16-45><a id=__codelineno-16-45 name=__codelineno-16-45></a><a href=#__codelineno-16-45><span class=linenos data-linenos=" 45 "></span></a><span class=w>                           </span><span class=nx>t</span><span class=p>.</span><span class=nx>Project</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;work&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span>
</span><span id=__span-16-46><a id=__codelineno-16-46 name=__codelineno-16-46></a><a href=#__codelineno-16-46><span class=linenos data-linenos=" 46 "></span></a><span class=w>                           </span><span class=nx>t</span><span class=p>.</span><span class=nx>Priority</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=nx>task</span><span class=p>.</span><span class=nx>PriorityHigh</span><span class=w> </span><span class=o>&amp;&amp;</span>
</span><span id=__span-16-47><a id=__codelineno-16-47 name=__codelineno-16-47></a><a href=#__codelineno-16-47><span class=linenos data-linenos=" 47 "></span></a><span class=w>                           </span><span class=nx>t</span><span class=p>.</span><span class=nx>DueDate</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span>
</span><span id=__span-16-48><a id=__codelineno-16-48 name=__codelineno-16-48></a><a href=#__codelineno-16-48><span class=linenos data-linenos=" 48 "></span></a><span class=w>                </span><span class=p>})).</span><span class=nx>Return</span><span class=p>(</span><span class=kc>nil</span><span class=p>)</span>
</span><span id=__span-16-49><a id=__codelineno-16-49 name=__codelineno-16-49></a><a href=#__codelineno-16-49><span class=linenos data-linenos=" 49 "></span></a><span class=w>            </span><span class=p>},</span>
</span><span id=__span-16-50><a id=__codelineno-16-50 name=__codelineno-16-50></a><a href=#__codelineno-16-50><span class=linenos data-linenos=" 50 "></span></a><span class=w>            </span><span class=nx>wantErr</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
</span><span id=__span-16-51><a id=__codelineno-16-51 name=__codelineno-16-51></a><a href=#__codelineno-16-51><span class=linenos data-linenos=" 51 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-16-52><a id=__codelineno-16-52 name=__codelineno-16-52></a><a href=#__codelineno-16-52><span class=linenos data-linenos=" 52 "></span></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-16-53><a id=__codelineno-16-53 name=__codelineno-16-53></a><a href=#__codelineno-16-53><span class=linenos data-linenos=" 53 "></span></a><span class=w>            </span><span class=nx>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;empty description error&quot;</span><span class=p>,</span>
</span><span id=__span-16-54><a id=__codelineno-16-54 name=__codelineno-16-54></a><a href=#__codelineno-16-54><span class=linenos data-linenos=" 54 "></span></a><span class=w>            </span><span class=nx>args</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{},</span>
</span><span id=__span-16-55><a id=__codelineno-16-55 name=__codelineno-16-55></a><a href=#__codelineno-16-55><span class=linenos data-linenos=" 55 "></span></a><span class=w>            </span><span class=nx>flags</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>{},</span>
</span><span id=__span-16-56><a id=__codelineno-16-56 name=__codelineno-16-56></a><a href=#__codelineno-16-56><span class=linenos data-linenos=" 56 "></span></a><span class=w>            </span><span class=nx>setupMock</span><span class=p>:</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>MockStorage</span><span class=p>)</span><span class=w> </span><span class=p>{},</span>
</span><span id=__span-16-57><a id=__codelineno-16-57 name=__codelineno-16-57></a><a href=#__codelineno-16-57><span class=linenos data-linenos=" 57 "></span></a><span class=w>            </span><span class=nx>wantErr</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-16-58><a id=__codelineno-16-58 name=__codelineno-16-58></a><a href=#__codelineno-16-58><span class=linenos data-linenos=" 58 "></span></a><span class=w>            </span><span class=nx>errContains</span><span class=p>:</span><span class=w> </span><span class=s>&quot;task description is required&quot;</span><span class=p>,</span>
</span><span id=__span-16-59><a id=__codelineno-16-59 name=__codelineno-16-59></a><a href=#__codelineno-16-59><span class=linenos data-linenos=" 59 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-16-60><a id=__codelineno-16-60 name=__codelineno-16-60></a><a href=#__codelineno-16-60><span class=linenos data-linenos=" 60 "></span></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-16-61><a id=__codelineno-16-61 name=__codelineno-16-61></a><a href=#__codelineno-16-61><span class=linenos data-linenos=" 61 "></span></a><span class=w>            </span><span class=nx>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;invalid priority&quot;</span><span class=p>,</span>
</span><span id=__span-16-62><a id=__codelineno-16-62 name=__codelineno-16-62></a><a href=#__codelineno-16-62><span class=linenos data-linenos=" 62 "></span></a><span class=w>            </span><span class=nx>args</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&quot;Test task&quot;</span><span class=p>},</span>
</span><span id=__span-16-63><a id=__codelineno-16-63 name=__codelineno-16-63></a><a href=#__codelineno-16-63><span class=linenos data-linenos=" 63 "></span></a><span class=w>            </span><span class=nx>flags</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>{</span>
</span><span id=__span-16-64><a id=__codelineno-16-64 name=__codelineno-16-64></a><a href=#__codelineno-16-64><span class=linenos data-linenos=" 64 "></span></a><span class=w>                </span><span class=s>&quot;priority&quot;</span><span class=p>:</span><span class=w> </span><span class=s>&quot;invalid&quot;</span><span class=p>,</span>
</span><span id=__span-16-65><a id=__codelineno-16-65 name=__codelineno-16-65></a><a href=#__codelineno-16-65><span class=linenos data-linenos=" 65 "></span></a><span class=w>            </span><span class=p>},</span>
</span><span id=__span-16-66><a id=__codelineno-16-66 name=__codelineno-16-66></a><a href=#__codelineno-16-66><span class=linenos data-linenos=" 66 "></span></a><span class=w>            </span><span class=nx>setupMock</span><span class=p>:</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>MockStorage</span><span class=p>)</span><span class=w> </span><span class=p>{},</span>
</span><span id=__span-16-67><a id=__codelineno-16-67 name=__codelineno-16-67></a><a href=#__codelineno-16-67><span class=linenos data-linenos=" 67 "></span></a><span class=w>            </span><span class=nx>wantErr</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-16-68><a id=__codelineno-16-68 name=__codelineno-16-68></a><a href=#__codelineno-16-68><span class=linenos data-linenos=" 68 "></span></a><span class=w>            </span><span class=nx>errContains</span><span class=p>:</span><span class=w> </span><span class=s>&quot;invalid priority&quot;</span><span class=p>,</span>
</span><span id=__span-16-69><a id=__codelineno-16-69 name=__codelineno-16-69></a><a href=#__codelineno-16-69><span class=linenos data-linenos=" 69 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-16-70><a id=__codelineno-16-70 name=__codelineno-16-70></a><a href=#__codelineno-16-70><span class=linenos data-linenos=" 70 "></span></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-16-71><a id=__codelineno-16-71 name=__codelineno-16-71></a><a href=#__codelineno-16-71><span class=linenos data-linenos=" 71 "></span></a><span class=w>            </span><span class=nx>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;storage error&quot;</span><span class=p>,</span>
</span><span id=__span-16-72><a id=__codelineno-16-72 name=__codelineno-16-72></a><a href=#__codelineno-16-72><span class=linenos data-linenos=" 72 "></span></a><span class=w>            </span><span class=nx>args</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&quot;Test task&quot;</span><span class=p>},</span>
</span><span id=__span-16-73><a id=__codelineno-16-73 name=__codelineno-16-73></a><a href=#__codelineno-16-73><span class=linenos data-linenos=" 73 "></span></a><span class=w>            </span><span class=nx>flags</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>{},</span>
</span><span id=__span-16-74><a id=__codelineno-16-74 name=__codelineno-16-74></a><a href=#__codelineno-16-74><span class=linenos data-linenos=" 74 "></span></a><span class=w>            </span><span class=nx>setupMock</span><span class=p>:</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>MockStorage</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-75><a id=__codelineno-16-75 name=__codelineno-16-75></a><a href=#__codelineno-16-75><span class=linenos data-linenos=" 75 "></span></a><span class=w>                </span><span class=nx>m</span><span class=p>.</span><span class=nx>On</span><span class=p>(</span><span class=s>&quot;SaveTask&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>mock</span><span class=p>.</span><span class=nx>Anything</span><span class=p>).</span><span class=nx>Return</span><span class=p>(</span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;database error&quot;</span><span class=p>))</span>
</span><span id=__span-16-76><a id=__codelineno-16-76 name=__codelineno-16-76></a><a href=#__codelineno-16-76><span class=linenos data-linenos=" 76 "></span></a><span class=w>            </span><span class=p>},</span>
</span><span id=__span-16-77><a id=__codelineno-16-77 name=__codelineno-16-77></a><a href=#__codelineno-16-77><span class=linenos data-linenos=" 77 "></span></a><span class=w>            </span><span class=nx>wantErr</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-16-78><a id=__codelineno-16-78 name=__codelineno-16-78></a><a href=#__codelineno-16-78><span class=linenos data-linenos=" 78 "></span></a><span class=w>            </span><span class=nx>errContains</span><span class=p>:</span><span class=w> </span><span class=s>&quot;failed to save task&quot;</span><span class=p>,</span>
</span><span id=__span-16-79><a id=__codelineno-16-79 name=__codelineno-16-79></a><a href=#__codelineno-16-79><span class=linenos data-linenos=" 79 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-16-80><a id=__codelineno-16-80 name=__codelineno-16-80></a><a href=#__codelineno-16-80><span class=linenos data-linenos=" 80 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-16-81><a id=__codelineno-16-81 name=__codelineno-16-81></a><a href=#__codelineno-16-81><span class=linenos data-linenos=" 81 "></span></a><span class=w>    </span>
</span><span id=__span-16-82><a id=__codelineno-16-82 name=__codelineno-16-82></a><a href=#__codelineno-16-82><span class=linenos data-linenos=" 82 "></span></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>tt</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>tests</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-83><a id=__codelineno-16-83 name=__codelineno-16-83></a><a href=#__codelineno-16-83><span class=linenos data-linenos=" 83 "></span></a><span class=w>        </span><span class=nx>t</span><span class=p>.</span><span class=nx>Run</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-84><a id=__codelineno-16-84 name=__codelineno-16-84></a><a href=#__codelineno-16-84><span class=linenos data-linenos=" 84 "></span></a><span class=w>            </span><span class=nx>mockStorage</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>new</span><span class=p>(</span><span class=nx>MockStorage</span><span class=p>)</span>
</span><span id=__span-16-85><a id=__codelineno-16-85 name=__codelineno-16-85></a><a href=#__codelineno-16-85><span class=linenos data-linenos=" 85 "></span></a><span class=w>            </span><span class=nx>tt</span><span class=p>.</span><span class=nx>setupMock</span><span class=p>(</span><span class=nx>mockStorage</span><span class=p>)</span>
</span><span id=__span-16-86><a id=__codelineno-16-86 name=__codelineno-16-86></a><a href=#__codelineno-16-86><span class=linenos data-linenos=" 86 "></span></a><span class=w>            </span>
</span><span id=__span-16-87><a id=__codelineno-16-87 name=__codelineno-16-87></a><a href=#__codelineno-16-87><span class=linenos data-linenos=" 87 "></span></a><span class=w>            </span><span class=nx>cmd</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>commands</span><span class=p>.</span><span class=nx>NewAddCommand</span><span class=p>(</span><span class=nx>mockStorage</span><span class=p>)</span>
</span><span id=__span-16-88><a id=__codelineno-16-88 name=__codelineno-16-88></a><a href=#__codelineno-16-88><span class=linenos data-linenos=" 88 "></span></a><span class=w>            </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>cmd</span><span class=p>.</span><span class=nx>Execute</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>args</span><span class=p>,</span><span class=w> </span><span class=nx>tt</span><span class=p>.</span><span class=nx>flags</span><span class=p>)</span>
</span><span id=__span-16-89><a id=__codelineno-16-89 name=__codelineno-16-89></a><a href=#__codelineno-16-89><span class=linenos data-linenos=" 89 "></span></a><span class=w>            </span>
</span><span id=__span-16-90><a id=__codelineno-16-90 name=__codelineno-16-90></a><a href=#__codelineno-16-90><span class=linenos data-linenos=" 90 "></span></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=nx>tt</span><span class=p>.</span><span class=nx>wantErr</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-91><a id=__codelineno-16-91 name=__codelineno-16-91></a><a href=#__codelineno-16-91><span class=linenos data-linenos=" 91 "></span></a><span class=w>                </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-16-92><a id=__codelineno-16-92 name=__codelineno-16-92></a><a href=#__codelineno-16-92><span class=linenos data-linenos=" 92 "></span></a><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=nx>tt</span><span class=p>.</span><span class=nx>errContains</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-93><a id=__codelineno-16-93 name=__codelineno-16-93></a><a href=#__codelineno-16-93><span class=linenos data-linenos=" 93 "></span></a><span class=w>                    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span><span class=w> </span><span class=nx>tt</span><span class=p>.</span><span class=nx>errContains</span><span class=p>)</span>
</span><span id=__span-16-94><a id=__codelineno-16-94 name=__codelineno-16-94></a><a href=#__codelineno-16-94><span class=linenos data-linenos=" 94 "></span></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-16-95><a id=__codelineno-16-95 name=__codelineno-16-95></a><a href=#__codelineno-16-95><span class=linenos data-linenos=" 95 "></span></a><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-96><a id=__codelineno-16-96 name=__codelineno-16-96></a><a href=#__codelineno-16-96><span class=linenos data-linenos=" 96 "></span></a><span class=w>                </span><span class=nx>assert</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-16-97><a id=__codelineno-16-97 name=__codelineno-16-97></a><a href=#__codelineno-16-97><span class=linenos data-linenos=" 97 "></span></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-16-98><a id=__codelineno-16-98 name=__codelineno-16-98></a><a href=#__codelineno-16-98><span class=linenos data-linenos=" 98 "></span></a><span class=w>            </span>
</span><span id=__span-16-99><a id=__codelineno-16-99 name=__codelineno-16-99></a><a href=#__codelineno-16-99><span class=linenos data-linenos=" 99 "></span></a><span class=w>            </span><span class=nx>mockStorage</span><span class=p>.</span><span class=nx>AssertExpectations</span><span class=p>(</span><span class=nx>t</span><span class=p>)</span>
</span><span id=__span-16-100><a id=__codelineno-16-100 name=__codelineno-16-100></a><a href=#__codelineno-16-100><span class=linenos data-linenos="100 "></span></a><span class=w>        </span><span class=p>})</span>
</span><span id=__span-16-101><a id=__codelineno-16-101 name=__codelineno-16-101></a><a href=#__codelineno-16-101><span class=linenos data-linenos="101 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-16-102><a id=__codelineno-16-102 name=__codelineno-16-102></a><a href=#__codelineno-16-102><span class=linenos data-linenos="102 "></span></a><span class=p>}</span>
</span><span id=__span-16-103><a id=__codelineno-16-103 name=__codelineno-16-103></a><a href=#__codelineno-16-103><span class=linenos data-linenos="103 "></span></a>
</span><span id=__span-16-104><a id=__codelineno-16-104 name=__codelineno-16-104></a><a href=#__codelineno-16-104><span class=linenos data-linenos="104 "></span></a><span class=kd>func</span><span class=w> </span><span class=nx>TestAddCommand_ParseDueDate</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-105><a id=__codelineno-16-105 name=__codelineno-16-105></a><a href=#__codelineno-16-105><span class=linenos data-linenos="105 "></span></a><span class=w>    </span><span class=nx>tests</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=p>[]</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-106><a id=__codelineno-16-106 name=__codelineno-16-106></a><a href=#__codelineno-16-106><span class=linenos data-linenos="106 "></span></a><span class=w>        </span><span class=nx>input</span><span class=w>    </span><span class=kt>string</span>
</span><span id=__span-16-107><a id=__codelineno-16-107 name=__codelineno-16-107></a><a href=#__codelineno-16-107><span class=linenos data-linenos="107 "></span></a><span class=w>        </span><span class=nx>wantTime</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
</span><span id=__span-16-108><a id=__codelineno-16-108 name=__codelineno-16-108></a><a href=#__codelineno-16-108><span class=linenos data-linenos="108 "></span></a><span class=w>        </span><span class=nx>wantErr</span><span class=w>  </span><span class=kt>bool</span>
</span><span id=__span-16-109><a id=__codelineno-16-109 name=__codelineno-16-109></a><a href=#__codelineno-16-109><span class=linenos data-linenos="109 "></span></a><span class=w>    </span><span class=p>}{</span>
</span><span id=__span-16-110><a id=__codelineno-16-110 name=__codelineno-16-110></a><a href=#__codelineno-16-110><span class=linenos data-linenos="110 "></span></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-16-111><a id=__codelineno-16-111 name=__codelineno-16-111></a><a href=#__codelineno-16-111><span class=linenos data-linenos="111 "></span></a><span class=w>            </span><span class=nx>input</span><span class=p>:</span><span class=w>    </span><span class=s>&quot;tomorrow&quot;</span><span class=p>,</span>
</span><span id=__span-16-112><a id=__codelineno-16-112 name=__codelineno-16-112></a><a href=#__codelineno-16-112><span class=linenos data-linenos="112 "></span></a><span class=w>            </span><span class=nx>wantTime</span><span class=p>:</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Now</span><span class=p>().</span><span class=nx>AddDate</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>).</span><span class=nx>Truncate</span><span class=p>(</span><span class=mi>24</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Hour</span><span class=p>),</span>
</span><span id=__span-16-113><a id=__codelineno-16-113 name=__codelineno-16-113></a><a href=#__codelineno-16-113><span class=linenos data-linenos="113 "></span></a><span class=w>            </span><span class=nx>wantErr</span><span class=p>:</span><span class=w>  </span><span class=kc>false</span><span class=p>,</span>
</span><span id=__span-16-114><a id=__codelineno-16-114 name=__codelineno-16-114></a><a href=#__codelineno-16-114><span class=linenos data-linenos="114 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-16-115><a id=__codelineno-16-115 name=__codelineno-16-115></a><a href=#__codelineno-16-115><span class=linenos data-linenos="115 "></span></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-16-116><a id=__codelineno-16-116 name=__codelineno-16-116></a><a href=#__codelineno-16-116><span class=linenos data-linenos="116 "></span></a><span class=w>            </span><span class=nx>input</span><span class=p>:</span><span class=w>    </span><span class=s>&quot;next week&quot;</span><span class=p>,</span>
</span><span id=__span-16-117><a id=__codelineno-16-117 name=__codelineno-16-117></a><a href=#__codelineno-16-117><span class=linenos data-linenos="117 "></span></a><span class=w>            </span><span class=nx>wantTime</span><span class=p>:</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Now</span><span class=p>().</span><span class=nx>AddDate</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>7</span><span class=p>).</span><span class=nx>Truncate</span><span class=p>(</span><span class=mi>24</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Hour</span><span class=p>),</span>
</span><span id=__span-16-118><a id=__codelineno-16-118 name=__codelineno-16-118></a><a href=#__codelineno-16-118><span class=linenos data-linenos="118 "></span></a><span class=w>            </span><span class=nx>wantErr</span><span class=p>:</span><span class=w>  </span><span class=kc>false</span><span class=p>,</span>
</span><span id=__span-16-119><a id=__codelineno-16-119 name=__codelineno-16-119></a><a href=#__codelineno-16-119><span class=linenos data-linenos="119 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-16-120><a id=__codelineno-16-120 name=__codelineno-16-120></a><a href=#__codelineno-16-120><span class=linenos data-linenos="120 "></span></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-16-121><a id=__codelineno-16-121 name=__codelineno-16-121></a><a href=#__codelineno-16-121><span class=linenos data-linenos="121 "></span></a><span class=w>            </span><span class=nx>input</span><span class=p>:</span><span class=w>    </span><span class=s>&quot;2024-12-31&quot;</span><span class=p>,</span>
</span><span id=__span-16-122><a id=__codelineno-16-122 name=__codelineno-16-122></a><a href=#__codelineno-16-122><span class=linenos data-linenos="122 "></span></a><span class=w>            </span><span class=nx>wantTime</span><span class=p>:</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Date</span><span class=p>(</span><span class=mi>2024</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=p>,</span><span class=w> </span><span class=mi>31</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Local</span><span class=p>),</span>
</span><span id=__span-16-123><a id=__codelineno-16-123 name=__codelineno-16-123></a><a href=#__codelineno-16-123><span class=linenos data-linenos="123 "></span></a><span class=w>            </span><span class=nx>wantErr</span><span class=p>:</span><span class=w>  </span><span class=kc>false</span><span class=p>,</span>
</span><span id=__span-16-124><a id=__codelineno-16-124 name=__codelineno-16-124></a><a href=#__codelineno-16-124><span class=linenos data-linenos="124 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-16-125><a id=__codelineno-16-125 name=__codelineno-16-125></a><a href=#__codelineno-16-125><span class=linenos data-linenos="125 "></span></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-16-126><a id=__codelineno-16-126 name=__codelineno-16-126></a><a href=#__codelineno-16-126><span class=linenos data-linenos="126 "></span></a><span class=w>            </span><span class=nx>input</span><span class=p>:</span><span class=w>   </span><span class=s>&quot;invalid&quot;</span><span class=p>,</span>
</span><span id=__span-16-127><a id=__codelineno-16-127 name=__codelineno-16-127></a><a href=#__codelineno-16-127><span class=linenos data-linenos="127 "></span></a><span class=w>            </span><span class=nx>wantErr</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-16-128><a id=__codelineno-16-128 name=__codelineno-16-128></a><a href=#__codelineno-16-128><span class=linenos data-linenos="128 "></span></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-16-129><a id=__codelineno-16-129 name=__codelineno-16-129></a><a href=#__codelineno-16-129><span class=linenos data-linenos="129 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-16-130><a id=__codelineno-16-130 name=__codelineno-16-130></a><a href=#__codelineno-16-130><span class=linenos data-linenos="130 "></span></a><span class=w>    </span>
</span><span id=__span-16-131><a id=__codelineno-16-131 name=__codelineno-16-131></a><a href=#__codelineno-16-131><span class=linenos data-linenos="131 "></span></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>tt</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>tests</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-132><a id=__codelineno-16-132 name=__codelineno-16-132></a><a href=#__codelineno-16-132><span class=linenos data-linenos="132 "></span></a><span class=w>        </span><span class=nx>t</span><span class=p>.</span><span class=nx>Run</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>input</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-133><a id=__codelineno-16-133 name=__codelineno-16-133></a><a href=#__codelineno-16-133><span class=linenos data-linenos="133 "></span></a><span class=w>            </span><span class=nx>got</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>commands</span><span class=p>.</span><span class=nx>ParseDueDate</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>input</span><span class=p>)</span>
</span><span id=__span-16-134><a id=__codelineno-16-134 name=__codelineno-16-134></a><a href=#__codelineno-16-134><span class=linenos data-linenos="134 "></span></a><span class=w>            </span>
</span><span id=__span-16-135><a id=__codelineno-16-135 name=__codelineno-16-135></a><a href=#__codelineno-16-135><span class=linenos data-linenos="135 "></span></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=nx>tt</span><span class=p>.</span><span class=nx>wantErr</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-136><a id=__codelineno-16-136 name=__codelineno-16-136></a><a href=#__codelineno-16-136><span class=linenos data-linenos="136 "></span></a><span class=w>                </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-16-137><a id=__codelineno-16-137 name=__codelineno-16-137></a><a href=#__codelineno-16-137><span class=linenos data-linenos="137 "></span></a><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-138><a id=__codelineno-16-138 name=__codelineno-16-138></a><a href=#__codelineno-16-138><span class=linenos data-linenos="138 "></span></a><span class=w>                </span><span class=nx>assert</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-16-139><a id=__codelineno-16-139 name=__codelineno-16-139></a><a href=#__codelineno-16-139><span class=linenos data-linenos="139 "></span></a><span class=w>                </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>tt</span><span class=p>.</span><span class=nx>wantTime</span><span class=p>.</span><span class=nx>Format</span><span class=p>(</span><span class=s>&quot;2006-01-02&quot;</span><span class=p>),</span><span class=w> </span><span class=nx>got</span><span class=p>.</span><span class=nx>Format</span><span class=p>(</span><span class=s>&quot;2006-01-02&quot;</span><span class=p>))</span>
</span><span id=__span-16-140><a id=__codelineno-16-140 name=__codelineno-16-140></a><a href=#__codelineno-16-140><span class=linenos data-linenos="140 "></span></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-16-141><a id=__codelineno-16-141 name=__codelineno-16-141></a><a href=#__codelineno-16-141><span class=linenos data-linenos="141 "></span></a><span class=w>        </span><span class=p>})</span>
</span><span id=__span-16-142><a id=__codelineno-16-142 name=__codelineno-16-142></a><a href=#__codelineno-16-142><span class=linenos data-linenos="142 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-16-143><a id=__codelineno-16-143 name=__codelineno-16-143></a><a href=#__codelineno-16-143><span class=linenos data-linenos="143 "></span></a><span class=p>}</span>
</span></code></pre></div></p><p><strong>Implementation:</strong><div class="language-go highlight"><span class=filename>Go</span><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1></a><a href=#__codelineno-17-1><span class=linenos data-linenos="  1 "></span></a><span class=c1>// cmd/commands/add.go</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2></a><a href=#__codelineno-17-2><span class=linenos data-linenos="  2 "></span></a><span class=kn>package</span><span class=w> </span><span class=nx>commands</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3></a><a href=#__codelineno-17-3><span class=linenos data-linenos="  3 "></span></a>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4></a><a href=#__codelineno-17-4><span class=linenos data-linenos="  4 "></span></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5></a><a href=#__codelineno-17-5><span class=linenos data-linenos="  5 "></span></a><span class=w>    </span><span class=s>&quot;errors&quot;</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6></a><a href=#__codelineno-17-6><span class=linenos data-linenos="  6 "></span></a><span class=w>    </span><span class=s>&quot;fmt&quot;</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7></a><a href=#__codelineno-17-7><span class=linenos data-linenos="  7 "></span></a><span class=w>    </span><span class=s>&quot;strings&quot;</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8></a><a href=#__codelineno-17-8><span class=linenos data-linenos="  8 "></span></a><span class=w>    </span><span class=s>&quot;time&quot;</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9></a><a href=#__codelineno-17-9><span class=linenos data-linenos="  9 "></span></a><span class=w>    </span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10></a><a href=#__codelineno-17-10><span class=linenos data-linenos=" 10 "></span></a><span class=w>    </span><span class=s>&quot;github.com/spf13/cobra&quot;</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11></a><a href=#__codelineno-17-11><span class=linenos data-linenos=" 11 "></span></a><span class=w>    </span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12></a><a href=#__codelineno-17-12><span class=linenos data-linenos=" 12 "></span></a><span class=w>    </span><span class=s>&quot;taskmaster/internal/task&quot;</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13></a><a href=#__codelineno-17-13><span class=linenos data-linenos=" 13 "></span></a><span class=w>    </span><span class=s>&quot;taskmaster/internal/storage&quot;</span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14></a><a href=#__codelineno-17-14><span class=linenos data-linenos=" 14 "></span></a><span class=p>)</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15></a><a href=#__codelineno-17-15><span class=linenos data-linenos=" 15 "></span></a>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16></a><a href=#__codelineno-17-16><span class=linenos data-linenos=" 16 "></span></a><span class=kd>type</span><span class=w> </span><span class=nx>AddCommand</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17></a><a href=#__codelineno-17-17><span class=linenos data-linenos=" 17 "></span></a><span class=w>    </span><span class=nx>storage</span><span class=w> </span><span class=nx>storage</span><span class=p>.</span><span class=nx>Storage</span>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18></a><a href=#__codelineno-17-18><span class=linenos data-linenos=" 18 "></span></a><span class=p>}</span>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19></a><a href=#__codelineno-17-19><span class=linenos data-linenos=" 19 "></span></a>
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20></a><a href=#__codelineno-17-20><span class=linenos data-linenos=" 20 "></span></a><span class=kd>func</span><span class=w> </span><span class=nx>NewAddCommand</span><span class=p>(</span><span class=nx>storage</span><span class=w> </span><span class=nx>storage</span><span class=p>.</span><span class=nx>Storage</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-21><a id=__codelineno-17-21 name=__codelineno-17-21></a><a href=#__codelineno-17-21><span class=linenos data-linenos=" 21 "></span></a><span class=w>    </span><span class=nx>ac</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>AddCommand</span><span class=p>{</span><span class=nx>storage</span><span class=p>:</span><span class=w> </span><span class=nx>storage</span><span class=p>}</span>
</span><span id=__span-17-22><a id=__codelineno-17-22 name=__codelineno-17-22></a><a href=#__codelineno-17-22><span class=linenos data-linenos=" 22 "></span></a><span class=w>    </span>
</span><span id=__span-17-23><a id=__codelineno-17-23 name=__codelineno-17-23></a><a href=#__codelineno-17-23><span class=linenos data-linenos=" 23 "></span></a><span class=w>    </span><span class=nx>cmd</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>{</span>
</span><span id=__span-17-24><a id=__codelineno-17-24 name=__codelineno-17-24></a><a href=#__codelineno-17-24><span class=linenos data-linenos=" 24 "></span></a><span class=w>        </span><span class=nx>Use</span><span class=p>:</span><span class=w>   </span><span class=s>&quot;add [description]&quot;</span><span class=p>,</span>
</span><span id=__span-17-25><a id=__codelineno-17-25 name=__codelineno-17-25></a><a href=#__codelineno-17-25><span class=linenos data-linenos=" 25 "></span></a><span class=w>        </span><span class=nx>Short</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Add a new task&quot;</span><span class=p>,</span>
</span><span id=__span-17-26><a id=__codelineno-17-26 name=__codelineno-17-26></a><a href=#__codelineno-17-26><span class=linenos data-linenos=" 26 "></span></a><span class=w>        </span><span class=nx>Long</span><span class=p>:</span><span class=w>  </span><span class=s>`Add a new task with optional project, priority, tags, and due date.`</span><span class=p>,</span>
</span><span id=__span-17-27><a id=__codelineno-17-27 name=__codelineno-17-27></a><a href=#__codelineno-17-27><span class=linenos data-linenos=" 27 "></span></a><span class=w>        </span><span class=nx>Args</span><span class=p>:</span><span class=w>  </span><span class=nx>cobra</span><span class=p>.</span><span class=nx>MinimumNArgs</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-17-28><a id=__codelineno-17-28 name=__codelineno-17-28></a><a href=#__codelineno-17-28><span class=linenos data-linenos=" 28 "></span></a><span class=w>        </span><span class=nx>RunE</span><span class=p>:</span><span class=w>  </span><span class=nx>ac</span><span class=p>.</span><span class=nx>runE</span><span class=p>,</span>
</span><span id=__span-17-29><a id=__codelineno-17-29 name=__codelineno-17-29></a><a href=#__codelineno-17-29><span class=linenos data-linenos=" 29 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-17-30><a id=__codelineno-17-30 name=__codelineno-17-30></a><a href=#__codelineno-17-30><span class=linenos data-linenos=" 30 "></span></a><span class=w>    </span>
</span><span id=__span-17-31><a id=__codelineno-17-31 name=__codelineno-17-31></a><a href=#__codelineno-17-31><span class=linenos data-linenos=" 31 "></span></a><span class=w>    </span><span class=nx>cmd</span><span class=p>.</span><span class=nx>Flags</span><span class=p>().</span><span class=nx>StringP</span><span class=p>(</span><span class=s>&quot;project&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;p&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Project name&quot;</span><span class=p>)</span>
</span><span id=__span-17-32><a id=__codelineno-17-32 name=__codelineno-17-32></a><a href=#__codelineno-17-32><span class=linenos data-linenos=" 32 "></span></a><span class=w>    </span><span class=nx>cmd</span><span class=p>.</span><span class=nx>Flags</span><span class=p>().</span><span class=nx>StringP</span><span class=p>(</span><span class=s>&quot;priority&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;r&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;medium&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Priority (low, medium, high)&quot;</span><span class=p>)</span>
</span><span id=__span-17-33><a id=__codelineno-17-33 name=__codelineno-17-33></a><a href=#__codelineno-17-33><span class=linenos data-linenos=" 33 "></span></a><span class=w>    </span><span class=nx>cmd</span><span class=p>.</span><span class=nx>Flags</span><span class=p>().</span><span class=nx>StringSliceP</span><span class=p>(</span><span class=s>&quot;tags&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;t&quot;</span><span class=p>,</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{},</span><span class=w> </span><span class=s>&quot;Tags (comma-separated)&quot;</span><span class=p>)</span>
</span><span id=__span-17-34><a id=__codelineno-17-34 name=__codelineno-17-34></a><a href=#__codelineno-17-34><span class=linenos data-linenos=" 34 "></span></a><span class=w>    </span><span class=nx>cmd</span><span class=p>.</span><span class=nx>Flags</span><span class=p>().</span><span class=nx>StringP</span><span class=p>(</span><span class=s>&quot;due&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;d&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Due date (e.g., tomorrow, next week, 2024-12-31)&quot;</span><span class=p>)</span>
</span><span id=__span-17-35><a id=__codelineno-17-35 name=__codelineno-17-35></a><a href=#__codelineno-17-35><span class=linenos data-linenos=" 35 "></span></a><span class=w>    </span>
</span><span id=__span-17-36><a id=__codelineno-17-36 name=__codelineno-17-36></a><a href=#__codelineno-17-36><span class=linenos data-linenos=" 36 "></span></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>cmd</span>
</span><span id=__span-17-37><a id=__codelineno-17-37 name=__codelineno-17-37></a><a href=#__codelineno-17-37><span class=linenos data-linenos=" 37 "></span></a><span class=p>}</span>
</span><span id=__span-17-38><a id=__codelineno-17-38 name=__codelineno-17-38></a><a href=#__codelineno-17-38><span class=linenos data-linenos=" 38 "></span></a>
</span><span id=__span-17-39><a id=__codelineno-17-39 name=__codelineno-17-39></a><a href=#__codelineno-17-39><span class=linenos data-linenos=" 39 "></span></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>ac</span><span class=w> </span><span class=o>*</span><span class=nx>AddCommand</span><span class=p>)</span><span class=w> </span><span class=nx>runE</span><span class=p>(</span><span class=nx>cmd</span><span class=w> </span><span class=o>*</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>,</span><span class=w> </span><span class=nx>args</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-40><a id=__codelineno-17-40 name=__codelineno-17-40></a><a href=#__codelineno-17-40><span class=linenos data-linenos=" 40 "></span></a><span class=w>    </span><span class=nx>description</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>strings</span><span class=p>.</span><span class=nx>Join</span><span class=p>(</span><span class=nx>args</span><span class=p>,</span><span class=w> </span><span class=s>&quot; &quot;</span><span class=p>)</span>
</span><span id=__span-17-41><a id=__codelineno-17-41 name=__codelineno-17-41></a><a href=#__codelineno-17-41><span class=linenos data-linenos=" 41 "></span></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>description</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-42><a id=__codelineno-17-42 name=__codelineno-17-42></a><a href=#__codelineno-17-42><span class=linenos data-linenos=" 42 "></span></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;task description is required&quot;</span><span class=p>)</span>
</span><span id=__span-17-43><a id=__codelineno-17-43 name=__codelineno-17-43></a><a href=#__codelineno-17-43><span class=linenos data-linenos=" 43 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-17-44><a id=__codelineno-17-44 name=__codelineno-17-44></a><a href=#__codelineno-17-44><span class=linenos data-linenos=" 44 "></span></a><span class=w>    </span>
</span><span id=__span-17-45><a id=__codelineno-17-45 name=__codelineno-17-45></a><a href=#__codelineno-17-45><span class=linenos data-linenos=" 45 "></span></a><span class=w>    </span><span class=c1>// Parse flags</span>
</span><span id=__span-17-46><a id=__codelineno-17-46 name=__codelineno-17-46></a><a href=#__codelineno-17-46><span class=linenos data-linenos=" 46 "></span></a><span class=w>    </span><span class=nx>project</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>cmd</span><span class=p>.</span><span class=nx>Flags</span><span class=p>().</span><span class=nx>GetString</span><span class=p>(</span><span class=s>&quot;project&quot;</span><span class=p>)</span>
</span><span id=__span-17-47><a id=__codelineno-17-47 name=__codelineno-17-47></a><a href=#__codelineno-17-47><span class=linenos data-linenos=" 47 "></span></a><span class=w>    </span><span class=nx>priorityStr</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>cmd</span><span class=p>.</span><span class=nx>Flags</span><span class=p>().</span><span class=nx>GetString</span><span class=p>(</span><span class=s>&quot;priority&quot;</span><span class=p>)</span>
</span><span id=__span-17-48><a id=__codelineno-17-48 name=__codelineno-17-48></a><a href=#__codelineno-17-48><span class=linenos data-linenos=" 48 "></span></a><span class=w>    </span><span class=nx>tags</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>cmd</span><span class=p>.</span><span class=nx>Flags</span><span class=p>().</span><span class=nx>GetStringSlice</span><span class=p>(</span><span class=s>&quot;tags&quot;</span><span class=p>)</span>
</span><span id=__span-17-49><a id=__codelineno-17-49 name=__codelineno-17-49></a><a href=#__codelineno-17-49><span class=linenos data-linenos=" 49 "></span></a><span class=w>    </span><span class=nx>dueStr</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>cmd</span><span class=p>.</span><span class=nx>Flags</span><span class=p>().</span><span class=nx>GetString</span><span class=p>(</span><span class=s>&quot;due&quot;</span><span class=p>)</span>
</span><span id=__span-17-50><a id=__codelineno-17-50 name=__codelineno-17-50></a><a href=#__codelineno-17-50><span class=linenos data-linenos=" 50 "></span></a><span class=w>    </span>
</span><span id=__span-17-51><a id=__codelineno-17-51 name=__codelineno-17-51></a><a href=#__codelineno-17-51><span class=linenos data-linenos=" 51 "></span></a><span class=w>    </span><span class=c1>// Parse priority</span>
</span><span id=__span-17-52><a id=__codelineno-17-52 name=__codelineno-17-52></a><a href=#__codelineno-17-52><span class=linenos data-linenos=" 52 "></span></a><span class=w>    </span><span class=nx>priority</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>task</span><span class=p>.</span><span class=nx>ParsePriority</span><span class=p>(</span><span class=nx>priorityStr</span><span class=p>)</span>
</span><span id=__span-17-53><a id=__codelineno-17-53 name=__codelineno-17-53></a><a href=#__codelineno-17-53><span class=linenos data-linenos=" 53 "></span></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-54><a id=__codelineno-17-54 name=__codelineno-17-54></a><a href=#__codelineno-17-54><span class=linenos data-linenos=" 54 "></span></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;invalid priority: %w&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-17-55><a id=__codelineno-17-55 name=__codelineno-17-55></a><a href=#__codelineno-17-55><span class=linenos data-linenos=" 55 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-17-56><a id=__codelineno-17-56 name=__codelineno-17-56></a><a href=#__codelineno-17-56><span class=linenos data-linenos=" 56 "></span></a><span class=w>    </span>
</span><span id=__span-17-57><a id=__codelineno-17-57 name=__codelineno-17-57></a><a href=#__codelineno-17-57><span class=linenos data-linenos=" 57 "></span></a><span class=w>    </span><span class=c1>// Parse due date</span>
</span><span id=__span-17-58><a id=__codelineno-17-58 name=__codelineno-17-58></a><a href=#__codelineno-17-58><span class=linenos data-linenos=" 58 "></span></a><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>dueDate</span><span class=w> </span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
</span><span id=__span-17-59><a id=__codelineno-17-59 name=__codelineno-17-59></a><a href=#__codelineno-17-59><span class=linenos data-linenos=" 59 "></span></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>dueStr</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-60><a id=__codelineno-17-60 name=__codelineno-17-60></a><a href=#__codelineno-17-60><span class=linenos data-linenos=" 60 "></span></a><span class=w>        </span><span class=nx>parsed</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ParseDueDate</span><span class=p>(</span><span class=nx>dueStr</span><span class=p>)</span>
</span><span id=__span-17-61><a id=__codelineno-17-61 name=__codelineno-17-61></a><a href=#__codelineno-17-61><span class=linenos data-linenos=" 61 "></span></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-62><a id=__codelineno-17-62 name=__codelineno-17-62></a><a href=#__codelineno-17-62><span class=linenos data-linenos=" 62 "></span></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;invalid due date: %w&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-17-63><a id=__codelineno-17-63 name=__codelineno-17-63></a><a href=#__codelineno-17-63><span class=linenos data-linenos=" 63 "></span></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-17-64><a id=__codelineno-17-64 name=__codelineno-17-64></a><a href=#__codelineno-17-64><span class=linenos data-linenos=" 64 "></span></a><span class=w>        </span><span class=nx>dueDate</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>parsed</span>
</span><span id=__span-17-65><a id=__codelineno-17-65 name=__codelineno-17-65></a><a href=#__codelineno-17-65><span class=linenos data-linenos=" 65 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-17-66><a id=__codelineno-17-66 name=__codelineno-17-66></a><a href=#__codelineno-17-66><span class=linenos data-linenos=" 66 "></span></a><span class=w>    </span>
</span><span id=__span-17-67><a id=__codelineno-17-67 name=__codelineno-17-67></a><a href=#__codelineno-17-67><span class=linenos data-linenos=" 67 "></span></a><span class=w>    </span><span class=c1>// Create task</span>
</span><span id=__span-17-68><a id=__codelineno-17-68 name=__codelineno-17-68></a><a href=#__codelineno-17-68><span class=linenos data-linenos=" 68 "></span></a><span class=w>    </span><span class=nx>t</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>task</span><span class=p>.</span><span class=nx>Task</span><span class=p>{</span>
</span><span id=__span-17-69><a id=__codelineno-17-69 name=__codelineno-17-69></a><a href=#__codelineno-17-69><span class=linenos data-linenos=" 69 "></span></a><span class=w>        </span><span class=nx>ID</span><span class=p>:</span><span class=w>          </span><span class=nx>task</span><span class=p>.</span><span class=nx>GenerateID</span><span class=p>(),</span>
</span><span id=__span-17-70><a id=__codelineno-17-70 name=__codelineno-17-70></a><a href=#__codelineno-17-70><span class=linenos data-linenos=" 70 "></span></a><span class=w>        </span><span class=nx>Description</span><span class=p>:</span><span class=w> </span><span class=nx>description</span><span class=p>,</span>
</span><span id=__span-17-71><a id=__codelineno-17-71 name=__codelineno-17-71></a><a href=#__codelineno-17-71><span class=linenos data-linenos=" 71 "></span></a><span class=w>        </span><span class=nx>Project</span><span class=p>:</span><span class=w>     </span><span class=nx>project</span><span class=p>,</span>
</span><span id=__span-17-72><a id=__codelineno-17-72 name=__codelineno-17-72></a><a href=#__codelineno-17-72><span class=linenos data-linenos=" 72 "></span></a><span class=w>        </span><span class=nx>Priority</span><span class=p>:</span><span class=w>    </span><span class=nx>priority</span><span class=p>,</span>
</span><span id=__span-17-73><a id=__codelineno-17-73 name=__codelineno-17-73></a><a href=#__codelineno-17-73><span class=linenos data-linenos=" 73 "></span></a><span class=w>        </span><span class=nx>Tags</span><span class=p>:</span><span class=w>        </span><span class=nx>tags</span><span class=p>,</span>
</span><span id=__span-17-74><a id=__codelineno-17-74 name=__codelineno-17-74></a><a href=#__codelineno-17-74><span class=linenos data-linenos=" 74 "></span></a><span class=w>        </span><span class=nx>DueDate</span><span class=p>:</span><span class=w>     </span><span class=nx>dueDate</span><span class=p>,</span>
</span><span id=__span-17-75><a id=__codelineno-17-75 name=__codelineno-17-75></a><a href=#__codelineno-17-75><span class=linenos data-linenos=" 75 "></span></a><span class=w>        </span><span class=nx>CreatedAt</span><span class=p>:</span><span class=w>   </span><span class=nx>time</span><span class=p>.</span><span class=nx>Now</span><span class=p>(),</span>
</span><span id=__span-17-76><a id=__codelineno-17-76 name=__codelineno-17-76></a><a href=#__codelineno-17-76><span class=linenos data-linenos=" 76 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-17-77><a id=__codelineno-17-77 name=__codelineno-17-77></a><a href=#__codelineno-17-77><span class=linenos data-linenos=" 77 "></span></a><span class=w>    </span>
</span><span id=__span-17-78><a id=__codelineno-17-78 name=__codelineno-17-78></a><a href=#__codelineno-17-78><span class=linenos data-linenos=" 78 "></span></a><span class=w>    </span><span class=c1>// Save task</span>
</span><span id=__span-17-79><a id=__codelineno-17-79 name=__codelineno-17-79></a><a href=#__codelineno-17-79><span class=linenos data-linenos=" 79 "></span></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ac</span><span class=p>.</span><span class=nx>storage</span><span class=p>.</span><span class=nx>SaveTask</span><span class=p>(</span><span class=nx>t</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-80><a id=__codelineno-17-80 name=__codelineno-17-80></a><a href=#__codelineno-17-80><span class=linenos data-linenos=" 80 "></span></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;failed to save task: %w&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
</span><span id=__span-17-81><a id=__codelineno-17-81 name=__codelineno-17-81></a><a href=#__codelineno-17-81><span class=linenos data-linenos=" 81 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-17-82><a id=__codelineno-17-82 name=__codelineno-17-82></a><a href=#__codelineno-17-82><span class=linenos data-linenos=" 82 "></span></a><span class=w>    </span>
</span><span id=__span-17-83><a id=__codelineno-17-83 name=__codelineno-17-83></a><a href=#__codelineno-17-83><span class=linenos data-linenos=" 83 "></span></a><span class=w>    </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Printf</span><span class=p>(</span><span class=s>&quot;✓ Task added: %s\n&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>t</span><span class=p>.</span><span class=nx>ID</span><span class=p>)</span>
</span><span id=__span-17-84><a id=__codelineno-17-84 name=__codelineno-17-84></a><a href=#__codelineno-17-84><span class=linenos data-linenos=" 84 "></span></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
</span><span id=__span-17-85><a id=__codelineno-17-85 name=__codelineno-17-85></a><a href=#__codelineno-17-85><span class=linenos data-linenos=" 85 "></span></a><span class=p>}</span>
</span><span id=__span-17-86><a id=__codelineno-17-86 name=__codelineno-17-86></a><a href=#__codelineno-17-86><span class=linenos data-linenos=" 86 "></span></a>
</span><span id=__span-17-87><a id=__codelineno-17-87 name=__codelineno-17-87></a><a href=#__codelineno-17-87><span class=linenos data-linenos=" 87 "></span></a><span class=kd>func</span><span class=w> </span><span class=nx>ParseDueDate</span><span class=p>(</span><span class=nx>input</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-88><a id=__codelineno-17-88 name=__codelineno-17-88></a><a href=#__codelineno-17-88><span class=linenos data-linenos=" 88 "></span></a><span class=w>    </span><span class=nx>now</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Now</span><span class=p>()</span>
</span><span id=__span-17-89><a id=__codelineno-17-89 name=__codelineno-17-89></a><a href=#__codelineno-17-89><span class=linenos data-linenos=" 89 "></span></a><span class=w>    </span>
</span><span id=__span-17-90><a id=__codelineno-17-90 name=__codelineno-17-90></a><a href=#__codelineno-17-90><span class=linenos data-linenos=" 90 "></span></a><span class=w>    </span><span class=k>switch</span><span class=w> </span><span class=nx>strings</span><span class=p>.</span><span class=nx>ToLower</span><span class=p>(</span><span class=nx>input</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-91><a id=__codelineno-17-91 name=__codelineno-17-91></a><a href=#__codelineno-17-91><span class=linenos data-linenos=" 91 "></span></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s>&quot;today&quot;</span><span class=p>:</span>
</span><span id=__span-17-92><a id=__codelineno-17-92 name=__codelineno-17-92></a><a href=#__codelineno-17-92><span class=linenos data-linenos=" 92 "></span></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>now</span><span class=p>.</span><span class=nx>Truncate</span><span class=p>(</span><span class=mi>24</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Hour</span><span class=p>),</span><span class=w> </span><span class=kc>nil</span>
</span><span id=__span-17-93><a id=__codelineno-17-93 name=__codelineno-17-93></a><a href=#__codelineno-17-93><span class=linenos data-linenos=" 93 "></span></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s>&quot;tomorrow&quot;</span><span class=p>:</span>
</span><span id=__span-17-94><a id=__codelineno-17-94 name=__codelineno-17-94></a><a href=#__codelineno-17-94><span class=linenos data-linenos=" 94 "></span></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>now</span><span class=p>.</span><span class=nx>AddDate</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>).</span><span class=nx>Truncate</span><span class=p>(</span><span class=mi>24</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Hour</span><span class=p>),</span><span class=w> </span><span class=kc>nil</span>
</span><span id=__span-17-95><a id=__codelineno-17-95 name=__codelineno-17-95></a><a href=#__codelineno-17-95><span class=linenos data-linenos=" 95 "></span></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s>&quot;next week&quot;</span><span class=p>:</span>
</span><span id=__span-17-96><a id=__codelineno-17-96 name=__codelineno-17-96></a><a href=#__codelineno-17-96><span class=linenos data-linenos=" 96 "></span></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>now</span><span class=p>.</span><span class=nx>AddDate</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>7</span><span class=p>).</span><span class=nx>Truncate</span><span class=p>(</span><span class=mi>24</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Hour</span><span class=p>),</span><span class=w> </span><span class=kc>nil</span>
</span><span id=__span-17-97><a id=__codelineno-17-97 name=__codelineno-17-97></a><a href=#__codelineno-17-97><span class=linenos data-linenos=" 97 "></span></a><span class=w>    </span><span class=k>default</span><span class=p>:</span>
</span><span id=__span-17-98><a id=__codelineno-17-98 name=__codelineno-17-98></a><a href=#__codelineno-17-98><span class=linenos data-linenos=" 98 "></span></a><span class=w>        </span><span class=c1>// Try parsing as date</span>
</span><span id=__span-17-99><a id=__codelineno-17-99 name=__codelineno-17-99></a><a href=#__codelineno-17-99><span class=linenos data-linenos=" 99 "></span></a><span class=w>        </span><span class=nx>layouts</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span>
</span><span id=__span-17-100><a id=__codelineno-17-100 name=__codelineno-17-100></a><a href=#__codelineno-17-100><span class=linenos data-linenos="100 "></span></a><span class=w>            </span><span class=s>&quot;2006-01-02&quot;</span><span class=p>,</span>
</span><span id=__span-17-101><a id=__codelineno-17-101 name=__codelineno-17-101></a><a href=#__codelineno-17-101><span class=linenos data-linenos="101 "></span></a><span class=w>            </span><span class=s>&quot;01/02/2006&quot;</span><span class=p>,</span>
</span><span id=__span-17-102><a id=__codelineno-17-102 name=__codelineno-17-102></a><a href=#__codelineno-17-102><span class=linenos data-linenos="102 "></span></a><span class=w>            </span><span class=s>&quot;Jan 2, 2006&quot;</span><span class=p>,</span>
</span><span id=__span-17-103><a id=__codelineno-17-103 name=__codelineno-17-103></a><a href=#__codelineno-17-103><span class=linenos data-linenos="103 "></span></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-17-104><a id=__codelineno-17-104 name=__codelineno-17-104></a><a href=#__codelineno-17-104><span class=linenos data-linenos="104 "></span></a><span class=w>        </span>
</span><span id=__span-17-105><a id=__codelineno-17-105 name=__codelineno-17-105></a><a href=#__codelineno-17-105><span class=linenos data-linenos="105 "></span></a><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>layout</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>layouts</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-106><a id=__codelineno-17-106 name=__codelineno-17-106></a><a href=#__codelineno-17-106><span class=linenos data-linenos="106 "></span></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Parse</span><span class=p>(</span><span class=nx>layout</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-107><a id=__codelineno-17-107 name=__codelineno-17-107></a><a href=#__codelineno-17-107><span class=linenos data-linenos="107 "></span></a><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
</span><span id=__span-17-108><a id=__codelineno-17-108 name=__codelineno-17-108></a><a href=#__codelineno-17-108><span class=linenos data-linenos="108 "></span></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-17-109><a id=__codelineno-17-109 name=__codelineno-17-109></a><a href=#__codelineno-17-109><span class=linenos data-linenos="109 "></span></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-17-110><a id=__codelineno-17-110 name=__codelineno-17-110></a><a href=#__codelineno-17-110><span class=linenos data-linenos="110 "></span></a><span class=w>        </span>
</span><span id=__span-17-111><a id=__codelineno-17-111 name=__codelineno-17-111></a><a href=#__codelineno-17-111><span class=linenos data-linenos="111 "></span></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=p>{},</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;unrecognized date format: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=p>)</span>
</span><span id=__span-17-112><a id=__codelineno-17-112 name=__codelineno-17-112></a><a href=#__codelineno-17-112><span class=linenos data-linenos="112 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-17-113><a id=__codelineno-17-113 name=__codelineno-17-113></a><a href=#__codelineno-17-113><span class=linenos data-linenos="113 "></span></a><span class=p>}</span>
</span></code></pre></div></p><h6 id=3-plugin-system-architecture>3. Plugin System Architecture<a class=headerlink href=#3-plugin-system-architecture title="Permanent link">&para;</a></h6><p><strong>Design:</strong><div class="language-go highlight"><span class=filename>Go</span><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1></a><a href=#__codelineno-18-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1>// internal/plugins/plugin.go</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2></a><a href=#__codelineno-18-2><span class=linenos data-linenos=" 2 "></span></a><span class=kn>package</span><span class=w> </span><span class=nx>plugins</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3></a><a href=#__codelineno-18-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4></a><a href=#__codelineno-18-4><span class=linenos data-linenos=" 4 "></span></a><span class=kn>import</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5></a><a href=#__codelineno-18-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>    </span><span class=s>&quot;context&quot;</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6></a><a href=#__codelineno-18-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>    </span><span class=s>&quot;taskmaster/internal/task&quot;</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7></a><a href=#__codelineno-18-7><span class=linenos data-linenos=" 7 "></span></a><span class=p>)</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8></a><a href=#__codelineno-18-8><span class=linenos data-linenos=" 8 "></span></a>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9></a><a href=#__codelineno-18-9><span class=linenos data-linenos=" 9 "></span></a><span class=kd>type</span><span class=w> </span><span class=nx>Plugin</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10></a><a href=#__codelineno-18-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span><span class=nx>Name</span><span class=p>()</span><span class=w> </span><span class=kt>string</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11></a><a href=#__codelineno-18-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span><span class=nx>Version</span><span class=p>()</span><span class=w> </span><span class=kt>string</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12></a><a href=#__codelineno-18-12><span class=linenos data-linenos="12 "></span></a><span class=w>    </span><span class=nx>Initialize</span><span class=p>(</span><span class=nx>config</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{})</span><span class=w> </span><span class=kt>error</span>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13></a><a href=#__codelineno-18-13><span class=linenos data-linenos="13 "></span></a><span class=w>    </span><span class=nx>Hooks</span><span class=p>()</span><span class=w> </span><span class=p>[]</span><span class=nx>Hook</span>
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14></a><a href=#__codelineno-18-14><span class=linenos data-linenos="14 "></span></a><span class=p>}</span>
</span><span id=__span-18-15><a id=__codelineno-18-15 name=__codelineno-18-15></a><a href=#__codelineno-18-15><span class=linenos data-linenos="15 "></span></a>
</span><span id=__span-18-16><a id=__codelineno-18-16 name=__codelineno-18-16></a><a href=#__codelineno-18-16><span class=linenos data-linenos="16 "></span></a><span class=kd>type</span><span class=w> </span><span class=nx>Hook</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-17><a id=__codelineno-18-17 name=__codelineno-18-17></a><a href=#__codelineno-18-17><span class=linenos data-linenos="17 "></span></a><span class=w>    </span><span class=nx>Type</span><span class=p>()</span><span class=w> </span><span class=nx>HookType</span>
</span><span id=__span-18-18><a id=__codelineno-18-18 name=__codelineno-18-18></a><a href=#__codelineno-18-18><span class=linenos data-linenos="18 "></span></a><span class=w>    </span><span class=nx>Execute</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>data</span><span class=w> </span><span class=kd>interface</span><span class=p>{})</span><span class=w> </span><span class=kt>error</span>
</span><span id=__span-18-19><a id=__codelineno-18-19 name=__codelineno-18-19></a><a href=#__codelineno-18-19><span class=linenos data-linenos="19 "></span></a><span class=p>}</span>
</span><span id=__span-18-20><a id=__codelineno-18-20 name=__codelineno-18-20></a><a href=#__codelineno-18-20><span class=linenos data-linenos="20 "></span></a>
</span><span id=__span-18-21><a id=__codelineno-18-21 name=__codelineno-18-21></a><a href=#__codelineno-18-21><span class=linenos data-linenos="21 "></span></a><span class=kd>type</span><span class=w> </span><span class=nx>HookType</span><span class=w> </span><span class=kt>string</span>
</span><span id=__span-18-22><a id=__codelineno-18-22 name=__codelineno-18-22></a><a href=#__codelineno-18-22><span class=linenos data-linenos="22 "></span></a>
</span><span id=__span-18-23><a id=__codelineno-18-23 name=__codelineno-18-23></a><a href=#__codelineno-18-23><span class=linenos data-linenos="23 "></span></a><span class=kd>const</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-18-24><a id=__codelineno-18-24 name=__codelineno-18-24></a><a href=#__codelineno-18-24><span class=linenos data-linenos="24 "></span></a><span class=w>    </span><span class=nx>HookBeforeTaskAdd</span><span class=w>    </span><span class=nx>HookType</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;before_task_add&quot;</span>
</span><span id=__span-18-25><a id=__codelineno-18-25 name=__codelineno-18-25></a><a href=#__codelineno-18-25><span class=linenos data-linenos="25 "></span></a><span class=w>    </span><span class=nx>HookAfterTaskAdd</span><span class=w>     </span><span class=nx>HookType</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;after_task_add&quot;</span>
</span><span id=__span-18-26><a id=__codelineno-18-26 name=__codelineno-18-26></a><a href=#__codelineno-18-26><span class=linenos data-linenos="26 "></span></a><span class=w>    </span><span class=nx>HookBeforeTaskUpdate</span><span class=w> </span><span class=nx>HookType</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;before_task_update&quot;</span>
</span><span id=__span-18-27><a id=__codelineno-18-27 name=__codelineno-18-27></a><a href=#__codelineno-18-27><span class=linenos data-linenos="27 "></span></a><span class=w>    </span><span class=nx>HookAfterTaskUpdate</span><span class=w>  </span><span class=nx>HookType</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;after_task_update&quot;</span>
</span><span id=__span-18-28><a id=__codelineno-18-28 name=__codelineno-18-28></a><a href=#__codelineno-18-28><span class=linenos data-linenos="28 "></span></a><span class=p>)</span>
</span><span id=__span-18-29><a id=__codelineno-18-29 name=__codelineno-18-29></a><a href=#__codelineno-18-29><span class=linenos data-linenos="29 "></span></a>
</span><span id=__span-18-30><a id=__codelineno-18-30 name=__codelineno-18-30></a><a href=#__codelineno-18-30><span class=linenos data-linenos="30 "></span></a><span class=c1>// Example plugin: Slack notifications</span>
</span><span id=__span-18-31><a id=__codelineno-18-31 name=__codelineno-18-31></a><a href=#__codelineno-18-31><span class=linenos data-linenos="31 "></span></a><span class=kd>type</span><span class=w> </span><span class=nx>SlackPlugin</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-32><a id=__codelineno-18-32 name=__codelineno-18-32></a><a href=#__codelineno-18-32><span class=linenos data-linenos="32 "></span></a><span class=w>    </span><span class=nx>webhookURL</span><span class=w> </span><span class=kt>string</span>
</span><span id=__span-18-33><a id=__codelineno-18-33 name=__codelineno-18-33></a><a href=#__codelineno-18-33><span class=linenos data-linenos="33 "></span></a><span class=p>}</span>
</span><span id=__span-18-34><a id=__codelineno-18-34 name=__codelineno-18-34></a><a href=#__codelineno-18-34><span class=linenos data-linenos="34 "></span></a>
</span><span id=__span-18-35><a id=__codelineno-18-35 name=__codelineno-18-35></a><a href=#__codelineno-18-35><span class=linenos data-linenos="35 "></span></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>SlackPlugin</span><span class=p>)</span><span class=w> </span><span class=nx>Name</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=s>&quot;slack-notifications&quot;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-18-36><a id=__codelineno-18-36 name=__codelineno-18-36></a><a href=#__codelineno-18-36><span class=linenos data-linenos="36 "></span></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>SlackPlugin</span><span class=p>)</span><span class=w> </span><span class=nx>Version</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-18-37><a id=__codelineno-18-37 name=__codelineno-18-37></a><a href=#__codelineno-18-37><span class=linenos data-linenos="37 "></span></a>
</span><span id=__span-18-38><a id=__codelineno-18-38 name=__codelineno-18-38></a><a href=#__codelineno-18-38><span class=linenos data-linenos="38 "></span></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>SlackPlugin</span><span class=p>)</span><span class=w> </span><span class=nx>Initialize</span><span class=p>(</span><span class=nx>config</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{})</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-39><a id=__codelineno-18-39 name=__codelineno-18-39></a><a href=#__codelineno-18-39><span class=linenos data-linenos="39 "></span></a><span class=w>    </span><span class=nx>url</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>config</span><span class=p>[</span><span class=s>&quot;webhook_url&quot;</span><span class=p>].(</span><span class=kt>string</span><span class=p>)</span>
</span><span id=__span-18-40><a id=__codelineno-18-40 name=__codelineno-18-40></a><a href=#__codelineno-18-40><span class=linenos data-linenos="40 "></span></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>ok</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-41><a id=__codelineno-18-41 name=__codelineno-18-41></a><a href=#__codelineno-18-41><span class=linenos data-linenos="41 "></span></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;webhook_url is required&quot;</span><span class=p>)</span>
</span><span id=__span-18-42><a id=__codelineno-18-42 name=__codelineno-18-42></a><a href=#__codelineno-18-42><span class=linenos data-linenos="42 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-18-43><a id=__codelineno-18-43 name=__codelineno-18-43></a><a href=#__codelineno-18-43><span class=linenos data-linenos="43 "></span></a><span class=w>    </span><span class=nx>p</span><span class=p>.</span><span class=nx>webhookURL</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>url</span>
</span><span id=__span-18-44><a id=__codelineno-18-44 name=__codelineno-18-44></a><a href=#__codelineno-18-44><span class=linenos data-linenos="44 "></span></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
</span><span id=__span-18-45><a id=__codelineno-18-45 name=__codelineno-18-45></a><a href=#__codelineno-18-45><span class=linenos data-linenos="45 "></span></a><span class=p>}</span>
</span><span id=__span-18-46><a id=__codelineno-18-46 name=__codelineno-18-46></a><a href=#__codelineno-18-46><span class=linenos data-linenos="46 "></span></a>
</span><span id=__span-18-47><a id=__codelineno-18-47 name=__codelineno-18-47></a><a href=#__codelineno-18-47><span class=linenos data-linenos="47 "></span></a><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>SlackPlugin</span><span class=p>)</span><span class=w> </span><span class=nx>Hooks</span><span class=p>()</span><span class=w> </span><span class=p>[]</span><span class=nx>Hook</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-48><a id=__codelineno-18-48 name=__codelineno-18-48></a><a href=#__codelineno-18-48><span class=linenos data-linenos="48 "></span></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>[]</span><span class=nx>Hook</span><span class=p>{</span>
</span><span id=__span-18-49><a id=__codelineno-18-49 name=__codelineno-18-49></a><a href=#__codelineno-18-49><span class=linenos data-linenos="49 "></span></a><span class=w>        </span><span class=o>&amp;</span><span class=nx>SlackHook</span><span class=p>{</span><span class=nx>plugin</span><span class=p>:</span><span class=w> </span><span class=nx>p</span><span class=p>,</span><span class=w> </span><span class=nx>hookType</span><span class=p>:</span><span class=w> </span><span class=nx>HookAfterTaskAdd</span><span class=p>},</span>
</span><span id=__span-18-50><a id=__codelineno-18-50 name=__codelineno-18-50></a><a href=#__codelineno-18-50><span class=linenos data-linenos="50 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-18-51><a id=__codelineno-18-51 name=__codelineno-18-51></a><a href=#__codelineno-18-51><span class=linenos data-linenos="51 "></span></a><span class=p>}</span>
</span></code></pre></div></p><h3 id=data-pipeline-project>Data Pipeline Project<a class=headerlink href=#data-pipeline-project title="Permanent link">&para;</a></h3><h4 id=building-a-data-pipeline-with-tdd>Building a Data Pipeline with TDD<a class=headerlink href=#building-a-data-pipeline-with-tdd title="Permanent link">&para;</a></h4><p>A complete example of creating a data processing pipeline using the AI Agent TDD-Scrum workflow. This project demonstrates ETL operations, stream processing, and data quality validation.</p><p><strong>Project Repository:</strong> <a href=https://github.com/agent-workflow-examples/dataflow-pipeline>github.com/agent-workflow-examples/dataflow-pipeline</a></p><h5 id=project-overview_1>Project Overview<a class=headerlink href=#project-overview_1 title="Permanent link">&para;</a></h5><p>DataFlow Pipeline - A scalable data processing system featuring: - Real-time data ingestion from multiple sources - Data transformation and enrichment - Quality validation and error handling - Batch and stream processing modes - Monitoring and alerting</p><h5 id=project-structure_2>Project Structure<a class=headerlink href=#project-structure_2 title="Permanent link">&para;</a></h5><div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1></a><a href=#__codelineno-19-1><span class=linenos data-linenos=" 1 "></span></a>dataflow-pipeline/
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2></a><a href=#__codelineno-19-2><span class=linenos data-linenos=" 2 "></span></a>├── .github/
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3></a><a href=#__codelineno-19-3><span class=linenos data-linenos=" 3 "></span></a>│   └── workflows/
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4></a><a href=#__codelineno-19-4><span class=linenos data-linenos=" 4 "></span></a>│       ├── data-validation.yml      # Data quality checks
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5></a><a href=#__codelineno-19-5><span class=linenos data-linenos=" 5 "></span></a>│       └── pipeline-tests.yml       # Pipeline testing
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6></a><a href=#__codelineno-19-6><span class=linenos data-linenos=" 6 "></span></a>├── .orch-state/                     # Agent workflow state
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7></a><a href=#__codelineno-19-7><span class=linenos data-linenos=" 7 "></span></a>├── src/
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8></a><a href=#__codelineno-19-8><span class=linenos data-linenos=" 8 "></span></a>│   ├── ingestion/                   # Data ingestion modules
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9></a><a href=#__codelineno-19-9><span class=linenos data-linenos=" 9 "></span></a>│   │   ├── kafka_consumer.py
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10></a><a href=#__codelineno-19-10><span class=linenos data-linenos="10 "></span></a>│   │   ├── file_watcher.py
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11></a><a href=#__codelineno-19-11><span class=linenos data-linenos="11 "></span></a>│   │   └── api_poller.py
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12></a><a href=#__codelineno-19-12><span class=linenos data-linenos="12 "></span></a>│   ├── transformation/              # Data transformation
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13></a><a href=#__codelineno-19-13><span class=linenos data-linenos="13 "></span></a>│   │   ├── cleaners.py
</span><span id=__span-19-14><a id=__codelineno-19-14 name=__codelineno-19-14></a><a href=#__codelineno-19-14><span class=linenos data-linenos="14 "></span></a>│   │   ├── enrichers.py
</span><span id=__span-19-15><a id=__codelineno-19-15 name=__codelineno-19-15></a><a href=#__codelineno-19-15><span class=linenos data-linenos="15 "></span></a>│   │   └── aggregators.py
</span><span id=__span-19-16><a id=__codelineno-19-16 name=__codelineno-19-16></a><a href=#__codelineno-19-16><span class=linenos data-linenos="16 "></span></a>│   ├── validation/                  # Data quality
</span><span id=__span-19-17><a id=__codelineno-19-17 name=__codelineno-19-17></a><a href=#__codelineno-19-17><span class=linenos data-linenos="17 "></span></a>│   │   ├── schemas.py
</span><span id=__span-19-18><a id=__codelineno-19-18 name=__codelineno-19-18></a><a href=#__codelineno-19-18><span class=linenos data-linenos="18 "></span></a>│   │   ├── rules.py
</span><span id=__span-19-19><a id=__codelineno-19-19 name=__codelineno-19-19></a><a href=#__codelineno-19-19><span class=linenos data-linenos="19 "></span></a>│   │   └── validators.py
</span><span id=__span-19-20><a id=__codelineno-19-20 name=__codelineno-19-20></a><a href=#__codelineno-19-20><span class=linenos data-linenos="20 "></span></a>│   ├── storage/                     # Data storage
</span><span id=__span-19-21><a id=__codelineno-19-21 name=__codelineno-19-21></a><a href=#__codelineno-19-21><span class=linenos data-linenos="21 "></span></a>│   │   ├── data_lake.py
</span><span id=__span-19-22><a id=__codelineno-19-22 name=__codelineno-19-22></a><a href=#__codelineno-19-22><span class=linenos data-linenos="22 "></span></a>│   │   ├── warehouse.py
</span><span id=__span-19-23><a id=__codelineno-19-23 name=__codelineno-19-23></a><a href=#__codelineno-19-23><span class=linenos data-linenos="23 "></span></a>│   │   └── cache.py
</span><span id=__span-19-24><a id=__codelineno-19-24 name=__codelineno-19-24></a><a href=#__codelineno-19-24><span class=linenos data-linenos="24 "></span></a>│   └── monitoring/                  # Pipeline monitoring
</span><span id=__span-19-25><a id=__codelineno-19-25 name=__codelineno-19-25></a><a href=#__codelineno-19-25><span class=linenos data-linenos="25 "></span></a>│       ├── metrics.py
</span><span id=__span-19-26><a id=__codelineno-19-26 name=__codelineno-19-26></a><a href=#__codelineno-19-26><span class=linenos data-linenos="26 "></span></a>│       └── alerts.py
</span><span id=__span-19-27><a id=__codelineno-19-27 name=__codelineno-19-27></a><a href=#__codelineno-19-27><span class=linenos data-linenos="27 "></span></a>├── tests/
</span><span id=__span-19-28><a id=__codelineno-19-28 name=__codelineno-19-28></a><a href=#__codelineno-19-28><span class=linenos data-linenos="28 "></span></a>│   ├── unit/
</span><span id=__span-19-29><a id=__codelineno-19-29 name=__codelineno-19-29></a><a href=#__codelineno-19-29><span class=linenos data-linenos="29 "></span></a>│   ├── integration/
</span><span id=__span-19-30><a id=__codelineno-19-30 name=__codelineno-19-30></a><a href=#__codelineno-19-30><span class=linenos data-linenos="30 "></span></a>│   └── tdd/
</span><span id=__span-19-31><a id=__codelineno-19-31 name=__codelineno-19-31></a><a href=#__codelineno-19-31><span class=linenos data-linenos="31 "></span></a>│       ├── PIPE-001/                # Kafka ingestion
</span><span id=__span-19-32><a id=__codelineno-19-32 name=__codelineno-19-32></a><a href=#__codelineno-19-32><span class=linenos data-linenos="32 "></span></a>│       ├── PIPE-002/                # Data validation
</span><span id=__span-19-33><a id=__codelineno-19-33 name=__codelineno-19-33></a><a href=#__codelineno-19-33><span class=linenos data-linenos="33 "></span></a>│       └── PIPE-003/                # Transformation logic
</span><span id=__span-19-34><a id=__codelineno-19-34 name=__codelineno-19-34></a><a href=#__codelineno-19-34><span class=linenos data-linenos="34 "></span></a>├── airflow/
</span><span id=__span-19-35><a id=__codelineno-19-35 name=__codelineno-19-35></a><a href=#__codelineno-19-35><span class=linenos data-linenos="35 "></span></a>│   └── dags/                        # Airflow DAGs
</span><span id=__span-19-36><a id=__codelineno-19-36 name=__codelineno-19-36></a><a href=#__codelineno-19-36><span class=linenos data-linenos="36 "></span></a>├── docker/
</span><span id=__span-19-37><a id=__codelineno-19-37 name=__codelineno-19-37></a><a href=#__codelineno-19-37><span class=linenos data-linenos="37 "></span></a>│   ├── Dockerfile
</span><span id=__span-19-38><a id=__codelineno-19-38 name=__codelineno-19-38></a><a href=#__codelineno-19-38><span class=linenos data-linenos="38 "></span></a>│   └── docker-compose.yml
</span><span id=__span-19-39><a id=__codelineno-19-39 name=__codelineno-19-39></a><a href=#__codelineno-19-39><span class=linenos data-linenos="39 "></span></a>└── config/
</span><span id=__span-19-40><a id=__codelineno-19-40 name=__codelineno-19-40></a><a href=#__codelineno-19-40><span class=linenos data-linenos="40 "></span></a>    ├── pipeline.yaml                # Pipeline configuration
</span><span id=__span-19-41><a id=__codelineno-19-41 name=__codelineno-19-41></a><a href=#__codelineno-19-41><span class=linenos data-linenos="41 "></span></a>    └── schemas/                     # Data schemas
</span></code></pre></div><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1></a><a href=#__codelineno-20-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># config/django-web.yml</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2></a><a href=#__codelineno-20-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>orchestrator</span><span class=p>:</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3></a><a href=#__codelineno-20-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>  </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">blocking</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4></a><a href=#__codelineno-20-4><span class=linenos data-linenos=" 4 "></span></a><span class=w>  </span><span class=nt>project_path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/workspace/django-app&quot;</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5></a><a href=#__codelineno-20-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6></a><a href=#__codelineno-20-6><span class=linenos data-linenos=" 6 "></span></a><span class=nt>tdd</span><span class=p>:</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7></a><a href=#__codelineno-20-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8></a><a href=#__codelineno-20-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>  </span><span class=nt>test_execution</span><span class=p>:</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9></a><a href=#__codelineno-20-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>    </span><span class=nt>runner</span><span class=p>:</span><span class=w> </span><span class=s>&quot;python</span><span class=nv> </span><span class=s>manage.py</span><span class=nv> </span><span class=s>test&quot;</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10></a><a href=#__codelineno-20-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span><span class=nt>coverage_threshold</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">90</span>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11></a><a href=#__codelineno-20-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span><span class=nt>parallel_jobs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12></a><a href=#__codelineno-20-12><span class=linenos data-linenos="12 "></span></a><span class=w>    </span>
</span><span id=__span-20-13><a id=__codelineno-20-13 name=__codelineno-20-13></a><a href=#__codelineno-20-13><span class=linenos data-linenos="13 "></span></a><span class=w>  </span><span class=nt>quality_gates</span><span class=p>:</span>
</span><span id=__span-20-14><a id=__codelineno-20-14 name=__codelineno-20-14></a><a href=#__codelineno-20-14><span class=linenos data-linenos="14 "></span></a><span class=w>    </span><span class=nt>code_green_phase</span><span class=p>:</span>
</span><span id=__span-20-15><a id=__codelineno-20-15 name=__codelineno-20-15></a><a href=#__codelineno-20-15><span class=linenos data-linenos="15 "></span></a><span class=w>      </span><span class=nt>require_migrations</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-20-16><a id=__codelineno-20-16 name=__codelineno-20-16></a><a href=#__codelineno-20-16><span class=linenos data-linenos="16 "></span></a><span class=w>      </span><span class=nt>validate_models</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-20-17><a id=__codelineno-20-17 name=__codelineno-20-17></a><a href=#__codelineno-20-17><span class=linenos data-linenos="17 "></span></a><span class=w>      </span>
</span><span id=__span-20-18><a id=__codelineno-20-18 name=__codelineno-20-18></a><a href=#__codelineno-20-18><span class=linenos data-linenos="18 "></span></a><span class=nt>integrations</span><span class=p>:</span>
</span><span id=__span-20-19><a id=__codelineno-20-19 name=__codelineno-20-19></a><a href=#__codelineno-20-19><span class=linenos data-linenos="19 "></span></a><span class=w>  </span><span class=nt>ci</span><span class=p>:</span>
</span><span id=__span-20-20><a id=__codelineno-20-20 name=__codelineno-20-20></a><a href=#__codelineno-20-20><span class=linenos data-linenos="20 "></span></a><span class=w>    </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=s>&quot;github_actions&quot;</span>
</span><span id=__span-20-21><a id=__codelineno-20-21 name=__codelineno-20-21></a><a href=#__codelineno-20-21><span class=linenos data-linenos="21 "></span></a><span class=w>    </span><span class=nt>config_file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;.github/workflows/django.yml&quot;</span>
</span></code></pre></div><p><strong>TDD Integration:</strong><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1></a><a href=#__codelineno-21-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># Generated test structure</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2></a><a href=#__codelineno-21-2><span class=linenos data-linenos=" 2 "></span></a><span class=c1># tests/tdd/USER-001/test_user_views.py</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3></a><a href=#__codelineno-21-3><span class=linenos data-linenos=" 3 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>django.test</span><span class=w> </span><span class=kn>import</span> <span class=n>TestCase</span><span class=p>,</span> <span class=n>Client</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4></a><a href=#__codelineno-21-4><span class=linenos data-linenos=" 4 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>django.contrib.auth.models</span><span class=w> </span><span class=kn>import</span> <span class=n>User</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5></a><a href=#__codelineno-21-5><span class=linenos data-linenos=" 5 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6></a><a href=#__codelineno-21-6><span class=linenos data-linenos=" 6 "></span></a>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7></a><a href=#__codelineno-21-7><span class=linenos data-linenos=" 7 "></span></a><span class=k>class</span><span class=w> </span><span class=nc>UserViewTestCase</span><span class=p>(</span><span class=n>TestCase</span><span class=p>):</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8></a><a href=#__codelineno-21-8><span class=linenos data-linenos=" 8 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>setUp</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9></a><a href=#__codelineno-21-9><span class=linenos data-linenos=" 9 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>Client</span><span class=p>()</span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10></a><a href=#__codelineno-21-10><span class=linenos data-linenos="10 "></span></a>        
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11></a><a href=#__codelineno-21-11><span class=linenos data-linenos="11 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>test_user_registration_valid_data</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12></a><a href=#__codelineno-21-12><span class=linenos data-linenos="12 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Test user registration with valid data&quot;&quot;&quot;</span>
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13></a><a href=#__codelineno-21-13><span class=linenos data-linenos="13 "></span></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s1>&#39;/api/users/&#39;</span><span class=p>,</span> <span class=p>{</span>
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14></a><a href=#__codelineno-21-14><span class=linenos data-linenos="14 "></span></a>            <span class=s1>&#39;username&#39;</span><span class=p>:</span> <span class=s1>&#39;testuser&#39;</span><span class=p>,</span>
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15></a><a href=#__codelineno-21-15><span class=linenos data-linenos="15 "></span></a>            <span class=s1>&#39;email&#39;</span><span class=p>:</span> <span class=s1>&#39;test@example.com&#39;</span><span class=p>,</span>
</span><span id=__span-21-16><a id=__codelineno-21-16 name=__codelineno-21-16></a><a href=#__codelineno-21-16><span class=linenos data-linenos="16 "></span></a>            <span class=s1>&#39;password&#39;</span><span class=p>:</span> <span class=s1>&#39;securepass123&#39;</span>
</span><span id=__span-21-17><a id=__codelineno-21-17 name=__codelineno-21-17></a><a href=#__codelineno-21-17><span class=linenos data-linenos="17 "></span></a>        <span class=p>})</span>
</span><span id=__span-21-18><a id=__codelineno-21-18 name=__codelineno-21-18></a><a href=#__codelineno-21-18><span class=linenos data-linenos="18 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=p>,</span> <span class=mi>201</span><span class=p>)</span>
</span><span id=__span-21-19><a id=__codelineno-21-19 name=__codelineno-21-19></a><a href=#__codelineno-21-19><span class=linenos data-linenos="19 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>assertTrue</span><span class=p>(</span><span class=n>User</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>username</span><span class=o>=</span><span class=s1>&#39;testuser&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>exists</span><span class=p>())</span>
</span><span id=__span-21-20><a id=__codelineno-21-20 name=__codelineno-21-20></a><a href=#__codelineno-21-20><span class=linenos data-linenos="20 "></span></a>        
</span><span id=__span-21-21><a id=__codelineno-21-21 name=__codelineno-21-21></a><a href=#__codelineno-21-21><span class=linenos data-linenos="21 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>test_user_registration_invalid_email</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-21-22><a id=__codelineno-21-22 name=__codelineno-21-22></a><a href=#__codelineno-21-22><span class=linenos data-linenos="22 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Test user registration with invalid email&quot;&quot;&quot;</span>
</span><span id=__span-21-23><a id=__codelineno-21-23 name=__codelineno-21-23></a><a href=#__codelineno-21-23><span class=linenos data-linenos="23 "></span></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s1>&#39;/api/users/&#39;</span><span class=p>,</span> <span class=p>{</span>
</span><span id=__span-21-24><a id=__codelineno-21-24 name=__codelineno-21-24></a><a href=#__codelineno-21-24><span class=linenos data-linenos="24 "></span></a>            <span class=s1>&#39;username&#39;</span><span class=p>:</span> <span class=s1>&#39;testuser&#39;</span><span class=p>,</span>
</span><span id=__span-21-25><a id=__codelineno-21-25 name=__codelineno-21-25></a><a href=#__codelineno-21-25><span class=linenos data-linenos="25 "></span></a>            <span class=s1>&#39;email&#39;</span><span class=p>:</span> <span class=s1>&#39;invalid-email&#39;</span><span class=p>,</span>
</span><span id=__span-21-26><a id=__codelineno-21-26 name=__codelineno-21-26></a><a href=#__codelineno-21-26><span class=linenos data-linenos="26 "></span></a>            <span class=s1>&#39;password&#39;</span><span class=p>:</span> <span class=s1>&#39;securepass123&#39;</span>
</span><span id=__span-21-27><a id=__codelineno-21-27 name=__codelineno-21-27></a><a href=#__codelineno-21-27><span class=linenos data-linenos="27 "></span></a>        <span class=p>})</span>
</span><span id=__span-21-28><a id=__codelineno-21-28 name=__codelineno-21-28></a><a href=#__codelineno-21-28><span class=linenos data-linenos="28 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=p>,</span> <span class=mi>400</span><span class=p>)</span>
</span></code></pre></div></p><h4 id=react-frontend-project>React Frontend Project<a class=headerlink href=#react-frontend-project title="Permanent link">&para;</a></h4><p>React application with component-based TDD.</p><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1></a><a href=#__codelineno-22-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># config/react-frontend.yml</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2></a><a href=#__codelineno-22-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>orchestrator</span><span class=p>:</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3></a><a href=#__codelineno-22-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>  </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">partial</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4></a><a href=#__codelineno-22-4><span class=linenos data-linenos=" 4 "></span></a><span class=w>  </span><span class=nt>project_path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/workspace/react-app&quot;</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5></a><a href=#__codelineno-22-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6></a><a href=#__codelineno-22-6><span class=linenos data-linenos=" 6 "></span></a><span class=nt>tdd</span><span class=p>:</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7></a><a href=#__codelineno-22-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8></a><a href=#__codelineno-22-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>  </span><span class=nt>test_execution</span><span class=p>:</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9></a><a href=#__codelineno-22-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>    </span><span class=nt>runner</span><span class=p>:</span><span class=w> </span><span class=s>&quot;npm</span><span class=nv> </span><span class=s>test</span><span class=nv> </span><span class=s>--</span><span class=nv> </span><span class=s>--coverage&quot;</span>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10></a><a href=#__codelineno-22-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span><span class=nt>coverage_threshold</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11></a><a href=#__codelineno-22-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span>
</span><span id=__span-22-12><a id=__codelineno-22-12 name=__codelineno-22-12></a><a href=#__codelineno-22-12><span class=linenos data-linenos="12 "></span></a><span class=w>  </span><span class=nt>agents</span><span class=p>:</span>
</span><span id=__span-22-13><a id=__codelineno-22-13 name=__codelineno-22-13></a><a href=#__codelineno-22-13><span class=linenos data-linenos="13 "></span></a><span class=w>    </span><span class=nt>design_agent</span><span class=p>:</span>
</span><span id=__span-22-14><a id=__codelineno-22-14 name=__codelineno-22-14></a><a href=#__codelineno-22-14><span class=linenos data-linenos="14 "></span></a><span class=w>      </span><span class=nt>detail_level</span><span class=p>:</span><span class=w> </span><span class=s>&quot;comprehensive&quot;</span>
</span><span id=__span-22-15><a id=__codelineno-22-15 name=__codelineno-22-15></a><a href=#__codelineno-22-15><span class=linenos data-linenos="15 "></span></a><span class=w>      </span><span class=nt>include_diagrams</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-22-16><a id=__codelineno-22-16 name=__codelineno-22-16></a><a href=#__codelineno-22-16><span class=linenos data-linenos="16 "></span></a><span class=w>    </span><span class=nt>qa_agent</span><span class=p>:</span>
</span><span id=__span-22-17><a id=__codelineno-22-17 name=__codelineno-22-17></a><a href=#__codelineno-22-17><span class=linenos data-linenos="17 "></span></a><span class=w>      </span><span class=nt>test_types</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;unit&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;integration&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;e2e&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-22-18><a id=__codelineno-22-18 name=__codelineno-22-18></a><a href=#__codelineno-22-18><span class=linenos data-linenos="18 "></span></a><span class=w>      </span><span class=nt>generate_test_data</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div><p><strong>Component TDD Example:</strong><div class="language-javascript highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1></a><a href=#__codelineno-23-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1>// tests/tdd/USER-PROFILE-001/UserProfile.test.js</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2></a><a href=#__codelineno-23-2><span class=linenos data-linenos=" 2 "></span></a><span class=k>import</span><span class=w> </span><span class=nx>React</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3></a><a href=#__codelineno-23-3><span class=linenos data-linenos=" 3 "></span></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>render</span><span class=p>,</span><span class=w> </span><span class=nx>screen</span><span class=p>,</span><span class=w> </span><span class=nx>fireEvent</span><span class=p>,</span><span class=w> </span><span class=nx>waitFor</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s1>&#39;@testing-library/react&#39;</span><span class=p>;</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4></a><a href=#__codelineno-23-4><span class=linenos data-linenos=" 4 "></span></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>UserProfile</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s1>&#39;../../../src/components/UserProfile&#39;</span><span class=p>;</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5></a><a href=#__codelineno-23-5><span class=linenos data-linenos=" 5 "></span></a>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6></a><a href=#__codelineno-23-6><span class=linenos data-linenos=" 6 "></span></a><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;UserProfile Component&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7></a><a href=#__codelineno-23-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>mockUser</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8></a><a href=#__codelineno-23-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>    </span><span class=nx>id</span><span class=o>:</span><span class=w> </span><span class=mf>1</span><span class=p>,</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9></a><a href=#__codelineno-23-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>    </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;John Doe&#39;</span><span class=p>,</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10></a><a href=#__codelineno-23-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span><span class=nx>email</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;john@example.com&#39;</span><span class=p>,</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11></a><a href=#__codelineno-23-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span><span class=nx>avatar</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;https://example.com/avatar.jpg&#39;</span>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12></a><a href=#__codelineno-23-12><span class=linenos data-linenos="12 "></span></a><span class=w>  </span><span class=p>};</span>
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13></a><a href=#__codelineno-23-13><span class=linenos data-linenos="13 "></span></a>
</span><span id=__span-23-14><a id=__codelineno-23-14 name=__codelineno-23-14></a><a href=#__codelineno-23-14><span class=linenos data-linenos="14 "></span></a><span class=w>  </span><span class=nx>test</span><span class=p>(</span><span class=s1>&#39;renders user information correctly&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-23-15><a id=__codelineno-23-15 name=__codelineno-23-15></a><a href=#__codelineno-23-15><span class=linenos data-linenos="15 "></span></a><span class=w>    </span><span class=nx>render</span><span class=p>(</span><span class=o>&lt;</span><span class=nx>UserProfile</span><span class=w> </span><span class=nx>user</span><span class=o>=</span><span class=p>{</span><span class=nx>mockUser</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span><span class=p>);</span>
</span><span id=__span-23-16><a id=__codelineno-23-16 name=__codelineno-23-16></a><a href=#__codelineno-23-16><span class=linenos data-linenos="16 "></span></a><span class=w>    </span>
</span><span id=__span-23-17><a id=__codelineno-23-17 name=__codelineno-23-17></a><a href=#__codelineno-23-17><span class=linenos data-linenos="17 "></span></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>screen</span><span class=p>.</span><span class=nx>getByText</span><span class=p>(</span><span class=s1>&#39;John Doe&#39;</span><span class=p>)).</span><span class=nx>toBeInTheDocument</span><span class=p>();</span>
</span><span id=__span-23-18><a id=__codelineno-23-18 name=__codelineno-23-18></a><a href=#__codelineno-23-18><span class=linenos data-linenos="18 "></span></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>screen</span><span class=p>.</span><span class=nx>getByText</span><span class=p>(</span><span class=s1>&#39;john@example.com&#39;</span><span class=p>)).</span><span class=nx>toBeInTheDocument</span><span class=p>();</span>
</span><span id=__span-23-19><a id=__codelineno-23-19 name=__codelineno-23-19></a><a href=#__codelineno-23-19><span class=linenos data-linenos="19 "></span></a><span class=w>    </span><span class=nx>expect</span><span class=p>(</span><span class=nx>screen</span><span class=p>.</span><span class=nx>getByRole</span><span class=p>(</span><span class=s1>&#39;img&#39;</span><span class=p>)).</span><span class=nx>toHaveAttribute</span><span class=p>(</span><span class=s1>&#39;src&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>mockUser</span><span class=p>.</span><span class=nx>avatar</span><span class=p>);</span>
</span><span id=__span-23-20><a id=__codelineno-23-20 name=__codelineno-23-20></a><a href=#__codelineno-23-20><span class=linenos data-linenos="20 "></span></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-23-21><a id=__codelineno-23-21 name=__codelineno-23-21></a><a href=#__codelineno-23-21><span class=linenos data-linenos="21 "></span></a>
</span><span id=__span-23-22><a id=__codelineno-23-22 name=__codelineno-23-22></a><a href=#__codelineno-23-22><span class=linenos data-linenos="22 "></span></a><span class=w>  </span><span class=nx>test</span><span class=p>(</span><span class=s1>&#39;handles edit mode toggle&#39;</span><span class=p>,</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-23-23><a id=__codelineno-23-23 name=__codelineno-23-23></a><a href=#__codelineno-23-23><span class=linenos data-linenos="23 "></span></a><span class=w>    </span><span class=nx>render</span><span class=p>(</span><span class=o>&lt;</span><span class=nx>UserProfile</span><span class=w> </span><span class=nx>user</span><span class=o>=</span><span class=p>{</span><span class=nx>mockUser</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span><span class=p>);</span>
</span><span id=__span-23-24><a id=__codelineno-23-24 name=__codelineno-23-24></a><a href=#__codelineno-23-24><span class=linenos data-linenos="24 "></span></a><span class=w>    </span>
</span><span id=__span-23-25><a id=__codelineno-23-25 name=__codelineno-23-25></a><a href=#__codelineno-23-25><span class=linenos data-linenos="25 "></span></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>editButton</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>screen</span><span class=p>.</span><span class=nx>getByText</span><span class=p>(</span><span class=s1>&#39;Edit Profile&#39;</span><span class=p>);</span>
</span><span id=__span-23-26><a id=__codelineno-23-26 name=__codelineno-23-26></a><a href=#__codelineno-23-26><span class=linenos data-linenos="26 "></span></a><span class=w>    </span><span class=nx>fireEvent</span><span class=p>.</span><span class=nx>click</span><span class=p>(</span><span class=nx>editButton</span><span class=p>);</span>
</span><span id=__span-23-27><a id=__codelineno-23-27 name=__codelineno-23-27></a><a href=#__codelineno-23-27><span class=linenos data-linenos="27 "></span></a><span class=w>    </span>
</span><span id=__span-23-28><a id=__codelineno-23-28 name=__codelineno-23-28></a><a href=#__codelineno-23-28><span class=linenos data-linenos="28 "></span></a><span class=w>    </span><span class=k>await</span><span class=w> </span><span class=nx>waitFor</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-23-29><a id=__codelineno-23-29 name=__codelineno-23-29></a><a href=#__codelineno-23-29><span class=linenos data-linenos="29 "></span></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>screen</span><span class=p>.</span><span class=nx>getByDisplayValue</span><span class=p>(</span><span class=s1>&#39;John Doe&#39;</span><span class=p>)).</span><span class=nx>toBeInTheDocument</span><span class=p>();</span>
</span><span id=__span-23-30><a id=__codelineno-23-30 name=__codelineno-23-30></a><a href=#__codelineno-23-30><span class=linenos data-linenos="30 "></span></a><span class=w>      </span><span class=nx>expect</span><span class=p>(</span><span class=nx>screen</span><span class=p>.</span><span class=nx>getByText</span><span class=p>(</span><span class=s1>&#39;Save Changes&#39;</span><span class=p>)).</span><span class=nx>toBeInTheDocument</span><span class=p>();</span>
</span><span id=__span-23-31><a id=__codelineno-23-31 name=__codelineno-23-31></a><a href=#__codelineno-23-31><span class=linenos data-linenos="31 "></span></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-23-32><a id=__codelineno-23-32 name=__codelineno-23-32></a><a href=#__codelineno-23-32><span class=linenos data-linenos="32 "></span></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-23-33><a id=__codelineno-23-33 name=__codelineno-23-33></a><a href=#__codelineno-23-33><span class=linenos data-linenos="33 "></span></a><span class=p>});</span>
</span></code></pre></div></p><h2 id=cicd-integration>CI/CD Integration<a class=headerlink href=#cicd-integration title="Permanent link">&para;</a></h2><h3 id=basic-cicd-setup>Basic CI/CD Setup<a class=headerlink href=#basic-cicd-setup title="Permanent link">&para;</a></h3><h4 id=minimal-github-actions-workflow>Minimal GitHub Actions Workflow<a class=headerlink href=#minimal-github-actions-workflow title="Permanent link">&para;</a></h4><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1></a><a href=#__codelineno-24-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># .github/workflows/simple-tdd.yml - Basic TDD workflow</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2></a><a href=#__codelineno-24-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Simple TDD Workflow</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3></a><a href=#__codelineno-24-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4></a><a href=#__codelineno-24-4><span class=linenos data-linenos=" 4 "></span></a><span class=nt>on</span><span class=p>:</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5></a><a href=#__codelineno-24-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span><span class=nt>push</span><span class=p>:</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6></a><a href=#__codelineno-24-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=nv>main</span><span class=w> </span><span class="p p-Indicator">]</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7></a><a href=#__codelineno-24-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8></a><a href=#__codelineno-24-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=nv>main</span><span class=w> </span><span class="p p-Indicator">]</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9></a><a href=#__codelineno-24-9><span class=linenos data-linenos=" 9 "></span></a>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10></a><a href=#__codelineno-24-10><span class=linenos data-linenos="10 "></span></a><span class=nt>jobs</span><span class=p>:</span>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11></a><a href=#__codelineno-24-11><span class=linenos data-linenos="11 "></span></a><span class=w>  </span><span class=nt>tdd-check</span><span class=p>:</span>
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12></a><a href=#__codelineno-24-12><span class=linenos data-linenos="12 "></span></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13></a><a href=#__codelineno-24-13><span class=linenos data-linenos="13 "></span></a><span class=w>    </span>
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14></a><a href=#__codelineno-24-14><span class=linenos data-linenos="14 "></span></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-24-15><a id=__codelineno-24-15 name=__codelineno-24-15></a><a href=#__codelineno-24-15><span class=linenos data-linenos="15 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id=__span-24-16><a id=__codelineno-24-16 name=__codelineno-24-16></a><a href=#__codelineno-24-16><span class=linenos data-linenos="16 "></span></a><span class=w>    </span>
</span><span id=__span-24-17><a id=__codelineno-24-17 name=__codelineno-24-17></a><a href=#__codelineno-24-17><span class=linenos data-linenos="17 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Setup Python</span>
</span><span id=__span-24-18><a id=__codelineno-24-18 name=__codelineno-24-18></a><a href=#__codelineno-24-18><span class=linenos data-linenos="18 "></span></a><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v4</span>
</span><span id=__span-24-19><a id=__codelineno-24-19 name=__codelineno-24-19></a><a href=#__codelineno-24-19><span class=linenos data-linenos="19 "></span></a><span class=w>      </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-24-20><a id=__codelineno-24-20 name=__codelineno-24-20></a><a href=#__codelineno-24-20><span class=linenos data-linenos="20 "></span></a><span class=w>        </span><span class=nt>python-version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.9&#39;</span>
</span><span id=__span-24-21><a id=__codelineno-24-21 name=__codelineno-24-21></a><a href=#__codelineno-24-21><span class=linenos data-linenos="21 "></span></a><span class=w>        </span>
</span><span id=__span-24-22><a id=__codelineno-24-22 name=__codelineno-24-22></a><a href=#__codelineno-24-22><span class=linenos data-linenos="22 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
</span><span id=__span-24-23><a id=__codelineno-24-23 name=__codelineno-24-23></a><a href=#__codelineno-24-23><span class=linenos data-linenos="23 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-24-24><a id=__codelineno-24-24 name=__codelineno-24-24></a><a href=#__codelineno-24-24><span class=linenos data-linenos="24 "></span></a><span class=w>        </span><span class=no>pip install -r requirements.txt</span>
</span><span id=__span-24-25><a id=__codelineno-24-25 name=__codelineno-24-25></a><a href=#__codelineno-24-25><span class=linenos data-linenos="25 "></span></a><span class=w>        </span>
</span><span id=__span-24-26><a id=__codelineno-24-26 name=__codelineno-24-26></a><a href=#__codelineno-24-26><span class=linenos data-linenos="26 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run TDD validation</span>
</span><span id=__span-24-27><a id=__codelineno-24-27 name=__codelineno-24-27></a><a href=#__codelineno-24-27><span class=linenos data-linenos="27 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-24-28><a id=__codelineno-24-28 name=__codelineno-24-28></a><a href=#__codelineno-24-28><span class=linenos data-linenos="28 "></span></a><span class=w>        </span><span class=no>python scripts/tdd_manager.py validate-all</span>
</span><span id=__span-24-29><a id=__codelineno-24-29 name=__codelineno-24-29></a><a href=#__codelineno-24-29><span class=linenos data-linenos="29 "></span></a><span class=w>        </span>
</span><span id=__span-24-30><a id=__codelineno-24-30 name=__codelineno-24-30></a><a href=#__codelineno-24-30><span class=linenos data-linenos="30 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run tests</span>
</span><span id=__span-24-31><a id=__codelineno-24-31 name=__codelineno-24-31></a><a href=#__codelineno-24-31><span class=linenos data-linenos="31 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-24-32><a id=__codelineno-24-32 name=__codelineno-24-32></a><a href=#__codelineno-24-32><span class=linenos data-linenos="32 "></span></a><span class=w>        </span><span class=no>pytest tests/ --cov=src --cov-report=term-missing</span>
</span></code></pre></div><h4 id=basic-docker-setup>Basic Docker Setup<a class=headerlink href=#basic-docker-setup title="Permanent link">&para;</a></h4><div class="language-dockerfile highlight"><span class=filename>Docker</span><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1></a><a href=#__codelineno-25-1><span class=linenos data-linenos=" 1 "></span></a><span class=c># Dockerfile - Simple container for TDD workflow</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2></a><a href=#__codelineno-25-2><span class=linenos data-linenos=" 2 "></span></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.9-slim</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3></a><a href=#__codelineno-25-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4></a><a href=#__codelineno-25-4><span class=linenos data-linenos=" 4 "></span></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5></a><a href=#__codelineno-25-5><span class=linenos data-linenos=" 5 "></span></a>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6></a><a href=#__codelineno-25-6><span class=linenos data-linenos=" 6 "></span></a><span class=c># Install dependencies</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7></a><a href=#__codelineno-25-7><span class=linenos data-linenos=" 7 "></span></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>.
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8></a><a href=#__codelineno-25-8><span class=linenos data-linenos=" 8 "></span></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>-r<span class=w> </span>requirements.txt
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9></a><a href=#__codelineno-25-9><span class=linenos data-linenos=" 9 "></span></a>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10></a><a href=#__codelineno-25-10><span class=linenos data-linenos="10 "></span></a><span class=c># Copy application</span>
</span><span id=__span-25-11><a id=__codelineno-25-11 name=__codelineno-25-11></a><a href=#__codelineno-25-11><span class=linenos data-linenos="11 "></span></a><span class=k>COPY</span><span class=w> </span>.<span class=w> </span>.
</span><span id=__span-25-12><a id=__codelineno-25-12 name=__codelineno-25-12></a><a href=#__codelineno-25-12><span class=linenos data-linenos="12 "></span></a>
</span><span id=__span-25-13><a id=__codelineno-25-13 name=__codelineno-25-13></a><a href=#__codelineno-25-13><span class=linenos data-linenos="13 "></span></a><span class=c># Run TDD validation and tests</span>
</span><span id=__span-25-14><a id=__codelineno-25-14 name=__codelineno-25-14></a><a href=#__codelineno-25-14><span class=linenos data-linenos="14 "></span></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;python&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;scripts/orchestrator.py&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--health-check&quot;</span><span class=p>]</span>
</span></code></pre></div><h3 id=github-actions-integration>GitHub Actions Integration<a class=headerlink href=#github-actions-integration title="Permanent link">&para;</a></h3><h4 id=complete-github-actions-workflow>Complete GitHub Actions Workflow<a class=headerlink href=#complete-github-actions-workflow title="Permanent link">&para;</a></h4><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1></a><a href=#__codelineno-26-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># .github/workflows/agent-workflow.yml</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2></a><a href=#__codelineno-26-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AI Agent TDD Workflow</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3></a><a href=#__codelineno-26-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4></a><a href=#__codelineno-26-4><span class=linenos data-linenos=" 4 "></span></a><span class=nt>on</span><span class=p>:</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5></a><a href=#__codelineno-26-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span><span class=nt>push</span><span class=p>:</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6></a><a href=#__codelineno-26-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=nv>main</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>develop</span><span class=w> </span><span class="p p-Indicator">]</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7></a><a href=#__codelineno-26-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8></a><a href=#__codelineno-26-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=nv>main</span><span class=w> </span><span class="p p-Indicator">]</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9></a><a href=#__codelineno-26-9><span class=linenos data-linenos=" 9 "></span></a>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10></a><a href=#__codelineno-26-10><span class=linenos data-linenos="10 "></span></a><span class=nt>env</span><span class=p>:</span>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11></a><a href=#__codelineno-26-11><span class=linenos data-linenos="11 "></span></a><span class=w>  </span><span class=nt>DISCORD_WEBHOOK</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.DISCORD_WEBHOOK }}</span>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12></a><a href=#__codelineno-26-12><span class=linenos data-linenos="12 "></span></a><span class=w>  </span><span class=nt>ORCHESTRATOR_MODE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">autonomous</span>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13></a><a href=#__codelineno-26-13><span class=linenos data-linenos="13 "></span></a>
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14></a><a href=#__codelineno-26-14><span class=linenos data-linenos="14 "></span></a><span class=nt>jobs</span><span class=p>:</span>
</span><span id=__span-26-15><a id=__codelineno-26-15 name=__codelineno-26-15></a><a href=#__codelineno-26-15><span class=linenos data-linenos="15 "></span></a><span class=w>  </span><span class=nt>tdd-validation</span><span class=p>:</span>
</span><span id=__span-26-16><a id=__codelineno-26-16 name=__codelineno-26-16></a><a href=#__codelineno-26-16><span class=linenos data-linenos="16 "></span></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-26-17><a id=__codelineno-26-17 name=__codelineno-26-17></a><a href=#__codelineno-26-17><span class=linenos data-linenos="17 "></span></a><span class=w>    </span>
</span><span id=__span-26-18><a id=__codelineno-26-18 name=__codelineno-26-18></a><a href=#__codelineno-26-18><span class=linenos data-linenos="18 "></span></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-26-19><a id=__codelineno-26-19 name=__codelineno-26-19></a><a href=#__codelineno-26-19><span class=linenos data-linenos="19 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id=__span-26-20><a id=__codelineno-26-20 name=__codelineno-26-20></a><a href=#__codelineno-26-20><span class=linenos data-linenos="20 "></span></a><span class=w>    </span>
</span><span id=__span-26-21><a id=__codelineno-26-21 name=__codelineno-26-21></a><a href=#__codelineno-26-21><span class=linenos data-linenos="21 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Setup Python</span>
</span><span id=__span-26-22><a id=__codelineno-26-22 name=__codelineno-26-22></a><a href=#__codelineno-26-22><span class=linenos data-linenos="22 "></span></a><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v4</span>
</span><span id=__span-26-23><a id=__codelineno-26-23 name=__codelineno-26-23></a><a href=#__codelineno-26-23><span class=linenos data-linenos="23 "></span></a><span class=w>      </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-26-24><a id=__codelineno-26-24 name=__codelineno-26-24></a><a href=#__codelineno-26-24><span class=linenos data-linenos="24 "></span></a><span class=w>        </span><span class=nt>python-version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.9&#39;</span>
</span><span id=__span-26-25><a id=__codelineno-26-25 name=__codelineno-26-25></a><a href=#__codelineno-26-25><span class=linenos data-linenos="25 "></span></a><span class=w>        </span>
</span><span id=__span-26-26><a id=__codelineno-26-26 name=__codelineno-26-26></a><a href=#__codelineno-26-26><span class=linenos data-linenos="26 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Install AI Agent Workflow</span>
</span><span id=__span-26-27><a id=__codelineno-26-27 name=__codelineno-26-27></a><a href=#__codelineno-26-27><span class=linenos data-linenos="27 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-26-28><a id=__codelineno-26-28 name=__codelineno-26-28></a><a href=#__codelineno-26-28><span class=linenos data-linenos="28 "></span></a><span class=w>        </span><span class=no>pip install -r requirements.txt</span>
</span><span id=__span-26-29><a id=__codelineno-26-29 name=__codelineno-26-29></a><a href=#__codelineno-26-29><span class=linenos data-linenos="29 "></span></a><span class=w>        </span><span class=no>python scripts/orchestrator.py --setup</span>
</span><span id=__span-26-30><a id=__codelineno-26-30 name=__codelineno-26-30></a><a href=#__codelineno-26-30><span class=linenos data-linenos="30 "></span></a><span class=w>        </span>
</span><span id=__span-26-31><a id=__codelineno-26-31 name=__codelineno-26-31></a><a href=#__codelineno-26-31><span class=linenos data-linenos="31 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Validate TDD Cycles</span>
</span><span id=__span-26-32><a id=__codelineno-26-32 name=__codelineno-26-32></a><a href=#__codelineno-26-32><span class=linenos data-linenos="32 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-26-33><a id=__codelineno-26-33 name=__codelineno-26-33></a><a href=#__codelineno-26-33><span class=linenos data-linenos="33 "></span></a><span class=w>        </span><span class=no>python scripts/tdd_manager.py validate-all</span>
</span><span id=__span-26-34><a id=__codelineno-26-34 name=__codelineno-26-34></a><a href=#__codelineno-26-34><span class=linenos data-linenos="34 "></span></a><span class=w>        </span><span class=no>python scripts/test_preservation.py verify-integrity</span>
</span><span id=__span-26-35><a id=__codelineno-26-35 name=__codelineno-26-35></a><a href=#__codelineno-26-35><span class=linenos data-linenos="35 "></span></a><span class=w>        </span>
</span><span id=__span-26-36><a id=__codelineno-26-36 name=__codelineno-26-36></a><a href=#__codelineno-26-36><span class=linenos data-linenos="36 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run Preserved Tests</span>
</span><span id=__span-26-37><a id=__codelineno-26-37 name=__codelineno-26-37></a><a href=#__codelineno-26-37><span class=linenos data-linenos="37 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-26-38><a id=__codelineno-26-38 name=__codelineno-26-38></a><a href=#__codelineno-26-38><span class=linenos data-linenos="38 "></span></a><span class=w>        </span><span class=no>pytest tests/tdd/ --cov=src --cov-report=xml</span>
</span><span id=__span-26-39><a id=__codelineno-26-39 name=__codelineno-26-39></a><a href=#__codelineno-26-39><span class=linenos data-linenos="39 "></span></a><span class=w>        </span>
</span><span id=__span-26-40><a id=__codelineno-26-40 name=__codelineno-26-40></a><a href=#__codelineno-26-40><span class=linenos data-linenos="40 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Upload Coverage</span>
</span><span id=__span-26-41><a id=__codelineno-26-41 name=__codelineno-26-41></a><a href=#__codelineno-26-41><span class=linenos data-linenos="41 "></span></a><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">codecov/codecov-action@v3</span>
</span><span id=__span-26-42><a id=__codelineno-26-42 name=__codelineno-26-42></a><a href=#__codelineno-26-42><span class=linenos data-linenos="42 "></span></a><span class=w>      </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-26-43><a id=__codelineno-26-43 name=__codelineno-26-43></a><a href=#__codelineno-26-43><span class=linenos data-linenos="43 "></span></a><span class=w>        </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./coverage.xml</span>
</span><span id=__span-26-44><a id=__codelineno-26-44 name=__codelineno-26-44></a><a href=#__codelineno-26-44><span class=linenos data-linenos="44 "></span></a><span class=w>        </span>
</span><span id=__span-26-45><a id=__codelineno-26-45 name=__codelineno-26-45></a><a href=#__codelineno-26-45><span class=linenos data-linenos="45 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Notify Discord</span>
</span><span id=__span-26-46><a id=__codelineno-26-46 name=__codelineno-26-46></a><a href=#__codelineno-26-46><span class=linenos data-linenos="46 "></span></a><span class=w>      </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">always()</span>
</span><span id=__span-26-47><a id=__codelineno-26-47 name=__codelineno-26-47></a><a href=#__codelineno-26-47><span class=linenos data-linenos="47 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-26-48><a id=__codelineno-26-48 name=__codelineno-26-48></a><a href=#__codelineno-26-48><span class=linenos data-linenos="48 "></span></a><span class=w>        </span><span class=no>python scripts/notify_discord.py \</span>
</span><span id=__span-26-49><a id=__codelineno-26-49 name=__codelineno-26-49></a><a href=#__codelineno-26-49><span class=linenos data-linenos="49 "></span></a><span class=w>          </span><span class=no>--webhook $DISCORD_WEBHOOK \</span>
</span><span id=__span-26-50><a id=__codelineno-26-50 name=__codelineno-26-50></a><a href=#__codelineno-26-50><span class=linenos data-linenos="50 "></span></a><span class=w>          </span><span class=no>--status ${{ job.status }} \</span>
</span><span id=__span-26-51><a id=__codelineno-26-51 name=__codelineno-26-51></a><a href=#__codelineno-26-51><span class=linenos data-linenos="51 "></span></a><span class=w>          </span><span class=no>--commit ${{ github.sha }}</span>
</span><span id=__span-26-52><a id=__codelineno-26-52 name=__codelineno-26-52></a><a href=#__codelineno-26-52><span class=linenos data-linenos="52 "></span></a>
</span><span id=__span-26-53><a id=__codelineno-26-53 name=__codelineno-26-53></a><a href=#__codelineno-26-53><span class=linenos data-linenos="53 "></span></a><span class=w>  </span><span class=nt>agent-integration</span><span class=p>:</span>
</span><span id=__span-26-54><a id=__codelineno-26-54 name=__codelineno-26-54></a><a href=#__codelineno-26-54><span class=linenos data-linenos="54 "></span></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-26-55><a id=__codelineno-26-55 name=__codelineno-26-55></a><a href=#__codelineno-26-55><span class=linenos data-linenos="55 "></span></a><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tdd-validation</span>
</span><span id=__span-26-56><a id=__codelineno-26-56 name=__codelineno-26-56></a><a href=#__codelineno-26-56><span class=linenos data-linenos="56 "></span></a><span class=w>    </span>
</span><span id=__span-26-57><a id=__codelineno-26-57 name=__codelineno-26-57></a><a href=#__codelineno-26-57><span class=linenos data-linenos="57 "></span></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-26-58><a id=__codelineno-26-58 name=__codelineno-26-58></a><a href=#__codelineno-26-58><span class=linenos data-linenos="58 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id=__span-26-59><a id=__codelineno-26-59 name=__codelineno-26-59></a><a href=#__codelineno-26-59><span class=linenos data-linenos="59 "></span></a><span class=w>    </span>
</span><span id=__span-26-60><a id=__codelineno-26-60 name=__codelineno-26-60></a><a href=#__codelineno-26-60><span class=linenos data-linenos="60 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Start Test Orchestrator</span>
</span><span id=__span-26-61><a id=__codelineno-26-61 name=__codelineno-26-61></a><a href=#__codelineno-26-61><span class=linenos data-linenos="61 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-26-62><a id=__codelineno-26-62 name=__codelineno-26-62></a><a href=#__codelineno-26-62><span class=linenos data-linenos="62 "></span></a><span class=w>        </span><span class=no>export NO_AGENT_MODE=true</span>
</span><span id=__span-26-63><a id=__codelineno-26-63 name=__codelineno-26-63></a><a href=#__codelineno-26-63><span class=linenos data-linenos="63 "></span></a><span class=w>        </span><span class=no>python scripts/orchestrator.py --health-check</span>
</span><span id=__span-26-64><a id=__codelineno-26-64 name=__codelineno-26-64></a><a href=#__codelineno-26-64><span class=linenos data-linenos="64 "></span></a><span class=w>        </span>
</span><span id=__span-26-65><a id=__codelineno-26-65 name=__codelineno-26-65></a><a href=#__codelineno-26-65><span class=linenos data-linenos="65 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run Integration Tests</span>
</span><span id=__span-26-66><a id=__codelineno-26-66 name=__codelineno-26-66></a><a href=#__codelineno-26-66><span class=linenos data-linenos="66 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-26-67><a id=__codelineno-26-67 name=__codelineno-26-67></a><a href=#__codelineno-26-67><span class=linenos data-linenos="67 "></span></a><span class=w>        </span><span class=no>pytest tests/integration/ --tb=short</span>
</span><span id=__span-26-68><a id=__codelineno-26-68 name=__codelineno-26-68></a><a href=#__codelineno-26-68><span class=linenos data-linenos="68 "></span></a><span class=w>        </span>
</span><span id=__span-26-69><a id=__codelineno-26-69 name=__codelineno-26-69></a><a href=#__codelineno-26-69><span class=linenos data-linenos="69 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Performance Benchmarks</span>
</span><span id=__span-26-70><a id=__codelineno-26-70 name=__codelineno-26-70></a><a href=#__codelineno-26-70><span class=linenos data-linenos="70 "></span></a><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-26-71><a id=__codelineno-26-71 name=__codelineno-26-71></a><a href=#__codelineno-26-71><span class=linenos data-linenos="71 "></span></a><span class=w>        </span><span class=no>python scripts/test_runner.py performance --output-file perf_results.json</span>
</span><span id=__span-26-72><a id=__codelineno-26-72 name=__codelineno-26-72></a><a href=#__codelineno-26-72><span class=linenos data-linenos="72 "></span></a><span class=w>        </span>
</span><span id=__span-26-73><a id=__codelineno-26-73 name=__codelineno-26-73></a><a href=#__codelineno-26-73><span class=linenos data-linenos="73 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Upload Artifacts</span>
</span><span id=__span-26-74><a id=__codelineno-26-74 name=__codelineno-26-74></a><a href=#__codelineno-26-74><span class=linenos data-linenos="74 "></span></a><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/upload-artifact@v3</span>
</span><span id=__span-26-75><a id=__codelineno-26-75 name=__codelineno-26-75></a><a href=#__codelineno-26-75><span class=linenos data-linenos="75 "></span></a><span class=w>      </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-26-76><a id=__codelineno-26-76 name=__codelineno-26-76></a><a href=#__codelineno-26-76><span class=linenos data-linenos="76 "></span></a><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-results</span>
</span><span id=__span-26-77><a id=__codelineno-26-77 name=__codelineno-26-77></a><a href=#__codelineno-26-77><span class=linenos data-linenos="77 "></span></a><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-26-78><a id=__codelineno-26-78 name=__codelineno-26-78></a><a href=#__codelineno-26-78><span class=linenos data-linenos="78 "></span></a><span class=w>          </span><span class=no>perf_results.json</span>
</span><span id=__span-26-79><a id=__codelineno-26-79 name=__codelineno-26-79></a><a href=#__codelineno-26-79><span class=linenos data-linenos="79 "></span></a><span class=w>          </span><span class=no>logs/</span>
</span></code></pre></div><h4 id=tdd-specific-github-integration>TDD-Specific GitHub Integration<a class=headerlink href=#tdd-specific-github-integration title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1></a><a href=#__codelineno-27-1><span class=linenos data-linenos="  1 "></span></a><span class=c1># scripts/github_tdd_integration.py</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2></a><a href=#__codelineno-27-2><span class=linenos data-linenos="  2 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>os</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3></a><a href=#__codelineno-27-3><span class=linenos data-linenos="  3 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>requests</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4></a><a href=#__codelineno-27-4><span class=linenos data-linenos="  4 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>github</span><span class=w> </span><span class=kn>import</span> <span class=n>Github</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5></a><a href=#__codelineno-27-5><span class=linenos data-linenos="  5 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>lib.tdd_models</span><span class=w> </span><span class=kn>import</span> <span class=n>TDDCycle</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6></a><a href=#__codelineno-27-6><span class=linenos data-linenos="  6 "></span></a>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7></a><a href=#__codelineno-27-7><span class=linenos data-linenos="  7 "></span></a><span class=k>class</span><span class=w> </span><span class=nc>GitHubTDDIntegration</span><span class=p>:</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8></a><a href=#__codelineno-27-8><span class=linenos data-linenos="  8 "></span></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>repo_name</span><span class=p>,</span> <span class=n>token</span><span class=p>):</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9></a><a href=#__codelineno-27-9><span class=linenos data-linenos="  9 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>github</span> <span class=o>=</span> <span class=n>Github</span><span class=p>(</span><span class=n>token</span><span class=p>)</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10></a><a href=#__codelineno-27-10><span class=linenos data-linenos=" 10 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>repo</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>github</span><span class=o>.</span><span class=n>get_repo</span><span class=p>(</span><span class=n>repo_name</span><span class=p>)</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11></a><a href=#__codelineno-27-11><span class=linenos data-linenos=" 11 "></span></a>        
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12></a><a href=#__codelineno-27-12><span class=linenos data-linenos=" 12 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>create_tdd_branch</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>story_id</span><span class=p>):</span>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13></a><a href=#__codelineno-27-13><span class=linenos data-linenos=" 13 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create dedicated branch for TDD cycle&quot;&quot;&quot;</span>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14></a><a href=#__codelineno-27-14><span class=linenos data-linenos=" 14 "></span></a>        <span class=n>main_branch</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>repo</span><span class=o>.</span><span class=n>get_branch</span><span class=p>(</span><span class=s2>&quot;main&quot;</span><span class=p>)</span>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15></a><a href=#__codelineno-27-15><span class=linenos data-linenos=" 15 "></span></a>        <span class=n>branch_name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;tdd/</span><span class=si>{</span><span class=n>story_id</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16></a><a href=#__codelineno-27-16><span class=linenos data-linenos=" 16 "></span></a>        
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17></a><a href=#__codelineno-27-17><span class=linenos data-linenos=" 17 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>repo</span><span class=o>.</span><span class=n>create_git_ref</span><span class=p>(</span>
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18></a><a href=#__codelineno-27-18><span class=linenos data-linenos=" 18 "></span></a>            <span class=n>ref</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;refs/heads/</span><span class=si>{</span><span class=n>branch_name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-27-19><a id=__codelineno-27-19 name=__codelineno-27-19></a><a href=#__codelineno-27-19><span class=linenos data-linenos=" 19 "></span></a>            <span class=n>sha</span><span class=o>=</span><span class=n>main_branch</span><span class=o>.</span><span class=n>commit</span><span class=o>.</span><span class=n>sha</span>
</span><span id=__span-27-20><a id=__codelineno-27-20 name=__codelineno-27-20></a><a href=#__codelineno-27-20><span class=linenos data-linenos=" 20 "></span></a>        <span class=p>)</span>
</span><span id=__span-27-21><a id=__codelineno-27-21 name=__codelineno-27-21></a><a href=#__codelineno-27-21><span class=linenos data-linenos=" 21 "></span></a>        
</span><span id=__span-27-22><a id=__codelineno-27-22 name=__codelineno-27-22></a><a href=#__codelineno-27-22><span class=linenos data-linenos=" 22 "></span></a>        <span class=k>return</span> <span class=n>branch_name</span>
</span><span id=__span-27-23><a id=__codelineno-27-23 name=__codelineno-27-23></a><a href=#__codelineno-27-23><span class=linenos data-linenos=" 23 "></span></a>        
</span><span id=__span-27-24><a id=__codelineno-27-24 name=__codelineno-27-24></a><a href=#__codelineno-27-24><span class=linenos data-linenos=" 24 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>create_tdd_pr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycle</span><span class=p>:</span> <span class=n>TDDCycle</span><span class=p>):</span>
</span><span id=__span-27-25><a id=__codelineno-27-25 name=__codelineno-27-25></a><a href=#__codelineno-27-25><span class=linenos data-linenos=" 25 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create PR for completed TDD cycle&quot;&quot;&quot;</span>
</span><span id=__span-27-26><a id=__codelineno-27-26 name=__codelineno-27-26></a><a href=#__codelineno-27-26><span class=linenos data-linenos=" 26 "></span></a>        <span class=n>branch_name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;tdd/</span><span class=si>{</span><span class=n>cycle</span><span class=o>.</span><span class=n>story_id</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-27-27><a id=__codelineno-27-27 name=__codelineno-27-27></a><a href=#__codelineno-27-27><span class=linenos data-linenos=" 27 "></span></a>        
</span><span id=__span-27-28><a id=__codelineno-27-28 name=__codelineno-27-28></a><a href=#__codelineno-27-28><span class=linenos data-linenos=" 28 "></span></a>        <span class=c1># Generate PR description</span>
</span><span id=__span-27-29><a id=__codelineno-27-29 name=__codelineno-27-29></a><a href=#__codelineno-27-29><span class=linenos data-linenos=" 29 "></span></a>        <span class=n>description</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_pr_description</span><span class=p>(</span><span class=n>cycle</span><span class=p>)</span>
</span><span id=__span-27-30><a id=__codelineno-27-30 name=__codelineno-27-30></a><a href=#__codelineno-27-30><span class=linenos data-linenos=" 30 "></span></a>        
</span><span id=__span-27-31><a id=__codelineno-27-31 name=__codelineno-27-31></a><a href=#__codelineno-27-31><span class=linenos data-linenos=" 31 "></span></a>        <span class=n>pr</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>repo</span><span class=o>.</span><span class=n>create_pull</span><span class=p>(</span>
</span><span id=__span-27-32><a id=__codelineno-27-32 name=__codelineno-27-32></a><a href=#__codelineno-27-32><span class=linenos data-linenos=" 32 "></span></a>            <span class=n>title</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;TDD: </span><span class=si>{</span><span class=n>cycle</span><span class=o>.</span><span class=n>story_id</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=n>cycle</span><span class=o>.</span><span class=n>description</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-27-33><a id=__codelineno-27-33 name=__codelineno-27-33></a><a href=#__codelineno-27-33><span class=linenos data-linenos=" 33 "></span></a>            <span class=n>body</span><span class=o>=</span><span class=n>description</span><span class=p>,</span>
</span><span id=__span-27-34><a id=__codelineno-27-34 name=__codelineno-27-34></a><a href=#__codelineno-27-34><span class=linenos data-linenos=" 34 "></span></a>            <span class=n>head</span><span class=o>=</span><span class=n>branch_name</span><span class=p>,</span>
</span><span id=__span-27-35><a id=__codelineno-27-35 name=__codelineno-27-35></a><a href=#__codelineno-27-35><span class=linenos data-linenos=" 35 "></span></a>            <span class=n>base</span><span class=o>=</span><span class=s2>&quot;main&quot;</span>
</span><span id=__span-27-36><a id=__codelineno-27-36 name=__codelineno-27-36></a><a href=#__codelineno-27-36><span class=linenos data-linenos=" 36 "></span></a>        <span class=p>)</span>
</span><span id=__span-27-37><a id=__codelineno-27-37 name=__codelineno-27-37></a><a href=#__codelineno-27-37><span class=linenos data-linenos=" 37 "></span></a>        
</span><span id=__span-27-38><a id=__codelineno-27-38 name=__codelineno-27-38></a><a href=#__codelineno-27-38><span class=linenos data-linenos=" 38 "></span></a>        <span class=c1># Add TDD-specific labels</span>
</span><span id=__span-27-39><a id=__codelineno-27-39 name=__codelineno-27-39></a><a href=#__codelineno-27-39><span class=linenos data-linenos=" 39 "></span></a>        <span class=n>pr</span><span class=o>.</span><span class=n>add_to_labels</span><span class=p>(</span><span class=s2>&quot;tdd-cycle&quot;</span><span class=p>,</span> <span class=s2>&quot;needs-review&quot;</span><span class=p>)</span>
</span><span id=__span-27-40><a id=__codelineno-27-40 name=__codelineno-27-40></a><a href=#__codelineno-27-40><span class=linenos data-linenos=" 40 "></span></a>        
</span><span id=__span-27-41><a id=__codelineno-27-41 name=__codelineno-27-41></a><a href=#__codelineno-27-41><span class=linenos data-linenos=" 41 "></span></a>        <span class=k>return</span> <span class=n>pr</span>
</span><span id=__span-27-42><a id=__codelineno-27-42 name=__codelineno-27-42></a><a href=#__codelineno-27-42><span class=linenos data-linenos=" 42 "></span></a>        
</span><span id=__span-27-43><a id=__codelineno-27-43 name=__codelineno-27-43></a><a href=#__codelineno-27-43><span class=linenos data-linenos=" 43 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>generate_pr_description</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycle</span><span class=p>:</span> <span class=n>TDDCycle</span><span class=p>):</span>
</span><span id=__span-27-44><a id=__codelineno-27-44 name=__codelineno-27-44></a><a href=#__codelineno-27-44><span class=linenos data-linenos=" 44 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Generate comprehensive PR description from TDD cycle&quot;&quot;&quot;</span>
</span><span id=__span-27-45><a id=__codelineno-27-45 name=__codelineno-27-45></a><a href=#__codelineno-27-45><span class=linenos data-linenos=" 45 "></span></a>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-27-46><a id=__codelineno-27-46 name=__codelineno-27-46></a><a href=#__codelineno-27-46><span class=linenos data-linenos=" 46 "></span></a><span class=s2>## TDD Cycle Summary</span>
</span><span id=__span-27-47><a id=__codelineno-27-47 name=__codelineno-27-47></a><a href=#__codelineno-27-47><span class=linenos data-linenos=" 47 "></span></a>
</span><span id=__span-27-48><a id=__codelineno-27-48 name=__codelineno-27-48></a><a href=#__codelineno-27-48><span class=linenos data-linenos=" 48 "></span></a><span class=s2>**Story ID:** </span><span class=si>{</span><span class=n>cycle</span><span class=o>.</span><span class=n>story_id</span><span class=si>}</span>
</span><span id=__span-27-49><a id=__codelineno-27-49 name=__codelineno-27-49></a><a href=#__codelineno-27-49><span class=linenos data-linenos=" 49 "></span></a><span class=s2>**Description:** </span><span class=si>{</span><span class=n>cycle</span><span class=o>.</span><span class=n>description</span><span class=si>}</span>
</span><span id=__span-27-50><a id=__codelineno-27-50 name=__codelineno-27-50></a><a href=#__codelineno-27-50><span class=linenos data-linenos=" 50 "></span></a><span class=s2>**Cycle Duration:** </span><span class=si>{</span><span class=n>cycle</span><span class=o>.</span><span class=n>get_duration_summary</span><span class=p>()</span><span class=si>}</span>
</span><span id=__span-27-51><a id=__codelineno-27-51 name=__codelineno-27-51></a><a href=#__codelineno-27-51><span class=linenos data-linenos=" 51 "></span></a>
</span><span id=__span-27-52><a id=__codelineno-27-52 name=__codelineno-27-52></a><a href=#__codelineno-27-52><span class=linenos data-linenos=" 52 "></span></a><span class=s2>## TDD Phases Completed</span>
</span><span id=__span-27-53><a id=__codelineno-27-53 name=__codelineno-27-53></a><a href=#__codelineno-27-53><span class=linenos data-linenos=" 53 "></span></a>
</span><span id=__span-27-54><a id=__codelineno-27-54 name=__codelineno-27-54></a><a href=#__codelineno-27-54><span class=linenos data-linenos=" 54 "></span></a><span class=s2>- ✅ **Design Phase**: Technical specifications created</span>
</span><span id=__span-27-55><a id=__codelineno-27-55 name=__codelineno-27-55></a><a href=#__codelineno-27-55><span class=linenos data-linenos=" 55 "></span></a><span class=s2>- ✅ **Test Red Phase**: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>cycle</span><span class=o>.</span><span class=n>get_test_files</span><span class=p>())</span><span class=si>}</span><span class=s2> failing tests written</span>
</span><span id=__span-27-56><a id=__codelineno-27-56 name=__codelineno-27-56></a><a href=#__codelineno-27-56><span class=linenos data-linenos=" 56 "></span></a><span class=s2>- ✅ **Code Green Phase**: Implementation completed, all tests passing</span>
</span><span id=__span-27-57><a id=__codelineno-27-57 name=__codelineno-27-57></a><a href=#__codelineno-27-57><span class=linenos data-linenos=" 57 "></span></a><span class=s2>- ✅ **Refactor Phase**: Code optimized while maintaining green tests</span>
</span><span id=__span-27-58><a id=__codelineno-27-58 name=__codelineno-27-58></a><a href=#__codelineno-27-58><span class=linenos data-linenos=" 58 "></span></a>
</span><span id=__span-27-59><a id=__codelineno-27-59 name=__codelineno-27-59></a><a href=#__codelineno-27-59><span class=linenos data-linenos=" 59 "></span></a><span class=s2>## Test Coverage</span>
</span><span id=__span-27-60><a id=__codelineno-27-60 name=__codelineno-27-60></a><a href=#__codelineno-27-60><span class=linenos data-linenos=" 60 "></span></a>
</span><span id=__span-27-61><a id=__codelineno-27-61 name=__codelineno-27-61></a><a href=#__codelineno-27-61><span class=linenos data-linenos=" 61 "></span></a><span class=s2>- **Test Files Created:** </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>cycle</span><span class=o>.</span><span class=n>get_test_files</span><span class=p>())</span><span class=si>}</span>
</span><span id=__span-27-62><a id=__codelineno-27-62 name=__codelineno-27-62></a><a href=#__codelineno-27-62><span class=linenos data-linenos=" 62 "></span></a><span class=s2>- **Test Coverage:** </span><span class=si>{</span><span class=n>cycle</span><span class=o>.</span><span class=n>overall_test_coverage</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%</span>
</span><span id=__span-27-63><a id=__codelineno-27-63 name=__codelineno-27-63></a><a href=#__codelineno-27-63><span class=linenos data-linenos=" 63 "></span></a><span class=s2>- **Tests Passing:** </span><span class=si>{</span><span class=n>cycle</span><span class=o>.</span><span class=n>get_passing_test_count</span><span class=p>()</span><span class=si>}</span>
</span><span id=__span-27-64><a id=__codelineno-27-64 name=__codelineno-27-64></a><a href=#__codelineno-27-64><span class=linenos data-linenos=" 64 "></span></a>
</span><span id=__span-27-65><a id=__codelineno-27-65 name=__codelineno-27-65></a><a href=#__codelineno-27-65><span class=linenos data-linenos=" 65 "></span></a><span class=s2>## Files Changed</span>
</span><span id=__span-27-66><a id=__codelineno-27-66 name=__codelineno-27-66></a><a href=#__codelineno-27-66><span class=linenos data-linenos=" 66 "></span></a>
</span><span id=__span-27-67><a id=__codelineno-27-67 name=__codelineno-27-67></a><a href=#__codelineno-27-67><span class=linenos data-linenos=" 67 "></span></a><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>get_files_changed_summary</span><span class=p>(</span><span class=n>cycle</span><span class=p>)</span><span class=si>}</span>
</span><span id=__span-27-68><a id=__codelineno-27-68 name=__codelineno-27-68></a><a href=#__codelineno-27-68><span class=linenos data-linenos=" 68 "></span></a>
</span><span id=__span-27-69><a id=__codelineno-27-69 name=__codelineno-27-69></a><a href=#__codelineno-27-69><span class=linenos data-linenos=" 69 "></span></a><span class=s2>## Quality Metrics</span>
</span><span id=__span-27-70><a id=__codelineno-27-70 name=__codelineno-27-70></a><a href=#__codelineno-27-70><span class=linenos data-linenos=" 70 "></span></a>
</span><span id=__span-27-71><a id=__codelineno-27-71 name=__codelineno-27-71></a><a href=#__codelineno-27-71><span class=linenos data-linenos=" 71 "></span></a><span class=s2>- **Code Complexity:** </span><span class=si>{</span><span class=n>cycle</span><span class=o>.</span><span class=n>get_complexity_score</span><span class=p>()</span><span class=si>}</span>
</span><span id=__span-27-72><a id=__codelineno-27-72 name=__codelineno-27-72></a><a href=#__codelineno-27-72><span class=linenos data-linenos=" 72 "></span></a><span class=s2>- **Technical Debt:** </span><span class=si>{</span><span class=n>cycle</span><span class=o>.</span><span class=n>get_technical_debt_score</span><span class=p>()</span><span class=si>}</span>
</span><span id=__span-27-73><a id=__codelineno-27-73 name=__codelineno-27-73></a><a href=#__codelineno-27-73><span class=linenos data-linenos=" 73 "></span></a><span class=s2>- **Performance Impact:** </span><span class=si>{</span><span class=n>cycle</span><span class=o>.</span><span class=n>get_performance_impact</span><span class=p>()</span><span class=si>}</span>
</span><span id=__span-27-74><a id=__codelineno-27-74 name=__codelineno-27-74></a><a href=#__codelineno-27-74><span class=linenos data-linenos=" 74 "></span></a>
</span><span id=__span-27-75><a id=__codelineno-27-75 name=__codelineno-27-75></a><a href=#__codelineno-27-75><span class=linenos data-linenos=" 75 "></span></a><span class=s2>---</span>
</span><span id=__span-27-76><a id=__codelineno-27-76 name=__codelineno-27-76></a><a href=#__codelineno-27-76><span class=linenos data-linenos=" 76 "></span></a><span class=s2>*Generated by AI Agent TDD-Scrum Workflow*</span>
</span><span id=__span-27-77><a id=__codelineno-27-77 name=__codelineno-27-77></a><a href=#__codelineno-27-77><span class=linenos data-linenos=" 77 "></span></a><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-27-78><a id=__codelineno-27-78 name=__codelineno-27-78></a><a href=#__codelineno-27-78><span class=linenos data-linenos=" 78 "></span></a>
</span><span id=__span-27-79><a id=__codelineno-27-79 name=__codelineno-27-79></a><a href=#__codelineno-27-79><span class=linenos data-linenos=" 79 "></span></a><span class=c1>#### Basic GitHub Webhook Setup</span>
</span><span id=__span-27-80><a id=__codelineno-27-80 name=__codelineno-27-80></a><a href=#__codelineno-27-80><span class=linenos data-linenos=" 80 "></span></a><span class=err>```</span><span class=n>python</span>
</span><span id=__span-27-81><a id=__codelineno-27-81 name=__codelineno-27-81></a><a href=#__codelineno-27-81><span class=linenos data-linenos=" 81 "></span></a><span class=c1># webhook_handler.py - Simple GitHub webhook handler</span>
</span><span id=__span-27-82><a id=__codelineno-27-82 name=__codelineno-27-82></a><a href=#__codelineno-27-82><span class=linenos data-linenos=" 82 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>flask</span><span class=w> </span><span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>jsonify</span>
</span><span id=__span-27-83><a id=__codelineno-27-83 name=__codelineno-27-83></a><a href=#__codelineno-27-83><span class=linenos data-linenos=" 83 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>hmac</span>
</span><span id=__span-27-84><a id=__codelineno-27-84 name=__codelineno-27-84></a><a href=#__codelineno-27-84><span class=linenos data-linenos=" 84 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>hashlib</span>
</span><span id=__span-27-85><a id=__codelineno-27-85 name=__codelineno-27-85></a><a href=#__codelineno-27-85><span class=linenos data-linenos=" 85 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-27-86><a id=__codelineno-27-86 name=__codelineno-27-86></a><a href=#__codelineno-27-86><span class=linenos data-linenos=" 86 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>subprocess</span>
</span><span id=__span-27-87><a id=__codelineno-27-87 name=__codelineno-27-87></a><a href=#__codelineno-27-87><span class=linenos data-linenos=" 87 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>os</span>
</span><span id=__span-27-88><a id=__codelineno-27-88 name=__codelineno-27-88></a><a href=#__codelineno-27-88><span class=linenos data-linenos=" 88 "></span></a>
</span><span id=__span-27-89><a id=__codelineno-27-89 name=__codelineno-27-89></a><a href=#__codelineno-27-89><span class=linenos data-linenos=" 89 "></span></a><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span><span id=__span-27-90><a id=__codelineno-27-90 name=__codelineno-27-90></a><a href=#__codelineno-27-90><span class=linenos data-linenos=" 90 "></span></a>
</span><span id=__span-27-91><a id=__codelineno-27-91 name=__codelineno-27-91></a><a href=#__codelineno-27-91><span class=linenos data-linenos=" 91 "></span></a><span class=c1># Configuration</span>
</span><span id=__span-27-92><a id=__codelineno-27-92 name=__codelineno-27-92></a><a href=#__codelineno-27-92><span class=linenos data-linenos=" 92 "></span></a><span class=n>WEBHOOK_SECRET</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;GITHUB_WEBHOOK_SECRET&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span><span id=__span-27-93><a id=__codelineno-27-93 name=__codelineno-27-93></a><a href=#__codelineno-27-93><span class=linenos data-linenos=" 93 "></span></a><span class=n>REPO_PATH</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;REPO_PATH&#39;</span><span class=p>,</span> <span class=s1>&#39;/path/to/your/repo&#39;</span><span class=p>)</span>
</span><span id=__span-27-94><a id=__codelineno-27-94 name=__codelineno-27-94></a><a href=#__codelineno-27-94><span class=linenos data-linenos=" 94 "></span></a>
</span><span id=__span-27-95><a id=__codelineno-27-95 name=__codelineno-27-95></a><a href=#__codelineno-27-95><span class=linenos data-linenos=" 95 "></span></a><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/github-webhook&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span><span id=__span-27-96><a id=__codelineno-27-96 name=__codelineno-27-96></a><a href=#__codelineno-27-96><span class=linenos data-linenos=" 96 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>handle_github_webhook</span><span class=p>():</span>
</span><span id=__span-27-97><a id=__codelineno-27-97 name=__codelineno-27-97></a><a href=#__codelineno-27-97><span class=linenos data-linenos=" 97 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Handle GitHub webhook events&quot;&quot;&quot;</span>
</span><span id=__span-27-98><a id=__codelineno-27-98 name=__codelineno-27-98></a><a href=#__codelineno-27-98><span class=linenos data-linenos=" 98 "></span></a>    
</span><span id=__span-27-99><a id=__codelineno-27-99 name=__codelineno-27-99></a><a href=#__codelineno-27-99><span class=linenos data-linenos=" 99 "></span></a>    <span class=c1># Verify webhook signature</span>
</span><span id=__span-27-100><a id=__codelineno-27-100 name=__codelineno-27-100></a><a href=#__codelineno-27-100><span class=linenos data-linenos="100 "></span></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>verify_signature</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span><span id=__span-27-101><a id=__codelineno-27-101 name=__codelineno-27-101></a><a href=#__codelineno-27-101><span class=linenos data-linenos="101 "></span></a>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=s1>&#39;Invalid signature&#39;</span><span class=p>}),</span> <span class=mi>403</span>
</span><span id=__span-27-102><a id=__codelineno-27-102 name=__codelineno-27-102></a><a href=#__codelineno-27-102><span class=linenos data-linenos="102 "></span></a>    
</span><span id=__span-27-103><a id=__codelineno-27-103 name=__codelineno-27-103></a><a href=#__codelineno-27-103><span class=linenos data-linenos="103 "></span></a>    <span class=c1># Parse webhook payload</span>
</span><span id=__span-27-104><a id=__codelineno-27-104 name=__codelineno-27-104></a><a href=#__codelineno-27-104><span class=linenos data-linenos="104 "></span></a>    <span class=n>payload</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>get_json</span><span class=p>()</span>
</span><span id=__span-27-105><a id=__codelineno-27-105 name=__codelineno-27-105></a><a href=#__codelineno-27-105><span class=linenos data-linenos="105 "></span></a>    <span class=n>event_type</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;X-GitHub-Event&#39;</span><span class=p>)</span>
</span><span id=__span-27-106><a id=__codelineno-27-106 name=__codelineno-27-106></a><a href=#__codelineno-27-106><span class=linenos data-linenos="106 "></span></a>    
</span><span id=__span-27-107><a id=__codelineno-27-107 name=__codelineno-27-107></a><a href=#__codelineno-27-107><span class=linenos data-linenos="107 "></span></a>    <span class=c1># Handle different event types</span>
</span><span id=__span-27-108><a id=__codelineno-27-108 name=__codelineno-27-108></a><a href=#__codelineno-27-108><span class=linenos data-linenos="108 "></span></a>    <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;push&#39;</span><span class=p>:</span>
</span><span id=__span-27-109><a id=__codelineno-27-109 name=__codelineno-27-109></a><a href=#__codelineno-27-109><span class=linenos data-linenos="109 "></span></a>        <span class=k>return</span> <span class=n>handle_push_event</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span><span id=__span-27-110><a id=__codelineno-27-110 name=__codelineno-27-110></a><a href=#__codelineno-27-110><span class=linenos data-linenos="110 "></span></a>    <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;pull_request&#39;</span><span class=p>:</span>
</span><span id=__span-27-111><a id=__codelineno-27-111 name=__codelineno-27-111></a><a href=#__codelineno-27-111><span class=linenos data-linenos="111 "></span></a>        <span class=k>return</span> <span class=n>handle_pr_event</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span><span id=__span-27-112><a id=__codelineno-27-112 name=__codelineno-27-112></a><a href=#__codelineno-27-112><span class=linenos data-linenos="112 "></span></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-27-113><a id=__codelineno-27-113 name=__codelineno-27-113></a><a href=#__codelineno-27-113><span class=linenos data-linenos="113 "></span></a>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=sa>f</span><span class=s1>&#39;Event </span><span class=si>{</span><span class=n>event_type</span><span class=si>}</span><span class=s1> not handled&#39;</span><span class=p>}),</span> <span class=mi>200</span>
</span><span id=__span-27-114><a id=__codelineno-27-114 name=__codelineno-27-114></a><a href=#__codelineno-27-114><span class=linenos data-linenos="114 "></span></a>
</span><span id=__span-27-115><a id=__codelineno-27-115 name=__codelineno-27-115></a><a href=#__codelineno-27-115><span class=linenos data-linenos="115 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>verify_signature</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span><span id=__span-27-116><a id=__codelineno-27-116 name=__codelineno-27-116></a><a href=#__codelineno-27-116><span class=linenos data-linenos="116 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Verify GitHub webhook signature&quot;&quot;&quot;</span>
</span><span id=__span-27-117><a id=__codelineno-27-117 name=__codelineno-27-117></a><a href=#__codelineno-27-117><span class=linenos data-linenos="117 "></span></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>WEBHOOK_SECRET</span><span class=p>:</span>
</span><span id=__span-27-118><a id=__codelineno-27-118 name=__codelineno-27-118></a><a href=#__codelineno-27-118><span class=linenos data-linenos="118 "></span></a>        <span class=k>return</span> <span class=kc>True</span>  <span class=c1># Skip verification if no secret set</span>
</span><span id=__span-27-119><a id=__codelineno-27-119 name=__codelineno-27-119></a><a href=#__codelineno-27-119><span class=linenos data-linenos="119 "></span></a>    
</span><span id=__span-27-120><a id=__codelineno-27-120 name=__codelineno-27-120></a><a href=#__codelineno-27-120><span class=linenos data-linenos="120 "></span></a>    <span class=n>signature</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;X-Hub-Signature-256&#39;</span><span class=p>)</span>
</span><span id=__span-27-121><a id=__codelineno-27-121 name=__codelineno-27-121></a><a href=#__codelineno-27-121><span class=linenos data-linenos="121 "></span></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>signature</span><span class=p>:</span>
</span><span id=__span-27-122><a id=__codelineno-27-122 name=__codelineno-27-122></a><a href=#__codelineno-27-122><span class=linenos data-linenos="122 "></span></a>        <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-27-123><a id=__codelineno-27-123 name=__codelineno-27-123></a><a href=#__codelineno-27-123><span class=linenos data-linenos="123 "></span></a>    
</span><span id=__span-27-124><a id=__codelineno-27-124 name=__codelineno-27-124></a><a href=#__codelineno-27-124><span class=linenos data-linenos="124 "></span></a>    <span class=n>expected_signature</span> <span class=o>=</span> <span class=s1>&#39;sha256=&#39;</span> <span class=o>+</span> <span class=n>hmac</span><span class=o>.</span><span class=n>new</span><span class=p>(</span>
</span><span id=__span-27-125><a id=__codelineno-27-125 name=__codelineno-27-125></a><a href=#__codelineno-27-125><span class=linenos data-linenos="125 "></span></a>        <span class=n>WEBHOOK_SECRET</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span>
</span><span id=__span-27-126><a id=__codelineno-27-126 name=__codelineno-27-126></a><a href=#__codelineno-27-126><span class=linenos data-linenos="126 "></span></a>        <span class=n>request</span><span class=o>.</span><span class=n>data</span><span class=p>,</span>
</span><span id=__span-27-127><a id=__codelineno-27-127 name=__codelineno-27-127></a><a href=#__codelineno-27-127><span class=linenos data-linenos="127 "></span></a>        <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span>
</span><span id=__span-27-128><a id=__codelineno-27-128 name=__codelineno-27-128></a><a href=#__codelineno-27-128><span class=linenos data-linenos="128 "></span></a>    <span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span><span id=__span-27-129><a id=__codelineno-27-129 name=__codelineno-27-129></a><a href=#__codelineno-27-129><span class=linenos data-linenos="129 "></span></a>    
</span><span id=__span-27-130><a id=__codelineno-27-130 name=__codelineno-27-130></a><a href=#__codelineno-27-130><span class=linenos data-linenos="130 "></span></a>    <span class=k>return</span> <span class=n>hmac</span><span class=o>.</span><span class=n>compare_digest</span><span class=p>(</span><span class=n>signature</span><span class=p>,</span> <span class=n>expected_signature</span><span class=p>)</span>
</span><span id=__span-27-131><a id=__codelineno-27-131 name=__codelineno-27-131></a><a href=#__codelineno-27-131><span class=linenos data-linenos="131 "></span></a>
</span><span id=__span-27-132><a id=__codelineno-27-132 name=__codelineno-27-132></a><a href=#__codelineno-27-132><span class=linenos data-linenos="132 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>handle_push_event</span><span class=p>(</span><span class=n>payload</span><span class=p>):</span>
</span><span id=__span-27-133><a id=__codelineno-27-133 name=__codelineno-27-133></a><a href=#__codelineno-27-133><span class=linenos data-linenos="133 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Handle push events to trigger TDD workflow&quot;&quot;&quot;</span>
</span><span id=__span-27-134><a id=__codelineno-27-134 name=__codelineno-27-134></a><a href=#__codelineno-27-134><span class=linenos data-linenos="134 "></span></a>    <span class=n>branch</span> <span class=o>=</span> <span class=n>payload</span><span class=p>[</span><span class=s1>&#39;ref&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-27-135><a id=__codelineno-27-135 name=__codelineno-27-135></a><a href=#__codelineno-27-135><span class=linenos data-linenos="135 "></span></a>    
</span><span id=__span-27-136><a id=__codelineno-27-136 name=__codelineno-27-136></a><a href=#__codelineno-27-136><span class=linenos data-linenos="136 "></span></a>    <span class=c1># Only process pushes to main branch</span>
</span><span id=__span-27-137><a id=__codelineno-27-137 name=__codelineno-27-137></a><a href=#__codelineno-27-137><span class=linenos data-linenos="137 "></span></a>    <span class=k>if</span> <span class=n>branch</span> <span class=o>!=</span> <span class=s1>&#39;main&#39;</span><span class=p>:</span>
</span><span id=__span-27-138><a id=__codelineno-27-138 name=__codelineno-27-138></a><a href=#__codelineno-27-138><span class=linenos data-linenos="138 "></span></a>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;Ignoring non-main branch push&#39;</span><span class=p>}),</span> <span class=mi>200</span>
</span><span id=__span-27-139><a id=__codelineno-27-139 name=__codelineno-27-139></a><a href=#__codelineno-27-139><span class=linenos data-linenos="139 "></span></a>    
</span><span id=__span-27-140><a id=__codelineno-27-140 name=__codelineno-27-140></a><a href=#__codelineno-27-140><span class=linenos data-linenos="140 "></span></a>    <span class=c1># Trigger orchestrator</span>
</span><span id=__span-27-141><a id=__codelineno-27-141 name=__codelineno-27-141></a><a href=#__codelineno-27-141><span class=linenos data-linenos="141 "></span></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-27-142><a id=__codelineno-27-142 name=__codelineno-27-142></a><a href=#__codelineno-27-142><span class=linenos data-linenos="142 "></span></a>        <span class=n>result</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>([</span>
</span><span id=__span-27-143><a id=__codelineno-27-143 name=__codelineno-27-143></a><a href=#__codelineno-27-143><span class=linenos data-linenos="143 "></span></a>            <span class=s1>&#39;python&#39;</span><span class=p>,</span> <span class=s1>&#39;scripts/orchestrator.py&#39;</span><span class=p>,</span>
</span><span id=__span-27-144><a id=__codelineno-27-144 name=__codelineno-27-144></a><a href=#__codelineno-27-144><span class=linenos data-linenos="144 "></span></a>            <span class=s1>&#39;--project-path&#39;</span><span class=p>,</span> <span class=n>REPO_PATH</span><span class=p>,</span>
</span><span id=__span-27-145><a id=__codelineno-27-145 name=__codelineno-27-145></a><a href=#__codelineno-27-145><span class=linenos data-linenos="145 "></span></a>            <span class=s1>&#39;--mode&#39;</span><span class=p>,</span> <span class=s1>&#39;autonomous&#39;</span><span class=p>,</span>
</span><span id=__span-27-146><a id=__codelineno-27-146 name=__codelineno-27-146></a><a href=#__codelineno-27-146><span class=linenos data-linenos="146 "></span></a>            <span class=s1>&#39;--trigger&#39;</span><span class=p>,</span> <span class=s1>&#39;push&#39;</span>
</span><span id=__span-27-147><a id=__codelineno-27-147 name=__codelineno-27-147></a><a href=#__codelineno-27-147><span class=linenos data-linenos="147 "></span></a>        <span class=p>],</span> <span class=n>capture_output</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>)</span>
</span><span id=__span-27-148><a id=__codelineno-27-148 name=__codelineno-27-148></a><a href=#__codelineno-27-148><span class=linenos data-linenos="148 "></span></a>        
</span><span id=__span-27-149><a id=__codelineno-27-149 name=__codelineno-27-149></a><a href=#__codelineno-27-149><span class=linenos data-linenos="149 "></span></a>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span>
</span><span id=__span-27-150><a id=__codelineno-27-150 name=__codelineno-27-150></a><a href=#__codelineno-27-150><span class=linenos data-linenos="150 "></span></a>            <span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;Orchestrator triggered&#39;</span><span class=p>,</span>
</span><span id=__span-27-151><a id=__codelineno-27-151 name=__codelineno-27-151></a><a href=#__codelineno-27-151><span class=linenos data-linenos="151 "></span></a>            <span class=s1>&#39;output&#39;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>stdout</span>
</span><span id=__span-27-152><a id=__codelineno-27-152 name=__codelineno-27-152></a><a href=#__codelineno-27-152><span class=linenos data-linenos="152 "></span></a>        <span class=p>}),</span> <span class=mi>200</span>
</span><span id=__span-27-153><a id=__codelineno-27-153 name=__codelineno-27-153></a><a href=#__codelineno-27-153><span class=linenos data-linenos="153 "></span></a>        
</span><span id=__span-27-154><a id=__codelineno-27-154 name=__codelineno-27-154></a><a href=#__codelineno-27-154><span class=linenos data-linenos="154 "></span></a>    <span class=k>except</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>TimeoutExpired</span><span class=p>:</span>
</span><span id=__span-27-155><a id=__codelineno-27-155 name=__codelineno-27-155></a><a href=#__codelineno-27-155><span class=linenos data-linenos="155 "></span></a>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=s1>&#39;Orchestrator timeout&#39;</span><span class=p>}),</span> <span class=mi>500</span>
</span><span id=__span-27-156><a id=__codelineno-27-156 name=__codelineno-27-156></a><a href=#__codelineno-27-156><span class=linenos data-linenos="156 "></span></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-27-157><a id=__codelineno-27-157 name=__codelineno-27-157></a><a href=#__codelineno-27-157><span class=linenos data-linenos="157 "></span></a>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}),</span> <span class=mi>500</span>
</span><span id=__span-27-158><a id=__codelineno-27-158 name=__codelineno-27-158></a><a href=#__codelineno-27-158><span class=linenos data-linenos="158 "></span></a>
</span><span id=__span-27-159><a id=__codelineno-27-159 name=__codelineno-27-159></a><a href=#__codelineno-27-159><span class=linenos data-linenos="159 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>handle_pr_event</span><span class=p>(</span><span class=n>payload</span><span class=p>):</span>
</span><span id=__span-27-160><a id=__codelineno-27-160 name=__codelineno-27-160></a><a href=#__codelineno-27-160><span class=linenos data-linenos="160 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Handle pull request events&quot;&quot;&quot;</span>
</span><span id=__span-27-161><a id=__codelineno-27-161 name=__codelineno-27-161></a><a href=#__codelineno-27-161><span class=linenos data-linenos="161 "></span></a>    <span class=n>action</span> <span class=o>=</span> <span class=n>payload</span><span class=p>[</span><span class=s1>&#39;action&#39;</span><span class=p>]</span>
</span><span id=__span-27-162><a id=__codelineno-27-162 name=__codelineno-27-162></a><a href=#__codelineno-27-162><span class=linenos data-linenos="162 "></span></a>    
</span><span id=__span-27-163><a id=__codelineno-27-163 name=__codelineno-27-163></a><a href=#__codelineno-27-163><span class=linenos data-linenos="163 "></span></a>    <span class=k>if</span> <span class=n>action</span> <span class=o>==</span> <span class=s1>&#39;opened&#39;</span><span class=p>:</span>
</span><span id=__span-27-164><a id=__codelineno-27-164 name=__codelineno-27-164></a><a href=#__codelineno-27-164><span class=linenos data-linenos="164 "></span></a>        <span class=c1># Trigger TDD validation for new PR</span>
</span><span id=__span-27-165><a id=__codelineno-27-165 name=__codelineno-27-165></a><a href=#__codelineno-27-165><span class=linenos data-linenos="165 "></span></a>        <span class=n>pr_number</span> <span class=o>=</span> <span class=n>payload</span><span class=p>[</span><span class=s1>&#39;pull_request&#39;</span><span class=p>][</span><span class=s1>&#39;number&#39;</span><span class=p>]</span>
</span><span id=__span-27-166><a id=__codelineno-27-166 name=__codelineno-27-166></a><a href=#__codelineno-27-166><span class=linenos data-linenos="166 "></span></a>        
</span><span id=__span-27-167><a id=__codelineno-27-167 name=__codelineno-27-167></a><a href=#__codelineno-27-167><span class=linenos data-linenos="167 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-27-168><a id=__codelineno-27-168 name=__codelineno-27-168></a><a href=#__codelineno-27-168><span class=linenos data-linenos="168 "></span></a>            <span class=n>result</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>([</span>
</span><span id=__span-27-169><a id=__codelineno-27-169 name=__codelineno-27-169></a><a href=#__codelineno-27-169><span class=linenos data-linenos="169 "></span></a>                <span class=s1>&#39;python&#39;</span><span class=p>,</span> <span class=s1>&#39;scripts/tdd_manager.py&#39;</span><span class=p>,</span>
</span><span id=__span-27-170><a id=__codelineno-27-170 name=__codelineno-27-170></a><a href=#__codelineno-27-170><span class=linenos data-linenos="170 "></span></a>                <span class=s1>&#39;validate-pr&#39;</span><span class=p>,</span>
</span><span id=__span-27-171><a id=__codelineno-27-171 name=__codelineno-27-171></a><a href=#__codelineno-27-171><span class=linenos data-linenos="171 "></span></a>                <span class=s1>&#39;--pr-number&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>pr_number</span><span class=p>),</span>
</span><span id=__span-27-172><a id=__codelineno-27-172 name=__codelineno-27-172></a><a href=#__codelineno-27-172><span class=linenos data-linenos="172 "></span></a>                <span class=s1>&#39;--project-path&#39;</span><span class=p>,</span> <span class=n>REPO_PATH</span>
</span><span id=__span-27-173><a id=__codelineno-27-173 name=__codelineno-27-173></a><a href=#__codelineno-27-173><span class=linenos data-linenos="173 "></span></a>            <span class=p>],</span> <span class=n>capture_output</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>60</span><span class=p>)</span>
</span><span id=__span-27-174><a id=__codelineno-27-174 name=__codelineno-27-174></a><a href=#__codelineno-27-174><span class=linenos data-linenos="174 "></span></a>            
</span><span id=__span-27-175><a id=__codelineno-27-175 name=__codelineno-27-175></a><a href=#__codelineno-27-175><span class=linenos data-linenos="175 "></span></a>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span>
</span><span id=__span-27-176><a id=__codelineno-27-176 name=__codelineno-27-176></a><a href=#__codelineno-27-176><span class=linenos data-linenos="176 "></span></a>                <span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=sa>f</span><span class=s1>&#39;TDD validation triggered for PR #</span><span class=si>{</span><span class=n>pr_number</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span>
</span><span id=__span-27-177><a id=__codelineno-27-177 name=__codelineno-27-177></a><a href=#__codelineno-27-177><span class=linenos data-linenos="177 "></span></a>                <span class=s1>&#39;output&#39;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>stdout</span>
</span><span id=__span-27-178><a id=__codelineno-27-178 name=__codelineno-27-178></a><a href=#__codelineno-27-178><span class=linenos data-linenos="178 "></span></a>            <span class=p>}),</span> <span class=mi>200</span>
</span><span id=__span-27-179><a id=__codelineno-27-179 name=__codelineno-27-179></a><a href=#__codelineno-27-179><span class=linenos data-linenos="179 "></span></a>            
</span><span id=__span-27-180><a id=__codelineno-27-180 name=__codelineno-27-180></a><a href=#__codelineno-27-180><span class=linenos data-linenos="180 "></span></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-27-181><a id=__codelineno-27-181 name=__codelineno-27-181></a><a href=#__codelineno-27-181><span class=linenos data-linenos="181 "></span></a>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}),</span> <span class=mi>500</span>
</span><span id=__span-27-182><a id=__codelineno-27-182 name=__codelineno-27-182></a><a href=#__codelineno-27-182><span class=linenos data-linenos="182 "></span></a>    
</span><span id=__span-27-183><a id=__codelineno-27-183 name=__codelineno-27-183></a><a href=#__codelineno-27-183><span class=linenos data-linenos="183 "></span></a>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=sa>f</span><span class=s1>&#39;PR action </span><span class=si>{</span><span class=n>action</span><span class=si>}</span><span class=s1> handled&#39;</span><span class=p>}),</span> <span class=mi>200</span>
</span><span id=__span-27-184><a id=__codelineno-27-184 name=__codelineno-27-184></a><a href=#__codelineno-27-184><span class=linenos data-linenos="184 "></span></a>
</span><span id=__span-27-185><a id=__codelineno-27-185 name=__codelineno-27-185></a><a href=#__codelineno-27-185><span class=linenos data-linenos="185 "></span></a><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span><span id=__span-27-186><a id=__codelineno-27-186 name=__codelineno-27-186></a><a href=#__codelineno-27-186><span class=linenos data-linenos="186 "></span></a>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>5000</span><span class=p>,</span> <span class=n>debug</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></code></pre></div><h4 id=github-webhook-configuration>GitHub Webhook Configuration<a class=headerlink href=#github-webhook-configuration title="Permanent link">&para;</a></h4><div class="language-bash highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1></a><a href=#__codelineno-28-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># Setup GitHub webhook</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2></a><a href=#__codelineno-28-2><span class=linenos data-linenos=" 2 "></span></a><span class=c1># 1. Go to your repository settings</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3></a><a href=#__codelineno-28-3><span class=linenos data-linenos=" 3 "></span></a><span class=c1># 2. Navigate to Webhooks</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4></a><a href=#__codelineno-28-4><span class=linenos data-linenos=" 4 "></span></a><span class=c1># 3. Click &quot;Add webhook&quot;</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5></a><a href=#__codelineno-28-5><span class=linenos data-linenos=" 5 "></span></a><span class=c1># 4. Configure:</span>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6></a><a href=#__codelineno-28-6><span class=linenos data-linenos=" 6 "></span></a><span class=c1>#    - Payload URL: https://your-server.com/github-webhook</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7></a><a href=#__codelineno-28-7><span class=linenos data-linenos=" 7 "></span></a><span class=c1>#    - Content type: application/json</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8></a><a href=#__codelineno-28-8><span class=linenos data-linenos=" 8 "></span></a><span class=c1>#    - Secret: your-webhook-secret</span>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9></a><a href=#__codelineno-28-9><span class=linenos data-linenos=" 9 "></span></a><span class=c1>#    - Events: Push events, Pull requests</span>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10></a><a href=#__codelineno-28-10><span class=linenos data-linenos="10 "></span></a>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11></a><a href=#__codelineno-28-11><span class=linenos data-linenos="11 "></span></a><span class=c1># Set environment variables</span>
</span><span id=__span-28-12><a id=__codelineno-28-12 name=__codelineno-28-12></a><a href=#__codelineno-28-12><span class=linenos data-linenos="12 "></span></a><span class=nb>export</span><span class=w> </span><span class=nv>GITHUB_WEBHOOK_SECRET</span><span class=o>=</span><span class=s2>&quot;your-webhook-secret&quot;</span>
</span><span id=__span-28-13><a id=__codelineno-28-13 name=__codelineno-28-13></a><a href=#__codelineno-28-13><span class=linenos data-linenos="13 "></span></a><span class=nb>export</span><span class=w> </span><span class=nv>REPO_PATH</span><span class=o>=</span><span class=s2>&quot;/path/to/your/repo&quot;</span>
</span><span id=__span-28-14><a id=__codelineno-28-14 name=__codelineno-28-14></a><a href=#__codelineno-28-14><span class=linenos data-linenos="14 "></span></a>
</span><span id=__span-28-15><a id=__codelineno-28-15 name=__codelineno-28-15></a><a href=#__codelineno-28-15><span class=linenos data-linenos="15 "></span></a><span class=c1># Run webhook handler</span>
</span><span id=__span-28-16><a id=__codelineno-28-16 name=__codelineno-28-16></a><a href=#__codelineno-28-16><span class=linenos data-linenos="16 "></span></a>python<span class=w> </span>webhook_handler.py
</span></code></pre></div><h3 id=gitlab-ci-integration>GitLab CI Integration<a class=headerlink href=#gitlab-ci-integration title="Permanent link">&para;</a></h3><h4 id=gitlab-ci-pipeline>GitLab CI Pipeline<a class=headerlink href=#gitlab-ci-pipeline title="Permanent link">&para;</a></h4><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1></a><a href=#__codelineno-29-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># .gitlab-ci.yml</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2></a><a href=#__codelineno-29-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>stages</span><span class=p>:</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3></a><a href=#__codelineno-29-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">validate</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4></a><a href=#__codelineno-29-4><span class=linenos data-linenos=" 4 "></span></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5></a><a href=#__codelineno-29-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6></a><a href=#__codelineno-29-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">notify</span>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7></a><a href=#__codelineno-29-7><span class=linenos data-linenos=" 7 "></span></a>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8></a><a href=#__codelineno-29-8><span class=linenos data-linenos=" 8 "></span></a><span class=nt>variables</span><span class=p>:</span>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9></a><a href=#__codelineno-29-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>  </span><span class=nt>ORCHESTRATOR_MODE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">partial</span>
</span><span id=__span-29-10><a id=__codelineno-29-10 name=__codelineno-29-10></a><a href=#__codelineno-29-10><span class=linenos data-linenos="10 "></span></a><span class=w>  </span><span class=nt>TDD_ENABLED</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
</span><span id=__span-29-11><a id=__codelineno-29-11 name=__codelineno-29-11></a><a href=#__codelineno-29-11><span class=linenos data-linenos="11 "></span></a>
</span><span id=__span-29-12><a id=__codelineno-29-12 name=__codelineno-29-12></a><a href=#__codelineno-29-12><span class=linenos data-linenos="12 "></span></a><span class=nt>validate-tdd</span><span class=p>:</span>
</span><span id=__span-29-13><a id=__codelineno-29-13 name=__codelineno-29-13></a><a href=#__codelineno-29-13><span class=linenos data-linenos="13 "></span></a><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">validate</span>
</span><span id=__span-29-14><a id=__codelineno-29-14 name=__codelineno-29-14></a><a href=#__codelineno-29-14><span class=linenos data-linenos="14 "></span></a><span class=w>  </span><span class=nt>script</span><span class=p>:</span>
</span><span id=__span-29-15><a id=__codelineno-29-15 name=__codelineno-29-15></a><a href=#__codelineno-29-15><span class=linenos data-linenos="15 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">python scripts/tdd_manager.py validate-all</span>
</span><span id=__span-29-16><a id=__codelineno-29-16 name=__codelineno-29-16></a><a href=#__codelineno-29-16><span class=linenos data-linenos="16 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">python scripts/config_manager.py validate config/gitlab.yml</span>
</span><span id=__span-29-17><a id=__codelineno-29-17 name=__codelineno-29-17></a><a href=#__codelineno-29-17><span class=linenos data-linenos="17 "></span></a><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span>
</span><span id=__span-29-18><a id=__codelineno-29-18 name=__codelineno-29-18></a><a href=#__codelineno-29-18><span class=linenos data-linenos="18 "></span></a><span class=w>    </span><span class=nt>reports</span><span class=p>:</span>
</span><span id=__span-29-19><a id=__codelineno-29-19 name=__codelineno-29-19></a><a href=#__codelineno-29-19><span class=linenos data-linenos="19 "></span></a><span class=w>      </span><span class=nt>junit</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tdd-validation-report.xml</span>
</span><span id=__span-29-20><a id=__codelineno-29-20 name=__codelineno-29-20></a><a href=#__codelineno-29-20><span class=linenos data-linenos="20 "></span></a>
</span><span id=__span-29-21><a id=__codelineno-29-21 name=__codelineno-29-21></a><a href=#__codelineno-29-21><span class=linenos data-linenos="21 "></span></a><span class=nt>run-preserved-tests</span><span class=p>:</span>
</span><span id=__span-29-22><a id=__codelineno-29-22 name=__codelineno-29-22></a><a href=#__codelineno-29-22><span class=linenos data-linenos="22 "></span></a><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
</span><span id=__span-29-23><a id=__codelineno-29-23 name=__codelineno-29-23></a><a href=#__codelineno-29-23><span class=linenos data-linenos="23 "></span></a><span class=w>  </span><span class=nt>script</span><span class=p>:</span>
</span><span id=__span-29-24><a id=__codelineno-29-24 name=__codelineno-29-24></a><a href=#__codelineno-29-24><span class=linenos data-linenos="24 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pytest tests/tdd/ --junitxml=tdd-tests.xml --cov=src</span>
</span><span id=__span-29-25><a id=__codelineno-29-25 name=__codelineno-29-25></a><a href=#__codelineno-29-25><span class=linenos data-linenos="25 "></span></a><span class=w>  </span><span class=nt>coverage</span><span class=p>:</span><span class=w> </span><span class=s>&#39;/TOTAL.+</span><span class=nv> </span><span class=s>([0-9]{1,3}%)/&#39;</span>
</span><span id=__span-29-26><a id=__codelineno-29-26 name=__codelineno-29-26></a><a href=#__codelineno-29-26><span class=linenos data-linenos="26 "></span></a><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span>
</span><span id=__span-29-27><a id=__codelineno-29-27 name=__codelineno-29-27></a><a href=#__codelineno-29-27><span class=linenos data-linenos="27 "></span></a><span class=w>    </span><span class=nt>reports</span><span class=p>:</span>
</span><span id=__span-29-28><a id=__codelineno-29-28 name=__codelineno-29-28></a><a href=#__codelineno-29-28><span class=linenos data-linenos="28 "></span></a><span class=w>      </span><span class=nt>junit</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tdd-tests.xml</span>
</span><span id=__span-29-29><a id=__codelineno-29-29 name=__codelineno-29-29></a><a href=#__codelineno-29-29><span class=linenos data-linenos="29 "></span></a><span class=w>      </span><span class=nt>coverage_report</span><span class=p>:</span>
</span><span id=__span-29-30><a id=__codelineno-29-30 name=__codelineno-29-30></a><a href=#__codelineno-29-30><span class=linenos data-linenos="30 "></span></a><span class=w>        </span><span class=nt>coverage_format</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cobertura</span>
</span><span id=__span-29-31><a id=__codelineno-29-31 name=__codelineno-29-31></a><a href=#__codelineno-29-31><span class=linenos data-linenos="31 "></span></a><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">coverage.xml</span>
</span><span id=__span-29-32><a id=__codelineno-29-32 name=__codelineno-29-32></a><a href=#__codelineno-29-32><span class=linenos data-linenos="32 "></span></a>
</span><span id=__span-29-33><a id=__codelineno-29-33 name=__codelineno-29-33></a><a href=#__codelineno-29-33><span class=linenos data-linenos="33 "></span></a><span class=nt>integration-tests</span><span class=p>:</span>
</span><span id=__span-29-34><a id=__codelineno-29-34 name=__codelineno-29-34></a><a href=#__codelineno-29-34><span class=linenos data-linenos="34 "></span></a><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
</span><span id=__span-29-35><a id=__codelineno-29-35 name=__codelineno-29-35></a><a href=#__codelineno-29-35><span class=linenos data-linenos="35 "></span></a><span class=w>  </span><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-29-36><a id=__codelineno-29-36 name=__codelineno-29-36></a><a href=#__codelineno-29-36><span class=linenos data-linenos="36 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13</span>
</span><span id=__span-29-37><a id=__codelineno-29-37 name=__codelineno-29-37></a><a href=#__codelineno-29-37><span class=linenos data-linenos="37 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis:6</span>
</span><span id=__span-29-38><a id=__codelineno-29-38 name=__codelineno-29-38></a><a href=#__codelineno-29-38><span class=linenos data-linenos="38 "></span></a><span class=w>  </span><span class=nt>variables</span><span class=p>:</span>
</span><span id=__span-29-39><a id=__codelineno-29-39 name=__codelineno-29-39></a><a href=#__codelineno-29-39><span class=linenos data-linenos="39 "></span></a><span class=w>    </span><span class=nt>NO_AGENT_MODE</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
</span><span id=__span-29-40><a id=__codelineno-29-40 name=__codelineno-29-40></a><a href=#__codelineno-29-40><span class=linenos data-linenos="40 "></span></a><span class=w>  </span><span class=nt>script</span><span class=p>:</span>
</span><span id=__span-29-41><a id=__codelineno-29-41 name=__codelineno-29-41></a><a href=#__codelineno-29-41><span class=linenos data-linenos="41 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">python scripts/orchestrator.py --health-check</span>
</span><span id=__span-29-42><a id=__codelineno-29-42 name=__codelineno-29-42></a><a href=#__codelineno-29-42><span class=linenos data-linenos="42 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pytest tests/integration/ --tb=short</span>
</span><span id=__span-29-43><a id=__codelineno-29-43 name=__codelineno-29-43></a><a href=#__codelineno-29-43><span class=linenos data-linenos="43 "></span></a><span class=w>  </span><span class=nt>parallel</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-29-44><a id=__codelineno-29-44 name=__codelineno-29-44></a><a href=#__codelineno-29-44><span class=linenos data-linenos="44 "></span></a>
</span><span id=__span-29-45><a id=__codelineno-29-45 name=__codelineno-29-45></a><a href=#__codelineno-29-45><span class=linenos data-linenos="45 "></span></a><span class=nt>deploy-review</span><span class=p>:</span>
</span><span id=__span-29-46><a id=__codelineno-29-46 name=__codelineno-29-46></a><a href=#__codelineno-29-46><span class=linenos data-linenos="46 "></span></a><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id=__span-29-47><a id=__codelineno-29-47 name=__codelineno-29-47></a><a href=#__codelineno-29-47><span class=linenos data-linenos="47 "></span></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-29-48><a id=__codelineno-29-48 name=__codelineno-29-48></a><a href=#__codelineno-29-48><span class=linenos data-linenos="48 "></span></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">review/$CI_COMMIT_REF_SLUG</span>
</span><span id=__span-29-49><a id=__codelineno-29-49 name=__codelineno-29-49></a><a href=#__codelineno-29-49><span class=linenos data-linenos="49 "></span></a><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://$CI_COMMIT_REF_SLUG.review.example.com</span>
</span><span id=__span-29-50><a id=__codelineno-29-50 name=__codelineno-29-50></a><a href=#__codelineno-29-50><span class=linenos data-linenos="50 "></span></a><span class=w>  </span><span class=nt>script</span><span class=p>:</span>
</span><span id=__span-29-51><a id=__codelineno-29-51 name=__codelineno-29-51></a><a href=#__codelineno-29-51><span class=linenos data-linenos="51 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">python scripts/deploy.py review --version $CI_COMMIT_SHA</span>
</span><span id=__span-29-52><a id=__codelineno-29-52 name=__codelineno-29-52></a><a href=#__codelineno-29-52><span class=linenos data-linenos="52 "></span></a><span class=w>  </span><span class=nt>only</span><span class=p>:</span>
</span><span id=__span-29-53><a id=__codelineno-29-53 name=__codelineno-29-53></a><a href=#__codelineno-29-53><span class=linenos data-linenos="53 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">merge_requests</span>
</span><span id=__span-29-54><a id=__codelineno-29-54 name=__codelineno-29-54></a><a href=#__codelineno-29-54><span class=linenos data-linenos="54 "></span></a>
</span><span id=__span-29-55><a id=__codelineno-29-55 name=__codelineno-29-55></a><a href=#__codelineno-29-55><span class=linenos data-linenos="55 "></span></a><span class=nt>notify-discord</span><span class=p>:</span>
</span><span id=__span-29-56><a id=__codelineno-29-56 name=__codelineno-29-56></a><a href=#__codelineno-29-56><span class=linenos data-linenos="56 "></span></a><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">notify</span>
</span><span id=__span-29-57><a id=__codelineno-29-57 name=__codelineno-29-57></a><a href=#__codelineno-29-57><span class=linenos data-linenos="57 "></span></a><span class=w>  </span><span class=nt>script</span><span class=p>:</span>
</span><span id=__span-29-58><a id=__codelineno-29-58 name=__codelineno-29-58></a><a href=#__codelineno-29-58><span class=linenos data-linenos="58 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-29-59><a id=__codelineno-29-59 name=__codelineno-29-59></a><a href=#__codelineno-29-59><span class=linenos data-linenos="59 "></span></a><span class=w>      </span><span class=no>python scripts/notify_discord.py \</span>
</span><span id=__span-29-60><a id=__codelineno-29-60 name=__codelineno-29-60></a><a href=#__codelineno-29-60><span class=linenos data-linenos="60 "></span></a><span class=w>        </span><span class=no>--webhook $DISCORD_WEBHOOK \</span>
</span><span id=__span-29-61><a id=__codelineno-29-61 name=__codelineno-29-61></a><a href=#__codelineno-29-61><span class=linenos data-linenos="61 "></span></a><span class=w>        </span><span class=no>--pipeline-status $CI_PIPELINE_STATUS \</span>
</span><span id=__span-29-62><a id=__codelineno-29-62 name=__codelineno-29-62></a><a href=#__codelineno-29-62><span class=linenos data-linenos="62 "></span></a><span class=w>        </span><span class=no>--commit $CI_COMMIT_SHA \</span>
</span><span id=__span-29-63><a id=__codelineno-29-63 name=__codelineno-29-63></a><a href=#__codelineno-29-63><span class=linenos data-linenos="63 "></span></a><span class=w>        </span><span class=no>--branch $CI_COMMIT_REF_NAME</span>
</span><span id=__span-29-64><a id=__codelineno-29-64 name=__codelineno-29-64></a><a href=#__codelineno-29-64><span class=linenos data-linenos="64 "></span></a><span class=w>  </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
</span></code></pre></div><h3 id=jenkins-integration>Jenkins Integration<a class=headerlink href=#jenkins-integration title="Permanent link">&para;</a></h3><h4 id=jenkins-pipeline>Jenkins Pipeline<a class=headerlink href=#jenkins-pipeline title="Permanent link">&para;</a></h4><div class="language-groovy highlight"><span class=filename>Groovy</span><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1></a><a href=#__codelineno-30-1><span class=linenos data-linenos="  1 "></span></a><span class=c1>// Jenkinsfile</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2></a><a href=#__codelineno-30-2><span class=linenos data-linenos="  2 "></span></a><span class=n>pipeline</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3></a><a href=#__codelineno-30-3><span class=linenos data-linenos="  3 "></span></a><span class=w>    </span><span class=n>agent</span><span class=w> </span><span class=n>any</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4></a><a href=#__codelineno-30-4><span class=linenos data-linenos="  4 "></span></a><span class=w>    </span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5></a><a href=#__codelineno-30-5><span class=linenos data-linenos="  5 "></span></a><span class=w>    </span><span class=n>environment</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6></a><a href=#__codelineno-30-6><span class=linenos data-linenos="  6 "></span></a><span class=w>        </span><span class=n>DISCORD_WEBHOOK</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>credentials</span><span class=o>(</span><span class=s1>&#39;discord-webhook&#39;</span><span class=o>)</span>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7></a><a href=#__codelineno-30-7><span class=linenos data-linenos="  7 "></span></a><span class=w>        </span><span class=n>ORCHESTRATOR_MODE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;autonomous&#39;</span>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8></a><a href=#__codelineno-30-8><span class=linenos data-linenos="  8 "></span></a><span class=w>        </span><span class=n>NO_AGENT_MODE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;false&#39;</span>
</span><span id=__span-30-9><a id=__codelineno-30-9 name=__codelineno-30-9></a><a href=#__codelineno-30-9><span class=linenos data-linenos="  9 "></span></a><span class=w>    </span><span class=o>}</span>
</span><span id=__span-30-10><a id=__codelineno-30-10 name=__codelineno-30-10></a><a href=#__codelineno-30-10><span class=linenos data-linenos=" 10 "></span></a><span class=w>    </span>
</span><span id=__span-30-11><a id=__codelineno-30-11 name=__codelineno-30-11></a><a href=#__codelineno-30-11><span class=linenos data-linenos=" 11 "></span></a><span class=w>    </span><span class=n>stages</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-12><a id=__codelineno-30-12 name=__codelineno-30-12></a><a href=#__codelineno-30-12><span class=linenos data-linenos=" 12 "></span></a><span class=w>        </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Setup&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-13><a id=__codelineno-30-13 name=__codelineno-30-13></a><a href=#__codelineno-30-13><span class=linenos data-linenos=" 13 "></span></a><span class=w>            </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-14><a id=__codelineno-30-14 name=__codelineno-30-14></a><a href=#__codelineno-30-14><span class=linenos data-linenos=" 14 "></span></a><span class=w>                </span><span class=n>script</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-15><a id=__codelineno-30-15 name=__codelineno-30-15></a><a href=#__codelineno-30-15><span class=linenos data-linenos=" 15 "></span></a><span class=w>                    </span><span class=n>sh</span><span class=w> </span><span class=s1>&#39;python -m venv .venv&#39;</span>
</span><span id=__span-30-16><a id=__codelineno-30-16 name=__codelineno-30-16></a><a href=#__codelineno-30-16><span class=linenos data-linenos=" 16 "></span></a><span class=w>                    </span><span class=n>sh</span><span class=w> </span><span class=s1>&#39;. .venv/bin/activate &amp;&amp; pip install -r requirements.txt&#39;</span>
</span><span id=__span-30-17><a id=__codelineno-30-17 name=__codelineno-30-17></a><a href=#__codelineno-30-17><span class=linenos data-linenos=" 17 "></span></a><span class=w>                </span><span class=o>}</span>
</span><span id=__span-30-18><a id=__codelineno-30-18 name=__codelineno-30-18></a><a href=#__codelineno-30-18><span class=linenos data-linenos=" 18 "></span></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-30-19><a id=__codelineno-30-19 name=__codelineno-30-19></a><a href=#__codelineno-30-19><span class=linenos data-linenos=" 19 "></span></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-30-20><a id=__codelineno-30-20 name=__codelineno-30-20></a><a href=#__codelineno-30-20><span class=linenos data-linenos=" 20 "></span></a><span class=w>        </span>
</span><span id=__span-30-21><a id=__codelineno-30-21 name=__codelineno-30-21></a><a href=#__codelineno-30-21><span class=linenos data-linenos=" 21 "></span></a><span class=w>        </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;TDD Validation&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-22><a id=__codelineno-30-22 name=__codelineno-30-22></a><a href=#__codelineno-30-22><span class=linenos data-linenos=" 22 "></span></a><span class=w>            </span><span class=n>parallel</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-23><a id=__codelineno-30-23 name=__codelineno-30-23></a><a href=#__codelineno-30-23><span class=linenos data-linenos=" 23 "></span></a><span class=w>                </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Validate Cycles&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-24><a id=__codelineno-30-24 name=__codelineno-30-24></a><a href=#__codelineno-30-24><span class=linenos data-linenos=" 24 "></span></a><span class=w>                    </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-25><a id=__codelineno-30-25 name=__codelineno-30-25></a><a href=#__codelineno-30-25><span class=linenos data-linenos=" 25 "></span></a><span class=w>                        </span><span class=n>sh</span><span class=w> </span><span class=s1>&#39;&#39;&#39;</span>
</span><span id=__span-30-26><a id=__codelineno-30-26 name=__codelineno-30-26></a><a href=#__codelineno-30-26><span class=linenos data-linenos=" 26 "></span></a><span class=s1>                            . .venv/bin/activate</span>
</span><span id=__span-30-27><a id=__codelineno-30-27 name=__codelineno-30-27></a><a href=#__codelineno-30-27><span class=linenos data-linenos=" 27 "></span></a><span class=s1>                            python scripts/tdd_manager.py validate-all</span>
</span><span id=__span-30-28><a id=__codelineno-30-28 name=__codelineno-30-28></a><a href=#__codelineno-30-28><span class=linenos data-linenos=" 28 "></span></a><span class=s1>                        &#39;&#39;&#39;</span>
</span><span id=__span-30-29><a id=__codelineno-30-29 name=__codelineno-30-29></a><a href=#__codelineno-30-29><span class=linenos data-linenos=" 29 "></span></a><span class=w>                    </span><span class=o>}</span>
</span><span id=__span-30-30><a id=__codelineno-30-30 name=__codelineno-30-30></a><a href=#__codelineno-30-30><span class=linenos data-linenos=" 30 "></span></a><span class=w>                </span><span class=o>}</span>
</span><span id=__span-30-31><a id=__codelineno-30-31 name=__codelineno-30-31></a><a href=#__codelineno-30-31><span class=linenos data-linenos=" 31 "></span></a><span class=w>                </span>
</span><span id=__span-30-32><a id=__codelineno-30-32 name=__codelineno-30-32></a><a href=#__codelineno-30-32><span class=linenos data-linenos=" 32 "></span></a><span class=w>                </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Test Preservation&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-33><a id=__codelineno-30-33 name=__codelineno-30-33></a><a href=#__codelineno-30-33><span class=linenos data-linenos=" 33 "></span></a><span class=w>                    </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-34><a id=__codelineno-30-34 name=__codelineno-30-34></a><a href=#__codelineno-30-34><span class=linenos data-linenos=" 34 "></span></a><span class=w>                        </span><span class=n>sh</span><span class=w> </span><span class=s1>&#39;&#39;&#39;</span>
</span><span id=__span-30-35><a id=__codelineno-30-35 name=__codelineno-30-35></a><a href=#__codelineno-30-35><span class=linenos data-linenos=" 35 "></span></a><span class=s1>                            . .venv/bin/activate</span>
</span><span id=__span-30-36><a id=__codelineno-30-36 name=__codelineno-30-36></a><a href=#__codelineno-30-36><span class=linenos data-linenos=" 36 "></span></a><span class=s1>                            python scripts/test_preservation.py verify-integrity</span>
</span><span id=__span-30-37><a id=__codelineno-30-37 name=__codelineno-30-37></a><a href=#__codelineno-30-37><span class=linenos data-linenos=" 37 "></span></a><span class=s1>                        &#39;&#39;&#39;</span>
</span><span id=__span-30-38><a id=__codelineno-30-38 name=__codelineno-30-38></a><a href=#__codelineno-30-38><span class=linenos data-linenos=" 38 "></span></a><span class=w>                    </span><span class=o>}</span>
</span><span id=__span-30-39><a id=__codelineno-30-39 name=__codelineno-30-39></a><a href=#__codelineno-30-39><span class=linenos data-linenos=" 39 "></span></a><span class=w>                </span><span class=o>}</span>
</span><span id=__span-30-40><a id=__codelineno-30-40 name=__codelineno-30-40></a><a href=#__codelineno-30-40><span class=linenos data-linenos=" 40 "></span></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-30-41><a id=__codelineno-30-41 name=__codelineno-30-41></a><a href=#__codelineno-30-41><span class=linenos data-linenos=" 41 "></span></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-30-42><a id=__codelineno-30-42 name=__codelineno-30-42></a><a href=#__codelineno-30-42><span class=linenos data-linenos=" 42 "></span></a><span class=w>        </span>
</span><span id=__span-30-43><a id=__codelineno-30-43 name=__codelineno-30-43></a><a href=#__codelineno-30-43><span class=linenos data-linenos=" 43 "></span></a><span class=w>        </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Execute Tests&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-44><a id=__codelineno-30-44 name=__codelineno-30-44></a><a href=#__codelineno-30-44><span class=linenos data-linenos=" 44 "></span></a><span class=w>            </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-45><a id=__codelineno-30-45 name=__codelineno-30-45></a><a href=#__codelineno-30-45><span class=linenos data-linenos=" 45 "></span></a><span class=w>                </span><span class=n>sh</span><span class=w> </span><span class=s1>&#39;&#39;&#39;</span>
</span><span id=__span-30-46><a id=__codelineno-30-46 name=__codelineno-30-46></a><a href=#__codelineno-30-46><span class=linenos data-linenos=" 46 "></span></a><span class=s1>                    . .venv/bin/activate</span>
</span><span id=__span-30-47><a id=__codelineno-30-47 name=__codelineno-30-47></a><a href=#__codelineno-30-47><span class=linenos data-linenos=" 47 "></span></a><span class=s1>                    pytest tests/tdd/ --junitxml=results.xml --cov=src</span>
</span><span id=__span-30-48><a id=__codelineno-30-48 name=__codelineno-30-48></a><a href=#__codelineno-30-48><span class=linenos data-linenos=" 48 "></span></a><span class=s1>                &#39;&#39;&#39;</span>
</span><span id=__span-30-49><a id=__codelineno-30-49 name=__codelineno-30-49></a><a href=#__codelineno-30-49><span class=linenos data-linenos=" 49 "></span></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-30-50><a id=__codelineno-30-50 name=__codelineno-30-50></a><a href=#__codelineno-30-50><span class=linenos data-linenos=" 50 "></span></a><span class=w>            </span><span class=n>post</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-51><a id=__codelineno-30-51 name=__codelineno-30-51></a><a href=#__codelineno-30-51><span class=linenos data-linenos=" 51 "></span></a><span class=w>                </span><span class=n>always</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-52><a id=__codelineno-30-52 name=__codelineno-30-52></a><a href=#__codelineno-30-52><span class=linenos data-linenos=" 52 "></span></a><span class=w>                    </span><span class=n>junit</span><span class=w> </span><span class=s1>&#39;results.xml&#39;</span>
</span><span id=__span-30-53><a id=__codelineno-30-53 name=__codelineno-30-53></a><a href=#__codelineno-30-53><span class=linenos data-linenos=" 53 "></span></a><span class=w>                    </span><span class=n>publishHTML</span><span class=o>([</span>
</span><span id=__span-30-54><a id=__codelineno-30-54 name=__codelineno-30-54></a><a href=#__codelineno-30-54><span class=linenos data-linenos=" 54 "></span></a><span class=w>                        </span><span class=nl>allowMissing:</span><span class=w> </span><span class=kc>false</span><span class=o>,</span>
</span><span id=__span-30-55><a id=__codelineno-30-55 name=__codelineno-30-55></a><a href=#__codelineno-30-55><span class=linenos data-linenos=" 55 "></span></a><span class=w>                        </span><span class=nl>alwaysLinkToLastBuild:</span><span class=w> </span><span class=kc>false</span><span class=o>,</span>
</span><span id=__span-30-56><a id=__codelineno-30-56 name=__codelineno-30-56></a><a href=#__codelineno-30-56><span class=linenos data-linenos=" 56 "></span></a><span class=w>                        </span><span class=nl>keepAll:</span><span class=w> </span><span class=kc>true</span><span class=o>,</span>
</span><span id=__span-30-57><a id=__codelineno-30-57 name=__codelineno-30-57></a><a href=#__codelineno-30-57><span class=linenos data-linenos=" 57 "></span></a><span class=w>                        </span><span class=nl>reportDir:</span><span class=w> </span><span class=s1>&#39;htmlcov&#39;</span><span class=o>,</span>
</span><span id=__span-30-58><a id=__codelineno-30-58 name=__codelineno-30-58></a><a href=#__codelineno-30-58><span class=linenos data-linenos=" 58 "></span></a><span class=w>                        </span><span class=nl>reportFiles:</span><span class=w> </span><span class=s1>&#39;index.html&#39;</span><span class=o>,</span>
</span><span id=__span-30-59><a id=__codelineno-30-59 name=__codelineno-30-59></a><a href=#__codelineno-30-59><span class=linenos data-linenos=" 59 "></span></a><span class=w>                        </span><span class=nl>reportName:</span><span class=w> </span><span class=s1>&#39;Coverage Report&#39;</span>
</span><span id=__span-30-60><a id=__codelineno-30-60 name=__codelineno-30-60></a><a href=#__codelineno-30-60><span class=linenos data-linenos=" 60 "></span></a><span class=w>                    </span><span class=o>])</span>
</span><span id=__span-30-61><a id=__codelineno-30-61 name=__codelineno-30-61></a><a href=#__codelineno-30-61><span class=linenos data-linenos=" 61 "></span></a><span class=w>                </span><span class=o>}</span>
</span><span id=__span-30-62><a id=__codelineno-30-62 name=__codelineno-30-62></a><a href=#__codelineno-30-62><span class=linenos data-linenos=" 62 "></span></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-30-63><a id=__codelineno-30-63 name=__codelineno-30-63></a><a href=#__codelineno-30-63><span class=linenos data-linenos=" 63 "></span></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-30-64><a id=__codelineno-30-64 name=__codelineno-30-64></a><a href=#__codelineno-30-64><span class=linenos data-linenos=" 64 "></span></a><span class=w>        </span>
</span><span id=__span-30-65><a id=__codelineno-30-65 name=__codelineno-30-65></a><a href=#__codelineno-30-65><span class=linenos data-linenos=" 65 "></span></a><span class=w>        </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Integration Tests&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-66><a id=__codelineno-30-66 name=__codelineno-30-66></a><a href=#__codelineno-30-66><span class=linenos data-linenos=" 66 "></span></a><span class=w>            </span><span class=n>environment</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-67><a id=__codelineno-30-67 name=__codelineno-30-67></a><a href=#__codelineno-30-67><span class=linenos data-linenos=" 67 "></span></a><span class=w>                </span><span class=n>NO_AGENT_MODE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;true&#39;</span>
</span><span id=__span-30-68><a id=__codelineno-30-68 name=__codelineno-30-68></a><a href=#__codelineno-30-68><span class=linenos data-linenos=" 68 "></span></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-30-69><a id=__codelineno-30-69 name=__codelineno-30-69></a><a href=#__codelineno-30-69><span class=linenos data-linenos=" 69 "></span></a><span class=w>            </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-70><a id=__codelineno-30-70 name=__codelineno-30-70></a><a href=#__codelineno-30-70><span class=linenos data-linenos=" 70 "></span></a><span class=w>                </span><span class=n>sh</span><span class=w> </span><span class=s1>&#39;&#39;&#39;</span>
</span><span id=__span-30-71><a id=__codelineno-30-71 name=__codelineno-30-71></a><a href=#__codelineno-30-71><span class=linenos data-linenos=" 71 "></span></a><span class=s1>                    . .venv/bin/activate</span>
</span><span id=__span-30-72><a id=__codelineno-30-72 name=__codelineno-30-72></a><a href=#__codelineno-30-72><span class=linenos data-linenos=" 72 "></span></a><span class=s1>                    python scripts/orchestrator.py --health-check</span>
</span><span id=__span-30-73><a id=__codelineno-30-73 name=__codelineno-30-73></a><a href=#__codelineno-30-73><span class=linenos data-linenos=" 73 "></span></a><span class=s1>                    pytest tests/integration/</span>
</span><span id=__span-30-74><a id=__codelineno-30-74 name=__codelineno-30-74></a><a href=#__codelineno-30-74><span class=linenos data-linenos=" 74 "></span></a><span class=s1>                &#39;&#39;&#39;</span>
</span><span id=__span-30-75><a id=__codelineno-30-75 name=__codelineno-30-75></a><a href=#__codelineno-30-75><span class=linenos data-linenos=" 75 "></span></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-30-76><a id=__codelineno-30-76 name=__codelineno-30-76></a><a href=#__codelineno-30-76><span class=linenos data-linenos=" 76 "></span></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-30-77><a id=__codelineno-30-77 name=__codelineno-30-77></a><a href=#__codelineno-30-77><span class=linenos data-linenos=" 77 "></span></a><span class=w>        </span>
</span><span id=__span-30-78><a id=__codelineno-30-78 name=__codelineno-30-78></a><a href=#__codelineno-30-78><span class=linenos data-linenos=" 78 "></span></a><span class=w>        </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Deploy&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-79><a id=__codelineno-30-79 name=__codelineno-30-79></a><a href=#__codelineno-30-79><span class=linenos data-linenos=" 79 "></span></a><span class=w>            </span><span class=n>when</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-80><a id=__codelineno-30-80 name=__codelineno-30-80></a><a href=#__codelineno-30-80><span class=linenos data-linenos=" 80 "></span></a><span class=w>                </span><span class=n>branch</span><span class=w> </span><span class=s1>&#39;main&#39;</span>
</span><span id=__span-30-81><a id=__codelineno-30-81 name=__codelineno-30-81></a><a href=#__codelineno-30-81><span class=linenos data-linenos=" 81 "></span></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-30-82><a id=__codelineno-30-82 name=__codelineno-30-82></a><a href=#__codelineno-30-82><span class=linenos data-linenos=" 82 "></span></a><span class=w>            </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-83><a id=__codelineno-30-83 name=__codelineno-30-83></a><a href=#__codelineno-30-83><span class=linenos data-linenos=" 83 "></span></a><span class=w>                </span><span class=n>script</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-84><a id=__codelineno-30-84 name=__codelineno-30-84></a><a href=#__codelineno-30-84><span class=linenos data-linenos=" 84 "></span></a><span class=w>                    </span><span class=n>sh</span><span class=w> </span><span class=s1>&#39;&#39;&#39;</span>
</span><span id=__span-30-85><a id=__codelineno-30-85 name=__codelineno-30-85></a><a href=#__codelineno-30-85><span class=linenos data-linenos=" 85 "></span></a><span class=s1>                        . .venv/bin/activate</span>
</span><span id=__span-30-86><a id=__codelineno-30-86 name=__codelineno-30-86></a><a href=#__codelineno-30-86><span class=linenos data-linenos=" 86 "></span></a><span class=s1>                        python scripts/deploy.py production --version ${BUILD_NUMBER}</span>
</span><span id=__span-30-87><a id=__codelineno-30-87 name=__codelineno-30-87></a><a href=#__codelineno-30-87><span class=linenos data-linenos=" 87 "></span></a><span class=s1>                    &#39;&#39;&#39;</span>
</span><span id=__span-30-88><a id=__codelineno-30-88 name=__codelineno-30-88></a><a href=#__codelineno-30-88><span class=linenos data-linenos=" 88 "></span></a><span class=w>                </span><span class=o>}</span>
</span><span id=__span-30-89><a id=__codelineno-30-89 name=__codelineno-30-89></a><a href=#__codelineno-30-89><span class=linenos data-linenos=" 89 "></span></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-30-90><a id=__codelineno-30-90 name=__codelineno-30-90></a><a href=#__codelineno-30-90><span class=linenos data-linenos=" 90 "></span></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-30-91><a id=__codelineno-30-91 name=__codelineno-30-91></a><a href=#__codelineno-30-91><span class=linenos data-linenos=" 91 "></span></a><span class=w>    </span><span class=o>}</span>
</span><span id=__span-30-92><a id=__codelineno-30-92 name=__codelineno-30-92></a><a href=#__codelineno-30-92><span class=linenos data-linenos=" 92 "></span></a><span class=w>    </span>
</span><span id=__span-30-93><a id=__codelineno-30-93 name=__codelineno-30-93></a><a href=#__codelineno-30-93><span class=linenos data-linenos=" 93 "></span></a><span class=w>    </span><span class=n>post</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-94><a id=__codelineno-30-94 name=__codelineno-30-94></a><a href=#__codelineno-30-94><span class=linenos data-linenos=" 94 "></span></a><span class=w>        </span><span class=n>always</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-95><a id=__codelineno-30-95 name=__codelineno-30-95></a><a href=#__codelineno-30-95><span class=linenos data-linenos=" 95 "></span></a><span class=w>            </span><span class=n>script</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-96><a id=__codelineno-30-96 name=__codelineno-30-96></a><a href=#__codelineno-30-96><span class=linenos data-linenos=" 96 "></span></a><span class=w>                </span><span class=n>sh</span><span class=w> </span><span class=s1>&#39;&#39;&#39;</span>
</span><span id=__span-30-97><a id=__codelineno-30-97 name=__codelineno-30-97></a><a href=#__codelineno-30-97><span class=linenos data-linenos=" 97 "></span></a><span class=s1>                    . .venv/bin/activate</span>
</span><span id=__span-30-98><a id=__codelineno-30-98 name=__codelineno-30-98></a><a href=#__codelineno-30-98><span class=linenos data-linenos=" 98 "></span></a><span class=s1>                    python scripts/notify_discord.py \</span>
</span><span id=__span-30-99><a id=__codelineno-30-99 name=__codelineno-30-99></a><a href=#__codelineno-30-99><span class=linenos data-linenos=" 99 "></span></a><span class=s1>                        --webhook ${DISCORD_WEBHOOK} \</span>
</span><span id=__span-30-100><a id=__codelineno-30-100 name=__codelineno-30-100></a><a href=#__codelineno-30-100><span class=linenos data-linenos="100 "></span></a><span class=s1>                        --build-status ${currentBuild.result} \</span>
</span><span id=__span-30-101><a id=__codelineno-30-101 name=__codelineno-30-101></a><a href=#__codelineno-30-101><span class=linenos data-linenos="101 "></span></a><span class=s1>                        --build-number ${BUILD_NUMBER}</span>
</span><span id=__span-30-102><a id=__codelineno-30-102 name=__codelineno-30-102></a><a href=#__codelineno-30-102><span class=linenos data-linenos="102 "></span></a><span class=s1>                &#39;&#39;&#39;</span>
</span><span id=__span-30-103><a id=__codelineno-30-103 name=__codelineno-30-103></a><a href=#__codelineno-30-103><span class=linenos data-linenos="103 "></span></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-30-104><a id=__codelineno-30-104 name=__codelineno-30-104></a><a href=#__codelineno-30-104><span class=linenos data-linenos="104 "></span></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-30-105><a id=__codelineno-30-105 name=__codelineno-30-105></a><a href=#__codelineno-30-105><span class=linenos data-linenos="105 "></span></a><span class=w>    </span><span class=o>}</span>
</span><span id=__span-30-106><a id=__codelineno-30-106 name=__codelineno-30-106></a><a href=#__codelineno-30-106><span class=linenos data-linenos="106 "></span></a><span class=o>}</span>
</span></code></pre></div><h2 id=database-integration>Database Integration<a class=headerlink href=#database-integration title="Permanent link">&para;</a></h2><h3 id=postgresql-integration>PostgreSQL Integration<a class=headerlink href=#postgresql-integration title="Permanent link">&para;</a></h3><h4 id=database-configuration>Database Configuration<a class=headerlink href=#database-configuration title="Permanent link">&para;</a></h4><h5 id=complete-pipeline-configuration>Complete Pipeline Configuration<a class=headerlink href=#complete-pipeline-configuration title="Permanent link">&para;</a></h5><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1></a><a href=#__codelineno-31-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># config/agent-workflow.yml</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2></a><a href=#__codelineno-31-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>orchestrator</span><span class=p>:</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3></a><a href=#__codelineno-31-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>  </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">partial</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4></a><a href=#__codelineno-31-4><span class=linenos data-linenos=" 4 "></span></a><span class=w>  </span><span class=nt>project_path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/workspace/dataflow-pipeline&quot;</span>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5></a><a href=#__codelineno-31-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span><span class=nt>github_repo</span><span class=p>:</span><span class=w> </span><span class=s>&quot;agent-workflow-examples/dataflow-pipeline&quot;</span>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6></a><a href=#__codelineno-31-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>  </span>
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7></a><a href=#__codelineno-31-7><span class=linenos data-linenos=" 7 "></span></a><span class=nt>tdd</span><span class=p>:</span>
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8></a><a href=#__codelineno-31-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9></a><a href=#__codelineno-31-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>  </span><span class=nt>test_execution</span><span class=p>:</span>
</span><span id=__span-31-10><a id=__codelineno-31-10 name=__codelineno-31-10></a><a href=#__codelineno-31-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span><span class=nt>runner</span><span class=p>:</span><span class=w> </span><span class=s>&quot;pytest&quot;</span>
</span><span id=__span-31-11><a id=__codelineno-31-11 name=__codelineno-31-11></a><a href=#__codelineno-31-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span><span class=nt>coverage_threshold</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">85</span>
</span><span id=__span-31-12><a id=__codelineno-31-12 name=__codelineno-31-12></a><a href=#__codelineno-31-12><span class=linenos data-linenos="12 "></span></a><span class=w>    </span><span class=nt>parallel_jobs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
</span><span id=__span-31-13><a id=__codelineno-31-13 name=__codelineno-31-13></a><a href=#__codelineno-31-13><span class=linenos data-linenos="13 "></span></a><span class=w>    </span>
</span><span id=__span-31-14><a id=__codelineno-31-14 name=__codelineno-31-14></a><a href=#__codelineno-31-14><span class=linenos data-linenos="14 "></span></a><span class=w>  </span><span class=nt>quality_gates</span><span class=p>:</span>
</span><span id=__span-31-15><a id=__codelineno-31-15 name=__codelineno-31-15></a><a href=#__codelineno-31-15><span class=linenos data-linenos="15 "></span></a><span class=w>    </span><span class=nt>code_green_phase</span><span class=p>:</span>
</span><span id=__span-31-16><a id=__codelineno-31-16 name=__codelineno-31-16></a><a href=#__codelineno-31-16><span class=linenos data-linenos="16 "></span></a><span class=w>      </span><span class=nt>data_validation</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-31-17><a id=__codelineno-31-17 name=__codelineno-31-17></a><a href=#__codelineno-31-17><span class=linenos data-linenos="17 "></span></a><span class=w>      </span><span class=nt>performance_benchmarks</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-31-18><a id=__codelineno-31-18 name=__codelineno-31-18></a><a href=#__codelineno-31-18><span class=linenos data-linenos="18 "></span></a><span class=w>      </span><span class=nt>integration_tests</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-31-19><a id=__codelineno-31-19 name=__codelineno-31-19></a><a href=#__codelineno-31-19><span class=linenos data-linenos="19 "></span></a><span class=w>      </span>
</span><span id=__span-31-20><a id=__codelineno-31-20 name=__codelineno-31-20></a><a href=#__codelineno-31-20><span class=linenos data-linenos="20 "></span></a><span class=nt>agents</span><span class=p>:</span>
</span><span id=__span-31-21><a id=__codelineno-31-21 name=__codelineno-31-21></a><a href=#__codelineno-31-21><span class=linenos data-linenos="21 "></span></a><span class=w>  </span><span class=nt>design_agent</span><span class=p>:</span>
</span><span id=__span-31-22><a id=__codelineno-31-22 name=__codelineno-31-22></a><a href=#__codelineno-31-22><span class=linenos data-linenos="22 "></span></a><span class=w>    </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Data</span><span class=nv> </span><span class=s>pipeline</span><span class=nv> </span><span class=s>with</span><span class=nv> </span><span class=s>Apache</span><span class=nv> </span><span class=s>Kafka,</span><span class=nv> </span><span class=s>Apache</span><span class=nv> </span><span class=s>Spark,</span><span class=nv> </span><span class=s>and</span><span class=nv> </span><span class=s>PostgreSQL&quot;</span>
</span><span id=__span-31-23><a id=__codelineno-31-23 name=__codelineno-31-23></a><a href=#__codelineno-31-23><span class=linenos data-linenos="23 "></span></a><span class=w>    </span><span class=nt>architecture_style</span><span class=p>:</span><span class=w> </span><span class=s>&quot;event-driven&quot;</span>
</span><span id=__span-31-24><a id=__codelineno-31-24 name=__codelineno-31-24></a><a href=#__codelineno-31-24><span class=linenos data-linenos="24 "></span></a><span class=w>    </span><span class=nt>data_patterns</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;ETL&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;streaming&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;batch&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-31-25><a id=__codelineno-31-25 name=__codelineno-31-25></a><a href=#__codelineno-31-25><span class=linenos data-linenos="25 "></span></a><span class=w>    </span>
</span><span id=__span-31-26><a id=__codelineno-31-26 name=__codelineno-31-26></a><a href=#__codelineno-31-26><span class=linenos data-linenos="26 "></span></a><span class=w>  </span><span class=nt>code_agent</span><span class=p>:</span>
</span><span id=__span-31-27><a id=__codelineno-31-27 name=__codelineno-31-27></a><a href=#__codelineno-31-27><span class=linenos data-linenos="27 "></span></a><span class=w>    </span><span class=nt>implementation_style</span><span class=p>:</span><span class=w> </span><span class=s>&quot;functional&quot;</span>
</span><span id=__span-31-28><a id=__codelineno-31-28 name=__codelineno-31-28></a><a href=#__codelineno-31-28><span class=linenos data-linenos="28 "></span></a><span class=w>    </span><span class=nt>frameworks</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;pyspark&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;kafka-python&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;pandas&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-31-29><a id=__codelineno-31-29 name=__codelineno-31-29></a><a href=#__codelineno-31-29><span class=linenos data-linenos="29 "></span></a><span class=w>    </span>
</span><span id=__span-31-30><a id=__codelineno-31-30 name=__codelineno-31-30></a><a href=#__codelineno-31-30><span class=linenos data-linenos="30 "></span></a><span class=w>  </span><span class=nt>qa_agent</span><span class=p>:</span>
</span><span id=__span-31-31><a id=__codelineno-31-31 name=__codelineno-31-31></a><a href=#__codelineno-31-31><span class=linenos data-linenos="31 "></span></a><span class=w>    </span><span class=nt>test_types</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;unit&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;integration&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;data_quality&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;performance&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-31-32><a id=__codelineno-31-32 name=__codelineno-31-32></a><a href=#__codelineno-31-32><span class=linenos data-linenos="32 "></span></a><span class=w>    </span><span class=nt>data_validation</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-31-33><a id=__codelineno-31-33 name=__codelineno-31-33></a><a href=#__codelineno-31-33><span class=linenos data-linenos="33 "></span></a><span class=w>    </span>
</span><span id=__span-31-34><a id=__codelineno-31-34 name=__codelineno-31-34></a><a href=#__codelineno-31-34><span class=linenos data-linenos="34 "></span></a><span class=w>  </span><span class=nt>data_agent</span><span class=p>:</span>
</span><span id=__span-31-35><a id=__codelineno-31-35 name=__codelineno-31-35></a><a href=#__codelineno-31-35><span class=linenos data-linenos="35 "></span></a><span class=w>    </span><span class=nt>analytics_tools</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;jupyter&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;matplotlib&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;seaborn&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-31-36><a id=__codelineno-31-36 name=__codelineno-31-36></a><a href=#__codelineno-31-36><span class=linenos data-linenos="36 "></span></a><span class=w>    </span><span class=nt>profiling_enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-31-37><a id=__codelineno-31-37 name=__codelineno-31-37></a><a href=#__codelineno-31-37><span class=linenos data-linenos="37 "></span></a><span class=w>    </span>
</span><span id=__span-31-38><a id=__codelineno-31-38 name=__codelineno-31-38></a><a href=#__codelineno-31-38><span class=linenos data-linenos="38 "></span></a><span class=nt>integrations</span><span class=p>:</span>
</span><span id=__span-31-39><a id=__codelineno-31-39 name=__codelineno-31-39></a><a href=#__codelineno-31-39><span class=linenos data-linenos="39 "></span></a><span class=w>  </span><span class=nt>data_platforms</span><span class=p>:</span>
</span><span id=__span-31-40><a id=__codelineno-31-40 name=__codelineno-31-40></a><a href=#__codelineno-31-40><span class=linenos data-linenos="40 "></span></a><span class=w>    </span><span class=nt>kafka</span><span class=p>:</span>
</span><span id=__span-31-41><a id=__codelineno-31-41 name=__codelineno-31-41></a><a href=#__codelineno-31-41><span class=linenos data-linenos="41 "></span></a><span class=w>      </span><span class=nt>bootstrap_servers</span><span class=p>:</span><span class=w> </span><span class=s>&quot;localhost:9092&quot;</span>
</span><span id=__span-31-42><a id=__codelineno-31-42 name=__codelineno-31-42></a><a href=#__codelineno-31-42><span class=linenos data-linenos="42 "></span></a><span class=w>    </span><span class=nt>spark</span><span class=p>:</span>
</span><span id=__span-31-43><a id=__codelineno-31-43 name=__codelineno-31-43></a><a href=#__codelineno-31-43><span class=linenos data-linenos="43 "></span></a><span class=w>      </span><span class=nt>master</span><span class=p>:</span><span class=w> </span><span class=s>&quot;local[*]&quot;</span>
</span><span id=__span-31-44><a id=__codelineno-31-44 name=__codelineno-31-44></a><a href=#__codelineno-31-44><span class=linenos data-linenos="44 "></span></a><span class=w>    </span><span class=nt>postgres</span><span class=p>:</span>
</span><span id=__span-31-45><a id=__codelineno-31-45 name=__codelineno-31-45></a><a href=#__codelineno-31-45><span class=linenos data-linenos="45 "></span></a><span class=w>      </span><span class=nt>connection_string</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${DATABASE_URL}&quot;</span>
</span></code></pre></div><h5 id=tdd-cycle-example-kafka-consumer>TDD Cycle Example: Kafka Consumer<a class=headerlink href=#tdd-cycle-example-kafka-consumer title="Permanent link">&para;</a></h5><p><strong>Design Phase:</strong><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1></a><a href=#__codelineno-32-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># docs/tdd/PIPE-001/kafka_consumer_design.md</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2></a><a href=#__codelineno-32-2><span class=linenos data-linenos=" 2 "></span></a><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3></a><a href=#__codelineno-32-3><span class=linenos data-linenos=" 3 "></span></a><span class=sd>Kafka Consumer Design</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4></a><a href=#__codelineno-32-4><span class=linenos data-linenos=" 4 "></span></a>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5></a><a href=#__codelineno-32-5><span class=linenos data-linenos=" 5 "></span></a><span class=sd>Objective: Create a robust Kafka consumer that can:</span>
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6></a><a href=#__codelineno-32-6><span class=linenos data-linenos=" 6 "></span></a><span class=sd>1. Connect to multiple topics</span>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7></a><a href=#__codelineno-32-7><span class=linenos data-linenos=" 7 "></span></a><span class=sd>2. Handle message deserialization</span>
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8></a><a href=#__codelineno-32-8><span class=linenos data-linenos=" 8 "></span></a><span class=sd>3. Implement error handling and retries</span>
</span><span id=__span-32-9><a id=__codelineno-32-9 name=__codelineno-32-9></a><a href=#__codelineno-32-9><span class=linenos data-linenos=" 9 "></span></a><span class=sd>4. Support checkpointing</span>
</span><span id=__span-32-10><a id=__codelineno-32-10 name=__codelineno-32-10></a><a href=#__codelineno-32-10><span class=linenos data-linenos="10 "></span></a><span class=sd>5. Provide metrics</span>
</span><span id=__span-32-11><a id=__codelineno-32-11 name=__codelineno-32-11></a><a href=#__codelineno-32-11><span class=linenos data-linenos="11 "></span></a>
</span><span id=__span-32-12><a id=__codelineno-32-12 name=__codelineno-32-12></a><a href=#__codelineno-32-12><span class=linenos data-linenos="12 "></span></a><span class=sd>Message Flow:</span>
</span><span id=__span-32-13><a id=__codelineno-32-13 name=__codelineno-32-13></a><a href=#__codelineno-32-13><span class=linenos data-linenos="13 "></span></a><span class=sd>Kafka Topic -&gt; Consumer -&gt; Deserializer -&gt; Validator -&gt; Processor -&gt; Storage</span>
</span><span id=__span-32-14><a id=__codelineno-32-14 name=__codelineno-32-14></a><a href=#__codelineno-32-14><span class=linenos data-linenos="14 "></span></a>
</span><span id=__span-32-15><a id=__codelineno-32-15 name=__codelineno-32-15></a><a href=#__codelineno-32-15><span class=linenos data-linenos="15 "></span></a><span class=sd>Error Handling:</span>
</span><span id=__span-32-16><a id=__codelineno-32-16 name=__codelineno-32-16></a><a href=#__codelineno-32-16><span class=linenos data-linenos="16 "></span></a><span class=sd>- Dead letter queue for failed messages</span>
</span><span id=__span-32-17><a id=__codelineno-32-17 name=__codelineno-32-17></a><a href=#__codelineno-32-17><span class=linenos data-linenos="17 "></span></a><span class=sd>- Exponential backoff for retries</span>
</span><span id=__span-32-18><a id=__codelineno-32-18 name=__codelineno-32-18></a><a href=#__codelineno-32-18><span class=linenos data-linenos="18 "></span></a><span class=sd>- Circuit breaker for downstream services</span>
</span><span id=__span-32-19><a id=__codelineno-32-19 name=__codelineno-32-19></a><a href=#__codelineno-32-19><span class=linenos data-linenos="19 "></span></a><span class=sd>&quot;&quot;&quot;</span>
</span></code></pre></div></p><p><strong>Generated Tests:</strong><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1></a><a href=#__codelineno-33-1><span class=linenos data-linenos="  1 "></span></a><span class=c1># tests/tdd/PIPE-001/test_kafka_consumer.py</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2></a><a href=#__codelineno-33-2><span class=linenos data-linenos="  2 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>pytest</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3></a><a href=#__codelineno-33-3><span class=linenos data-linenos="  3 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>unittest.mock</span><span class=w> </span><span class=kn>import</span> <span class=n>Mock</span><span class=p>,</span> <span class=n>patch</span><span class=p>,</span> <span class=n>MagicMock</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4></a><a href=#__codelineno-33-4><span class=linenos data-linenos="  4 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5></a><a href=#__codelineno-33-5><span class=linenos data-linenos="  5 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6></a><a href=#__codelineno-33-6><span class=linenos data-linenos="  6 "></span></a>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7></a><a href=#__codelineno-33-7><span class=linenos data-linenos="  7 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>src.ingestion.kafka_consumer</span><span class=w> </span><span class=kn>import</span> <span class=n>KafkaConsumer</span><span class=p>,</span> <span class=n>MessageProcessor</span>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8></a><a href=#__codelineno-33-8><span class=linenos data-linenos="  8 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>src.validation.validators</span><span class=w> </span><span class=kn>import</span> <span class=n>MessageValidator</span>
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9></a><a href=#__codelineno-33-9><span class=linenos data-linenos="  9 "></span></a>
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10></a><a href=#__codelineno-33-10><span class=linenos data-linenos=" 10 "></span></a>
</span><span id=__span-33-11><a id=__codelineno-33-11 name=__codelineno-33-11></a><a href=#__codelineno-33-11><span class=linenos data-linenos=" 11 "></span></a><span class=k>class</span><span class=w> </span><span class=nc>TestKafkaConsumer</span><span class=p>:</span>
</span><span id=__span-33-12><a id=__codelineno-33-12 name=__codelineno-33-12></a><a href=#__codelineno-33-12><span class=linenos data-linenos=" 12 "></span></a>    
</span><span id=__span-33-13><a id=__codelineno-33-13 name=__codelineno-33-13></a><a href=#__codelineno-33-13><span class=linenos data-linenos=" 13 "></span></a>    <span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span>
</span><span id=__span-33-14><a id=__codelineno-33-14 name=__codelineno-33-14></a><a href=#__codelineno-33-14><span class=linenos data-linenos=" 14 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>mock_kafka_consumer</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-33-15><a id=__codelineno-33-15 name=__codelineno-33-15></a><a href=#__codelineno-33-15><span class=linenos data-linenos=" 15 "></span></a>        <span class=k>with</span> <span class=n>patch</span><span class=p>(</span><span class=s1>&#39;kafka.KafkaConsumer&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>mock</span><span class=p>:</span>
</span><span id=__span-33-16><a id=__codelineno-33-16 name=__codelineno-33-16></a><a href=#__codelineno-33-16><span class=linenos data-linenos=" 16 "></span></a>            <span class=k>yield</span> <span class=n>mock</span>
</span><span id=__span-33-17><a id=__codelineno-33-17 name=__codelineno-33-17></a><a href=#__codelineno-33-17><span class=linenos data-linenos=" 17 "></span></a>    
</span><span id=__span-33-18><a id=__codelineno-33-18 name=__codelineno-33-18></a><a href=#__codelineno-33-18><span class=linenos data-linenos=" 18 "></span></a>    <span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span>
</span><span id=__span-33-19><a id=__codelineno-33-19 name=__codelineno-33-19></a><a href=#__codelineno-33-19><span class=linenos data-linenos=" 19 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>consumer_config</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-33-20><a id=__codelineno-33-20 name=__codelineno-33-20></a><a href=#__codelineno-33-20><span class=linenos data-linenos=" 20 "></span></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-33-21><a id=__codelineno-33-21 name=__codelineno-33-21></a><a href=#__codelineno-33-21><span class=linenos data-linenos=" 21 "></span></a>            <span class=s1>&#39;bootstrap_servers&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;localhost:9092&#39;</span><span class=p>],</span>
</span><span id=__span-33-22><a id=__codelineno-33-22 name=__codelineno-33-22></a><a href=#__codelineno-33-22><span class=linenos data-linenos=" 22 "></span></a>            <span class=s1>&#39;topics&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;user-events&#39;</span><span class=p>,</span> <span class=s1>&#39;system-logs&#39;</span><span class=p>],</span>
</span><span id=__span-33-23><a id=__codelineno-33-23 name=__codelineno-33-23></a><a href=#__codelineno-33-23><span class=linenos data-linenos=" 23 "></span></a>            <span class=s1>&#39;group_id&#39;</span><span class=p>:</span> <span class=s1>&#39;test-consumer-group&#39;</span><span class=p>,</span>
</span><span id=__span-33-24><a id=__codelineno-33-24 name=__codelineno-33-24></a><a href=#__codelineno-33-24><span class=linenos data-linenos=" 24 "></span></a>            <span class=s1>&#39;auto_offset_reset&#39;</span><span class=p>:</span> <span class=s1>&#39;earliest&#39;</span><span class=p>,</span>
</span><span id=__span-33-25><a id=__codelineno-33-25 name=__codelineno-33-25></a><a href=#__codelineno-33-25><span class=linenos data-linenos=" 25 "></span></a>            <span class=s1>&#39;enable_auto_commit&#39;</span><span class=p>:</span> <span class=kc>False</span>
</span><span id=__span-33-26><a id=__codelineno-33-26 name=__codelineno-33-26></a><a href=#__codelineno-33-26><span class=linenos data-linenos=" 26 "></span></a>        <span class=p>}</span>
</span><span id=__span-33-27><a id=__codelineno-33-27 name=__codelineno-33-27></a><a href=#__codelineno-33-27><span class=linenos data-linenos=" 27 "></span></a>    
</span><span id=__span-33-28><a id=__codelineno-33-28 name=__codelineno-33-28></a><a href=#__codelineno-33-28><span class=linenos data-linenos=" 28 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>test_consumer_initialization</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>mock_kafka_consumer</span><span class=p>,</span> <span class=n>consumer_config</span><span class=p>):</span>
</span><span id=__span-33-29><a id=__codelineno-33-29 name=__codelineno-33-29></a><a href=#__codelineno-33-29><span class=linenos data-linenos=" 29 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Test that consumer initializes with correct configuration&quot;&quot;&quot;</span>
</span><span id=__span-33-30><a id=__codelineno-33-30 name=__codelineno-33-30></a><a href=#__codelineno-33-30><span class=linenos data-linenos=" 30 "></span></a>        <span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span><span class=n>consumer_config</span><span class=p>)</span>
</span><span id=__span-33-31><a id=__codelineno-33-31 name=__codelineno-33-31></a><a href=#__codelineno-33-31><span class=linenos data-linenos=" 31 "></span></a>        
</span><span id=__span-33-32><a id=__codelineno-33-32 name=__codelineno-33-32></a><a href=#__codelineno-33-32><span class=linenos data-linenos=" 32 "></span></a>        <span class=n>mock_kafka_consumer</span><span class=o>.</span><span class=n>assert_called_once_with</span><span class=p>(</span>
</span><span id=__span-33-33><a id=__codelineno-33-33 name=__codelineno-33-33></a><a href=#__codelineno-33-33><span class=linenos data-linenos=" 33 "></span></a>            <span class=o>*</span><span class=n>consumer_config</span><span class=p>[</span><span class=s1>&#39;topics&#39;</span><span class=p>],</span>
</span><span id=__span-33-34><a id=__codelineno-33-34 name=__codelineno-33-34></a><a href=#__codelineno-33-34><span class=linenos data-linenos=" 34 "></span></a>            <span class=n>bootstrap_servers</span><span class=o>=</span><span class=n>consumer_config</span><span class=p>[</span><span class=s1>&#39;bootstrap_servers&#39;</span><span class=p>],</span>
</span><span id=__span-33-35><a id=__codelineno-33-35 name=__codelineno-33-35></a><a href=#__codelineno-33-35><span class=linenos data-linenos=" 35 "></span></a>            <span class=n>group_id</span><span class=o>=</span><span class=n>consumer_config</span><span class=p>[</span><span class=s1>&#39;group_id&#39;</span><span class=p>],</span>
</span><span id=__span-33-36><a id=__codelineno-33-36 name=__codelineno-33-36></a><a href=#__codelineno-33-36><span class=linenos data-linenos=" 36 "></span></a>            <span class=n>auto_offset_reset</span><span class=o>=</span><span class=n>consumer_config</span><span class=p>[</span><span class=s1>&#39;auto_offset_reset&#39;</span><span class=p>],</span>
</span><span id=__span-33-37><a id=__codelineno-33-37 name=__codelineno-33-37></a><a href=#__codelineno-33-37><span class=linenos data-linenos=" 37 "></span></a>            <span class=n>enable_auto_commit</span><span class=o>=</span><span class=n>consumer_config</span><span class=p>[</span><span class=s1>&#39;enable_auto_commit&#39;</span><span class=p>],</span>
</span><span id=__span-33-38><a id=__codelineno-33-38 name=__codelineno-33-38></a><a href=#__codelineno-33-38><span class=linenos data-linenos=" 38 "></span></a>            <span class=n>value_deserializer</span><span class=o>=</span><span class=n>consumer</span><span class=o>.</span><span class=n>_deserialize_message</span>
</span><span id=__span-33-39><a id=__codelineno-33-39 name=__codelineno-33-39></a><a href=#__codelineno-33-39><span class=linenos data-linenos=" 39 "></span></a>        <span class=p>)</span>
</span><span id=__span-33-40><a id=__codelineno-33-40 name=__codelineno-33-40></a><a href=#__codelineno-33-40><span class=linenos data-linenos=" 40 "></span></a>    
</span><span id=__span-33-41><a id=__codelineno-33-41 name=__codelineno-33-41></a><a href=#__codelineno-33-41><span class=linenos data-linenos=" 41 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>test_message_deserialization</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>consumer_config</span><span class=p>):</span>
</span><span id=__span-33-42><a id=__codelineno-33-42 name=__codelineno-33-42></a><a href=#__codelineno-33-42><span class=linenos data-linenos=" 42 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Test JSON message deserialization&quot;&quot;&quot;</span>
</span><span id=__span-33-43><a id=__codelineno-33-43 name=__codelineno-33-43></a><a href=#__codelineno-33-43><span class=linenos data-linenos=" 43 "></span></a>        <span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span><span class=n>consumer_config</span><span class=p>)</span>
</span><span id=__span-33-44><a id=__codelineno-33-44 name=__codelineno-33-44></a><a href=#__codelineno-33-44><span class=linenos data-linenos=" 44 "></span></a>        
</span><span id=__span-33-45><a id=__codelineno-33-45 name=__codelineno-33-45></a><a href=#__codelineno-33-45><span class=linenos data-linenos=" 45 "></span></a>        <span class=c1># Test valid JSON</span>
</span><span id=__span-33-46><a id=__codelineno-33-46 name=__codelineno-33-46></a><a href=#__codelineno-33-46><span class=linenos data-linenos=" 46 "></span></a>        <span class=n>valid_json</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;{&quot;event&quot;: &quot;user_signup&quot;, &quot;user_id&quot;: 123}&#39;</span>
</span><span id=__span-33-47><a id=__codelineno-33-47 name=__codelineno-33-47></a><a href=#__codelineno-33-47><span class=linenos data-linenos=" 47 "></span></a>        <span class=n>result</span> <span class=o>=</span> <span class=n>consumer</span><span class=o>.</span><span class=n>_deserialize_message</span><span class=p>(</span><span class=n>valid_json</span><span class=p>)</span>
</span><span id=__span-33-48><a id=__codelineno-33-48 name=__codelineno-33-48></a><a href=#__codelineno-33-48><span class=linenos data-linenos=" 48 "></span></a>        <span class=k>assert</span> <span class=n>result</span> <span class=o>==</span> <span class=p>{</span><span class=s2>&quot;event&quot;</span><span class=p>:</span> <span class=s2>&quot;user_signup&quot;</span><span class=p>,</span> <span class=s2>&quot;user_id&quot;</span><span class=p>:</span> <span class=mi>123</span><span class=p>}</span>
</span><span id=__span-33-49><a id=__codelineno-33-49 name=__codelineno-33-49></a><a href=#__codelineno-33-49><span class=linenos data-linenos=" 49 "></span></a>        
</span><span id=__span-33-50><a id=__codelineno-33-50 name=__codelineno-33-50></a><a href=#__codelineno-33-50><span class=linenos data-linenos=" 50 "></span></a>        <span class=c1># Test invalid JSON</span>
</span><span id=__span-33-51><a id=__codelineno-33-51 name=__codelineno-33-51></a><a href=#__codelineno-33-51><span class=linenos data-linenos=" 51 "></span></a>        <span class=n>invalid_json</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;invalid json&#39;</span>
</span><span id=__span-33-52><a id=__codelineno-33-52 name=__codelineno-33-52></a><a href=#__codelineno-33-52><span class=linenos data-linenos=" 52 "></span></a>        <span class=k>with</span> <span class=n>pytest</span><span class=o>.</span><span class=n>raises</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span><span class=p>):</span>
</span><span id=__span-33-53><a id=__codelineno-33-53 name=__codelineno-33-53></a><a href=#__codelineno-33-53><span class=linenos data-linenos=" 53 "></span></a>            <span class=n>consumer</span><span class=o>.</span><span class=n>_deserialize_message</span><span class=p>(</span><span class=n>invalid_json</span><span class=p>)</span>
</span><span id=__span-33-54><a id=__codelineno-33-54 name=__codelineno-33-54></a><a href=#__codelineno-33-54><span class=linenos data-linenos=" 54 "></span></a>    
</span><span id=__span-33-55><a id=__codelineno-33-55 name=__codelineno-33-55></a><a href=#__codelineno-33-55><span class=linenos data-linenos=" 55 "></span></a>    <span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>asyncio</span>
</span><span id=__span-33-56><a id=__codelineno-33-56 name=__codelineno-33-56></a><a href=#__codelineno-33-56><span class=linenos data-linenos=" 56 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>test_message_processing_success</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>mock_kafka_consumer</span><span class=p>,</span> <span class=n>consumer_config</span><span class=p>):</span>
</span><span id=__span-33-57><a id=__codelineno-33-57 name=__codelineno-33-57></a><a href=#__codelineno-33-57><span class=linenos data-linenos=" 57 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Test successful message processing&quot;&quot;&quot;</span>
</span><span id=__span-33-58><a id=__codelineno-33-58 name=__codelineno-33-58></a><a href=#__codelineno-33-58><span class=linenos data-linenos=" 58 "></span></a>        <span class=c1># Setup</span>
</span><span id=__span-33-59><a id=__codelineno-33-59 name=__codelineno-33-59></a><a href=#__codelineno-33-59><span class=linenos data-linenos=" 59 "></span></a>        <span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span><span class=n>consumer_config</span><span class=p>)</span>
</span><span id=__span-33-60><a id=__codelineno-33-60 name=__codelineno-33-60></a><a href=#__codelineno-33-60><span class=linenos data-linenos=" 60 "></span></a>        <span class=n>processor</span> <span class=o>=</span> <span class=n>Mock</span><span class=p>(</span><span class=n>spec</span><span class=o>=</span><span class=n>MessageProcessor</span><span class=p>)</span>
</span><span id=__span-33-61><a id=__codelineno-33-61 name=__codelineno-33-61></a><a href=#__codelineno-33-61><span class=linenos data-linenos=" 61 "></span></a>        <span class=n>validator</span> <span class=o>=</span> <span class=n>Mock</span><span class=p>(</span><span class=n>spec</span><span class=o>=</span><span class=n>MessageValidator</span><span class=p>)</span>
</span><span id=__span-33-62><a id=__codelineno-33-62 name=__codelineno-33-62></a><a href=#__codelineno-33-62><span class=linenos data-linenos=" 62 "></span></a>        
</span><span id=__span-33-63><a id=__codelineno-33-63 name=__codelineno-33-63></a><a href=#__codelineno-33-63><span class=linenos data-linenos=" 63 "></span></a>        <span class=n>consumer</span><span class=o>.</span><span class=n>processor</span> <span class=o>=</span> <span class=n>processor</span>
</span><span id=__span-33-64><a id=__codelineno-33-64 name=__codelineno-33-64></a><a href=#__codelineno-33-64><span class=linenos data-linenos=" 64 "></span></a>        <span class=n>consumer</span><span class=o>.</span><span class=n>validator</span> <span class=o>=</span> <span class=n>validator</span>
</span><span id=__span-33-65><a id=__codelineno-33-65 name=__codelineno-33-65></a><a href=#__codelineno-33-65><span class=linenos data-linenos=" 65 "></span></a>        
</span><span id=__span-33-66><a id=__codelineno-33-66 name=__codelineno-33-66></a><a href=#__codelineno-33-66><span class=linenos data-linenos=" 66 "></span></a>        <span class=c1># Mock message</span>
</span><span id=__span-33-67><a id=__codelineno-33-67 name=__codelineno-33-67></a><a href=#__codelineno-33-67><span class=linenos data-linenos=" 67 "></span></a>        <span class=n>mock_message</span> <span class=o>=</span> <span class=n>MagicMock</span><span class=p>()</span>
</span><span id=__span-33-68><a id=__codelineno-33-68 name=__codelineno-33-68></a><a href=#__codelineno-33-68><span class=linenos data-linenos=" 68 "></span></a>        <span class=n>mock_message</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;event&quot;</span><span class=p>:</span> <span class=s2>&quot;user_signup&quot;</span><span class=p>,</span> <span class=s2>&quot;user_id&quot;</span><span class=p>:</span> <span class=mi>123</span><span class=p>}</span>
</span><span id=__span-33-69><a id=__codelineno-33-69 name=__codelineno-33-69></a><a href=#__codelineno-33-69><span class=linenos data-linenos=" 69 "></span></a>        <span class=n>mock_message</span><span class=o>.</span><span class=n>topic</span> <span class=o>=</span> <span class=s2>&quot;user-events&quot;</span>
</span><span id=__span-33-70><a id=__codelineno-33-70 name=__codelineno-33-70></a><a href=#__codelineno-33-70><span class=linenos data-linenos=" 70 "></span></a>        <span class=n>mock_message</span><span class=o>.</span><span class=n>partition</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-33-71><a id=__codelineno-33-71 name=__codelineno-33-71></a><a href=#__codelineno-33-71><span class=linenos data-linenos=" 71 "></span></a>        <span class=n>mock_message</span><span class=o>.</span><span class=n>offset</span> <span class=o>=</span> <span class=mi>100</span>
</span><span id=__span-33-72><a id=__codelineno-33-72 name=__codelineno-33-72></a><a href=#__codelineno-33-72><span class=linenos data-linenos=" 72 "></span></a>        
</span><span id=__span-33-73><a id=__codelineno-33-73 name=__codelineno-33-73></a><a href=#__codelineno-33-73><span class=linenos data-linenos=" 73 "></span></a>        <span class=n>validator</span><span class=o>.</span><span class=n>validate</span><span class=o>.</span><span class=n>return_value</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-33-74><a id=__codelineno-33-74 name=__codelineno-33-74></a><a href=#__codelineno-33-74><span class=linenos data-linenos=" 74 "></span></a>        <span class=n>processor</span><span class=o>.</span><span class=n>process</span><span class=o>.</span><span class=n>return_value</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;success&quot;</span><span class=p>}</span>
</span><span id=__span-33-75><a id=__codelineno-33-75 name=__codelineno-33-75></a><a href=#__codelineno-33-75><span class=linenos data-linenos=" 75 "></span></a>        
</span><span id=__span-33-76><a id=__codelineno-33-76 name=__codelineno-33-76></a><a href=#__codelineno-33-76><span class=linenos data-linenos=" 76 "></span></a>        <span class=c1># Process message</span>
</span><span id=__span-33-77><a id=__codelineno-33-77 name=__codelineno-33-77></a><a href=#__codelineno-33-77><span class=linenos data-linenos=" 77 "></span></a>        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>consumer</span><span class=o>.</span><span class=n>_process_message</span><span class=p>(</span><span class=n>mock_message</span><span class=p>)</span>
</span><span id=__span-33-78><a id=__codelineno-33-78 name=__codelineno-33-78></a><a href=#__codelineno-33-78><span class=linenos data-linenos=" 78 "></span></a>        
</span><span id=__span-33-79><a id=__codelineno-33-79 name=__codelineno-33-79></a><a href=#__codelineno-33-79><span class=linenos data-linenos=" 79 "></span></a>        <span class=c1># Assertions</span>
</span><span id=__span-33-80><a id=__codelineno-33-80 name=__codelineno-33-80></a><a href=#__codelineno-33-80><span class=linenos data-linenos=" 80 "></span></a>        <span class=k>assert</span> <span class=n>result</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;success&quot;</span>
</span><span id=__span-33-81><a id=__codelineno-33-81 name=__codelineno-33-81></a><a href=#__codelineno-33-81><span class=linenos data-linenos=" 81 "></span></a>        <span class=n>validator</span><span class=o>.</span><span class=n>validate</span><span class=o>.</span><span class=n>assert_called_once_with</span><span class=p>(</span><span class=n>mock_message</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span><span id=__span-33-82><a id=__codelineno-33-82 name=__codelineno-33-82></a><a href=#__codelineno-33-82><span class=linenos data-linenos=" 82 "></span></a>        <span class=n>processor</span><span class=o>.</span><span class=n>process</span><span class=o>.</span><span class=n>assert_called_once_with</span><span class=p>(</span><span class=n>mock_message</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span><span id=__span-33-83><a id=__codelineno-33-83 name=__codelineno-33-83></a><a href=#__codelineno-33-83><span class=linenos data-linenos=" 83 "></span></a>    
</span><span id=__span-33-84><a id=__codelineno-33-84 name=__codelineno-33-84></a><a href=#__codelineno-33-84><span class=linenos data-linenos=" 84 "></span></a>    <span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>asyncio</span>
</span><span id=__span-33-85><a id=__codelineno-33-85 name=__codelineno-33-85></a><a href=#__codelineno-33-85><span class=linenos data-linenos=" 85 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>test_message_processing_validation_failure</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>consumer_config</span><span class=p>):</span>
</span><span id=__span-33-86><a id=__codelineno-33-86 name=__codelineno-33-86></a><a href=#__codelineno-33-86><span class=linenos data-linenos=" 86 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Test message processing with validation failure&quot;&quot;&quot;</span>
</span><span id=__span-33-87><a id=__codelineno-33-87 name=__codelineno-33-87></a><a href=#__codelineno-33-87><span class=linenos data-linenos=" 87 "></span></a>        <span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span><span class=n>consumer_config</span><span class=p>)</span>
</span><span id=__span-33-88><a id=__codelineno-33-88 name=__codelineno-33-88></a><a href=#__codelineno-33-88><span class=linenos data-linenos=" 88 "></span></a>        <span class=n>validator</span> <span class=o>=</span> <span class=n>Mock</span><span class=p>(</span><span class=n>spec</span><span class=o>=</span><span class=n>MessageValidator</span><span class=p>)</span>
</span><span id=__span-33-89><a id=__codelineno-33-89 name=__codelineno-33-89></a><a href=#__codelineno-33-89><span class=linenos data-linenos=" 89 "></span></a>        <span class=n>validator</span><span class=o>.</span><span class=n>validate</span><span class=o>.</span><span class=n>return_value</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-33-90><a id=__codelineno-33-90 name=__codelineno-33-90></a><a href=#__codelineno-33-90><span class=linenos data-linenos=" 90 "></span></a>        <span class=n>consumer</span><span class=o>.</span><span class=n>validator</span> <span class=o>=</span> <span class=n>validator</span>
</span><span id=__span-33-91><a id=__codelineno-33-91 name=__codelineno-33-91></a><a href=#__codelineno-33-91><span class=linenos data-linenos=" 91 "></span></a>        
</span><span id=__span-33-92><a id=__codelineno-33-92 name=__codelineno-33-92></a><a href=#__codelineno-33-92><span class=linenos data-linenos=" 92 "></span></a>        <span class=n>mock_message</span> <span class=o>=</span> <span class=n>MagicMock</span><span class=p>()</span>
</span><span id=__span-33-93><a id=__codelineno-33-93 name=__codelineno-33-93></a><a href=#__codelineno-33-93><span class=linenos data-linenos=" 93 "></span></a>        <span class=n>mock_message</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;invalid&quot;</span><span class=p>:</span> <span class=s2>&quot;data&quot;</span><span class=p>}</span>
</span><span id=__span-33-94><a id=__codelineno-33-94 name=__codelineno-33-94></a><a href=#__codelineno-33-94><span class=linenos data-linenos=" 94 "></span></a>        
</span><span id=__span-33-95><a id=__codelineno-33-95 name=__codelineno-33-95></a><a href=#__codelineno-33-95><span class=linenos data-linenos=" 95 "></span></a>        <span class=k>with</span> <span class=n>pytest</span><span class=o>.</span><span class=n>raises</span><span class=p>(</span><span class=ne>ValueError</span><span class=p>)</span> <span class=k>as</span> <span class=n>exc_info</span><span class=p>:</span>
</span><span id=__span-33-96><a id=__codelineno-33-96 name=__codelineno-33-96></a><a href=#__codelineno-33-96><span class=linenos data-linenos=" 96 "></span></a>            <span class=k>await</span> <span class=n>consumer</span><span class=o>.</span><span class=n>_process_message</span><span class=p>(</span><span class=n>mock_message</span><span class=p>)</span>
</span><span id=__span-33-97><a id=__codelineno-33-97 name=__codelineno-33-97></a><a href=#__codelineno-33-97><span class=linenos data-linenos=" 97 "></span></a>        
</span><span id=__span-33-98><a id=__codelineno-33-98 name=__codelineno-33-98></a><a href=#__codelineno-33-98><span class=linenos data-linenos=" 98 "></span></a>        <span class=k>assert</span> <span class=s2>&quot;Message validation failed&quot;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>exc_info</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span><span id=__span-33-99><a id=__codelineno-33-99 name=__codelineno-33-99></a><a href=#__codelineno-33-99><span class=linenos data-linenos=" 99 "></span></a>    
</span><span id=__span-33-100><a id=__codelineno-33-100 name=__codelineno-33-100></a><a href=#__codelineno-33-100><span class=linenos data-linenos="100 "></span></a>    <span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>asyncio</span>
</span><span id=__span-33-101><a id=__codelineno-33-101 name=__codelineno-33-101></a><a href=#__codelineno-33-101><span class=linenos data-linenos="101 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>test_retry_mechanism</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>consumer_config</span><span class=p>):</span>
</span><span id=__span-33-102><a id=__codelineno-33-102 name=__codelineno-33-102></a><a href=#__codelineno-33-102><span class=linenos data-linenos="102 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Test retry mechanism with exponential backoff&quot;&quot;&quot;</span>
</span><span id=__span-33-103><a id=__codelineno-33-103 name=__codelineno-33-103></a><a href=#__codelineno-33-103><span class=linenos data-linenos="103 "></span></a>        <span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span><span class=n>consumer_config</span><span class=p>)</span>
</span><span id=__span-33-104><a id=__codelineno-33-104 name=__codelineno-33-104></a><a href=#__codelineno-33-104><span class=linenos data-linenos="104 "></span></a>        <span class=n>processor</span> <span class=o>=</span> <span class=n>Mock</span><span class=p>(</span><span class=n>spec</span><span class=o>=</span><span class=n>MessageProcessor</span><span class=p>)</span>
</span><span id=__span-33-105><a id=__codelineno-33-105 name=__codelineno-33-105></a><a href=#__codelineno-33-105><span class=linenos data-linenos="105 "></span></a>        
</span><span id=__span-33-106><a id=__codelineno-33-106 name=__codelineno-33-106></a><a href=#__codelineno-33-106><span class=linenos data-linenos="106 "></span></a>        <span class=c1># Simulate failures then success</span>
</span><span id=__span-33-107><a id=__codelineno-33-107 name=__codelineno-33-107></a><a href=#__codelineno-33-107><span class=linenos data-linenos="107 "></span></a>        <span class=n>processor</span><span class=o>.</span><span class=n>process</span><span class=o>.</span><span class=n>side_effect</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-33-108><a id=__codelineno-33-108 name=__codelineno-33-108></a><a href=#__codelineno-33-108><span class=linenos data-linenos="108 "></span></a>            <span class=ne>Exception</span><span class=p>(</span><span class=s2>&quot;First attempt failed&quot;</span><span class=p>),</span>
</span><span id=__span-33-109><a id=__codelineno-33-109 name=__codelineno-33-109></a><a href=#__codelineno-33-109><span class=linenos data-linenos="109 "></span></a>            <span class=ne>Exception</span><span class=p>(</span><span class=s2>&quot;Second attempt failed&quot;</span><span class=p>),</span>
</span><span id=__span-33-110><a id=__codelineno-33-110 name=__codelineno-33-110></a><a href=#__codelineno-33-110><span class=linenos data-linenos="110 "></span></a>            <span class=p>{</span><span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;success&quot;</span><span class=p>}</span>
</span><span id=__span-33-111><a id=__codelineno-33-111 name=__codelineno-33-111></a><a href=#__codelineno-33-111><span class=linenos data-linenos="111 "></span></a>        <span class=p>]</span>
</span><span id=__span-33-112><a id=__codelineno-33-112 name=__codelineno-33-112></a><a href=#__codelineno-33-112><span class=linenos data-linenos="112 "></span></a>        
</span><span id=__span-33-113><a id=__codelineno-33-113 name=__codelineno-33-113></a><a href=#__codelineno-33-113><span class=linenos data-linenos="113 "></span></a>        <span class=n>consumer</span><span class=o>.</span><span class=n>processor</span> <span class=o>=</span> <span class=n>processor</span>
</span><span id=__span-33-114><a id=__codelineno-33-114 name=__codelineno-33-114></a><a href=#__codelineno-33-114><span class=linenos data-linenos="114 "></span></a>        <span class=n>consumer</span><span class=o>.</span><span class=n>validator</span> <span class=o>=</span> <span class=n>Mock</span><span class=p>(</span><span class=n>return_value</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-33-115><a id=__codelineno-33-115 name=__codelineno-33-115></a><a href=#__codelineno-33-115><span class=linenos data-linenos="115 "></span></a>        
</span><span id=__span-33-116><a id=__codelineno-33-116 name=__codelineno-33-116></a><a href=#__codelineno-33-116><span class=linenos data-linenos="116 "></span></a>        <span class=n>mock_message</span> <span class=o>=</span> <span class=n>MagicMock</span><span class=p>()</span>
</span><span id=__span-33-117><a id=__codelineno-33-117 name=__codelineno-33-117></a><a href=#__codelineno-33-117><span class=linenos data-linenos="117 "></span></a>        <span class=n>mock_message</span><span class=o>.</span><span class=n>value</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;data&quot;</span><span class=p>:</span> <span class=s2>&quot;test&quot;</span><span class=p>}</span>
</span><span id=__span-33-118><a id=__codelineno-33-118 name=__codelineno-33-118></a><a href=#__codelineno-33-118><span class=linenos data-linenos="118 "></span></a>        
</span><span id=__span-33-119><a id=__codelineno-33-119 name=__codelineno-33-119></a><a href=#__codelineno-33-119><span class=linenos data-linenos="119 "></span></a>        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>consumer</span><span class=o>.</span><span class=n>_process_message_with_retry</span><span class=p>(</span><span class=n>mock_message</span><span class=p>,</span> <span class=n>max_retries</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span><span id=__span-33-120><a id=__codelineno-33-120 name=__codelineno-33-120></a><a href=#__codelineno-33-120><span class=linenos data-linenos="120 "></span></a>        
</span><span id=__span-33-121><a id=__codelineno-33-121 name=__codelineno-33-121></a><a href=#__codelineno-33-121><span class=linenos data-linenos="121 "></span></a>        <span class=k>assert</span> <span class=n>result</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;success&quot;</span>
</span><span id=__span-33-122><a id=__codelineno-33-122 name=__codelineno-33-122></a><a href=#__codelineno-33-122><span class=linenos data-linenos="122 "></span></a>        <span class=k>assert</span> <span class=n>processor</span><span class=o>.</span><span class=n>process</span><span class=o>.</span><span class=n>call_count</span> <span class=o>==</span> <span class=mi>3</span>
</span><span id=__span-33-123><a id=__codelineno-33-123 name=__codelineno-33-123></a><a href=#__codelineno-33-123><span class=linenos data-linenos="123 "></span></a>    
</span><span id=__span-33-124><a id=__codelineno-33-124 name=__codelineno-33-124></a><a href=#__codelineno-33-124><span class=linenos data-linenos="124 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>test_dead_letter_queue</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>consumer_config</span><span class=p>):</span>
</span><span id=__span-33-125><a id=__codelineno-33-125 name=__codelineno-33-125></a><a href=#__codelineno-33-125><span class=linenos data-linenos="125 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Test that failed messages go to DLQ&quot;&quot;&quot;</span>
</span><span id=__span-33-126><a id=__codelineno-33-126 name=__codelineno-33-126></a><a href=#__codelineno-33-126><span class=linenos data-linenos="126 "></span></a>        <span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span><span class=n>consumer_config</span><span class=p>)</span>
</span><span id=__span-33-127><a id=__codelineno-33-127 name=__codelineno-33-127></a><a href=#__codelineno-33-127><span class=linenos data-linenos="127 "></span></a>        <span class=n>dlq_producer</span> <span class=o>=</span> <span class=n>Mock</span><span class=p>()</span>
</span><span id=__span-33-128><a id=__codelineno-33-128 name=__codelineno-33-128></a><a href=#__codelineno-33-128><span class=linenos data-linenos="128 "></span></a>        <span class=n>consumer</span><span class=o>.</span><span class=n>dlq_producer</span> <span class=o>=</span> <span class=n>dlq_producer</span>
</span><span id=__span-33-129><a id=__codelineno-33-129 name=__codelineno-33-129></a><a href=#__codelineno-33-129><span class=linenos data-linenos="129 "></span></a>        
</span><span id=__span-33-130><a id=__codelineno-33-130 name=__codelineno-33-130></a><a href=#__codelineno-33-130><span class=linenos data-linenos="130 "></span></a>        <span class=n>failed_message</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-33-131><a id=__codelineno-33-131 name=__codelineno-33-131></a><a href=#__codelineno-33-131><span class=linenos data-linenos="131 "></span></a>            <span class=s2>&quot;original_message&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;data&quot;</span><span class=p>:</span> <span class=s2>&quot;test&quot;</span><span class=p>},</span>
</span><span id=__span-33-132><a id=__codelineno-33-132 name=__codelineno-33-132></a><a href=#__codelineno-33-132><span class=linenos data-linenos="132 "></span></a>            <span class=s2>&quot;error&quot;</span><span class=p>:</span> <span class=s2>&quot;Processing failed after max retries&quot;</span><span class=p>,</span>
</span><span id=__span-33-133><a id=__codelineno-33-133 name=__codelineno-33-133></a><a href=#__codelineno-33-133><span class=linenos data-linenos="133 "></span></a>            <span class=s2>&quot;timestamp&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span><span id=__span-33-134><a id=__codelineno-33-134 name=__codelineno-33-134></a><a href=#__codelineno-33-134><span class=linenos data-linenos="134 "></span></a>            <span class=s2>&quot;topic&quot;</span><span class=p>:</span> <span class=s2>&quot;user-events&quot;</span><span class=p>,</span>
</span><span id=__span-33-135><a id=__codelineno-33-135 name=__codelineno-33-135></a><a href=#__codelineno-33-135><span class=linenos data-linenos="135 "></span></a>            <span class=s2>&quot;partition&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-33-136><a id=__codelineno-33-136 name=__codelineno-33-136></a><a href=#__codelineno-33-136><span class=linenos data-linenos="136 "></span></a>            <span class=s2>&quot;offset&quot;</span><span class=p>:</span> <span class=mi>100</span>
</span><span id=__span-33-137><a id=__codelineno-33-137 name=__codelineno-33-137></a><a href=#__codelineno-33-137><span class=linenos data-linenos="137 "></span></a>        <span class=p>}</span>
</span><span id=__span-33-138><a id=__codelineno-33-138 name=__codelineno-33-138></a><a href=#__codelineno-33-138><span class=linenos data-linenos="138 "></span></a>        
</span><span id=__span-33-139><a id=__codelineno-33-139 name=__codelineno-33-139></a><a href=#__codelineno-33-139><span class=linenos data-linenos="139 "></span></a>        <span class=n>consumer</span><span class=o>.</span><span class=n>_send_to_dlq</span><span class=p>(</span><span class=n>failed_message</span><span class=p>)</span>
</span><span id=__span-33-140><a id=__codelineno-33-140 name=__codelineno-33-140></a><a href=#__codelineno-33-140><span class=linenos data-linenos="140 "></span></a>        
</span><span id=__span-33-141><a id=__codelineno-33-141 name=__codelineno-33-141></a><a href=#__codelineno-33-141><span class=linenos data-linenos="141 "></span></a>        <span class=n>dlq_producer</span><span class=o>.</span><span class=n>send</span><span class=o>.</span><span class=n>assert_called_once</span><span class=p>()</span>
</span><span id=__span-33-142><a id=__codelineno-33-142 name=__codelineno-33-142></a><a href=#__codelineno-33-142><span class=linenos data-linenos="142 "></span></a>        <span class=n>call_args</span> <span class=o>=</span> <span class=n>dlq_producer</span><span class=o>.</span><span class=n>send</span><span class=o>.</span><span class=n>call_args</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-33-143><a id=__codelineno-33-143 name=__codelineno-33-143></a><a href=#__codelineno-33-143><span class=linenos data-linenos="143 "></span></a>        <span class=k>assert</span> <span class=n>call_args</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;dead-letter-queue&quot;</span>
</span><span id=__span-33-144><a id=__codelineno-33-144 name=__codelineno-33-144></a><a href=#__codelineno-33-144><span class=linenos data-linenos="144 "></span></a>        <span class=k>assert</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>call_args</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>==</span> <span class=n>failed_message</span>
</span><span id=__span-33-145><a id=__codelineno-33-145 name=__codelineno-33-145></a><a href=#__codelineno-33-145><span class=linenos data-linenos="145 "></span></a>    
</span><span id=__span-33-146><a id=__codelineno-33-146 name=__codelineno-33-146></a><a href=#__codelineno-33-146><span class=linenos data-linenos="146 "></span></a>    <span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>integration</span>
</span><span id=__span-33-147><a id=__codelineno-33-147 name=__codelineno-33-147></a><a href=#__codelineno-33-147><span class=linenos data-linenos="147 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>test_end_to_end_consumer_flow</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>kafka_test_cluster</span><span class=p>):</span>
</span><span id=__span-33-148><a id=__codelineno-33-148 name=__codelineno-33-148></a><a href=#__codelineno-33-148><span class=linenos data-linenos="148 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Integration test with real Kafka cluster&quot;&quot;&quot;</span>
</span><span id=__span-33-149><a id=__codelineno-33-149 name=__codelineno-33-149></a><a href=#__codelineno-33-149><span class=linenos data-linenos="149 "></span></a>        <span class=c1># This would run against a test Kafka instance</span>
</span><span id=__span-33-150><a id=__codelineno-33-150 name=__codelineno-33-150></a><a href=#__codelineno-33-150><span class=linenos data-linenos="150 "></span></a>        <span class=n>config</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-33-151><a id=__codelineno-33-151 name=__codelineno-33-151></a><a href=#__codelineno-33-151><span class=linenos data-linenos="151 "></span></a>            <span class=s1>&#39;bootstrap_servers&#39;</span><span class=p>:</span> <span class=n>kafka_test_cluster</span><span class=o>.</span><span class=n>bootstrap_servers</span><span class=p>,</span>
</span><span id=__span-33-152><a id=__codelineno-33-152 name=__codelineno-33-152></a><a href=#__codelineno-33-152><span class=linenos data-linenos="152 "></span></a>            <span class=s1>&#39;topics&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;test-topic&#39;</span><span class=p>],</span>
</span><span id=__span-33-153><a id=__codelineno-33-153 name=__codelineno-33-153></a><a href=#__codelineno-33-153><span class=linenos data-linenos="153 "></span></a>            <span class=s1>&#39;group_id&#39;</span><span class=p>:</span> <span class=s1>&#39;integration-test-group&#39;</span>
</span><span id=__span-33-154><a id=__codelineno-33-154 name=__codelineno-33-154></a><a href=#__codelineno-33-154><span class=linenos data-linenos="154 "></span></a>        <span class=p>}</span>
</span><span id=__span-33-155><a id=__codelineno-33-155 name=__codelineno-33-155></a><a href=#__codelineno-33-155><span class=linenos data-linenos="155 "></span></a>        
</span><span id=__span-33-156><a id=__codelineno-33-156 name=__codelineno-33-156></a><a href=#__codelineno-33-156><span class=linenos data-linenos="156 "></span></a>        <span class=n>consumer</span> <span class=o>=</span> <span class=n>KafkaConsumer</span><span class=p>(</span><span class=n>config</span><span class=p>)</span>
</span><span id=__span-33-157><a id=__codelineno-33-157 name=__codelineno-33-157></a><a href=#__codelineno-33-157><span class=linenos data-linenos="157 "></span></a>        
</span><span id=__span-33-158><a id=__codelineno-33-158 name=__codelineno-33-158></a><a href=#__codelineno-33-158><span class=linenos data-linenos="158 "></span></a>        <span class=c1># Produce test message</span>
</span><span id=__span-33-159><a id=__codelineno-33-159 name=__codelineno-33-159></a><a href=#__codelineno-33-159><span class=linenos data-linenos="159 "></span></a>        <span class=n>producer</span> <span class=o>=</span> <span class=n>kafka_test_cluster</span><span class=o>.</span><span class=n>get_producer</span><span class=p>()</span>
</span><span id=__span-33-160><a id=__codelineno-33-160 name=__codelineno-33-160></a><a href=#__codelineno-33-160><span class=linenos data-linenos="160 "></span></a>        <span class=n>test_message</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;event&quot;</span><span class=p>:</span> <span class=s2>&quot;test&quot;</span><span class=p>,</span> <span class=s2>&quot;timestamp&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()}</span>
</span><span id=__span-33-161><a id=__codelineno-33-161 name=__codelineno-33-161></a><a href=#__codelineno-33-161><span class=linenos data-linenos="161 "></span></a>        <span class=n>producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;test-topic&#39;</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>test_message</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span><span id=__span-33-162><a id=__codelineno-33-162 name=__codelineno-33-162></a><a href=#__codelineno-33-162><span class=linenos data-linenos="162 "></span></a>        <span class=n>producer</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span><span id=__span-33-163><a id=__codelineno-33-163 name=__codelineno-33-163></a><a href=#__codelineno-33-163><span class=linenos data-linenos="163 "></span></a>        
</span><span id=__span-33-164><a id=__codelineno-33-164 name=__codelineno-33-164></a><a href=#__codelineno-33-164><span class=linenos data-linenos="164 "></span></a>        <span class=c1># Consume and verify</span>
</span><span id=__span-33-165><a id=__codelineno-33-165 name=__codelineno-33-165></a><a href=#__codelineno-33-165><span class=linenos data-linenos="165 "></span></a>        <span class=n>messages</span> <span class=o>=</span> <span class=k>await</span> <span class=n>consumer</span><span class=o>.</span><span class=n>consume_batch</span><span class=p>(</span><span class=n>max_messages</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span><span id=__span-33-166><a id=__codelineno-33-166 name=__codelineno-33-166></a><a href=#__codelineno-33-166><span class=linenos data-linenos="166 "></span></a>        <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>messages</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span>
</span><span id=__span-33-167><a id=__codelineno-33-167 name=__codelineno-33-167></a><a href=#__codelineno-33-167><span class=linenos data-linenos="167 "></span></a>        <span class=k>assert</span> <span class=n>messages</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;event&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;test&#39;</span>
</span></code></pre></div></p><p><strong>Implementation:</strong><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1></a><a href=#__codelineno-34-1><span class=linenos data-linenos="  1 "></span></a><span class=c1># src/ingestion/kafka_consumer.py</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2></a><a href=#__codelineno-34-2><span class=linenos data-linenos="  2 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3></a><a href=#__codelineno-34-3><span class=linenos data-linenos="  3 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>asyncio</span>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4></a><a href=#__codelineno-34-4><span class=linenos data-linenos="  4 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>logging</span>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5></a><a href=#__codelineno-34-5><span class=linenos data-linenos="  5 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Optional</span>
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6></a><a href=#__codelineno-34-6><span class=linenos data-linenos="  6 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span>
</span><span id=__span-34-7><a id=__codelineno-34-7 name=__codelineno-34-7></a><a href=#__codelineno-34-7><span class=linenos data-linenos="  7 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>backoff</span>
</span><span id=__span-34-8><a id=__codelineno-34-8 name=__codelineno-34-8></a><a href=#__codelineno-34-8><span class=linenos data-linenos="  8 "></span></a>
</span><span id=__span-34-9><a id=__codelineno-34-9 name=__codelineno-34-9></a><a href=#__codelineno-34-9><span class=linenos data-linenos="  9 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>kafka</span><span class=w> </span><span class=kn>import</span> <span class=n>KafkaConsumer</span> <span class=k>as</span> <span class=n>KafkaClient</span>
</span><span id=__span-34-10><a id=__codelineno-34-10 name=__codelineno-34-10></a><a href=#__codelineno-34-10><span class=linenos data-linenos=" 10 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>kafka</span><span class=w> </span><span class=kn>import</span> <span class=n>KafkaProducer</span>
</span><span id=__span-34-11><a id=__codelineno-34-11 name=__codelineno-34-11></a><a href=#__codelineno-34-11><span class=linenos data-linenos=" 11 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>kafka.errors</span><span class=w> </span><span class=kn>import</span> <span class=n>KafkaError</span>
</span><span id=__span-34-12><a id=__codelineno-34-12 name=__codelineno-34-12></a><a href=#__codelineno-34-12><span class=linenos data-linenos=" 12 "></span></a>
</span><span id=__span-34-13><a id=__codelineno-34-13 name=__codelineno-34-13></a><a href=#__codelineno-34-13><span class=linenos data-linenos=" 13 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>src.validation.validators</span><span class=w> </span><span class=kn>import</span> <span class=n>MessageValidator</span>
</span><span id=__span-34-14><a id=__codelineno-34-14 name=__codelineno-34-14></a><a href=#__codelineno-34-14><span class=linenos data-linenos=" 14 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>src.monitoring.metrics</span><span class=w> </span><span class=kn>import</span> <span class=n>MetricsCollector</span>
</span><span id=__span-34-15><a id=__codelineno-34-15 name=__codelineno-34-15></a><a href=#__codelineno-34-15><span class=linenos data-linenos=" 15 "></span></a>
</span><span id=__span-34-16><a id=__codelineno-34-16 name=__codelineno-34-16></a><a href=#__codelineno-34-16><span class=linenos data-linenos=" 16 "></span></a>
</span><span id=__span-34-17><a id=__codelineno-34-17 name=__codelineno-34-17></a><a href=#__codelineno-34-17><span class=linenos data-linenos=" 17 "></span></a><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span><span id=__span-34-18><a id=__codelineno-34-18 name=__codelineno-34-18></a><a href=#__codelineno-34-18><span class=linenos data-linenos=" 18 "></span></a>
</span><span id=__span-34-19><a id=__codelineno-34-19 name=__codelineno-34-19></a><a href=#__codelineno-34-19><span class=linenos data-linenos=" 19 "></span></a>
</span><span id=__span-34-20><a id=__codelineno-34-20 name=__codelineno-34-20></a><a href=#__codelineno-34-20><span class=linenos data-linenos=" 20 "></span></a><span class=k>class</span><span class=w> </span><span class=nc>KafkaConsumer</span><span class=p>:</span>
</span><span id=__span-34-21><a id=__codelineno-34-21 name=__codelineno-34-21></a><a href=#__codelineno-34-21><span class=linenos data-linenos=" 21 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Robust Kafka consumer with error handling and monitoring&quot;&quot;&quot;</span>
</span><span id=__span-34-22><a id=__codelineno-34-22 name=__codelineno-34-22></a><a href=#__codelineno-34-22><span class=linenos data-linenos=" 22 "></span></a>    
</span><span id=__span-34-23><a id=__codelineno-34-23 name=__codelineno-34-23></a><a href=#__codelineno-34-23><span class=linenos data-linenos=" 23 "></span></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span><span id=__span-34-24><a id=__codelineno-34-24 name=__codelineno-34-24></a><a href=#__codelineno-34-24><span class=linenos data-linenos=" 24 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>config</span> <span class=o>=</span> <span class=n>config</span>
</span><span id=__span-34-25><a id=__codelineno-34-25 name=__codelineno-34-25></a><a href=#__codelineno-34-25><span class=linenos data-linenos=" 25 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>topics</span> <span class=o>=</span> <span class=n>config</span><span class=p>[</span><span class=s1>&#39;topics&#39;</span><span class=p>]</span>
</span><span id=__span-34-26><a id=__codelineno-34-26 name=__codelineno-34-26></a><a href=#__codelineno-34-26><span class=linenos data-linenos=" 26 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_consumer</span><span class=p>()</span>
</span><span id=__span-34-27><a id=__codelineno-34-27 name=__codelineno-34-27></a><a href=#__codelineno-34-27><span class=linenos data-linenos=" 27 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>validator</span> <span class=o>=</span> <span class=n>MessageValidator</span><span class=p>()</span>
</span><span id=__span-34-28><a id=__codelineno-34-28 name=__codelineno-34-28></a><a href=#__codelineno-34-28><span class=linenos data-linenos=" 28 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>processor</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-34-29><a id=__codelineno-34-29 name=__codelineno-34-29></a><a href=#__codelineno-34-29><span class=linenos data-linenos=" 29 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span> <span class=o>=</span> <span class=n>MetricsCollector</span><span class=p>()</span>
</span><span id=__span-34-30><a id=__codelineno-34-30 name=__codelineno-34-30></a><a href=#__codelineno-34-30><span class=linenos data-linenos=" 30 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>dlq_producer</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_dlq_producer</span><span class=p>()</span>
</span><span id=__span-34-31><a id=__codelineno-34-31 name=__codelineno-34-31></a><a href=#__codelineno-34-31><span class=linenos data-linenos=" 31 "></span></a>        
</span><span id=__span-34-32><a id=__codelineno-34-32 name=__codelineno-34-32></a><a href=#__codelineno-34-32><span class=linenos data-linenos=" 32 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>_create_consumer</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>KafkaClient</span><span class=p>:</span>
</span><span id=__span-34-33><a id=__codelineno-34-33 name=__codelineno-34-33></a><a href=#__codelineno-34-33><span class=linenos data-linenos=" 33 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create Kafka consumer with configuration&quot;&quot;&quot;</span>
</span><span id=__span-34-34><a id=__codelineno-34-34 name=__codelineno-34-34></a><a href=#__codelineno-34-34><span class=linenos data-linenos=" 34 "></span></a>        <span class=k>return</span> <span class=n>KafkaClient</span><span class=p>(</span>
</span><span id=__span-34-35><a id=__codelineno-34-35 name=__codelineno-34-35></a><a href=#__codelineno-34-35><span class=linenos data-linenos=" 35 "></span></a>            <span class=o>*</span><span class=bp>self</span><span class=o>.</span><span class=n>topics</span><span class=p>,</span>
</span><span id=__span-34-36><a id=__codelineno-34-36 name=__codelineno-34-36></a><a href=#__codelineno-34-36><span class=linenos data-linenos=" 36 "></span></a>            <span class=n>bootstrap_servers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;bootstrap_servers&#39;</span><span class=p>],</span>
</span><span id=__span-34-37><a id=__codelineno-34-37 name=__codelineno-34-37></a><a href=#__codelineno-34-37><span class=linenos data-linenos=" 37 "></span></a>            <span class=n>group_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;group_id&#39;</span><span class=p>],</span>
</span><span id=__span-34-38><a id=__codelineno-34-38 name=__codelineno-34-38></a><a href=#__codelineno-34-38><span class=linenos data-linenos=" 38 "></span></a>            <span class=n>auto_offset_reset</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;auto_offset_reset&#39;</span><span class=p>,</span> <span class=s1>&#39;earliest&#39;</span><span class=p>),</span>
</span><span id=__span-34-39><a id=__codelineno-34-39 name=__codelineno-34-39></a><a href=#__codelineno-34-39><span class=linenos data-linenos=" 39 "></span></a>            <span class=n>enable_auto_commit</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;enable_auto_commit&#39;</span><span class=p>,</span> <span class=kc>False</span><span class=p>),</span>
</span><span id=__span-34-40><a id=__codelineno-34-40 name=__codelineno-34-40></a><a href=#__codelineno-34-40><span class=linenos data-linenos=" 40 "></span></a>            <span class=n>value_deserializer</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_deserialize_message</span><span class=p>,</span>
</span><span id=__span-34-41><a id=__codelineno-34-41 name=__codelineno-34-41></a><a href=#__codelineno-34-41><span class=linenos data-linenos=" 41 "></span></a>            <span class=n>max_poll_records</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;max_poll_records&#39;</span><span class=p>,</span> <span class=mi>500</span><span class=p>)</span>
</span><span id=__span-34-42><a id=__codelineno-34-42 name=__codelineno-34-42></a><a href=#__codelineno-34-42><span class=linenos data-linenos=" 42 "></span></a>        <span class=p>)</span>
</span><span id=__span-34-43><a id=__codelineno-34-43 name=__codelineno-34-43></a><a href=#__codelineno-34-43><span class=linenos data-linenos=" 43 "></span></a>    
</span><span id=__span-34-44><a id=__codelineno-34-44 name=__codelineno-34-44></a><a href=#__codelineno-34-44><span class=linenos data-linenos=" 44 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>_create_dlq_producer</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>KafkaProducer</span><span class=p>:</span>
</span><span id=__span-34-45><a id=__codelineno-34-45 name=__codelineno-34-45></a><a href=#__codelineno-34-45><span class=linenos data-linenos=" 45 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create producer for dead letter queue&quot;&quot;&quot;</span>
</span><span id=__span-34-46><a id=__codelineno-34-46 name=__codelineno-34-46></a><a href=#__codelineno-34-46><span class=linenos data-linenos=" 46 "></span></a>        <span class=k>return</span> <span class=n>KafkaProducer</span><span class=p>(</span>
</span><span id=__span-34-47><a id=__codelineno-34-47 name=__codelineno-34-47></a><a href=#__codelineno-34-47><span class=linenos data-linenos=" 47 "></span></a>            <span class=n>bootstrap_servers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;bootstrap_servers&#39;</span><span class=p>],</span>
</span><span id=__span-34-48><a id=__codelineno-34-48 name=__codelineno-34-48></a><a href=#__codelineno-34-48><span class=linenos data-linenos=" 48 "></span></a>            <span class=n>value_serializer</span><span class=o>=</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>v</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span><span id=__span-34-49><a id=__codelineno-34-49 name=__codelineno-34-49></a><a href=#__codelineno-34-49><span class=linenos data-linenos=" 49 "></span></a>        <span class=p>)</span>
</span><span id=__span-34-50><a id=__codelineno-34-50 name=__codelineno-34-50></a><a href=#__codelineno-34-50><span class=linenos data-linenos=" 50 "></span></a>    
</span><span id=__span-34-51><a id=__codelineno-34-51 name=__codelineno-34-51></a><a href=#__codelineno-34-51><span class=linenos data-linenos=" 51 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>_deserialize_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-34-52><a id=__codelineno-34-52 name=__codelineno-34-52></a><a href=#__codelineno-34-52><span class=linenos data-linenos=" 52 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Deserialize JSON message&quot;&quot;&quot;</span>
</span><span id=__span-34-53><a id=__codelineno-34-53 name=__codelineno-34-53></a><a href=#__codelineno-34-53><span class=linenos data-linenos=" 53 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-34-54><a id=__codelineno-34-54 name=__codelineno-34-54></a><a href=#__codelineno-34-54><span class=linenos data-linenos=" 54 "></span></a>            <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span><span id=__span-34-55><a id=__codelineno-34-55 name=__codelineno-34-55></a><a href=#__codelineno-34-55><span class=linenos data-linenos=" 55 "></span></a>        <span class=k>except</span> <span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-34-56><a id=__codelineno-34-56 name=__codelineno-34-56></a><a href=#__codelineno-34-56><span class=linenos data-linenos=" 56 "></span></a>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to deserialize message: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-34-57><a id=__codelineno-34-57 name=__codelineno-34-57></a><a href=#__codelineno-34-57><span class=linenos data-linenos=" 57 "></span></a>            <span class=k>raise</span>
</span><span id=__span-34-58><a id=__codelineno-34-58 name=__codelineno-34-58></a><a href=#__codelineno-34-58><span class=linenos data-linenos=" 58 "></span></a>    
</span><span id=__span-34-59><a id=__codelineno-34-59 name=__codelineno-34-59></a><a href=#__codelineno-34-59><span class=linenos data-linenos=" 59 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>consume</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-34-60><a id=__codelineno-34-60 name=__codelineno-34-60></a><a href=#__codelineno-34-60><span class=linenos data-linenos=" 60 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Main consumption loop&quot;&quot;&quot;</span>
</span><span id=__span-34-61><a id=__codelineno-34-61 name=__codelineno-34-61></a><a href=#__codelineno-34-61><span class=linenos data-linenos=" 61 "></span></a>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Starting consumer for topics: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>topics</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-34-62><a id=__codelineno-34-62 name=__codelineno-34-62></a><a href=#__codelineno-34-62><span class=linenos data-linenos=" 62 "></span></a>        
</span><span id=__span-34-63><a id=__codelineno-34-63 name=__codelineno-34-63></a><a href=#__codelineno-34-63><span class=linenos data-linenos=" 63 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-34-64><a id=__codelineno-34-64 name=__codelineno-34-64></a><a href=#__codelineno-34-64><span class=linenos data-linenos=" 64 "></span></a>            <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=p>:</span>
</span><span id=__span-34-65><a id=__codelineno-34-65 name=__codelineno-34-65></a><a href=#__codelineno-34-65><span class=linenos data-linenos=" 65 "></span></a>                <span class=k>try</span><span class=p>:</span>
</span><span id=__span-34-66><a id=__codelineno-34-66 name=__codelineno-34-66></a><a href=#__codelineno-34-66><span class=linenos data-linenos=" 66 "></span></a>                    <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_message</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span><span id=__span-34-67><a id=__codelineno-34-67 name=__codelineno-34-67></a><a href=#__codelineno-34-67><span class=linenos data-linenos=" 67 "></span></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span><span id=__span-34-68><a id=__codelineno-34-68 name=__codelineno-34-68></a><a href=#__codelineno-34-68><span class=linenos data-linenos=" 68 "></span></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>increment</span><span class=p>(</span><span class=s1>&#39;messages_processed&#39;</span><span class=p>)</span>
</span><span id=__span-34-69><a id=__codelineno-34-69 name=__codelineno-34-69></a><a href=#__codelineno-34-69><span class=linenos data-linenos=" 69 "></span></a>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-34-70><a id=__codelineno-34-70 name=__codelineno-34-70></a><a href=#__codelineno-34-70><span class=linenos data-linenos=" 70 "></span></a>                    <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error processing message: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-34-71><a id=__codelineno-34-71 name=__codelineno-34-71></a><a href=#__codelineno-34-71><span class=linenos data-linenos=" 71 "></span></a>                    <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_handle_failed_message</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span><span id=__span-34-72><a id=__codelineno-34-72 name=__codelineno-34-72></a><a href=#__codelineno-34-72><span class=linenos data-linenos=" 72 "></span></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>increment</span><span class=p>(</span><span class=s1>&#39;messages_failed&#39;</span><span class=p>)</span>
</span><span id=__span-34-73><a id=__codelineno-34-73 name=__codelineno-34-73></a><a href=#__codelineno-34-73><span class=linenos data-linenos=" 73 "></span></a>        <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span><span id=__span-34-74><a id=__codelineno-34-74 name=__codelineno-34-74></a><a href=#__codelineno-34-74><span class=linenos data-linenos=" 74 "></span></a>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Consumer stopped by user&quot;</span><span class=p>)</span>
</span><span id=__span-34-75><a id=__codelineno-34-75 name=__codelineno-34-75></a><a href=#__codelineno-34-75><span class=linenos data-linenos=" 75 "></span></a>        <span class=k>finally</span><span class=p>:</span>
</span><span id=__span-34-76><a id=__codelineno-34-76 name=__codelineno-34-76></a><a href=#__codelineno-34-76><span class=linenos data-linenos=" 76 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span><span id=__span-34-77><a id=__codelineno-34-77 name=__codelineno-34-77></a><a href=#__codelineno-34-77><span class=linenos data-linenos=" 77 "></span></a>    
</span><span id=__span-34-78><a id=__codelineno-34-78 name=__codelineno-34-78></a><a href=#__codelineno-34-78><span class=linenos data-linenos=" 78 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>_process_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-34-79><a id=__codelineno-34-79 name=__codelineno-34-79></a><a href=#__codelineno-34-79><span class=linenos data-linenos=" 79 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Process a single message&quot;&quot;&quot;</span>
</span><span id=__span-34-80><a id=__codelineno-34-80 name=__codelineno-34-80></a><a href=#__codelineno-34-80><span class=linenos data-linenos=" 80 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>increment</span><span class=p>(</span><span class=s1>&#39;messages_received&#39;</span><span class=p>)</span>
</span><span id=__span-34-81><a id=__codelineno-34-81 name=__codelineno-34-81></a><a href=#__codelineno-34-81><span class=linenos data-linenos=" 81 "></span></a>        
</span><span id=__span-34-82><a id=__codelineno-34-82 name=__codelineno-34-82></a><a href=#__codelineno-34-82><span class=linenos data-linenos=" 82 "></span></a>        <span class=c1># Validate message</span>
</span><span id=__span-34-83><a id=__codelineno-34-83 name=__codelineno-34-83></a><a href=#__codelineno-34-83><span class=linenos data-linenos=" 83 "></span></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>validator</span><span class=o>.</span><span class=n>validate</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>value</span><span class=p>):</span>
</span><span id=__span-34-84><a id=__codelineno-34-84 name=__codelineno-34-84></a><a href=#__codelineno-34-84><span class=linenos data-linenos=" 84 "></span></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Message validation failed&quot;</span><span class=p>)</span>
</span><span id=__span-34-85><a id=__codelineno-34-85 name=__codelineno-34-85></a><a href=#__codelineno-34-85><span class=linenos data-linenos=" 85 "></span></a>        
</span><span id=__span-34-86><a id=__codelineno-34-86 name=__codelineno-34-86></a><a href=#__codelineno-34-86><span class=linenos data-linenos=" 86 "></span></a>        <span class=c1># Process with retry</span>
</span><span id=__span-34-87><a id=__codelineno-34-87 name=__codelineno-34-87></a><a href=#__codelineno-34-87><span class=linenos data-linenos=" 87 "></span></a>        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_message_with_retry</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span><span id=__span-34-88><a id=__codelineno-34-88 name=__codelineno-34-88></a><a href=#__codelineno-34-88><span class=linenos data-linenos=" 88 "></span></a>        
</span><span id=__span-34-89><a id=__codelineno-34-89 name=__codelineno-34-89></a><a href=#__codelineno-34-89><span class=linenos data-linenos=" 89 "></span></a>        <span class=c1># Log success</span>
</span><span id=__span-34-90><a id=__codelineno-34-90 name=__codelineno-34-90></a><a href=#__codelineno-34-90><span class=linenos data-linenos=" 90 "></span></a>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Processed message from </span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>topic</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>partition</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>offset</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-34-91><a id=__codelineno-34-91 name=__codelineno-34-91></a><a href=#__codelineno-34-91><span class=linenos data-linenos=" 91 "></span></a>        
</span><span id=__span-34-92><a id=__codelineno-34-92 name=__codelineno-34-92></a><a href=#__codelineno-34-92><span class=linenos data-linenos=" 92 "></span></a>        <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-34-93><a id=__codelineno-34-93 name=__codelineno-34-93></a><a href=#__codelineno-34-93><span class=linenos data-linenos=" 93 "></span></a>    
</span><span id=__span-34-94><a id=__codelineno-34-94 name=__codelineno-34-94></a><a href=#__codelineno-34-94><span class=linenos data-linenos=" 94 "></span></a>    <span class=nd>@backoff</span><span class=o>.</span><span class=n>on_exception</span><span class=p>(</span>
</span><span id=__span-34-95><a id=__codelineno-34-95 name=__codelineno-34-95></a><a href=#__codelineno-34-95><span class=linenos data-linenos=" 95 "></span></a>        <span class=n>backoff</span><span class=o>.</span><span class=n>expo</span><span class=p>,</span>
</span><span id=__span-34-96><a id=__codelineno-34-96 name=__codelineno-34-96></a><a href=#__codelineno-34-96><span class=linenos data-linenos=" 96 "></span></a>        <span class=ne>Exception</span><span class=p>,</span>
</span><span id=__span-34-97><a id=__codelineno-34-97 name=__codelineno-34-97></a><a href=#__codelineno-34-97><span class=linenos data-linenos=" 97 "></span></a>        <span class=n>max_tries</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span><span id=__span-34-98><a id=__codelineno-34-98 name=__codelineno-34-98></a><a href=#__codelineno-34-98><span class=linenos data-linenos=" 98 "></span></a>        <span class=n>max_time</span><span class=o>=</span><span class=mi>60</span>
</span><span id=__span-34-99><a id=__codelineno-34-99 name=__codelineno-34-99></a><a href=#__codelineno-34-99><span class=linenos data-linenos=" 99 "></span></a>    <span class=p>)</span>
</span><span id=__span-34-100><a id=__codelineno-34-100 name=__codelineno-34-100></a><a href=#__codelineno-34-100><span class=linenos data-linenos="100 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>_process_message_with_retry</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>max_retries</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-34-101><a id=__codelineno-34-101 name=__codelineno-34-101></a><a href=#__codelineno-34-101><span class=linenos data-linenos="101 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Process message with exponential backoff retry&quot;&quot;&quot;</span>
</span><span id=__span-34-102><a id=__codelineno-34-102 name=__codelineno-34-102></a><a href=#__codelineno-34-102><span class=linenos data-linenos="102 "></span></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>processor</span><span class=p>:</span>
</span><span id=__span-34-103><a id=__codelineno-34-103 name=__codelineno-34-103></a><a href=#__codelineno-34-103><span class=linenos data-linenos="103 "></span></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;No processor configured&quot;</span><span class=p>)</span>
</span><span id=__span-34-104><a id=__codelineno-34-104 name=__codelineno-34-104></a><a href=#__codelineno-34-104><span class=linenos data-linenos="104 "></span></a>        
</span><span id=__span-34-105><a id=__codelineno-34-105 name=__codelineno-34-105></a><a href=#__codelineno-34-105><span class=linenos data-linenos="105 "></span></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>processor</span><span class=o>.</span><span class=n>process</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span><span id=__span-34-106><a id=__codelineno-34-106 name=__codelineno-34-106></a><a href=#__codelineno-34-106><span class=linenos data-linenos="106 "></span></a>    
</span><span id=__span-34-107><a id=__codelineno-34-107 name=__codelineno-34-107></a><a href=#__codelineno-34-107><span class=linenos data-linenos="107 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>_handle_failed_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>error</span><span class=p>:</span> <span class=ne>Exception</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-34-108><a id=__codelineno-34-108 name=__codelineno-34-108></a><a href=#__codelineno-34-108><span class=linenos data-linenos="108 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Handle messages that failed processing&quot;&quot;&quot;</span>
</span><span id=__span-34-109><a id=__codelineno-34-109 name=__codelineno-34-109></a><a href=#__codelineno-34-109><span class=linenos data-linenos="109 "></span></a>        <span class=n>failed_message</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-34-110><a id=__codelineno-34-110 name=__codelineno-34-110></a><a href=#__codelineno-34-110><span class=linenos data-linenos="110 "></span></a>            <span class=s2>&quot;original_message&quot;</span><span class=p>:</span> <span class=n>message</span><span class=o>.</span><span class=n>value</span><span class=p>,</span>
</span><span id=__span-34-111><a id=__codelineno-34-111 name=__codelineno-34-111></a><a href=#__codelineno-34-111><span class=linenos data-linenos="111 "></span></a>            <span class=s2>&quot;error&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>error</span><span class=p>),</span>
</span><span id=__span-34-112><a id=__codelineno-34-112 name=__codelineno-34-112></a><a href=#__codelineno-34-112><span class=linenos data-linenos="112 "></span></a>            <span class=s2>&quot;timestamp&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span><span id=__span-34-113><a id=__codelineno-34-113 name=__codelineno-34-113></a><a href=#__codelineno-34-113><span class=linenos data-linenos="113 "></span></a>            <span class=s2>&quot;topic&quot;</span><span class=p>:</span> <span class=n>message</span><span class=o>.</span><span class=n>topic</span><span class=p>,</span>
</span><span id=__span-34-114><a id=__codelineno-34-114 name=__codelineno-34-114></a><a href=#__codelineno-34-114><span class=linenos data-linenos="114 "></span></a>            <span class=s2>&quot;partition&quot;</span><span class=p>:</span> <span class=n>message</span><span class=o>.</span><span class=n>partition</span><span class=p>,</span>
</span><span id=__span-34-115><a id=__codelineno-34-115 name=__codelineno-34-115></a><a href=#__codelineno-34-115><span class=linenos data-linenos="115 "></span></a>            <span class=s2>&quot;offset&quot;</span><span class=p>:</span> <span class=n>message</span><span class=o>.</span><span class=n>offset</span><span class=p>,</span>
</span><span id=__span-34-116><a id=__codelineno-34-116 name=__codelineno-34-116></a><a href=#__codelineno-34-116><span class=linenos data-linenos="116 "></span></a>            <span class=s2>&quot;consumer_group&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;group_id&#39;</span><span class=p>]</span>
</span><span id=__span-34-117><a id=__codelineno-34-117 name=__codelineno-34-117></a><a href=#__codelineno-34-117><span class=linenos data-linenos="117 "></span></a>        <span class=p>}</span>
</span><span id=__span-34-118><a id=__codelineno-34-118 name=__codelineno-34-118></a><a href=#__codelineno-34-118><span class=linenos data-linenos="118 "></span></a>        
</span><span id=__span-34-119><a id=__codelineno-34-119 name=__codelineno-34-119></a><a href=#__codelineno-34-119><span class=linenos data-linenos="119 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_send_to_dlq</span><span class=p>(</span><span class=n>failed_message</span><span class=p>)</span>
</span><span id=__span-34-120><a id=__codelineno-34-120 name=__codelineno-34-120></a><a href=#__codelineno-34-120><span class=linenos data-linenos="120 "></span></a>    
</span><span id=__span-34-121><a id=__codelineno-34-121 name=__codelineno-34-121></a><a href=#__codelineno-34-121><span class=linenos data-linenos="121 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>_send_to_dlq</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>failed_message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-34-122><a id=__codelineno-34-122 name=__codelineno-34-122></a><a href=#__codelineno-34-122><span class=linenos data-linenos="122 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Send failed message to dead letter queue&quot;&quot;&quot;</span>
</span><span id=__span-34-123><a id=__codelineno-34-123 name=__codelineno-34-123></a><a href=#__codelineno-34-123><span class=linenos data-linenos="123 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-34-124><a id=__codelineno-34-124 name=__codelineno-34-124></a><a href=#__codelineno-34-124><span class=linenos data-linenos="124 "></span></a>            <span class=n>future</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dlq_producer</span><span class=o>.</span><span class=n>send</span><span class=p>(</span>
</span><span id=__span-34-125><a id=__codelineno-34-125 name=__codelineno-34-125></a><a href=#__codelineno-34-125><span class=linenos data-linenos="125 "></span></a>                <span class=s1>&#39;dead-letter-queue&#39;</span><span class=p>,</span>
</span><span id=__span-34-126><a id=__codelineno-34-126 name=__codelineno-34-126></a><a href=#__codelineno-34-126><span class=linenos data-linenos="126 "></span></a>                <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>failed_message</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span><span id=__span-34-127><a id=__codelineno-34-127 name=__codelineno-34-127></a><a href=#__codelineno-34-127><span class=linenos data-linenos="127 "></span></a>            <span class=p>)</span>
</span><span id=__span-34-128><a id=__codelineno-34-128 name=__codelineno-34-128></a><a href=#__codelineno-34-128><span class=linenos data-linenos="128 "></span></a>            <span class=n>future</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span><span id=__span-34-129><a id=__codelineno-34-129 name=__codelineno-34-129></a><a href=#__codelineno-34-129><span class=linenos data-linenos="129 "></span></a>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Sent message to DLQ: </span><span class=si>{</span><span class=n>failed_message</span><span class=p>[</span><span class=s1>&#39;offset&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-34-130><a id=__codelineno-34-130 name=__codelineno-34-130></a><a href=#__codelineno-34-130><span class=linenos data-linenos="130 "></span></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-34-131><a id=__codelineno-34-131 name=__codelineno-34-131></a><a href=#__codelineno-34-131><span class=linenos data-linenos="131 "></span></a>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to send to DLQ: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-34-132><a id=__codelineno-34-132 name=__codelineno-34-132></a><a href=#__codelineno-34-132><span class=linenos data-linenos="132 "></span></a>    
</span><span id=__span-34-133><a id=__codelineno-34-133 name=__codelineno-34-133></a><a href=#__codelineno-34-133><span class=linenos data-linenos="133 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>consume_batch</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>max_messages</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>100</span><span class=p>,</span> <span class=n>timeout</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
</span><span id=__span-34-134><a id=__codelineno-34-134 name=__codelineno-34-134></a><a href=#__codelineno-34-134><span class=linenos data-linenos="134 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Consume messages in batch mode&quot;&quot;&quot;</span>
</span><span id=__span-34-135><a id=__codelineno-34-135 name=__codelineno-34-135></a><a href=#__codelineno-34-135><span class=linenos data-linenos="135 "></span></a>        <span class=n>messages</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-34-136><a id=__codelineno-34-136 name=__codelineno-34-136></a><a href=#__codelineno-34-136><span class=linenos data-linenos="136 "></span></a>        <span class=n>end_time</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>+</span> <span class=n>timeout</span>
</span><span id=__span-34-137><a id=__codelineno-34-137 name=__codelineno-34-137></a><a href=#__codelineno-34-137><span class=linenos data-linenos="137 "></span></a>        
</span><span id=__span-34-138><a id=__codelineno-34-138 name=__codelineno-34-138></a><a href=#__codelineno-34-138><span class=linenos data-linenos="138 "></span></a>        <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=n>messages</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>max_messages</span> <span class=ow>and</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>&lt;</span> <span class=n>end_time</span><span class=p>:</span>
</span><span id=__span-34-139><a id=__codelineno-34-139 name=__codelineno-34-139></a><a href=#__codelineno-34-139><span class=linenos data-linenos="139 "></span></a>            <span class=n>records</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>consumer</span><span class=o>.</span><span class=n>poll</span><span class=p>(</span><span class=n>timeout_ms</span><span class=o>=</span><span class=mi>1000</span><span class=p>)</span>
</span><span id=__span-34-140><a id=__codelineno-34-140 name=__codelineno-34-140></a><a href=#__codelineno-34-140><span class=linenos data-linenos="140 "></span></a>            
</span><span id=__span-34-141><a id=__codelineno-34-141 name=__codelineno-34-141></a><a href=#__codelineno-34-141><span class=linenos data-linenos="141 "></span></a>            <span class=k>for</span> <span class=n>topic_partition</span><span class=p>,</span> <span class=n>msgs</span> <span class=ow>in</span> <span class=n>records</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-34-142><a id=__codelineno-34-142 name=__codelineno-34-142></a><a href=#__codelineno-34-142><span class=linenos data-linenos="142 "></span></a>                <span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=n>msgs</span><span class=p>:</span>
</span><span id=__span-34-143><a id=__codelineno-34-143 name=__codelineno-34-143></a><a href=#__codelineno-34-143><span class=linenos data-linenos="143 "></span></a>                    <span class=n>messages</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span><span id=__span-34-144><a id=__codelineno-34-144 name=__codelineno-34-144></a><a href=#__codelineno-34-144><span class=linenos data-linenos="144 "></span></a>                    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>messages</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=n>max_messages</span><span class=p>:</span>
</span><span id=__span-34-145><a id=__codelineno-34-145 name=__codelineno-34-145></a><a href=#__codelineno-34-145><span class=linenos data-linenos="145 "></span></a>                        <span class=k>break</span>
</span><span id=__span-34-146><a id=__codelineno-34-146 name=__codelineno-34-146></a><a href=#__codelineno-34-146><span class=linenos data-linenos="146 "></span></a>        
</span><span id=__span-34-147><a id=__codelineno-34-147 name=__codelineno-34-147></a><a href=#__codelineno-34-147><span class=linenos data-linenos="147 "></span></a>        <span class=k>return</span> <span class=n>messages</span>
</span><span id=__span-34-148><a id=__codelineno-34-148 name=__codelineno-34-148></a><a href=#__codelineno-34-148><span class=linenos data-linenos="148 "></span></a>
</span><span id=__span-34-149><a id=__codelineno-34-149 name=__codelineno-34-149></a><a href=#__codelineno-34-149><span class=linenos data-linenos="149 "></span></a>
</span><span id=__span-34-150><a id=__codelineno-34-150 name=__codelineno-34-150></a><a href=#__codelineno-34-150><span class=linenos data-linenos="150 "></span></a><span class=k>class</span><span class=w> </span><span class=nc>MessageProcessor</span><span class=p>:</span>
</span><span id=__span-34-151><a id=__codelineno-34-151 name=__codelineno-34-151></a><a href=#__codelineno-34-151><span class=linenos data-linenos="151 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Process validated messages&quot;&quot;&quot;</span>
</span><span id=__span-34-152><a id=__codelineno-34-152 name=__codelineno-34-152></a><a href=#__codelineno-34-152><span class=linenos data-linenos="152 "></span></a>    
</span><span id=__span-34-153><a id=__codelineno-34-153 name=__codelineno-34-153></a><a href=#__codelineno-34-153><span class=linenos data-linenos="153 "></span></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>storage_backend</span><span class=p>):</span>
</span><span id=__span-34-154><a id=__codelineno-34-154 name=__codelineno-34-154></a><a href=#__codelineno-34-154><span class=linenos data-linenos="154 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>storage</span> <span class=o>=</span> <span class=n>storage_backend</span>
</span><span id=__span-34-155><a id=__codelineno-34-155 name=__codelineno-34-155></a><a href=#__codelineno-34-155><span class=linenos data-linenos="155 "></span></a>    
</span><span id=__span-34-156><a id=__codelineno-34-156 name=__codelineno-34-156></a><a href=#__codelineno-34-156><span class=linenos data-linenos="156 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>process</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-34-157><a id=__codelineno-34-157 name=__codelineno-34-157></a><a href=#__codelineno-34-157><span class=linenos data-linenos="157 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Process message and store results&quot;&quot;&quot;</span>
</span><span id=__span-34-158><a id=__codelineno-34-158 name=__codelineno-34-158></a><a href=#__codelineno-34-158><span class=linenos data-linenos="158 "></span></a>        <span class=c1># Transform message</span>
</span><span id=__span-34-159><a id=__codelineno-34-159 name=__codelineno-34-159></a><a href=#__codelineno-34-159><span class=linenos data-linenos="159 "></span></a>        <span class=n>transformed</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span><span id=__span-34-160><a id=__codelineno-34-160 name=__codelineno-34-160></a><a href=#__codelineno-34-160><span class=linenos data-linenos="160 "></span></a>        
</span><span id=__span-34-161><a id=__codelineno-34-161 name=__codelineno-34-161></a><a href=#__codelineno-34-161><span class=linenos data-linenos="161 "></span></a>        <span class=c1># Enrich with additional data</span>
</span><span id=__span-34-162><a id=__codelineno-34-162 name=__codelineno-34-162></a><a href=#__codelineno-34-162><span class=linenos data-linenos="162 "></span></a>        <span class=n>enriched</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>enrich</span><span class=p>(</span><span class=n>transformed</span><span class=p>)</span>
</span><span id=__span-34-163><a id=__codelineno-34-163 name=__codelineno-34-163></a><a href=#__codelineno-34-163><span class=linenos data-linenos="163 "></span></a>        
</span><span id=__span-34-164><a id=__codelineno-34-164 name=__codelineno-34-164></a><a href=#__codelineno-34-164><span class=linenos data-linenos="164 "></span></a>        <span class=c1># Store in backend</span>
</span><span id=__span-34-165><a id=__codelineno-34-165 name=__codelineno-34-165></a><a href=#__codelineno-34-165><span class=linenos data-linenos="165 "></span></a>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>store</span><span class=p>(</span><span class=n>enriched</span><span class=p>)</span>
</span><span id=__span-34-166><a id=__codelineno-34-166 name=__codelineno-34-166></a><a href=#__codelineno-34-166><span class=linenos data-linenos="166 "></span></a>        
</span><span id=__span-34-167><a id=__codelineno-34-167 name=__codelineno-34-167></a><a href=#__codelineno-34-167><span class=linenos data-linenos="167 "></span></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-34-168><a id=__codelineno-34-168 name=__codelineno-34-168></a><a href=#__codelineno-34-168><span class=linenos data-linenos="168 "></span></a>            <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;success&quot;</span><span class=p>,</span>
</span><span id=__span-34-169><a id=__codelineno-34-169 name=__codelineno-34-169></a><a href=#__codelineno-34-169><span class=linenos data-linenos="169 "></span></a>            <span class=s2>&quot;message_id&quot;</span><span class=p>:</span> <span class=n>message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>),</span>
</span><span id=__span-34-170><a id=__codelineno-34-170 name=__codelineno-34-170></a><a href=#__codelineno-34-170><span class=linenos data-linenos="170 "></span></a>            <span class=s2>&quot;stored_at&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span><span id=__span-34-171><a id=__codelineno-34-171 name=__codelineno-34-171></a><a href=#__codelineno-34-171><span class=linenos data-linenos="171 "></span></a>        <span class=p>}</span>
</span><span id=__span-34-172><a id=__codelineno-34-172 name=__codelineno-34-172></a><a href=#__codelineno-34-172><span class=linenos data-linenos="172 "></span></a>    
</span><span id=__span-34-173><a id=__codelineno-34-173 name=__codelineno-34-173></a><a href=#__codelineno-34-173><span class=linenos data-linenos="173 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>transform</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-34-174><a id=__codelineno-34-174 name=__codelineno-34-174></a><a href=#__codelineno-34-174><span class=linenos data-linenos="174 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Apply transformations to message&quot;&quot;&quot;</span>
</span><span id=__span-34-175><a id=__codelineno-34-175 name=__codelineno-34-175></a><a href=#__codelineno-34-175><span class=linenos data-linenos="175 "></span></a>        <span class=c1># Implementation here</span>
</span><span id=__span-34-176><a id=__codelineno-34-176 name=__codelineno-34-176></a><a href=#__codelineno-34-176><span class=linenos data-linenos="176 "></span></a>        <span class=k>return</span> <span class=n>message</span>
</span><span id=__span-34-177><a id=__codelineno-34-177 name=__codelineno-34-177></a><a href=#__codelineno-34-177><span class=linenos data-linenos="177 "></span></a>    
</span><span id=__span-34-178><a id=__codelineno-34-178 name=__codelineno-34-178></a><a href=#__codelineno-34-178><span class=linenos data-linenos="178 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>enrich</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-34-179><a id=__codelineno-34-179 name=__codelineno-34-179></a><a href=#__codelineno-34-179><span class=linenos data-linenos="179 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Enrich message with additional data&quot;&quot;&quot;</span>
</span><span id=__span-34-180><a id=__codelineno-34-180 name=__codelineno-34-180></a><a href=#__codelineno-34-180><span class=linenos data-linenos="180 "></span></a>        <span class=c1># Implementation here</span>
</span><span id=__span-34-181><a id=__codelineno-34-181 name=__codelineno-34-181></a><a href=#__codelineno-34-181><span class=linenos data-linenos="181 "></span></a>        <span class=k>return</span> <span class=n>message</span>
</span></code></pre></div></p><h3 id=microservice-architecture-project>Microservice Architecture Project<a class=headerlink href=#microservice-architecture-project title="Permanent link">&para;</a></h3><h4 id=building-microservices-with-tdd>Building Microservices with TDD<a class=headerlink href=#building-microservices-with-tdd title="Permanent link">&para;</a></h4><p>A comprehensive example of developing a microservice architecture using the AI Agent TDD-Scrum workflow. This project demonstrates service decomposition, API gateway patterns, and distributed system testing.</p><p><strong>Project Repository:</strong> <a href=https://github.com/agent-workflow-examples/microservices-platform>github.com/agent-workflow-examples/microservices-platform</a></p><h5 id=project-overview_2>Project Overview<a class=headerlink href=#project-overview_2 title="Permanent link">&para;</a></h5><p>E-Commerce Microservices Platform featuring: - User Service: Authentication and user management - Product Service: Product catalog and inventory - Order Service: Order processing and fulfillment - Payment Service: Payment processing - Notification Service: Email and SMS notifications - API Gateway: Request routing and authentication</p><h5 id=project-structure_3>Project Structure<a class=headerlink href=#project-structure_3 title="Permanent link">&para;</a></h5><div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1></a><a href=#__codelineno-35-1><span class=linenos data-linenos=" 1 "></span></a>microservices-platform/
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2></a><a href=#__codelineno-35-2><span class=linenos data-linenos=" 2 "></span></a>├── .github/
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3></a><a href=#__codelineno-35-3><span class=linenos data-linenos=" 3 "></span></a>│   └── workflows/
</span><span id=__span-35-4><a id=__codelineno-35-4 name=__codelineno-35-4></a><a href=#__codelineno-35-4><span class=linenos data-linenos=" 4 "></span></a>│       ├── service-tests.yml        # Per-service testing
</span><span id=__span-35-5><a id=__codelineno-35-5 name=__codelineno-35-5></a><a href=#__codelineno-35-5><span class=linenos data-linenos=" 5 "></span></a>│       └── integration-tests.yml    # Cross-service tests
</span><span id=__span-35-6><a id=__codelineno-35-6 name=__codelineno-35-6></a><a href=#__codelineno-35-6><span class=linenos data-linenos=" 6 "></span></a>├── .orch-state/                     # Agent workflow state
</span><span id=__span-35-7><a id=__codelineno-35-7 name=__codelineno-35-7></a><a href=#__codelineno-35-7><span class=linenos data-linenos=" 7 "></span></a>├── services/
</span><span id=__span-35-8><a id=__codelineno-35-8 name=__codelineno-35-8></a><a href=#__codelineno-35-8><span class=linenos data-linenos=" 8 "></span></a>│   ├── api-gateway/
</span><span id=__span-35-9><a id=__codelineno-35-9 name=__codelineno-35-9></a><a href=#__codelineno-35-9><span class=linenos data-linenos=" 9 "></span></a>│   │   ├── src/
</span><span id=__span-35-10><a id=__codelineno-35-10 name=__codelineno-35-10></a><a href=#__codelineno-35-10><span class=linenos data-linenos="10 "></span></a>│   │   ├── tests/
</span><span id=__span-35-11><a id=__codelineno-35-11 name=__codelineno-35-11></a><a href=#__codelineno-35-11><span class=linenos data-linenos="11 "></span></a>│   │   └── Dockerfile
</span><span id=__span-35-12><a id=__codelineno-35-12 name=__codelineno-35-12></a><a href=#__codelineno-35-12><span class=linenos data-linenos="12 "></span></a>│   ├── user-service/
</span><span id=__span-35-13><a id=__codelineno-35-13 name=__codelineno-35-13></a><a href=#__codelineno-35-13><span class=linenos data-linenos="13 "></span></a>│   │   ├── src/
</span><span id=__span-35-14><a id=__codelineno-35-14 name=__codelineno-35-14></a><a href=#__codelineno-35-14><span class=linenos data-linenos="14 "></span></a>│   │   ├── tests/
</span><span id=__span-35-15><a id=__codelineno-35-15 name=__codelineno-35-15></a><a href=#__codelineno-35-15><span class=linenos data-linenos="15 "></span></a>│   │   └── Dockerfile
</span><span id=__span-35-16><a id=__codelineno-35-16 name=__codelineno-35-16></a><a href=#__codelineno-35-16><span class=linenos data-linenos="16 "></span></a>│   ├── product-service/
</span><span id=__span-35-17><a id=__codelineno-35-17 name=__codelineno-35-17></a><a href=#__codelineno-35-17><span class=linenos data-linenos="17 "></span></a>│   │   ├── src/
</span><span id=__span-35-18><a id=__codelineno-35-18 name=__codelineno-35-18></a><a href=#__codelineno-35-18><span class=linenos data-linenos="18 "></span></a>│   │   ├── tests/
</span><span id=__span-35-19><a id=__codelineno-35-19 name=__codelineno-35-19></a><a href=#__codelineno-35-19><span class=linenos data-linenos="19 "></span></a>│   │   └── Dockerfile
</span><span id=__span-35-20><a id=__codelineno-35-20 name=__codelineno-35-20></a><a href=#__codelineno-35-20><span class=linenos data-linenos="20 "></span></a>│   ├── order-service/
</span><span id=__span-35-21><a id=__codelineno-35-21 name=__codelineno-35-21></a><a href=#__codelineno-35-21><span class=linenos data-linenos="21 "></span></a>│   │   ├── src/
</span><span id=__span-35-22><a id=__codelineno-35-22 name=__codelineno-35-22></a><a href=#__codelineno-35-22><span class=linenos data-linenos="22 "></span></a>│   │   ├── tests/
</span><span id=__span-35-23><a id=__codelineno-35-23 name=__codelineno-35-23></a><a href=#__codelineno-35-23><span class=linenos data-linenos="23 "></span></a>│   │   └── Dockerfile
</span><span id=__span-35-24><a id=__codelineno-35-24 name=__codelineno-35-24></a><a href=#__codelineno-35-24><span class=linenos data-linenos="24 "></span></a>│   └── notification-service/
</span><span id=__span-35-25><a id=__codelineno-35-25 name=__codelineno-35-25></a><a href=#__codelineno-35-25><span class=linenos data-linenos="25 "></span></a>│       ├── src/
</span><span id=__span-35-26><a id=__codelineno-35-26 name=__codelineno-35-26></a><a href=#__codelineno-35-26><span class=linenos data-linenos="26 "></span></a>│       ├── tests/
</span><span id=__span-35-27><a id=__codelineno-35-27 name=__codelineno-35-27></a><a href=#__codelineno-35-27><span class=linenos data-linenos="27 "></span></a>│       └── Dockerfile
</span><span id=__span-35-28><a id=__codelineno-35-28 name=__codelineno-35-28></a><a href=#__codelineno-35-28><span class=linenos data-linenos="28 "></span></a>├── shared/
</span><span id=__span-35-29><a id=__codelineno-35-29 name=__codelineno-35-29></a><a href=#__codelineno-35-29><span class=linenos data-linenos="29 "></span></a>│   ├── proto/                       # Protocol buffers
</span><span id=__span-35-30><a id=__codelineno-35-30 name=__codelineno-35-30></a><a href=#__codelineno-35-30><span class=linenos data-linenos="30 "></span></a>│   ├── schemas/                     # Shared schemas
</span><span id=__span-35-31><a id=__codelineno-35-31 name=__codelineno-35-31></a><a href=#__codelineno-35-31><span class=linenos data-linenos="31 "></span></a>│   └── libraries/                   # Shared libraries
</span><span id=__span-35-32><a id=__codelineno-35-32 name=__codelineno-35-32></a><a href=#__codelineno-35-32><span class=linenos data-linenos="32 "></span></a>├── infrastructure/
</span><span id=__span-35-33><a id=__codelineno-35-33 name=__codelineno-35-33></a><a href=#__codelineno-35-33><span class=linenos data-linenos="33 "></span></a>│   ├── kubernetes/                  # K8s manifests
</span><span id=__span-35-34><a id=__codelineno-35-34 name=__codelineno-35-34></a><a href=#__codelineno-35-34><span class=linenos data-linenos="34 "></span></a>│   ├── terraform/                   # Infrastructure as code
</span><span id=__span-35-35><a id=__codelineno-35-35 name=__codelineno-35-35></a><a href=#__codelineno-35-35><span class=linenos data-linenos="35 "></span></a>│   └── monitoring/                  # Monitoring config
</span><span id=__span-35-36><a id=__codelineno-35-36 name=__codelineno-35-36></a><a href=#__codelineno-35-36><span class=linenos data-linenos="36 "></span></a>├── tests/
</span><span id=__span-35-37><a id=__codelineno-35-37 name=__codelineno-35-37></a><a href=#__codelineno-35-37><span class=linenos data-linenos="37 "></span></a>│   ├── integration/                 # Cross-service tests
</span><span id=__span-35-38><a id=__codelineno-35-38 name=__codelineno-35-38></a><a href=#__codelineno-35-38><span class=linenos data-linenos="38 "></span></a>│   ├── e2e/                        # End-to-end tests
</span><span id=__span-35-39><a id=__codelineno-35-39 name=__codelineno-35-39></a><a href=#__codelineno-35-39><span class=linenos data-linenos="39 "></span></a>│   └── tdd/
</span><span id=__span-35-40><a id=__codelineno-35-40 name=__codelineno-35-40></a><a href=#__codelineno-35-40><span class=linenos data-linenos="40 "></span></a>│       ├── MICRO-001/              # API Gateway
</span><span id=__span-35-41><a id=__codelineno-35-41 name=__codelineno-35-41></a><a href=#__codelineno-35-41><span class=linenos data-linenos="41 "></span></a>│       ├── MICRO-002/              # Service communication
</span><span id=__span-35-42><a id=__codelineno-35-42 name=__codelineno-35-42></a><a href=#__codelineno-35-42><span class=linenos data-linenos="42 "></span></a>│       └── MICRO-003/              # Distributed transactions
</span><span id=__span-35-43><a id=__codelineno-35-43 name=__codelineno-35-43></a><a href=#__codelineno-35-43><span class=linenos data-linenos="43 "></span></a>└── docker-compose.yml              # Local development
</span></code></pre></div><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1></a><a href=#__codelineno-36-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># config/postgresql.yml</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2></a><a href=#__codelineno-36-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>storage</span><span class=p>:</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3></a><a href=#__codelineno-36-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s>&quot;postgresql&quot;</span>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4></a><a href=#__codelineno-36-4><span class=linenos data-linenos=" 4 "></span></a><span class=w>  </span><span class=nt>connection</span><span class=p>:</span>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5></a><a href=#__codelineno-36-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>    </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=s>&quot;localhost&quot;</span>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6></a><a href=#__codelineno-36-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7></a><a href=#__codelineno-36-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>    </span><span class=nt>database</span><span class=p>:</span><span class=w> </span><span class=s>&quot;agent_workflow&quot;</span>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8></a><a href=#__codelineno-36-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>    </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=s>&quot;workflow_user&quot;</span>
</span><span id=__span-36-9><a id=__codelineno-36-9 name=__codelineno-36-9></a><a href=#__codelineno-36-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>    </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${DATABASE_PASSWORD}&quot;</span>
</span><span id=__span-36-10><a id=__codelineno-36-10 name=__codelineno-36-10></a><a href=#__codelineno-36-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span>
</span><span id=__span-36-11><a id=__codelineno-36-11 name=__codelineno-36-11></a><a href=#__codelineno-36-11><span class=linenos data-linenos="11 "></span></a><span class=w>  </span><span class=nt>pool</span><span class=p>:</span>
</span><span id=__span-36-12><a id=__codelineno-36-12 name=__codelineno-36-12></a><a href=#__codelineno-36-12><span class=linenos data-linenos="12 "></span></a><span class=w>    </span><span class=nt>min_connections</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id=__span-36-13><a id=__codelineno-36-13 name=__codelineno-36-13></a><a href=#__codelineno-36-13><span class=linenos data-linenos="13 "></span></a><span class=w>    </span><span class=nt>max_connections</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
</span><span id=__span-36-14><a id=__codelineno-36-14 name=__codelineno-36-14></a><a href=#__codelineno-36-14><span class=linenos data-linenos="14 "></span></a><span class=w>    </span>
</span><span id=__span-36-15><a id=__codelineno-36-15 name=__codelineno-36-15></a><a href=#__codelineno-36-15><span class=linenos data-linenos="15 "></span></a><span class=nt>tdd</span><span class=p>:</span>
</span><span id=__span-36-16><a id=__codelineno-36-16 name=__codelineno-36-16></a><a href=#__codelineno-36-16><span class=linenos data-linenos="16 "></span></a><span class=w>  </span><span class=nt>test_execution</span><span class=p>:</span>
</span><span id=__span-36-17><a id=__codelineno-36-17 name=__codelineno-36-17></a><a href=#__codelineno-36-17><span class=linenos data-linenos="17 "></span></a><span class=w>    </span><span class=nt>test_database</span><span class=p>:</span><span class=w> </span><span class=s>&quot;agent_workflow_test&quot;</span>
</span><span id=__span-36-18><a id=__codelineno-36-18 name=__codelineno-36-18></a><a href=#__codelineno-36-18><span class=linenos data-linenos="18 "></span></a><span class=w>    </span><span class=nt>isolation_level</span><span class=p>:</span><span class=w> </span><span class=s>&quot;transaction&quot;</span>
</span></code></pre></div><h4 id=database-schema-migration>Database Schema Migration<a class=headerlink href=#database-schema-migration title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1></a><a href=#__codelineno-37-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># scripts/setup_postgresql.py</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2></a><a href=#__codelineno-37-2><span class=linenos data-linenos=" 2 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>asyncpg</span>
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3></a><a href=#__codelineno-37-3><span class=linenos data-linenos=" 3 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>asyncio</span>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4></a><a href=#__codelineno-37-4><span class=linenos data-linenos=" 4 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>lib.storage.postgresql_adapter</span><span class=w> </span><span class=kn>import</span> <span class=n>PostgreSQLAdapter</span>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5></a><a href=#__codelineno-37-5><span class=linenos data-linenos=" 5 "></span></a>
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6></a><a href=#__codelineno-37-6><span class=linenos data-linenos=" 6 "></span></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>setup_database</span><span class=p>():</span>
</span><span id=__span-37-7><a id=__codelineno-37-7 name=__codelineno-37-7></a><a href=#__codelineno-37-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Setup PostgreSQL database for agent workflow&quot;&quot;&quot;</span>
</span><span id=__span-37-8><a id=__codelineno-37-8 name=__codelineno-37-8></a><a href=#__codelineno-37-8><span class=linenos data-linenos=" 8 "></span></a>    
</span><span id=__span-37-9><a id=__codelineno-37-9 name=__codelineno-37-9></a><a href=#__codelineno-37-9><span class=linenos data-linenos=" 9 "></span></a>    <span class=c1># Create database schema</span>
</span><span id=__span-37-10><a id=__codelineno-37-10 name=__codelineno-37-10></a><a href=#__codelineno-37-10><span class=linenos data-linenos="10 "></span></a>    <span class=n>adapter</span> <span class=o>=</span> <span class=n>PostgreSQLAdapter</span><span class=p>()</span>
</span><span id=__span-37-11><a id=__codelineno-37-11 name=__codelineno-37-11></a><a href=#__codelineno-37-11><span class=linenos data-linenos="11 "></span></a>    <span class=k>await</span> <span class=n>adapter</span><span class=o>.</span><span class=n>create_schema</span><span class=p>()</span>
</span><span id=__span-37-12><a id=__codelineno-37-12 name=__codelineno-37-12></a><a href=#__codelineno-37-12><span class=linenos data-linenos="12 "></span></a>    
</span><span id=__span-37-13><a id=__codelineno-37-13 name=__codelineno-37-13></a><a href=#__codelineno-37-13><span class=linenos data-linenos="13 "></span></a>    <span class=c1># Create TDD-specific tables</span>
</span><span id=__span-37-14><a id=__codelineno-37-14 name=__codelineno-37-14></a><a href=#__codelineno-37-14><span class=linenos data-linenos="14 "></span></a>    <span class=k>await</span> <span class=n>adapter</span><span class=o>.</span><span class=n>execute_sql</span><span class=p>(</span><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-37-15><a id=__codelineno-37-15 name=__codelineno-37-15></a><a href=#__codelineno-37-15><span class=linenos data-linenos="15 "></span></a><span class=s2>        CREATE TABLE IF NOT EXISTS tdd_cycles (</span>
</span><span id=__span-37-16><a id=__codelineno-37-16 name=__codelineno-37-16></a><a href=#__codelineno-37-16><span class=linenos data-linenos="16 "></span></a><span class=s2>            id VARCHAR(50) PRIMARY KEY,</span>
</span><span id=__span-37-17><a id=__codelineno-37-17 name=__codelineno-37-17></a><a href=#__codelineno-37-17><span class=linenos data-linenos="17 "></span></a><span class=s2>            story_id VARCHAR(50) NOT NULL,</span>
</span><span id=__span-37-18><a id=__codelineno-37-18 name=__codelineno-37-18></a><a href=#__codelineno-37-18><span class=linenos data-linenos="18 "></span></a><span class=s2>            current_state VARCHAR(20) NOT NULL,</span>
</span><span id=__span-37-19><a id=__codelineno-37-19 name=__codelineno-37-19></a><a href=#__codelineno-37-19><span class=linenos data-linenos="19 "></span></a><span class=s2>            started_at TIMESTAMP DEFAULT NOW(),</span>
</span><span id=__span-37-20><a id=__codelineno-37-20 name=__codelineno-37-20></a><a href=#__codelineno-37-20><span class=linenos data-linenos="20 "></span></a><span class=s2>            completed_at TIMESTAMP,</span>
</span><span id=__span-37-21><a id=__codelineno-37-21 name=__codelineno-37-21></a><a href=#__codelineno-37-21><span class=linenos data-linenos="21 "></span></a><span class=s2>            metadata JSONB</span>
</span><span id=__span-37-22><a id=__codelineno-37-22 name=__codelineno-37-22></a><a href=#__codelineno-37-22><span class=linenos data-linenos="22 "></span></a><span class=s2>        );</span>
</span><span id=__span-37-23><a id=__codelineno-37-23 name=__codelineno-37-23></a><a href=#__codelineno-37-23><span class=linenos data-linenos="23 "></span></a><span class=s2>        </span>
</span><span id=__span-37-24><a id=__codelineno-37-24 name=__codelineno-37-24></a><a href=#__codelineno-37-24><span class=linenos data-linenos="24 "></span></a><span class=s2>        CREATE TABLE IF NOT EXISTS tdd_tasks (</span>
</span><span id=__span-37-25><a id=__codelineno-37-25 name=__codelineno-37-25></a><a href=#__codelineno-37-25><span class=linenos data-linenos="25 "></span></a><span class=s2>            id VARCHAR(50) PRIMARY KEY,</span>
</span><span id=__span-37-26><a id=__codelineno-37-26 name=__codelineno-37-26></a><a href=#__codelineno-37-26><span class=linenos data-linenos="26 "></span></a><span class=s2>            cycle_id VARCHAR(50) REFERENCES tdd_cycles(id),</span>
</span><span id=__span-37-27><a id=__codelineno-37-27 name=__codelineno-37-27></a><a href=#__codelineno-37-27><span class=linenos data-linenos="27 "></span></a><span class=s2>            description TEXT NOT NULL,</span>
</span><span id=__span-37-28><a id=__codelineno-37-28 name=__codelineno-37-28></a><a href=#__codelineno-37-28><span class=linenos data-linenos="28 "></span></a><span class=s2>            current_state VARCHAR(20) NOT NULL,</span>
</span><span id=__span-37-29><a id=__codelineno-37-29 name=__codelineno-37-29></a><a href=#__codelineno-37-29><span class=linenos data-linenos="29 "></span></a><span class=s2>            test_files JSONB,</span>
</span><span id=__span-37-30><a id=__codelineno-37-30 name=__codelineno-37-30></a><a href=#__codelineno-37-30><span class=linenos data-linenos="30 "></span></a><span class=s2>            source_files JSONB,</span>
</span><span id=__span-37-31><a id=__codelineno-37-31 name=__codelineno-37-31></a><a href=#__codelineno-37-31><span class=linenos data-linenos="31 "></span></a><span class=s2>            created_at TIMESTAMP DEFAULT NOW()</span>
</span><span id=__span-37-32><a id=__codelineno-37-32 name=__codelineno-37-32></a><a href=#__codelineno-37-32><span class=linenos data-linenos="32 "></span></a><span class=s2>        );</span>
</span><span id=__span-37-33><a id=__codelineno-37-33 name=__codelineno-37-33></a><a href=#__codelineno-37-33><span class=linenos data-linenos="33 "></span></a><span class=s2>        </span>
</span><span id=__span-37-34><a id=__codelineno-37-34 name=__codelineno-37-34></a><a href=#__codelineno-37-34><span class=linenos data-linenos="34 "></span></a><span class=s2>        CREATE TABLE IF NOT EXISTS test_results (</span>
</span><span id=__span-37-35><a id=__codelineno-37-35 name=__codelineno-37-35></a><a href=#__codelineno-37-35><span class=linenos data-linenos="35 "></span></a><span class=s2>            id SERIAL PRIMARY KEY,</span>
</span><span id=__span-37-36><a id=__codelineno-37-36 name=__codelineno-37-36></a><a href=#__codelineno-37-36><span class=linenos data-linenos="36 "></span></a><span class=s2>            task_id VARCHAR(50) REFERENCES tdd_tasks(id),</span>
</span><span id=__span-37-37><a id=__codelineno-37-37 name=__codelineno-37-37></a><a href=#__codelineno-37-37><span class=linenos data-linenos="37 "></span></a><span class=s2>            test_name VARCHAR(200) NOT NULL,</span>
</span><span id=__span-37-38><a id=__codelineno-37-38 name=__codelineno-37-38></a><a href=#__codelineno-37-38><span class=linenos data-linenos="38 "></span></a><span class=s2>            status VARCHAR(20) NOT NULL,</span>
</span><span id=__span-37-39><a id=__codelineno-37-39 name=__codelineno-37-39></a><a href=#__codelineno-37-39><span class=linenos data-linenos="39 "></span></a><span class=s2>            execution_time FLOAT,</span>
</span><span id=__span-37-40><a id=__codelineno-37-40 name=__codelineno-37-40></a><a href=#__codelineno-37-40><span class=linenos data-linenos="40 "></span></a><span class=s2>            output TEXT,</span>
</span><span id=__span-37-41><a id=__codelineno-37-41 name=__codelineno-37-41></a><a href=#__codelineno-37-41><span class=linenos data-linenos="41 "></span></a><span class=s2>            timestamp TIMESTAMP DEFAULT NOW()</span>
</span><span id=__span-37-42><a id=__codelineno-37-42 name=__codelineno-37-42></a><a href=#__codelineno-37-42><span class=linenos data-linenos="42 "></span></a><span class=s2>        );</span>
</span><span id=__span-37-43><a id=__codelineno-37-43 name=__codelineno-37-43></a><a href=#__codelineno-37-43><span class=linenos data-linenos="43 "></span></a><span class=s2>        </span>
</span><span id=__span-37-44><a id=__codelineno-37-44 name=__codelineno-37-44></a><a href=#__codelineno-37-44><span class=linenos data-linenos="44 "></span></a><span class=s2>        CREATE INDEX idx_tdd_cycles_story_id ON tdd_cycles(story_id);</span>
</span><span id=__span-37-45><a id=__codelineno-37-45 name=__codelineno-37-45></a><a href=#__codelineno-37-45><span class=linenos data-linenos="45 "></span></a><span class=s2>        CREATE INDEX idx_test_results_task_id ON test_results(task_id);</span>
</span><span id=__span-37-46><a id=__codelineno-37-46 name=__codelineno-37-46></a><a href=#__codelineno-37-46><span class=linenos data-linenos="46 "></span></a><span class=s2>    &quot;&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-37-47><a id=__codelineno-37-47 name=__codelineno-37-47></a><a href=#__codelineno-37-47><span class=linenos data-linenos="47 "></span></a>    
</span><span id=__span-37-48><a id=__codelineno-37-48 name=__codelineno-37-48></a><a href=#__codelineno-37-48><span class=linenos data-linenos="48 "></span></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;✅ PostgreSQL database setup complete&quot;</span><span class=p>)</span>
</span><span id=__span-37-49><a id=__codelineno-37-49 name=__codelineno-37-49></a><a href=#__codelineno-37-49><span class=linenos data-linenos="49 "></span></a>
</span><span id=__span-37-50><a id=__codelineno-37-50 name=__codelineno-37-50></a><a href=#__codelineno-37-50><span class=linenos data-linenos="50 "></span></a><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&quot;__main__&quot;</span><span class=p>:</span>
</span><span id=__span-37-51><a id=__codelineno-37-51 name=__codelineno-37-51></a><a href=#__codelineno-37-51><span class=linenos data-linenos="51 "></span></a>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>setup_database</span><span class=p>())</span>
</span></code></pre></div><h3 id=mongodb-integration>MongoDB Integration<a class=headerlink href=#mongodb-integration title="Permanent link">&para;</a></h3><h4 id=mongodb-configuration>MongoDB Configuration<a class=headerlink href=#mongodb-configuration title="Permanent link">&para;</a></h4><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1></a><a href=#__codelineno-38-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># config/mongodb.yml</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2></a><a href=#__codelineno-38-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>storage</span><span class=p>:</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3></a><a href=#__codelineno-38-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s>&quot;mongodb&quot;</span>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4></a><a href=#__codelineno-38-4><span class=linenos data-linenos=" 4 "></span></a><span class=w>  </span><span class=nt>connection</span><span class=p>:</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5></a><a href=#__codelineno-38-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>    </span><span class=nt>uri</span><span class=p>:</span><span class=w> </span><span class=s>&quot;mongodb://localhost:27017/agent_workflow&quot;</span>
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6></a><a href=#__codelineno-38-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>    </span><span class=nt>options</span><span class=p>:</span>
</span><span id=__span-38-7><a id=__codelineno-38-7 name=__codelineno-38-7></a><a href=#__codelineno-38-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>      </span><span class=nt>maxPoolSize</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
</span><span id=__span-38-8><a id=__codelineno-38-8 name=__codelineno-38-8></a><a href=#__codelineno-38-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>      </span><span class=nt>retryWrites</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-38-9><a id=__codelineno-38-9 name=__codelineno-38-9></a><a href=#__codelineno-38-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>      </span>
</span><span id=__span-38-10><a id=__codelineno-38-10 name=__codelineno-38-10></a><a href=#__codelineno-38-10><span class=linenos data-linenos="10 "></span></a><span class=w>  </span><span class=nt>collections</span><span class=p>:</span>
</span><span id=__span-38-11><a id=__codelineno-38-11 name=__codelineno-38-11></a><a href=#__codelineno-38-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span><span class=nt>tdd_cycles</span><span class=p>:</span><span class=w> </span><span class=s>&quot;tdd_cycles&quot;</span>
</span><span id=__span-38-12><a id=__codelineno-38-12 name=__codelineno-38-12></a><a href=#__codelineno-38-12><span class=linenos data-linenos="12 "></span></a><span class=w>    </span><span class=nt>test_results</span><span class=p>:</span><span class=w> </span><span class=s>&quot;test_results&quot;</span>
</span><span id=__span-38-13><a id=__codelineno-38-13 name=__codelineno-38-13></a><a href=#__codelineno-38-13><span class=linenos data-linenos="13 "></span></a><span class=w>    </span><span class=nt>agent_logs</span><span class=p>:</span><span class=w> </span><span class=s>&quot;agent_logs&quot;</span>
</span></code></pre></div><h4 id=mongodb-document-models>MongoDB Document Models<a class=headerlink href=#mongodb-document-models title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1></a><a href=#__codelineno-39-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># lib/storage/mongodb_models.py</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2></a><a href=#__codelineno-39-2><span class=linenos data-linenos=" 2 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>motor.motor_asyncio</span><span class=w> </span><span class=kn>import</span> <span class=n>AsyncIOMotorClient</span>
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3></a><a href=#__codelineno-39-3><span class=linenos data-linenos=" 3 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4></a><a href=#__codelineno-39-4><span class=linenos data-linenos=" 4 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>uuid</span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5></a><a href=#__codelineno-39-5><span class=linenos data-linenos=" 5 "></span></a>
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6></a><a href=#__codelineno-39-6><span class=linenos data-linenos=" 6 "></span></a><span class=k>class</span><span class=w> </span><span class=nc>MongoDBTDDStorage</span><span class=p>:</span>
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7></a><a href=#__codelineno-39-7><span class=linenos data-linenos=" 7 "></span></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection_uri</span><span class=p>):</span>
</span><span id=__span-39-8><a id=__codelineno-39-8 name=__codelineno-39-8></a><a href=#__codelineno-39-8><span class=linenos data-linenos=" 8 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>AsyncIOMotorClient</span><span class=p>(</span><span class=n>connection_uri</span><span class=p>)</span>
</span><span id=__span-39-9><a id=__codelineno-39-9 name=__codelineno-39-9></a><a href=#__codelineno-39-9><span class=linenos data-linenos=" 9 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>db</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>agent_workflow</span>
</span><span id=__span-39-10><a id=__codelineno-39-10 name=__codelineno-39-10></a><a href=#__codelineno-39-10><span class=linenos data-linenos="10 "></span></a>        
</span><span id=__span-39-11><a id=__codelineno-39-11 name=__codelineno-39-11></a><a href=#__codelineno-39-11><span class=linenos data-linenos="11 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>save_tdd_cycle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>cycle</span><span class=p>):</span>
</span><span id=__span-39-12><a id=__codelineno-39-12 name=__codelineno-39-12></a><a href=#__codelineno-39-12><span class=linenos data-linenos="12 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Save TDD cycle to MongoDB&quot;&quot;&quot;</span>
</span><span id=__span-39-13><a id=__codelineno-39-13 name=__codelineno-39-13></a><a href=#__codelineno-39-13><span class=linenos data-linenos="13 "></span></a>        <span class=n>document</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-39-14><a id=__codelineno-39-14 name=__codelineno-39-14></a><a href=#__codelineno-39-14><span class=linenos data-linenos="14 "></span></a>            <span class=s2>&quot;_id&quot;</span><span class=p>:</span> <span class=n>cycle</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-39-15><a id=__codelineno-39-15 name=__codelineno-39-15></a><a href=#__codelineno-39-15><span class=linenos data-linenos="15 "></span></a>            <span class=s2>&quot;story_id&quot;</span><span class=p>:</span> <span class=n>cycle</span><span class=o>.</span><span class=n>story_id</span><span class=p>,</span>
</span><span id=__span-39-16><a id=__codelineno-39-16 name=__codelineno-39-16></a><a href=#__codelineno-39-16><span class=linenos data-linenos="16 "></span></a>            <span class=s2>&quot;current_state&quot;</span><span class=p>:</span> <span class=n>cycle</span><span class=o>.</span><span class=n>current_state</span><span class=o>.</span><span class=n>value</span><span class=p>,</span>
</span><span id=__span-39-17><a id=__codelineno-39-17 name=__codelineno-39-17></a><a href=#__codelineno-39-17><span class=linenos data-linenos="17 "></span></a>            <span class=s2>&quot;tasks&quot;</span><span class=p>:</span> <span class=p>[</span><span class=n>task</span><span class=o>.</span><span class=n>to_dict</span><span class=p>()</span> <span class=k>for</span> <span class=n>task</span> <span class=ow>in</span> <span class=n>cycle</span><span class=o>.</span><span class=n>tasks</span><span class=p>],</span>
</span><span id=__span-39-18><a id=__codelineno-39-18 name=__codelineno-39-18></a><a href=#__codelineno-39-18><span class=linenos data-linenos="18 "></span></a>            <span class=s2>&quot;started_at&quot;</span><span class=p>:</span> <span class=n>cycle</span><span class=o>.</span><span class=n>started_at</span><span class=p>,</span>
</span><span id=__span-39-19><a id=__codelineno-39-19 name=__codelineno-39-19></a><a href=#__codelineno-39-19><span class=linenos data-linenos="19 "></span></a>            <span class=s2>&quot;completed_at&quot;</span><span class=p>:</span> <span class=n>cycle</span><span class=o>.</span><span class=n>completed_at</span><span class=p>,</span>
</span><span id=__span-39-20><a id=__codelineno-39-20 name=__codelineno-39-20></a><a href=#__codelineno-39-20><span class=linenos data-linenos="20 "></span></a>            <span class=s2>&quot;metadata&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-39-21><a id=__codelineno-39-21 name=__codelineno-39-21></a><a href=#__codelineno-39-21><span class=linenos data-linenos="21 "></span></a>                <span class=s2>&quot;total_test_runs&quot;</span><span class=p>:</span> <span class=n>cycle</span><span class=o>.</span><span class=n>total_test_runs</span><span class=p>,</span>
</span><span id=__span-39-22><a id=__codelineno-39-22 name=__codelineno-39-22></a><a href=#__codelineno-39-22><span class=linenos data-linenos="22 "></span></a>                <span class=s2>&quot;total_refactors&quot;</span><span class=p>:</span> <span class=n>cycle</span><span class=o>.</span><span class=n>total_refactors</span><span class=p>,</span>
</span><span id=__span-39-23><a id=__codelineno-39-23 name=__codelineno-39-23></a><a href=#__codelineno-39-23><span class=linenos data-linenos="23 "></span></a>                <span class=s2>&quot;overall_test_coverage&quot;</span><span class=p>:</span> <span class=n>cycle</span><span class=o>.</span><span class=n>overall_test_coverage</span>
</span><span id=__span-39-24><a id=__codelineno-39-24 name=__codelineno-39-24></a><a href=#__codelineno-39-24><span class=linenos data-linenos="24 "></span></a>            <span class=p>},</span>
</span><span id=__span-39-25><a id=__codelineno-39-25 name=__codelineno-39-25></a><a href=#__codelineno-39-25><span class=linenos data-linenos="25 "></span></a>            <span class=s2>&quot;updated_at&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span>
</span><span id=__span-39-26><a id=__codelineno-39-26 name=__codelineno-39-26></a><a href=#__codelineno-39-26><span class=linenos data-linenos="26 "></span></a>        <span class=p>}</span>
</span><span id=__span-39-27><a id=__codelineno-39-27 name=__codelineno-39-27></a><a href=#__codelineno-39-27><span class=linenos data-linenos="27 "></span></a>        
</span><span id=__span-39-28><a id=__codelineno-39-28 name=__codelineno-39-28></a><a href=#__codelineno-39-28><span class=linenos data-linenos="28 "></span></a>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>db</span><span class=o>.</span><span class=n>tdd_cycles</span><span class=o>.</span><span class=n>replace_one</span><span class=p>(</span>
</span><span id=__span-39-29><a id=__codelineno-39-29 name=__codelineno-39-29></a><a href=#__codelineno-39-29><span class=linenos data-linenos="29 "></span></a>            <span class=p>{</span><span class=s2>&quot;_id&quot;</span><span class=p>:</span> <span class=n>cycle</span><span class=o>.</span><span class=n>id</span><span class=p>},</span>
</span><span id=__span-39-30><a id=__codelineno-39-30 name=__codelineno-39-30></a><a href=#__codelineno-39-30><span class=linenos data-linenos="30 "></span></a>            <span class=n>document</span><span class=p>,</span>
</span><span id=__span-39-31><a id=__codelineno-39-31 name=__codelineno-39-31></a><a href=#__codelineno-39-31><span class=linenos data-linenos="31 "></span></a>            <span class=n>upsert</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-39-32><a id=__codelineno-39-32 name=__codelineno-39-32></a><a href=#__codelineno-39-32><span class=linenos data-linenos="32 "></span></a>        <span class=p>)</span>
</span><span id=__span-39-33><a id=__codelineno-39-33 name=__codelineno-39-33></a><a href=#__codelineno-39-33><span class=linenos data-linenos="33 "></span></a>        
</span><span id=__span-39-34><a id=__codelineno-39-34 name=__codelineno-39-34></a><a href=#__codelineno-39-34><span class=linenos data-linenos="34 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>get_active_cycles</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-39-35><a id=__codelineno-39-35 name=__codelineno-39-35></a><a href=#__codelineno-39-35><span class=linenos data-linenos="35 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get all active TDD cycles&quot;&quot;&quot;</span>
</span><span id=__span-39-36><a id=__codelineno-39-36 name=__codelineno-39-36></a><a href=#__codelineno-39-36><span class=linenos data-linenos="36 "></span></a>        <span class=n>cursor</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>db</span><span class=o>.</span><span class=n>tdd_cycles</span><span class=o>.</span><span class=n>find</span><span class=p>({</span>
</span><span id=__span-39-37><a id=__codelineno-39-37 name=__codelineno-39-37></a><a href=#__codelineno-39-37><span class=linenos data-linenos="37 "></span></a>            <span class=s2>&quot;current_state&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$ne&quot;</span><span class=p>:</span> <span class=s2>&quot;COMMIT&quot;</span><span class=p>},</span>
</span><span id=__span-39-38><a id=__codelineno-39-38 name=__codelineno-39-38></a><a href=#__codelineno-39-38><span class=linenos data-linenos="38 "></span></a>            <span class=s2>&quot;completed_at&quot;</span><span class=p>:</span> <span class=kc>None</span>
</span><span id=__span-39-39><a id=__codelineno-39-39 name=__codelineno-39-39></a><a href=#__codelineno-39-39><span class=linenos data-linenos="39 "></span></a>        <span class=p>})</span>
</span><span id=__span-39-40><a id=__codelineno-39-40 name=__codelineno-39-40></a><a href=#__codelineno-39-40><span class=linenos data-linenos="40 "></span></a>        
</span><span id=__span-39-41><a id=__codelineno-39-41 name=__codelineno-39-41></a><a href=#__codelineno-39-41><span class=linenos data-linenos="41 "></span></a>        <span class=n>cycles</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-39-42><a id=__codelineno-39-42 name=__codelineno-39-42></a><a href=#__codelineno-39-42><span class=linenos data-linenos="42 "></span></a>        <span class=k>async</span> <span class=k>for</span> <span class=n>document</span> <span class=ow>in</span> <span class=n>cursor</span><span class=p>:</span>
</span><span id=__span-39-43><a id=__codelineno-39-43 name=__codelineno-39-43></a><a href=#__codelineno-39-43><span class=linenos data-linenos="43 "></span></a>            <span class=n>cycle</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>document_to_cycle</span><span class=p>(</span><span class=n>document</span><span class=p>)</span>
</span><span id=__span-39-44><a id=__codelineno-39-44 name=__codelineno-39-44></a><a href=#__codelineno-39-44><span class=linenos data-linenos="44 "></span></a>            <span class=n>cycles</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>cycle</span><span class=p>)</span>
</span><span id=__span-39-45><a id=__codelineno-39-45 name=__codelineno-39-45></a><a href=#__codelineno-39-45><span class=linenos data-linenos="45 "></span></a>            
</span><span id=__span-39-46><a id=__codelineno-39-46 name=__codelineno-39-46></a><a href=#__codelineno-39-46><span class=linenos data-linenos="46 "></span></a>        <span class=k>return</span> <span class=n>cycles</span>
</span></code></pre></div><h2 id=cloud-platform-integration>Cloud Platform Integration<a class=headerlink href=#cloud-platform-integration title="Permanent link">&para;</a></h2><h3 id=aws-integration>AWS Integration<a class=headerlink href=#aws-integration title="Permanent link">&para;</a></h3><h4 id=aws-ecs-deployment>AWS ECS Deployment<a class=headerlink href=#aws-ecs-deployment title="Permanent link">&para;</a></h4><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1></a><a href=#__codelineno-40-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># aws/ecs-task-definition.json</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2></a><a href=#__codelineno-40-2><span class=linenos data-linenos=" 2 "></span></a><span class="p p-Indicator">{</span>
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3></a><a href=#__codelineno-40-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>  </span><span class=s>&quot;family&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;agent-workflow&quot;</span><span class="p p-Indicator">,</span>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4></a><a href=#__codelineno-40-4><span class=linenos data-linenos=" 4 "></span></a><span class=w>  </span><span class=s>&quot;networkMode&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;awsvpc&quot;</span><span class="p p-Indicator">,</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5></a><a href=#__codelineno-40-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span><span class=s>&quot;requiresCompatibilities&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;FARGATE&quot;</span><span class="p p-Indicator">],</span>
</span><span id=__span-40-6><a id=__codelineno-40-6 name=__codelineno-40-6></a><a href=#__codelineno-40-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>  </span><span class=s>&quot;cpu&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;1024&quot;</span><span class="p p-Indicator">,</span>
</span><span id=__span-40-7><a id=__codelineno-40-7 name=__codelineno-40-7></a><a href=#__codelineno-40-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>  </span><span class=s>&quot;memory&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;2048&quot;</span><span class="p p-Indicator">,</span>
</span><span id=__span-40-8><a id=__codelineno-40-8 name=__codelineno-40-8></a><a href=#__codelineno-40-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>  </span><span class=s>&quot;executionRoleArn&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;arn:aws:iam::ACCOUNT:role/ecsTaskExecutionRole&quot;</span><span class="p p-Indicator">,</span>
</span><span id=__span-40-9><a id=__codelineno-40-9 name=__codelineno-40-9></a><a href=#__codelineno-40-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>  </span><span class=s>&quot;taskRoleArn&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;arn:aws:iam::ACCOUNT:role/agent-workflow-task-role&quot;</span><span class="p p-Indicator">,</span>
</span><span id=__span-40-10><a id=__codelineno-40-10 name=__codelineno-40-10></a><a href=#__codelineno-40-10><span class=linenos data-linenos="10 "></span></a><span class=w>  </span><span class=s>&quot;containerDefinitions&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">[</span>
</span><span id=__span-40-11><a id=__codelineno-40-11 name=__codelineno-40-11></a><a href=#__codelineno-40-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span><span class="p p-Indicator">{</span>
</span><span id=__span-40-12><a id=__codelineno-40-12 name=__codelineno-40-12></a><a href=#__codelineno-40-12><span class=linenos data-linenos="12 "></span></a><span class=w>      </span><span class=s>&quot;name&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;orchestrator&quot;</span><span class="p p-Indicator">,</span>
</span><span id=__span-40-13><a id=__codelineno-40-13 name=__codelineno-40-13></a><a href=#__codelineno-40-13><span class=linenos data-linenos="13 "></span></a><span class=w>      </span><span class=s>&quot;image&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;your-registry/agent-workflow:latest&quot;</span><span class="p p-Indicator">,</span>
</span><span id=__span-40-14><a id=__codelineno-40-14 name=__codelineno-40-14></a><a href=#__codelineno-40-14><span class=linenos data-linenos="14 "></span></a><span class=w>      </span><span class=s>&quot;essential&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=nv>true</span><span class="p p-Indicator">,</span>
</span><span id=__span-40-15><a id=__codelineno-40-15 name=__codelineno-40-15></a><a href=#__codelineno-40-15><span class=linenos data-linenos="15 "></span></a><span class=w>      </span><span class=s>&quot;portMappings&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">[</span>
</span><span id=__span-40-16><a id=__codelineno-40-16 name=__codelineno-40-16></a><a href=#__codelineno-40-16><span class=linenos data-linenos="16 "></span></a><span class=w>        </span><span class="p p-Indicator">{</span>
</span><span id=__span-40-17><a id=__codelineno-40-17 name=__codelineno-40-17></a><a href=#__codelineno-40-17><span class=linenos data-linenos="17 "></span></a><span class=w>          </span><span class=s>&quot;containerPort&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=nv>8080</span><span class="p p-Indicator">,</span>
</span><span id=__span-40-18><a id=__codelineno-40-18 name=__codelineno-40-18></a><a href=#__codelineno-40-18><span class=linenos data-linenos="18 "></span></a><span class=w>          </span><span class=s>&quot;protocol&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;tcp&quot;</span>
</span><span id=__span-40-19><a id=__codelineno-40-19 name=__codelineno-40-19></a><a href=#__codelineno-40-19><span class=linenos data-linenos="19 "></span></a><span class=w>        </span><span class="p p-Indicator">}</span>
</span><span id=__span-40-20><a id=__codelineno-40-20 name=__codelineno-40-20></a><a href=#__codelineno-40-20><span class=linenos data-linenos="20 "></span></a><span class=w>      </span><span class="p p-Indicator">],</span>
</span><span id=__span-40-21><a id=__codelineno-40-21 name=__codelineno-40-21></a><a href=#__codelineno-40-21><span class=linenos data-linenos="21 "></span></a><span class=w>      </span><span class=s>&quot;environment&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">[</span>
</span><span id=__span-40-22><a id=__codelineno-40-22 name=__codelineno-40-22></a><a href=#__codelineno-40-22><span class=linenos data-linenos="22 "></span></a><span class=w>        </span><span class="p p-Indicator">{</span><span class=s>&quot;name&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;ORCHESTRATOR_MODE&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;value&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;autonomous&quot;</span><span class="p p-Indicator">},</span>
</span><span id=__span-40-23><a id=__codelineno-40-23 name=__codelineno-40-23></a><a href=#__codelineno-40-23><span class=linenos data-linenos="23 "></span></a><span class=w>        </span><span class="p p-Indicator">{</span><span class=s>&quot;name&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;AWS_REGION&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;value&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;us-east-1&quot;</span><span class="p p-Indicator">}</span>
</span><span id=__span-40-24><a id=__codelineno-40-24 name=__codelineno-40-24></a><a href=#__codelineno-40-24><span class=linenos data-linenos="24 "></span></a><span class=w>      </span><span class="p p-Indicator">],</span>
</span><span id=__span-40-25><a id=__codelineno-40-25 name=__codelineno-40-25></a><a href=#__codelineno-40-25><span class=linenos data-linenos="25 "></span></a><span class=w>      </span><span class=s>&quot;secrets&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">[</span>
</span><span id=__span-40-26><a id=__codelineno-40-26 name=__codelineno-40-26></a><a href=#__codelineno-40-26><span class=linenos data-linenos="26 "></span></a><span class=w>        </span><span class="p p-Indicator">{</span>
</span><span id=__span-40-27><a id=__codelineno-40-27 name=__codelineno-40-27></a><a href=#__codelineno-40-27><span class=linenos data-linenos="27 "></span></a><span class=w>          </span><span class=s>&quot;name&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;DISCORD_BOT_TOKEN&quot;</span><span class="p p-Indicator">,</span>
</span><span id=__span-40-28><a id=__codelineno-40-28 name=__codelineno-40-28></a><a href=#__codelineno-40-28><span class=linenos data-linenos="28 "></span></a><span class=w>          </span><span class=s>&quot;valueFrom&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;arn:aws:secretsmanager:us-east-1:ACCOUNT:secret:discord-token&quot;</span>
</span><span id=__span-40-29><a id=__codelineno-40-29 name=__codelineno-40-29></a><a href=#__codelineno-40-29><span class=linenos data-linenos="29 "></span></a><span class=w>        </span><span class="p p-Indicator">}</span>
</span><span id=__span-40-30><a id=__codelineno-40-30 name=__codelineno-40-30></a><a href=#__codelineno-40-30><span class=linenos data-linenos="30 "></span></a><span class=w>      </span><span class="p p-Indicator">],</span>
</span><span id=__span-40-31><a id=__codelineno-40-31 name=__codelineno-40-31></a><a href=#__codelineno-40-31><span class=linenos data-linenos="31 "></span></a><span class=w>      </span><span class=s>&quot;logConfiguration&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span>
</span><span id=__span-40-32><a id=__codelineno-40-32 name=__codelineno-40-32></a><a href=#__codelineno-40-32><span class=linenos data-linenos="32 "></span></a><span class=w>        </span><span class=s>&quot;logDriver&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;awslogs&quot;</span><span class="p p-Indicator">,</span>
</span><span id=__span-40-33><a id=__codelineno-40-33 name=__codelineno-40-33></a><a href=#__codelineno-40-33><span class=linenos data-linenos="33 "></span></a><span class=w>        </span><span class=s>&quot;options&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span>
</span><span id=__span-40-34><a id=__codelineno-40-34 name=__codelineno-40-34></a><a href=#__codelineno-40-34><span class=linenos data-linenos="34 "></span></a><span class=w>          </span><span class=s>&quot;awslogs-group&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;/ecs/agent-workflow&quot;</span><span class="p p-Indicator">,</span>
</span><span id=__span-40-35><a id=__codelineno-40-35 name=__codelineno-40-35></a><a href=#__codelineno-40-35><span class=linenos data-linenos="35 "></span></a><span class=w>          </span><span class=s>&quot;awslogs-region&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;us-east-1&quot;</span><span class="p p-Indicator">,</span>
</span><span id=__span-40-36><a id=__codelineno-40-36 name=__codelineno-40-36></a><a href=#__codelineno-40-36><span class=linenos data-linenos="36 "></span></a><span class=w>          </span><span class=s>&quot;awslogs-stream-prefix&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;ecs&quot;</span>
</span><span id=__span-40-37><a id=__codelineno-40-37 name=__codelineno-40-37></a><a href=#__codelineno-40-37><span class=linenos data-linenos="37 "></span></a><span class=w>        </span><span class="p p-Indicator">}</span>
</span><span id=__span-40-38><a id=__codelineno-40-38 name=__codelineno-40-38></a><a href=#__codelineno-40-38><span class=linenos data-linenos="38 "></span></a><span class=w>      </span><span class="p p-Indicator">}</span>
</span><span id=__span-40-39><a id=__codelineno-40-39 name=__codelineno-40-39></a><a href=#__codelineno-40-39><span class=linenos data-linenos="39 "></span></a><span class=w>    </span><span class="p p-Indicator">}</span>
</span><span id=__span-40-40><a id=__codelineno-40-40 name=__codelineno-40-40></a><a href=#__codelineno-40-40><span class=linenos data-linenos="40 "></span></a><span class=w>  </span><span class="p p-Indicator">]</span>
</span><span id=__span-40-41><a id=__codelineno-40-41 name=__codelineno-40-41></a><a href=#__codelineno-40-41><span class=linenos data-linenos="41 "></span></a><span class="p p-Indicator">}</span>
</span></code></pre></div><h4 id=aws-lambda-integration>AWS Lambda Integration<a class=headerlink href=#aws-lambda-integration title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1></a><a href=#__codelineno-41-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># aws/lambda_tdd_processor.py</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2></a><a href=#__codelineno-41-2><span class=linenos data-linenos=" 2 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3></a><a href=#__codelineno-41-3><span class=linenos data-linenos=" 3 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>boto3</span>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4></a><a href=#__codelineno-41-4><span class=linenos data-linenos=" 4 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>lib.tdd_models</span><span class=w> </span><span class=kn>import</span> <span class=n>TDDCycle</span>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5></a><a href=#__codelineno-41-5><span class=linenos data-linenos=" 5 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>lib.storage.s3_adapter</span><span class=w> </span><span class=kn>import</span> <span class=n>S3TDDStorage</span>
</span><span id=__span-41-6><a id=__codelineno-41-6 name=__codelineno-41-6></a><a href=#__codelineno-41-6><span class=linenos data-linenos=" 6 "></span></a>
</span><span id=__span-41-7><a id=__codelineno-41-7 name=__codelineno-41-7></a><a href=#__codelineno-41-7><span class=linenos data-linenos=" 7 "></span></a><span class=k>def</span><span class=w> </span><span class=nf>lambda_handler</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span><span id=__span-41-8><a id=__codelineno-41-8 name=__codelineno-41-8></a><a href=#__codelineno-41-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;AWS Lambda function for processing TDD events&quot;&quot;&quot;</span>
</span><span id=__span-41-9><a id=__codelineno-41-9 name=__codelineno-41-9></a><a href=#__codelineno-41-9><span class=linenos data-linenos=" 9 "></span></a>    
</span><span id=__span-41-10><a id=__codelineno-41-10 name=__codelineno-41-10></a><a href=#__codelineno-41-10><span class=linenos data-linenos="10 "></span></a>    <span class=c1># Parse SQS message</span>
</span><span id=__span-41-11><a id=__codelineno-41-11 name=__codelineno-41-11></a><a href=#__codelineno-41-11><span class=linenos data-linenos="11 "></span></a>    <span class=k>for</span> <span class=n>record</span> <span class=ow>in</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;Records&#39;</span><span class=p>]:</span>
</span><span id=__span-41-12><a id=__codelineno-41-12 name=__codelineno-41-12></a><a href=#__codelineno-41-12><span class=linenos data-linenos="12 "></span></a>        <span class=n>message</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>record</span><span class=p>[</span><span class=s1>&#39;body&#39;</span><span class=p>])</span>
</span><span id=__span-41-13><a id=__codelineno-41-13 name=__codelineno-41-13></a><a href=#__codelineno-41-13><span class=linenos data-linenos="13 "></span></a>        <span class=n>event_type</span> <span class=o>=</span> <span class=n>message</span><span class=p>[</span><span class=s1>&#39;event_type&#39;</span><span class=p>]</span>
</span><span id=__span-41-14><a id=__codelineno-41-14 name=__codelineno-41-14></a><a href=#__codelineno-41-14><span class=linenos data-linenos="14 "></span></a>        
</span><span id=__span-41-15><a id=__codelineno-41-15 name=__codelineno-41-15></a><a href=#__codelineno-41-15><span class=linenos data-linenos="15 "></span></a>        <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;tdd_cycle_completed&#39;</span><span class=p>:</span>
</span><span id=__span-41-16><a id=__codelineno-41-16 name=__codelineno-41-16></a><a href=#__codelineno-41-16><span class=linenos data-linenos="16 "></span></a>            <span class=k>await</span> <span class=n>process_completed_cycle</span><span class=p>(</span><span class=n>message</span><span class=p>[</span><span class=s1>&#39;cycle_id&#39;</span><span class=p>])</span>
</span><span id=__span-41-17><a id=__codelineno-41-17 name=__codelineno-41-17></a><a href=#__codelineno-41-17><span class=linenos data-linenos="17 "></span></a>        <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;test_results_available&#39;</span><span class=p>:</span>
</span><span id=__span-41-18><a id=__codelineno-41-18 name=__codelineno-41-18></a><a href=#__codelineno-41-18><span class=linenos data-linenos="18 "></span></a>            <span class=k>await</span> <span class=n>process_test_results</span><span class=p>(</span><span class=n>message</span><span class=p>[</span><span class=s1>&#39;task_id&#39;</span><span class=p>])</span>
</span><span id=__span-41-19><a id=__codelineno-41-19 name=__codelineno-41-19></a><a href=#__codelineno-41-19><span class=linenos data-linenos="19 "></span></a>            
</span><span id=__span-41-20><a id=__codelineno-41-20 name=__codelineno-41-20></a><a href=#__codelineno-41-20><span class=linenos data-linenos="20 "></span></a>    <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-41-21><a id=__codelineno-41-21 name=__codelineno-41-21></a><a href=#__codelineno-41-21><span class=linenos data-linenos="21 "></span></a>        <span class=s1>&#39;statusCode&#39;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span><span id=__span-41-22><a id=__codelineno-41-22 name=__codelineno-41-22></a><a href=#__codelineno-41-22><span class=linenos data-linenos="22 "></span></a>        <span class=s1>&#39;body&#39;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=s1>&#39;TDD events processed successfully&#39;</span><span class=p>)</span>
</span><span id=__span-41-23><a id=__codelineno-41-23 name=__codelineno-41-23></a><a href=#__codelineno-41-23><span class=linenos data-linenos="23 "></span></a>    <span class=p>}</span>
</span><span id=__span-41-24><a id=__codelineno-41-24 name=__codelineno-41-24></a><a href=#__codelineno-41-24><span class=linenos data-linenos="24 "></span></a>
</span><span id=__span-41-25><a id=__codelineno-41-25 name=__codelineno-41-25></a><a href=#__codelineno-41-25><span class=linenos data-linenos="25 "></span></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>process_completed_cycle</span><span class=p>(</span><span class=n>cycle_id</span><span class=p>):</span>
</span><span id=__span-41-26><a id=__codelineno-41-26 name=__codelineno-41-26></a><a href=#__codelineno-41-26><span class=linenos data-linenos="26 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Process completed TDD cycle&quot;&quot;&quot;</span>
</span><span id=__span-41-27><a id=__codelineno-41-27 name=__codelineno-41-27></a><a href=#__codelineno-41-27><span class=linenos data-linenos="27 "></span></a>    <span class=n>storage</span> <span class=o>=</span> <span class=n>S3TDDStorage</span><span class=p>()</span>
</span><span id=__span-41-28><a id=__codelineno-41-28 name=__codelineno-41-28></a><a href=#__codelineno-41-28><span class=linenos data-linenos="28 "></span></a>    <span class=n>cycle</span> <span class=o>=</span> <span class=k>await</span> <span class=n>storage</span><span class=o>.</span><span class=n>load_cycle</span><span class=p>(</span><span class=n>cycle_id</span><span class=p>)</span>
</span><span id=__span-41-29><a id=__codelineno-41-29 name=__codelineno-41-29></a><a href=#__codelineno-41-29><span class=linenos data-linenos="29 "></span></a>    
</span><span id=__span-41-30><a id=__codelineno-41-30 name=__codelineno-41-30></a><a href=#__codelineno-41-30><span class=linenos data-linenos="30 "></span></a>    <span class=c1># Generate completion report</span>
</span><span id=__span-41-31><a id=__codelineno-41-31 name=__codelineno-41-31></a><a href=#__codelineno-41-31><span class=linenos data-linenos="31 "></span></a>    <span class=n>report</span> <span class=o>=</span> <span class=n>generate_cycle_report</span><span class=p>(</span><span class=n>cycle</span><span class=p>)</span>
</span><span id=__span-41-32><a id=__codelineno-41-32 name=__codelineno-41-32></a><a href=#__codelineno-41-32><span class=linenos data-linenos="32 "></span></a>    
</span><span id=__span-41-33><a id=__codelineno-41-33 name=__codelineno-41-33></a><a href=#__codelineno-41-33><span class=linenos data-linenos="33 "></span></a>    <span class=c1># Store in S3</span>
</span><span id=__span-41-34><a id=__codelineno-41-34 name=__codelineno-41-34></a><a href=#__codelineno-41-34><span class=linenos data-linenos="34 "></span></a>    <span class=n>s3</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;s3&#39;</span><span class=p>)</span>
</span><span id=__span-41-35><a id=__codelineno-41-35 name=__codelineno-41-35></a><a href=#__codelineno-41-35><span class=linenos data-linenos="35 "></span></a>    <span class=n>s3</span><span class=o>.</span><span class=n>put_object</span><span class=p>(</span>
</span><span id=__span-41-36><a id=__codelineno-41-36 name=__codelineno-41-36></a><a href=#__codelineno-41-36><span class=linenos data-linenos="36 "></span></a>        <span class=n>Bucket</span><span class=o>=</span><span class=s1>&#39;agent-workflow-reports&#39;</span><span class=p>,</span>
</span><span id=__span-41-37><a id=__codelineno-41-37 name=__codelineno-41-37></a><a href=#__codelineno-41-37><span class=linenos data-linenos="37 "></span></a>        <span class=n>Key</span><span class=o>=</span><span class=sa>f</span><span class=s1>&#39;tdd-reports/</span><span class=si>{</span><span class=n>cycle_id</span><span class=si>}</span><span class=s1>/completion-report.json&#39;</span><span class=p>,</span>
</span><span id=__span-41-38><a id=__codelineno-41-38 name=__codelineno-41-38></a><a href=#__codelineno-41-38><span class=linenos data-linenos="38 "></span></a>        <span class=n>Body</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>report</span><span class=p>),</span>
</span><span id=__span-41-39><a id=__codelineno-41-39 name=__codelineno-41-39></a><a href=#__codelineno-41-39><span class=linenos data-linenos="39 "></span></a>        <span class=n>ContentType</span><span class=o>=</span><span class=s1>&#39;application/json&#39;</span>
</span><span id=__span-41-40><a id=__codelineno-41-40 name=__codelineno-41-40></a><a href=#__codelineno-41-40><span class=linenos data-linenos="40 "></span></a>    <span class=p>)</span>
</span><span id=__span-41-41><a id=__codelineno-41-41 name=__codelineno-41-41></a><a href=#__codelineno-41-41><span class=linenos data-linenos="41 "></span></a>    
</span><span id=__span-41-42><a id=__codelineno-41-42 name=__codelineno-41-42></a><a href=#__codelineno-41-42><span class=linenos data-linenos="42 "></span></a>    <span class=c1># Send SNS notification</span>
</span><span id=__span-41-43><a id=__codelineno-41-43 name=__codelineno-41-43></a><a href=#__codelineno-41-43><span class=linenos data-linenos="43 "></span></a>    <span class=n>sns</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;sns&#39;</span><span class=p>)</span>
</span><span id=__span-41-44><a id=__codelineno-41-44 name=__codelineno-41-44></a><a href=#__codelineno-41-44><span class=linenos data-linenos="44 "></span></a>    <span class=n>sns</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span>
</span><span id=__span-41-45><a id=__codelineno-41-45 name=__codelineno-41-45></a><a href=#__codelineno-41-45><span class=linenos data-linenos="45 "></span></a>        <span class=n>TopicArn</span><span class=o>=</span><span class=s1>&#39;arn:aws:sns:us-east-1:ACCOUNT:tdd-notifications&#39;</span><span class=p>,</span>
</span><span id=__span-41-46><a id=__codelineno-41-46 name=__codelineno-41-46></a><a href=#__codelineno-41-46><span class=linenos data-linenos="46 "></span></a>        <span class=n>Message</span><span class=o>=</span><span class=sa>f</span><span class=s1>&#39;TDD Cycle </span><span class=si>{</span><span class=n>cycle_id</span><span class=si>}</span><span class=s1> completed successfully&#39;</span><span class=p>,</span>
</span><span id=__span-41-47><a id=__codelineno-41-47 name=__codelineno-41-47></a><a href=#__codelineno-41-47><span class=linenos data-linenos="47 "></span></a>        <span class=n>Subject</span><span class=o>=</span><span class=s1>&#39;TDD Cycle Completion&#39;</span>
</span><span id=__span-41-48><a id=__codelineno-41-48 name=__codelineno-41-48></a><a href=#__codelineno-41-48><span class=linenos data-linenos="48 "></span></a>    <span class=p>)</span>
</span></code></pre></div><h3 id=google-cloud-platform>Google Cloud Platform<a class=headerlink href=#google-cloud-platform title="Permanent link">&para;</a></h3><h4 id=gcp-cloud-run-deployment>GCP Cloud Run Deployment<a class=headerlink href=#gcp-cloud-run-deployment title="Permanent link">&para;</a></h4><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1></a><a href=#__codelineno-42-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># gcp/cloudbuild.yaml</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2></a><a href=#__codelineno-42-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3></a><a href=#__codelineno-42-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>  </span><span class=c1># Build the container image</span>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4></a><a href=#__codelineno-42-4><span class=linenos data-linenos=" 4 "></span></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;gcr.io/cloud-builders/docker&#39;</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5></a><a href=#__codelineno-42-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>    </span><span class=nt>args</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&#39;build&#39;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&#39;-t&#39;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&#39;gcr.io/$PROJECT_ID/agent-workflow:$COMMIT_SHA&#39;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&#39;.&#39;</span><span class="p p-Indicator">]</span>
</span><span id=__span-42-6><a id=__codelineno-42-6 name=__codelineno-42-6></a><a href=#__codelineno-42-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>    </span>
</span><span id=__span-42-7><a id=__codelineno-42-7 name=__codelineno-42-7></a><a href=#__codelineno-42-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>  </span><span class=c1># Push the container image to Container Registry</span>
</span><span id=__span-42-8><a id=__codelineno-42-8 name=__codelineno-42-8></a><a href=#__codelineno-42-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;gcr.io/cloud-builders/docker&#39;</span>
</span><span id=__span-42-9><a id=__codelineno-42-9 name=__codelineno-42-9></a><a href=#__codelineno-42-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>    </span><span class=nt>args</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&#39;push&#39;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&#39;gcr.io/$PROJECT_ID/agent-workflow:$COMMIT_SHA&#39;</span><span class="p p-Indicator">]</span>
</span><span id=__span-42-10><a id=__codelineno-42-10 name=__codelineno-42-10></a><a href=#__codelineno-42-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span>
</span><span id=__span-42-11><a id=__codelineno-42-11 name=__codelineno-42-11></a><a href=#__codelineno-42-11><span class=linenos data-linenos="11 "></span></a><span class=w>  </span><span class=c1># Deploy container image to Cloud Run</span>
</span><span id=__span-42-12><a id=__codelineno-42-12 name=__codelineno-42-12></a><a href=#__codelineno-42-12><span class=linenos data-linenos="12 "></span></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;gcr.io/google.com/cloudsdktool/cloud-sdk&#39;</span>
</span><span id=__span-42-13><a id=__codelineno-42-13 name=__codelineno-42-13></a><a href=#__codelineno-42-13><span class=linenos data-linenos="13 "></span></a><span class=w>    </span><span class=nt>entrypoint</span><span class=p>:</span><span class=w> </span><span class=s>&#39;gcloud&#39;</span>
</span><span id=__span-42-14><a id=__codelineno-42-14 name=__codelineno-42-14></a><a href=#__codelineno-42-14><span class=linenos data-linenos="14 "></span></a><span class=w>    </span><span class=nt>args</span><span class=p>:</span>
</span><span id=__span-42-15><a id=__codelineno-42-15 name=__codelineno-42-15></a><a href=#__codelineno-42-15><span class=linenos data-linenos="15 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;run&#39;</span>
</span><span id=__span-42-16><a id=__codelineno-42-16 name=__codelineno-42-16></a><a href=#__codelineno-42-16><span class=linenos data-linenos="16 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;deploy&#39;</span>
</span><span id=__span-42-17><a id=__codelineno-42-17 name=__codelineno-42-17></a><a href=#__codelineno-42-17><span class=linenos data-linenos="17 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;agent-workflow&#39;</span>
</span><span id=__span-42-18><a id=__codelineno-42-18 name=__codelineno-42-18></a><a href=#__codelineno-42-18><span class=linenos data-linenos="18 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--image=gcr.io/$PROJECT_ID/agent-workflow:$COMMIT_SHA&#39;</span>
</span><span id=__span-42-19><a id=__codelineno-42-19 name=__codelineno-42-19></a><a href=#__codelineno-42-19><span class=linenos data-linenos="19 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--region=us-central1&#39;</span>
</span><span id=__span-42-20><a id=__codelineno-42-20 name=__codelineno-42-20></a><a href=#__codelineno-42-20><span class=linenos data-linenos="20 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--platform=managed&#39;</span>
</span><span id=__span-42-21><a id=__codelineno-42-21 name=__codelineno-42-21></a><a href=#__codelineno-42-21><span class=linenos data-linenos="21 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--memory=2Gi&#39;</span>
</span><span id=__span-42-22><a id=__codelineno-42-22 name=__codelineno-42-22></a><a href=#__codelineno-42-22><span class=linenos data-linenos="22 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--cpu=2&#39;</span>
</span><span id=__span-42-23><a id=__codelineno-42-23 name=__codelineno-42-23></a><a href=#__codelineno-42-23><span class=linenos data-linenos="23 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--max-instances=10&#39;</span>
</span><span id=__span-42-24><a id=__codelineno-42-24 name=__codelineno-42-24></a><a href=#__codelineno-42-24><span class=linenos data-linenos="24 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--set-env-vars=ORCHESTRATOR_MODE=autonomous&#39;</span>
</span><span id=__span-42-25><a id=__codelineno-42-25 name=__codelineno-42-25></a><a href=#__codelineno-42-25><span class=linenos data-linenos="25 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--set-secrets=DISCORD_BOT_TOKEN=discord-token:latest&#39;</span>
</span><span id=__span-42-26><a id=__codelineno-42-26 name=__codelineno-42-26></a><a href=#__codelineno-42-26><span class=linenos data-linenos="26 "></span></a>
</span><span id=__span-42-27><a id=__codelineno-42-27 name=__codelineno-42-27></a><a href=#__codelineno-42-27><span class=linenos data-linenos="27 "></span></a><span class=nt>options</span><span class=p>:</span>
</span><span id=__span-42-28><a id=__codelineno-42-28 name=__codelineno-42-28></a><a href=#__codelineno-42-28><span class=linenos data-linenos="28 "></span></a><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CLOUD_LOGGING_ONLY</span>
</span></code></pre></div><h4 id=gcp-pubsub-integration>GCP Pub/Sub Integration<a class=headerlink href=#gcp-pubsub-integration title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1></a><a href=#__codelineno-43-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># gcp/pubsub_tdd_handler.py</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2></a><a href=#__codelineno-43-2><span class=linenos data-linenos=" 2 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>google.cloud</span><span class=w> </span><span class=kn>import</span> <span class=n>pubsub_v1</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3></a><a href=#__codelineno-43-3><span class=linenos data-linenos=" 3 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4></a><a href=#__codelineno-43-4><span class=linenos data-linenos=" 4 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>asyncio</span>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5></a><a href=#__codelineno-43-5><span class=linenos data-linenos=" 5 "></span></a>
</span><span id=__span-43-6><a id=__codelineno-43-6 name=__codelineno-43-6></a><a href=#__codelineno-43-6><span class=linenos data-linenos=" 6 "></span></a><span class=k>class</span><span class=w> </span><span class=nc>PubSubTDDHandler</span><span class=p>:</span>
</span><span id=__span-43-7><a id=__codelineno-43-7 name=__codelineno-43-7></a><a href=#__codelineno-43-7><span class=linenos data-linenos=" 7 "></span></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>project_id</span><span class=p>,</span> <span class=n>subscription_name</span><span class=p>):</span>
</span><span id=__span-43-8><a id=__codelineno-43-8 name=__codelineno-43-8></a><a href=#__codelineno-43-8><span class=linenos data-linenos=" 8 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>subscriber</span> <span class=o>=</span> <span class=n>pubsub_v1</span><span class=o>.</span><span class=n>SubscriberClient</span><span class=p>()</span>
</span><span id=__span-43-9><a id=__codelineno-43-9 name=__codelineno-43-9></a><a href=#__codelineno-43-9><span class=linenos data-linenos=" 9 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>subscription_path</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>subscriber</span><span class=o>.</span><span class=n>subscription_path</span><span class=p>(</span>
</span><span id=__span-43-10><a id=__codelineno-43-10 name=__codelineno-43-10></a><a href=#__codelineno-43-10><span class=linenos data-linenos="10 "></span></a>            <span class=n>project_id</span><span class=p>,</span> <span class=n>subscription_name</span>
</span><span id=__span-43-11><a id=__codelineno-43-11 name=__codelineno-43-11></a><a href=#__codelineno-43-11><span class=linenos data-linenos="11 "></span></a>        <span class=p>)</span>
</span><span id=__span-43-12><a id=__codelineno-43-12 name=__codelineno-43-12></a><a href=#__codelineno-43-12><span class=linenos data-linenos="12 "></span></a>        
</span><span id=__span-43-13><a id=__codelineno-43-13 name=__codelineno-43-13></a><a href=#__codelineno-43-13><span class=linenos data-linenos="13 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>start_listening</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-43-14><a id=__codelineno-43-14 name=__codelineno-43-14></a><a href=#__codelineno-43-14><span class=linenos data-linenos="14 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Start listening for TDD events&quot;&quot;&quot;</span>
</span><span id=__span-43-15><a id=__codelineno-43-15 name=__codelineno-43-15></a><a href=#__codelineno-43-15><span class=linenos data-linenos="15 "></span></a>        <span class=n>flow_control</span> <span class=o>=</span> <span class=n>pubsub_v1</span><span class=o>.</span><span class=n>types</span><span class=o>.</span><span class=n>FlowControl</span><span class=p>(</span><span class=n>max_messages</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
</span><span id=__span-43-16><a id=__codelineno-43-16 name=__codelineno-43-16></a><a href=#__codelineno-43-16><span class=linenos data-linenos="16 "></span></a>        
</span><span id=__span-43-17><a id=__codelineno-43-17 name=__codelineno-43-17></a><a href=#__codelineno-43-17><span class=linenos data-linenos="17 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>subscriber</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span>
</span><span id=__span-43-18><a id=__codelineno-43-18 name=__codelineno-43-18></a><a href=#__codelineno-43-18><span class=linenos data-linenos="18 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>subscription_path</span><span class=p>,</span>
</span><span id=__span-43-19><a id=__codelineno-43-19 name=__codelineno-43-19></a><a href=#__codelineno-43-19><span class=linenos data-linenos="19 "></span></a>            <span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>handle_message</span><span class=p>,</span>
</span><span id=__span-43-20><a id=__codelineno-43-20 name=__codelineno-43-20></a><a href=#__codelineno-43-20><span class=linenos data-linenos="20 "></span></a>            <span class=n>flow_control</span><span class=o>=</span><span class=n>flow_control</span>
</span><span id=__span-43-21><a id=__codelineno-43-21 name=__codelineno-43-21></a><a href=#__codelineno-43-21><span class=linenos data-linenos="21 "></span></a>        <span class=p>)</span>
</span><span id=__span-43-22><a id=__codelineno-43-22 name=__codelineno-43-22></a><a href=#__codelineno-43-22><span class=linenos data-linenos="22 "></span></a>        
</span><span id=__span-43-23><a id=__codelineno-43-23 name=__codelineno-43-23></a><a href=#__codelineno-43-23><span class=linenos data-linenos="23 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>handle_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span><span id=__span-43-24><a id=__codelineno-43-24 name=__codelineno-43-24></a><a href=#__codelineno-43-24><span class=linenos data-linenos="24 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Handle incoming TDD event message&quot;&quot;&quot;</span>
</span><span id=__span-43-25><a id=__codelineno-43-25 name=__codelineno-43-25></a><a href=#__codelineno-43-25><span class=linenos data-linenos="25 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-43-26><a id=__codelineno-43-26 name=__codelineno-43-26></a><a href=#__codelineno-43-26><span class=linenos data-linenos="26 "></span></a>            <span class=n>event</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span><span id=__span-43-27><a id=__codelineno-43-27 name=__codelineno-43-27></a><a href=#__codelineno-43-27><span class=linenos data-linenos="27 "></span></a>            
</span><span id=__span-43-28><a id=__codelineno-43-28 name=__codelineno-43-28></a><a href=#__codelineno-43-28><span class=linenos data-linenos="28 "></span></a>            <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;tdd_state_change&#39;</span><span class=p>:</span>
</span><span id=__span-43-29><a id=__codelineno-43-29 name=__codelineno-43-29></a><a href=#__codelineno-43-29><span class=linenos data-linenos="29 "></span></a>                <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>process_state_change</span><span class=p>(</span><span class=n>event</span><span class=p>))</span>
</span><span id=__span-43-30><a id=__codelineno-43-30 name=__codelineno-43-30></a><a href=#__codelineno-43-30><span class=linenos data-linenos="30 "></span></a>            <span class=k>elif</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;test_execution_complete&#39;</span><span class=p>:</span>
</span><span id=__span-43-31><a id=__codelineno-43-31 name=__codelineno-43-31></a><a href=#__codelineno-43-31><span class=linenos data-linenos="31 "></span></a>                <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>process_test_results</span><span class=p>(</span><span class=n>event</span><span class=p>))</span>
</span><span id=__span-43-32><a id=__codelineno-43-32 name=__codelineno-43-32></a><a href=#__codelineno-43-32><span class=linenos data-linenos="32 "></span></a>                
</span><span id=__span-43-33><a id=__codelineno-43-33 name=__codelineno-43-33></a><a href=#__codelineno-43-33><span class=linenos data-linenos="33 "></span></a>            <span class=n>message</span><span class=o>.</span><span class=n>ack</span><span class=p>()</span>
</span><span id=__span-43-34><a id=__codelineno-43-34 name=__codelineno-43-34></a><a href=#__codelineno-43-34><span class=linenos data-linenos="34 "></span></a>            
</span><span id=__span-43-35><a id=__codelineno-43-35 name=__codelineno-43-35></a><a href=#__codelineno-43-35><span class=linenos data-linenos="35 "></span></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-43-36><a id=__codelineno-43-36 name=__codelineno-43-36></a><a href=#__codelineno-43-36><span class=linenos data-linenos="36 "></span></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error processing message: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-43-37><a id=__codelineno-43-37 name=__codelineno-43-37></a><a href=#__codelineno-43-37><span class=linenos data-linenos="37 "></span></a>            <span class=n>message</span><span class=o>.</span><span class=n>nack</span><span class=p>()</span>
</span><span id=__span-43-38><a id=__codelineno-43-38 name=__codelineno-43-38></a><a href=#__codelineno-43-38><span class=linenos data-linenos="38 "></span></a>            
</span><span id=__span-43-39><a id=__codelineno-43-39 name=__codelineno-43-39></a><a href=#__codelineno-43-39><span class=linenos data-linenos="39 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>process_state_change</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span><span id=__span-43-40><a id=__codelineno-43-40 name=__codelineno-43-40></a><a href=#__codelineno-43-40><span class=linenos data-linenos="40 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Process TDD state change event&quot;&quot;&quot;</span>
</span><span id=__span-43-41><a id=__codelineno-43-41 name=__codelineno-43-41></a><a href=#__codelineno-43-41><span class=linenos data-linenos="41 "></span></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;TDD State Change: </span><span class=si>{</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;cycle_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> -&gt; </span><span class=si>{</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;new_state&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-43-42><a id=__codelineno-43-42 name=__codelineno-43-42></a><a href=#__codelineno-43-42><span class=linenos data-linenos="42 "></span></a>        
</span><span id=__span-43-43><a id=__codelineno-43-43 name=__codelineno-43-43></a><a href=#__codelineno-43-43><span class=linenos data-linenos="43 "></span></a>        <span class=c1># Update monitoring dashboards</span>
</span><span id=__span-43-44><a id=__codelineno-43-44 name=__codelineno-43-44></a><a href=#__codelineno-43-44><span class=linenos data-linenos="44 "></span></a>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>update_monitoring_metrics</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span><span id=__span-43-45><a id=__codelineno-43-45 name=__codelineno-43-45></a><a href=#__codelineno-43-45><span class=linenos data-linenos="45 "></span></a>        
</span><span id=__span-43-46><a id=__codelineno-43-46 name=__codelineno-43-46></a><a href=#__codelineno-43-46><span class=linenos data-linenos="46 "></span></a>        <span class=c1># Send notifications if needed</span>
</span><span id=__span-43-47><a id=__codelineno-43-47 name=__codelineno-43-47></a><a href=#__codelineno-43-47><span class=linenos data-linenos="47 "></span></a>        <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;new_state&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;BLOCKED&#39;</span><span class=p>:</span>
</span><span id=__span-43-48><a id=__codelineno-43-48 name=__codelineno-43-48></a><a href=#__codelineno-43-48><span class=linenos data-linenos="48 "></span></a>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>send_alert</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></code></pre></div><h2 id=monitoring-observability-integration>Monitoring &amp; Observability Integration<a class=headerlink href=#monitoring-observability-integration title="Permanent link">&para;</a></h2><h3 id=current-monitoring-integration>Current Monitoring Integration<a class=headerlink href=#current-monitoring-integration title="Permanent link">&para;</a></h3><p>The system provides basic monitoring capabilities that can be integrated with external systems:</p><h4 id=available-monitoring-endpoints>Available Monitoring Endpoints<a class=headerlink href=#available-monitoring-endpoints title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1></a><a href=#__codelineno-44-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># integration/monitoring_client.py</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2></a><a href=#__codelineno-44-2><span class=linenos data-linenos=" 2 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>requests</span>
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3></a><a href=#__codelineno-44-3><span class=linenos data-linenos=" 3 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-44-4><a id=__codelineno-44-4 name=__codelineno-44-4></a><a href=#__codelineno-44-4><span class=linenos data-linenos=" 4 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span>
</span><span id=__span-44-5><a id=__codelineno-44-5 name=__codelineno-44-5></a><a href=#__codelineno-44-5><span class=linenos data-linenos=" 5 "></span></a>
</span><span id=__span-44-6><a id=__codelineno-44-6 name=__codelineno-44-6></a><a href=#__codelineno-44-6><span class=linenos data-linenos=" 6 "></span></a><span class=k>class</span><span class=w> </span><span class=nc>MonitoringIntegration</span><span class=p>:</span>
</span><span id=__span-44-7><a id=__codelineno-44-7 name=__codelineno-44-7></a><a href=#__codelineno-44-7><span class=linenos data-linenos=" 7 "></span></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>visualizer_url</span><span class=o>=</span><span class=s2>&quot;http://localhost:5000&quot;</span><span class=p>):</span>
</span><span id=__span-44-8><a id=__codelineno-44-8 name=__codelineno-44-8></a><a href=#__codelineno-44-8><span class=linenos data-linenos=" 8 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>visualizer_url</span> <span class=o>=</span> <span class=n>visualizer_url</span>
</span><span id=__span-44-9><a id=__codelineno-44-9 name=__codelineno-44-9></a><a href=#__codelineno-44-9><span class=linenos data-linenos=" 9 "></span></a>    
</span><span id=__span-44-10><a id=__codelineno-44-10 name=__codelineno-44-10></a><a href=#__codelineno-44-10><span class=linenos data-linenos="10 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_system_health</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-44-11><a id=__codelineno-44-11 name=__codelineno-44-11></a><a href=#__codelineno-44-11><span class=linenos data-linenos="11 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get system health status&quot;&quot;&quot;</span>
</span><span id=__span-44-12><a id=__codelineno-44-12 name=__codelineno-44-12></a><a href=#__codelineno-44-12><span class=linenos data-linenos="12 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-44-13><a id=__codelineno-44-13 name=__codelineno-44-13></a><a href=#__codelineno-44-13><span class=linenos data-linenos="13 "></span></a>            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>visualizer_url</span><span class=si>}</span><span class=s2>/health&quot;</span><span class=p>)</span>
</span><span id=__span-44-14><a id=__codelineno-44-14 name=__codelineno-44-14></a><a href=#__codelineno-44-14><span class=linenos data-linenos="14 "></span></a>            <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-44-15><a id=__codelineno-44-15 name=__codelineno-44-15></a><a href=#__codelineno-44-15><span class=linenos data-linenos="15 "></span></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-44-16><a id=__codelineno-44-16 name=__codelineno-44-16></a><a href=#__codelineno-44-16><span class=linenos data-linenos="16 "></span></a>            <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;error&quot;</span><span class=p>,</span> <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}</span>
</span><span id=__span-44-17><a id=__codelineno-44-17 name=__codelineno-44-17></a><a href=#__codelineno-44-17><span class=linenos data-linenos="17 "></span></a>    
</span><span id=__span-44-18><a id=__codelineno-44-18 name=__codelineno-44-18></a><a href=#__codelineno-44-18><span class=linenos data-linenos="18 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_current_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-44-19><a id=__codelineno-44-19 name=__codelineno-44-19></a><a href=#__codelineno-44-19><span class=linenos data-linenos="19 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get current system metrics&quot;&quot;&quot;</span>
</span><span id=__span-44-20><a id=__codelineno-44-20 name=__codelineno-44-20></a><a href=#__codelineno-44-20><span class=linenos data-linenos="20 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-44-21><a id=__codelineno-44-21 name=__codelineno-44-21></a><a href=#__codelineno-44-21><span class=linenos data-linenos="21 "></span></a>            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>visualizer_url</span><span class=si>}</span><span class=s2>/metrics&quot;</span><span class=p>)</span>
</span><span id=__span-44-22><a id=__codelineno-44-22 name=__codelineno-44-22></a><a href=#__codelineno-44-22><span class=linenos data-linenos="22 "></span></a>            <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span>  <span class=c1># Prometheus format</span>
</span><span id=__span-44-23><a id=__codelineno-44-23 name=__codelineno-44-23></a><a href=#__codelineno-44-23><span class=linenos data-linenos="23 "></span></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-44-24><a id=__codelineno-44-24 name=__codelineno-44-24></a><a href=#__codelineno-44-24><span class=linenos data-linenos="24 "></span></a>            <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-44-25><a id=__codelineno-44-25 name=__codelineno-44-25></a><a href=#__codelineno-44-25><span class=linenos data-linenos="25 "></span></a>    
</span><span id=__span-44-26><a id=__codelineno-44-26 name=__codelineno-44-26></a><a href=#__codelineno-44-26><span class=linenos data-linenos="26 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_workflow_state</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-44-27><a id=__codelineno-44-27 name=__codelineno-44-27></a><a href=#__codelineno-44-27><span class=linenos data-linenos="27 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get current workflow state&quot;&quot;&quot;</span>
</span><span id=__span-44-28><a id=__codelineno-44-28 name=__codelineno-44-28></a><a href=#__codelineno-44-28><span class=linenos data-linenos="28 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-44-29><a id=__codelineno-44-29 name=__codelineno-44-29></a><a href=#__codelineno-44-29><span class=linenos data-linenos="29 "></span></a>            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>visualizer_url</span><span class=si>}</span><span class=s2>/api/state&quot;</span><span class=p>)</span>
</span><span id=__span-44-30><a id=__codelineno-44-30 name=__codelineno-44-30></a><a href=#__codelineno-44-30><span class=linenos data-linenos="30 "></span></a>            <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-44-31><a id=__codelineno-44-31 name=__codelineno-44-31></a><a href=#__codelineno-44-31><span class=linenos data-linenos="31 "></span></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-44-32><a id=__codelineno-44-32 name=__codelineno-44-32></a><a href=#__codelineno-44-32><span class=linenos data-linenos="32 "></span></a>            <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-44-33><a id=__codelineno-44-33 name=__codelineno-44-33></a><a href=#__codelineno-44-33><span class=linenos data-linenos="33 "></span></a>
</span><span id=__span-44-34><a id=__codelineno-44-34 name=__codelineno-44-34></a><a href=#__codelineno-44-34><span class=linenos data-linenos="34 "></span></a><span class=c1># Usage example</span>
</span><span id=__span-44-35><a id=__codelineno-44-35 name=__codelineno-44-35></a><a href=#__codelineno-44-35><span class=linenos data-linenos="35 "></span></a><span class=n>monitor</span> <span class=o>=</span> <span class=n>MonitoringIntegration</span><span class=p>()</span>
</span><span id=__span-44-36><a id=__codelineno-44-36 name=__codelineno-44-36></a><a href=#__codelineno-44-36><span class=linenos data-linenos="36 "></span></a><span class=n>health</span> <span class=o>=</span> <span class=n>monitor</span><span class=o>.</span><span class=n>get_system_health</span><span class=p>()</span>
</span><span id=__span-44-37><a id=__codelineno-44-37 name=__codelineno-44-37></a><a href=#__codelineno-44-37><span class=linenos data-linenos="37 "></span></a><span class=n>metrics</span> <span class=o>=</span> <span class=n>monitor</span><span class=o>.</span><span class=n>get_current_metrics</span><span class=p>()</span>
</span><span id=__span-44-38><a id=__codelineno-44-38 name=__codelineno-44-38></a><a href=#__codelineno-44-38><span class=linenos data-linenos="38 "></span></a><span class=n>state</span> <span class=o>=</span> <span class=n>monitor</span><span class=o>.</span><span class=n>get_workflow_state</span><span class=p>()</span>
</span></code></pre></div><h4 id=performance-data-export>Performance Data Export<a class=headerlink href=#performance-data-export title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1></a><a href=#__codelineno-45-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># monitoring/export_performance_data.py</span>
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2></a><a href=#__codelineno-45-2><span class=linenos data-linenos=" 2 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3></a><a href=#__codelineno-45-3><span class=linenos data-linenos=" 3 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>sys</span>
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4></a><a href=#__codelineno-45-4><span class=linenos data-linenos=" 4 "></span></a><span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;tools/monitoring&#39;</span><span class=p>)</span>
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5></a><a href=#__codelineno-45-5><span class=linenos data-linenos=" 5 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>performance_monitor</span><span class=w> </span><span class=kn>import</span> <span class=n>PerformanceMonitor</span>
</span><span id=__span-45-6><a id=__codelineno-45-6 name=__codelineno-45-6></a><a href=#__codelineno-45-6><span class=linenos data-linenos=" 6 "></span></a>
</span><span id=__span-45-7><a id=__codelineno-45-7 name=__codelineno-45-7></a><a href=#__codelineno-45-7><span class=linenos data-linenos=" 7 "></span></a><span class=k>class</span><span class=w> </span><span class=nc>PerformanceDataExporter</span><span class=p>:</span>
</span><span id=__span-45-8><a id=__codelineno-45-8 name=__codelineno-45-8></a><a href=#__codelineno-45-8><span class=linenos data-linenos=" 8 "></span></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-45-9><a id=__codelineno-45-9 name=__codelineno-45-9></a><a href=#__codelineno-45-9><span class=linenos data-linenos=" 9 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>monitor</span> <span class=o>=</span> <span class=n>PerformanceMonitor</span><span class=p>()</span>
</span><span id=__span-45-10><a id=__codelineno-45-10 name=__codelineno-45-10></a><a href=#__codelineno-45-10><span class=linenos data-linenos="10 "></span></a>    
</span><span id=__span-45-11><a id=__codelineno-45-11 name=__codelineno-45-11></a><a href=#__codelineno-45-11><span class=linenos data-linenos="11 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>export_to_json</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>output_file</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-45-12><a id=__codelineno-45-12 name=__codelineno-45-12></a><a href=#__codelineno-45-12><span class=linenos data-linenos="12 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Export performance data as JSON&quot;&quot;&quot;</span>
</span><span id=__span-45-13><a id=__codelineno-45-13 name=__codelineno-45-13></a><a href=#__codelineno-45-13><span class=linenos data-linenos="13 "></span></a>        <span class=n>status</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>monitor</span><span class=o>.</span><span class=n>get_current_status</span><span class=p>()</span>
</span><span id=__span-45-14><a id=__codelineno-45-14 name=__codelineno-45-14></a><a href=#__codelineno-45-14><span class=linenos data-linenos="14 "></span></a>        
</span><span id=__span-45-15><a id=__codelineno-45-15 name=__codelineno-45-15></a><a href=#__codelineno-45-15><span class=linenos data-linenos="15 "></span></a>        <span class=k>if</span> <span class=n>output_file</span><span class=p>:</span>
</span><span id=__span-45-16><a id=__codelineno-45-16 name=__codelineno-45-16></a><a href=#__codelineno-45-16><span class=linenos data-linenos="16 "></span></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>output_file</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-45-17><a id=__codelineno-45-17 name=__codelineno-45-17></a><a href=#__codelineno-45-17><span class=linenos data-linenos="17 "></span></a>                <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>status</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=nb>str</span><span class=p>)</span>
</span><span id=__span-45-18><a id=__codelineno-45-18 name=__codelineno-45-18></a><a href=#__codelineno-45-18><span class=linenos data-linenos="18 "></span></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-45-19><a id=__codelineno-45-19 name=__codelineno-45-19></a><a href=#__codelineno-45-19><span class=linenos data-linenos="19 "></span></a>            <span class=nb>print</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>status</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=nb>str</span><span class=p>))</span>
</span><span id=__span-45-20><a id=__codelineno-45-20 name=__codelineno-45-20></a><a href=#__codelineno-45-20><span class=linenos data-linenos="20 "></span></a>    
</span><span id=__span-45-21><a id=__codelineno-45-21 name=__codelineno-45-21></a><a href=#__codelineno-45-21><span class=linenos data-linenos="21 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>export_prometheus_format</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-45-22><a id=__codelineno-45-22 name=__codelineno-45-22></a><a href=#__codelineno-45-22><span class=linenos data-linenos="22 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Export basic metrics in Prometheus format&quot;&quot;&quot;</span>
</span><span id=__span-45-23><a id=__codelineno-45-23 name=__codelineno-45-23></a><a href=#__codelineno-45-23><span class=linenos data-linenos="23 "></span></a>        <span class=n>status</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>monitor</span><span class=o>.</span><span class=n>get_current_status</span><span class=p>()</span>
</span><span id=__span-45-24><a id=__codelineno-45-24 name=__codelineno-45-24></a><a href=#__codelineno-45-24><span class=linenos data-linenos="24 "></span></a>        
</span><span id=__span-45-25><a id=__codelineno-45-25 name=__codelineno-45-25></a><a href=#__codelineno-45-25><span class=linenos data-linenos="25 "></span></a>        <span class=k>if</span> <span class=n>status</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;status&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=s2>&quot;monitoring&quot;</span><span class=p>:</span>
</span><span id=__span-45-26><a id=__codelineno-45-26 name=__codelineno-45-26></a><a href=#__codelineno-45-26><span class=linenos data-linenos="26 "></span></a>            <span class=n>latest</span> <span class=o>=</span> <span class=n>status</span><span class=p>[</span><span class=s2>&quot;latest_snapshot&quot;</span><span class=p>]</span>
</span><span id=__span-45-27><a id=__codelineno-45-27 name=__codelineno-45-27></a><a href=#__codelineno-45-27><span class=linenos data-linenos="27 "></span></a>            
</span><span id=__span-45-28><a id=__codelineno-45-28 name=__codelineno-45-28></a><a href=#__codelineno-45-28><span class=linenos data-linenos="28 "></span></a>            <span class=n>metrics</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-45-29><a id=__codelineno-45-29 name=__codelineno-45-29></a><a href=#__codelineno-45-29><span class=linenos data-linenos="29 "></span></a>                <span class=sa>f</span><span class=s2>&quot;agent_workflow_cpu_usage </span><span class=si>{</span><span class=n>latest</span><span class=p>[</span><span class=s1>&#39;cpu_usage&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-45-30><a id=__codelineno-45-30 name=__codelineno-45-30></a><a href=#__codelineno-45-30><span class=linenos data-linenos="30 "></span></a>                <span class=sa>f</span><span class=s2>&quot;agent_workflow_memory_usage </span><span class=si>{</span><span class=n>latest</span><span class=p>[</span><span class=s1>&#39;memory_usage&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-45-31><a id=__codelineno-45-31 name=__codelineno-45-31></a><a href=#__codelineno-45-31><span class=linenos data-linenos="31 "></span></a>                <span class=sa>f</span><span class=s2>&quot;agent_workflow_disk_usage </span><span class=si>{</span><span class=n>latest</span><span class=p>[</span><span class=s1>&#39;disk_usage&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-45-32><a id=__codelineno-45-32 name=__codelineno-45-32></a><a href=#__codelineno-45-32><span class=linenos data-linenos="32 "></span></a>                <span class=sa>f</span><span class=s2>&quot;agent_workflow_active_processes </span><span class=si>{</span><span class=n>latest</span><span class=p>[</span><span class=s1>&#39;active_processes&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-45-33><a id=__codelineno-45-33 name=__codelineno-45-33></a><a href=#__codelineno-45-33><span class=linenos data-linenos="33 "></span></a>                <span class=sa>f</span><span class=s2>&quot;agent_workflow_monitoring_duration_minutes </span><span class=si>{</span><span class=n>status</span><span class=p>[</span><span class=s1>&#39;monitoring_duration_minutes&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-45-34><a id=__codelineno-45-34 name=__codelineno-45-34></a><a href=#__codelineno-45-34><span class=linenos data-linenos="34 "></span></a>            <span class=p>]</span>
</span><span id=__span-45-35><a id=__codelineno-45-35 name=__codelineno-45-35></a><a href=#__codelineno-45-35><span class=linenos data-linenos="35 "></span></a>            
</span><span id=__span-45-36><a id=__codelineno-45-36 name=__codelineno-45-36></a><a href=#__codelineno-45-36><span class=linenos data-linenos="36 "></span></a>            <span class=k>return</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>metrics</span><span class=p>)</span>
</span><span id=__span-45-37><a id=__codelineno-45-37 name=__codelineno-45-37></a><a href=#__codelineno-45-37><span class=linenos data-linenos="37 "></span></a>        
</span><span id=__span-45-38><a id=__codelineno-45-38 name=__codelineno-45-38></a><a href=#__codelineno-45-38><span class=linenos data-linenos="38 "></span></a>        <span class=k>return</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-45-39><a id=__codelineno-45-39 name=__codelineno-45-39></a><a href=#__codelineno-45-39><span class=linenos data-linenos="39 "></span></a>
</span><span id=__span-45-40><a id=__codelineno-45-40 name=__codelineno-45-40></a><a href=#__codelineno-45-40><span class=linenos data-linenos="40 "></span></a><span class=c1># Usage</span>
</span><span id=__span-45-41><a id=__codelineno-45-41 name=__codelineno-45-41></a><a href=#__codelineno-45-41><span class=linenos data-linenos="41 "></span></a><span class=n>exporter</span> <span class=o>=</span> <span class=n>PerformanceDataExporter</span><span class=p>()</span>
</span><span id=__span-45-42><a id=__codelineno-45-42 name=__codelineno-45-42></a><a href=#__codelineno-45-42><span class=linenos data-linenos="42 "></span></a><span class=n>exporter</span><span class=o>.</span><span class=n>export_to_json</span><span class=p>(</span><span class=s2>&quot;performance_data.json&quot;</span><span class=p>)</span>
</span><span id=__span-45-43><a id=__codelineno-45-43 name=__codelineno-45-43></a><a href=#__codelineno-45-43><span class=linenos data-linenos="43 "></span></a><span class=nb>print</span><span class=p>(</span><span class=n>exporter</span><span class=o>.</span><span class=n>export_prometheus_format</span><span class=p>())</span>
</span></code></pre></div><h4 id=log-based-monitoring-integration>Log-based Monitoring Integration<a class=headerlink href=#log-based-monitoring-integration title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1></a><a href=#__codelineno-46-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># monitoring/log_parser.py</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2></a><a href=#__codelineno-46-2><span class=linenos data-linenos=" 2 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>re</span>
</span><span id=__span-46-3><a id=__codelineno-46-3 name=__codelineno-46-3></a><a href=#__codelineno-46-3><span class=linenos data-linenos=" 3 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-46-4><a id=__codelineno-46-4 name=__codelineno-46-4></a><a href=#__codelineno-46-4><span class=linenos data-linenos=" 4 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>pathlib</span><span class=w> </span><span class=kn>import</span> <span class=n>Path</span>
</span><span id=__span-46-5><a id=__codelineno-46-5 name=__codelineno-46-5></a><a href=#__codelineno-46-5><span class=linenos data-linenos=" 5 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span>
</span><span id=__span-46-6><a id=__codelineno-46-6 name=__codelineno-46-6></a><a href=#__codelineno-46-6><span class=linenos data-linenos=" 6 "></span></a>
</span><span id=__span-46-7><a id=__codelineno-46-7 name=__codelineno-46-7></a><a href=#__codelineno-46-7><span class=linenos data-linenos=" 7 "></span></a><span class=k>class</span><span class=w> </span><span class=nc>LogMonitoringIntegration</span><span class=p>:</span>
</span><span id=__span-46-8><a id=__codelineno-46-8 name=__codelineno-46-8></a><a href=#__codelineno-46-8><span class=linenos data-linenos=" 8 "></span></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>log_directory</span><span class=o>=</span><span class=s2>&quot;.orch-monitoring&quot;</span><span class=p>):</span>
</span><span id=__span-46-9><a id=__codelineno-46-9 name=__codelineno-46-9></a><a href=#__codelineno-46-9><span class=linenos data-linenos=" 9 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>log_dir</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>log_directory</span><span class=p>)</span>
</span><span id=__span-46-10><a id=__codelineno-46-10 name=__codelineno-46-10></a><a href=#__codelineno-46-10><span class=linenos data-linenos="10 "></span></a>    
</span><span id=__span-46-11><a id=__codelineno-46-11 name=__codelineno-46-11></a><a href=#__codelineno-46-11><span class=linenos data-linenos="11 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>parse_performance_reports</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-46-12><a id=__codelineno-46-12 name=__codelineno-46-12></a><a href=#__codelineno-46-12><span class=linenos data-linenos="12 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Parse performance report files&quot;&quot;&quot;</span>
</span><span id=__span-46-13><a id=__codelineno-46-13 name=__codelineno-46-13></a><a href=#__codelineno-46-13><span class=linenos data-linenos="13 "></span></a>        <span class=n>reports</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-46-14><a id=__codelineno-46-14 name=__codelineno-46-14></a><a href=#__codelineno-46-14><span class=linenos data-linenos="14 "></span></a>        
</span><span id=__span-46-15><a id=__codelineno-46-15 name=__codelineno-46-15></a><a href=#__codelineno-46-15><span class=linenos data-linenos="15 "></span></a>        <span class=k>for</span> <span class=n>report_file</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>log_dir</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=s2>&quot;performance_report_*.json&quot;</span><span class=p>):</span>
</span><span id=__span-46-16><a id=__codelineno-46-16 name=__codelineno-46-16></a><a href=#__codelineno-46-16><span class=linenos data-linenos="16 "></span></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-46-17><a id=__codelineno-46-17 name=__codelineno-46-17></a><a href=#__codelineno-46-17><span class=linenos data-linenos="17 "></span></a>                <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>report_file</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-46-18><a id=__codelineno-46-18 name=__codelineno-46-18></a><a href=#__codelineno-46-18><span class=linenos data-linenos="18 "></span></a>                    <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span><span id=__span-46-19><a id=__codelineno-46-19 name=__codelineno-46-19></a><a href=#__codelineno-46-19><span class=linenos data-linenos="19 "></span></a>                    <span class=n>reports</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span><span id=__span-46-20><a id=__codelineno-46-20 name=__codelineno-46-20></a><a href=#__codelineno-46-20><span class=linenos data-linenos="20 "></span></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-46-21><a id=__codelineno-46-21 name=__codelineno-46-21></a><a href=#__codelineno-46-21><span class=linenos data-linenos="21 "></span></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error parsing </span><span class=si>{</span><span class=n>report_file</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-46-22><a id=__codelineno-46-22 name=__codelineno-46-22></a><a href=#__codelineno-46-22><span class=linenos data-linenos="22 "></span></a>        
</span><span id=__span-46-23><a id=__codelineno-46-23 name=__codelineno-46-23></a><a href=#__codelineno-46-23><span class=linenos data-linenos="23 "></span></a>        <span class=k>return</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>reports</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;generated_at&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>))</span>
</span><span id=__span-46-24><a id=__codelineno-46-24 name=__codelineno-46-24></a><a href=#__codelineno-46-24><span class=linenos data-linenos="24 "></span></a>    
</span><span id=__span-46-25><a id=__codelineno-46-25 name=__codelineno-46-25></a><a href=#__codelineno-46-25><span class=linenos data-linenos="25 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>extract_metrics_summary</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-46-26><a id=__codelineno-46-26 name=__codelineno-46-26></a><a href=#__codelineno-46-26><span class=linenos data-linenos="26 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Extract key metrics from reports&quot;&quot;&quot;</span>
</span><span id=__span-46-27><a id=__codelineno-46-27 name=__codelineno-46-27></a><a href=#__codelineno-46-27><span class=linenos data-linenos="27 "></span></a>        <span class=n>reports</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>parse_performance_reports</span><span class=p>()</span>
</span><span id=__span-46-28><a id=__codelineno-46-28 name=__codelineno-46-28></a><a href=#__codelineno-46-28><span class=linenos data-linenos="28 "></span></a>        
</span><span id=__span-46-29><a id=__codelineno-46-29 name=__codelineno-46-29></a><a href=#__codelineno-46-29><span class=linenos data-linenos="29 "></span></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>reports</span><span class=p>:</span>
</span><span id=__span-46-30><a id=__codelineno-46-30 name=__codelineno-46-30></a><a href=#__codelineno-46-30><span class=linenos data-linenos="30 "></span></a>            <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-46-31><a id=__codelineno-46-31 name=__codelineno-46-31></a><a href=#__codelineno-46-31><span class=linenos data-linenos="31 "></span></a>        
</span><span id=__span-46-32><a id=__codelineno-46-32 name=__codelineno-46-32></a><a href=#__codelineno-46-32><span class=linenos data-linenos="32 "></span></a>        <span class=n>latest</span> <span class=o>=</span> <span class=n>reports</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-46-33><a id=__codelineno-46-33 name=__codelineno-46-33></a><a href=#__codelineno-46-33><span class=linenos data-linenos="33 "></span></a>        <span class=n>summary</span> <span class=o>=</span> <span class=n>latest</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;summary&quot;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-46-34><a id=__codelineno-46-34 name=__codelineno-46-34></a><a href=#__codelineno-46-34><span class=linenos data-linenos="34 "></span></a>        
</span><span id=__span-46-35><a id=__codelineno-46-35 name=__codelineno-46-35></a><a href=#__codelineno-46-35><span class=linenos data-linenos="35 "></span></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-46-36><a id=__codelineno-46-36 name=__codelineno-46-36></a><a href=#__codelineno-46-36><span class=linenos data-linenos="36 "></span></a>            <span class=s2>&quot;timestamp&quot;</span><span class=p>:</span> <span class=n>latest</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;generated_at&quot;</span><span class=p>),</span>
</span><span id=__span-46-37><a id=__codelineno-46-37 name=__codelineno-46-37></a><a href=#__codelineno-46-37><span class=linenos data-linenos="37 "></span></a>            <span class=s2>&quot;cpu_avg&quot;</span><span class=p>:</span> <span class=n>summary</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;cpu_usage&quot;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;avg&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span><span id=__span-46-38><a id=__codelineno-46-38 name=__codelineno-46-38></a><a href=#__codelineno-46-38><span class=linenos data-linenos="38 "></span></a>            <span class=s2>&quot;memory_avg&quot;</span><span class=p>:</span> <span class=n>summary</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;memory_usage&quot;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;avg&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span><span id=__span-46-39><a id=__codelineno-46-39 name=__codelineno-46-39></a><a href=#__codelineno-46-39><span class=linenos data-linenos="39 "></span></a>            <span class=s2>&quot;alerts_triggered&quot;</span><span class=p>:</span> <span class=n>summary</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;alerts_triggered&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span><span id=__span-46-40><a id=__codelineno-46-40 name=__codelineno-46-40></a><a href=#__codelineno-46-40><span class=linenos data-linenos="40 "></span></a>            <span class=s2>&quot;snapshots_count&quot;</span><span class=p>:</span> <span class=n>latest</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;snapshots_count&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span><span id=__span-46-41><a id=__codelineno-46-41 name=__codelineno-46-41></a><a href=#__codelineno-46-41><span class=linenos data-linenos="41 "></span></a>        <span class=p>}</span>
</span><span id=__span-46-42><a id=__codelineno-46-42 name=__codelineno-46-42></a><a href=#__codelineno-46-42><span class=linenos data-linenos="42 "></span></a>
</span><span id=__span-46-43><a id=__codelineno-46-43 name=__codelineno-46-43></a><a href=#__codelineno-46-43><span class=linenos data-linenos="43 "></span></a><span class=c1># Usage</span>
</span><span id=__span-46-44><a id=__codelineno-46-44 name=__codelineno-46-44></a><a href=#__codelineno-46-44><span class=linenos data-linenos="44 "></span></a><span class=n>log_monitor</span> <span class=o>=</span> <span class=n>LogMonitoringIntegration</span><span class=p>()</span>
</span><span id=__span-46-45><a id=__codelineno-46-45 name=__codelineno-46-45></a><a href=#__codelineno-46-45><span class=linenos data-linenos="45 "></span></a><span class=n>metrics</span> <span class=o>=</span> <span class=n>log_monitor</span><span class=o>.</span><span class=n>extract_metrics_summary</span><span class=p>()</span>
</span></code></pre></div><h4 id=external-system-integration>External System Integration<a class=headerlink href=#external-system-integration title="Permanent link">&para;</a></h4><div class="language-bash highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1></a><a href=#__codelineno-47-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># scripts/export_metrics.sh</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2></a><a href=#__codelineno-47-2><span class=linenos data-linenos=" 2 "></span></a><span class=c1>#!/bin/bash</span>
</span><span id=__span-47-3><a id=__codelineno-47-3 name=__codelineno-47-3></a><a href=#__codelineno-47-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-47-4><a id=__codelineno-47-4 name=__codelineno-47-4></a><a href=#__codelineno-47-4><span class=linenos data-linenos=" 4 "></span></a><span class=c1># Export to external monitoring system</span>
</span><span id=__span-47-5><a id=__codelineno-47-5 name=__codelineno-47-5></a><a href=#__codelineno-47-5><span class=linenos data-linenos=" 5 "></span></a>python<span class=w> </span>tools/monitoring/performance_monitor.py<span class=w> </span>--report-only<span class=w> </span><span class=p>|</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-47-6><a id=__codelineno-47-6 name=__codelineno-47-6></a><a href=#__codelineno-47-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>  </span>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span><span class=s2>&quot;http://your-metrics-endpoint/api/metrics&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-47-7><a id=__codelineno-47-7 name=__codelineno-47-7></a><a href=#__codelineno-47-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Content-Type: application/json&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-47-8><a id=__codelineno-47-8 name=__codelineno-47-8></a><a href=#__codelineno-47-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>  </span>-d<span class=w> </span>@-
</span><span id=__span-47-9><a id=__codelineno-47-9 name=__codelineno-47-9></a><a href=#__codelineno-47-9><span class=linenos data-linenos=" 9 "></span></a>
</span><span id=__span-47-10><a id=__codelineno-47-10 name=__codelineno-47-10></a><a href=#__codelineno-47-10><span class=linenos data-linenos="10 "></span></a><span class=c1># Health check for external monitoring</span>
</span><span id=__span-47-11><a id=__codelineno-47-11 name=__codelineno-47-11></a><a href=#__codelineno-47-11><span class=linenos data-linenos="11 "></span></a>curl<span class=w> </span>-f<span class=w> </span>http://localhost:5000/health<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;OK&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;FAIL&quot;</span>
</span><span id=__span-47-12><a id=__codelineno-47-12 name=__codelineno-47-12></a><a href=#__codelineno-47-12><span class=linenos data-linenos="12 "></span></a>
</span><span id=__span-47-13><a id=__codelineno-47-13 name=__codelineno-47-13></a><a href=#__codelineno-47-13><span class=linenos data-linenos="13 "></span></a><span class=c1># Export logs to external log aggregator</span>
</span><span id=__span-47-14><a id=__codelineno-47-14 name=__codelineno-47-14></a><a href=#__codelineno-47-14><span class=linenos data-linenos="14 "></span></a>tail<span class=w> </span>-n<span class=w> </span><span class=m>100</span><span class=w> </span>logs/agent-workflow.log<span class=w> </span><span class=p>|</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-47-15><a id=__codelineno-47-15 name=__codelineno-47-15></a><a href=#__codelineno-47-15><span class=linenos data-linenos="15 "></span></a><span class=w>  </span>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span><span class=s2>&quot;http://your-log-endpoint/api/logs&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-47-16><a id=__codelineno-47-16 name=__codelineno-47-16></a><a href=#__codelineno-47-16><span class=linenos data-linenos="16 "></span></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Content-Type: text/plain&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-47-17><a id=__codelineno-47-17 name=__codelineno-47-17></a><a href=#__codelineno-47-17><span class=linenos data-linenos="17 "></span></a><span class=w>  </span>-d<span class=w> </span>@-
</span></code></pre></div><h3 id=future-advanced-monitoring>Future Advanced Monitoring<a class=headerlink href=#future-advanced-monitoring title="Permanent link">&para;</a></h3><p><strong>Note</strong>: Advanced monitoring integrations are planned but not yet implemented:</p><ul><li><strong>Prometheus/Grafana Stack</strong>: Full metrics collection and visualization</li><li><strong>ELK Stack Integration</strong>: Advanced log analysis and dashboards</li><li><strong>Custom Dashboard Framework</strong>: Real-time monitoring web interface</li><li><strong>Alert Management System</strong>: Comprehensive alerting with multiple channels</li><li><strong>Distributed Tracing</strong>: Request tracing across system components</li></ul><p><strong>Current Recommendation</strong>: Use the available basic monitoring for development and basic production monitoring. Integrate with existing monitoring infrastructure using the provided endpoints and export capabilities.</p><h2 id=notification-integration>Notification Integration<a class=headerlink href=#notification-integration title="Permanent link">&para;</a></h2><h3 id=slack-integration>Slack Integration<a class=headerlink href=#slack-integration title="Permanent link">&para;</a></h3><h4 id=slack-bot-configuration>Slack Bot Configuration<a class=headerlink href=#slack-bot-configuration title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1></a><a href=#__codelineno-48-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># integrations/slack_bot.py</span>
</span><span id=__span-48-2><a id=__codelineno-48-2 name=__codelineno-48-2></a><a href=#__codelineno-48-2><span class=linenos data-linenos=" 2 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>slack_bolt</span><span class=w> </span><span class=kn>import</span> <span class=n>App</span>
</span><span id=__span-48-3><a id=__codelineno-48-3 name=__codelineno-48-3></a><a href=#__codelineno-48-3><span class=linenos data-linenos=" 3 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>slack_bolt.adapter.socket_mode</span><span class=w> </span><span class=kn>import</span> <span class=n>SocketModeHandler</span>
</span><span id=__span-48-4><a id=__codelineno-48-4 name=__codelineno-48-4></a><a href=#__codelineno-48-4><span class=linenos data-linenos=" 4 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>asyncio</span>
</span><span id=__span-48-5><a id=__codelineno-48-5 name=__codelineno-48-5></a><a href=#__codelineno-48-5><span class=linenos data-linenos=" 5 "></span></a>
</span><span id=__span-48-6><a id=__codelineno-48-6 name=__codelineno-48-6></a><a href=#__codelineno-48-6><span class=linenos data-linenos=" 6 "></span></a><span class=k>class</span><span class=w> </span><span class=nc>SlackTDDBot</span><span class=p>:</span>
</span><span id=__span-48-7><a id=__codelineno-48-7 name=__codelineno-48-7></a><a href=#__codelineno-48-7><span class=linenos data-linenos=" 7 "></span></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bot_token</span><span class=p>,</span> <span class=n>app_token</span><span class=p>):</span>
</span><span id=__span-48-8><a id=__codelineno-48-8 name=__codelineno-48-8></a><a href=#__codelineno-48-8><span class=linenos data-linenos=" 8 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>app</span> <span class=o>=</span> <span class=n>App</span><span class=p>(</span><span class=n>token</span><span class=o>=</span><span class=n>bot_token</span><span class=p>)</span>
</span><span id=__span-48-9><a id=__codelineno-48-9 name=__codelineno-48-9></a><a href=#__codelineno-48-9><span class=linenos data-linenos=" 9 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>handler</span> <span class=o>=</span> <span class=n>SocketModeHandler</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>app</span><span class=p>,</span> <span class=n>app_token</span><span class=p>)</span>
</span><span id=__span-48-10><a id=__codelineno-48-10 name=__codelineno-48-10></a><a href=#__codelineno-48-10><span class=linenos data-linenos="10 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>setup_commands</span><span class=p>()</span>
</span><span id=__span-48-11><a id=__codelineno-48-11 name=__codelineno-48-11></a><a href=#__codelineno-48-11><span class=linenos data-linenos="11 "></span></a>        
</span><span id=__span-48-12><a id=__codelineno-48-12 name=__codelineno-48-12></a><a href=#__codelineno-48-12><span class=linenos data-linenos="12 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>setup_commands</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-48-13><a id=__codelineno-48-13 name=__codelineno-48-13></a><a href=#__codelineno-48-13><span class=linenos data-linenos="13 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Setup Slack slash commands&quot;&quot;&quot;</span>
</span><span id=__span-48-14><a id=__codelineno-48-14 name=__codelineno-48-14></a><a href=#__codelineno-48-14><span class=linenos data-linenos="14 "></span></a>        
</span><span id=__span-48-15><a id=__codelineno-48-15 name=__codelineno-48-15></a><a href=#__codelineno-48-15><span class=linenos data-linenos="15 "></span></a>        <span class=nd>@self</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>command</span><span class=p>(</span><span class=s2>&quot;/tdd-status&quot;</span><span class=p>)</span>
</span><span id=__span-48-16><a id=__codelineno-48-16 name=__codelineno-48-16></a><a href=#__codelineno-48-16><span class=linenos data-linenos="16 "></span></a>        <span class=k>def</span><span class=w> </span><span class=nf>handle_tdd_status</span><span class=p>(</span><span class=n>ack</span><span class=p>,</span> <span class=n>respond</span><span class=p>,</span> <span class=n>command</span><span class=p>):</span>
</span><span id=__span-48-17><a id=__codelineno-48-17 name=__codelineno-48-17></a><a href=#__codelineno-48-17><span class=linenos data-linenos="17 "></span></a>            <span class=n>ack</span><span class=p>()</span>
</span><span id=__span-48-18><a id=__codelineno-48-18 name=__codelineno-48-18></a><a href=#__codelineno-48-18><span class=linenos data-linenos="18 "></span></a>            
</span><span id=__span-48-19><a id=__codelineno-48-19 name=__codelineno-48-19></a><a href=#__codelineno-48-19><span class=linenos data-linenos="19 "></span></a>            <span class=n>project</span> <span class=o>=</span> <span class=n>command</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;text&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-48-20><a id=__codelineno-48-20 name=__codelineno-48-20></a><a href=#__codelineno-48-20><span class=linenos data-linenos="20 "></span></a>            <span class=n>status</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>get_tdd_status</span><span class=p>(</span><span class=n>project</span><span class=p>))</span>
</span><span id=__span-48-21><a id=__codelineno-48-21 name=__codelineno-48-21></a><a href=#__codelineno-48-21><span class=linenos data-linenos="21 "></span></a>            
</span><span id=__span-48-22><a id=__codelineno-48-22 name=__codelineno-48-22></a><a href=#__codelineno-48-22><span class=linenos data-linenos="22 "></span></a>            <span class=n>respond</span><span class=p>({</span>
</span><span id=__span-48-23><a id=__codelineno-48-23 name=__codelineno-48-23></a><a href=#__codelineno-48-23><span class=linenos data-linenos="23 "></span></a>                <span class=s2>&quot;response_type&quot;</span><span class=p>:</span> <span class=s2>&quot;in_channel&quot;</span><span class=p>,</span>
</span><span id=__span-48-24><a id=__codelineno-48-24 name=__codelineno-48-24></a><a href=#__codelineno-48-24><span class=linenos data-linenos="24 "></span></a>                <span class=s2>&quot;blocks&quot;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-48-25><a id=__codelineno-48-25 name=__codelineno-48-25></a><a href=#__codelineno-48-25><span class=linenos data-linenos="25 "></span></a>                    <span class=p>{</span>
</span><span id=__span-48-26><a id=__codelineno-48-26 name=__codelineno-48-26></a><a href=#__codelineno-48-26><span class=linenos data-linenos="26 "></span></a>                        <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;section&quot;</span><span class=p>,</span>
</span><span id=__span-48-27><a id=__codelineno-48-27 name=__codelineno-48-27></a><a href=#__codelineno-48-27><span class=linenos data-linenos="27 "></span></a>                        <span class=s2>&quot;text&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-48-28><a id=__codelineno-48-28 name=__codelineno-48-28></a><a href=#__codelineno-48-28><span class=linenos data-linenos="28 "></span></a>                            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;mrkdwn&quot;</span><span class=p>,</span>
</span><span id=__span-48-29><a id=__codelineno-48-29 name=__codelineno-48-29></a><a href=#__codelineno-48-29><span class=linenos data-linenos="29 "></span></a>                            <span class=s2>&quot;text&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;*TDD Status for </span><span class=si>{</span><span class=n>project</span><span class=si>}</span><span class=s2>*</span><span class=se>\n</span><span class=si>{</span><span class=n>status</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-48-30><a id=__codelineno-48-30 name=__codelineno-48-30></a><a href=#__codelineno-48-30><span class=linenos data-linenos="30 "></span></a>                        <span class=p>}</span>
</span><span id=__span-48-31><a id=__codelineno-48-31 name=__codelineno-48-31></a><a href=#__codelineno-48-31><span class=linenos data-linenos="31 "></span></a>                    <span class=p>}</span>
</span><span id=__span-48-32><a id=__codelineno-48-32 name=__codelineno-48-32></a><a href=#__codelineno-48-32><span class=linenos data-linenos="32 "></span></a>                <span class=p>]</span>
</span><span id=__span-48-33><a id=__codelineno-48-33 name=__codelineno-48-33></a><a href=#__codelineno-48-33><span class=linenos data-linenos="33 "></span></a>            <span class=p>})</span>
</span><span id=__span-48-34><a id=__codelineno-48-34 name=__codelineno-48-34></a><a href=#__codelineno-48-34><span class=linenos data-linenos="34 "></span></a>            
</span><span id=__span-48-35><a id=__codelineno-48-35 name=__codelineno-48-35></a><a href=#__codelineno-48-35><span class=linenos data-linenos="35 "></span></a>        <span class=nd>@self</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>command</span><span class=p>(</span><span class=s2>&quot;/tdd-metrics&quot;</span><span class=p>)</span>
</span><span id=__span-48-36><a id=__codelineno-48-36 name=__codelineno-48-36></a><a href=#__codelineno-48-36><span class=linenos data-linenos="36 "></span></a>        <span class=k>def</span><span class=w> </span><span class=nf>handle_tdd_metrics</span><span class=p>(</span><span class=n>ack</span><span class=p>,</span> <span class=n>respond</span><span class=p>,</span> <span class=n>command</span><span class=p>):</span>
</span><span id=__span-48-37><a id=__codelineno-48-37 name=__codelineno-48-37></a><a href=#__codelineno-48-37><span class=linenos data-linenos="37 "></span></a>            <span class=n>ack</span><span class=p>()</span>
</span><span id=__span-48-38><a id=__codelineno-48-38 name=__codelineno-48-38></a><a href=#__codelineno-48-38><span class=linenos data-linenos="38 "></span></a>            
</span><span id=__span-48-39><a id=__codelineno-48-39 name=__codelineno-48-39></a><a href=#__codelineno-48-39><span class=linenos data-linenos="39 "></span></a>            <span class=n>metrics</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>get_tdd_metrics</span><span class=p>())</span>
</span><span id=__span-48-40><a id=__codelineno-48-40 name=__codelineno-48-40></a><a href=#__codelineno-48-40><span class=linenos data-linenos="40 "></span></a>            
</span><span id=__span-48-41><a id=__codelineno-48-41 name=__codelineno-48-41></a><a href=#__codelineno-48-41><span class=linenos data-linenos="41 "></span></a>            <span class=n>respond</span><span class=p>({</span>
</span><span id=__span-48-42><a id=__codelineno-48-42 name=__codelineno-48-42></a><a href=#__codelineno-48-42><span class=linenos data-linenos="42 "></span></a>                <span class=s2>&quot;response_type&quot;</span><span class=p>:</span> <span class=s2>&quot;ephemeral&quot;</span><span class=p>,</span>
</span><span id=__span-48-43><a id=__codelineno-48-43 name=__codelineno-48-43></a><a href=#__codelineno-48-43><span class=linenos data-linenos="43 "></span></a>                <span class=s2>&quot;attachments&quot;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-48-44><a id=__codelineno-48-44 name=__codelineno-48-44></a><a href=#__codelineno-48-44><span class=linenos data-linenos="44 "></span></a>                    <span class=p>{</span>
</span><span id=__span-48-45><a id=__codelineno-48-45 name=__codelineno-48-45></a><a href=#__codelineno-48-45><span class=linenos data-linenos="45 "></span></a>                        <span class=s2>&quot;color&quot;</span><span class=p>:</span> <span class=s2>&quot;good&quot;</span><span class=p>,</span>
</span><span id=__span-48-46><a id=__codelineno-48-46 name=__codelineno-48-46></a><a href=#__codelineno-48-46><span class=linenos data-linenos="46 "></span></a>                        <span class=s2>&quot;title&quot;</span><span class=p>:</span> <span class=s2>&quot;TDD Metrics Dashboard&quot;</span><span class=p>,</span>
</span><span id=__span-48-47><a id=__codelineno-48-47 name=__codelineno-48-47></a><a href=#__codelineno-48-47><span class=linenos data-linenos="47 "></span></a>                        <span class=s2>&quot;fields&quot;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-48-48><a id=__codelineno-48-48 name=__codelineno-48-48></a><a href=#__codelineno-48-48><span class=linenos data-linenos="48 "></span></a>                            <span class=p>{</span>
</span><span id=__span-48-49><a id=__codelineno-48-49 name=__codelineno-48-49></a><a href=#__codelineno-48-49><span class=linenos data-linenos="49 "></span></a>                                <span class=s2>&quot;title&quot;</span><span class=p>:</span> <span class=s2>&quot;Active Cycles&quot;</span><span class=p>,</span>
</span><span id=__span-48-50><a id=__codelineno-48-50 name=__codelineno-48-50></a><a href=#__codelineno-48-50><span class=linenos data-linenos="50 "></span></a>                                <span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;active_cycles&#39;</span><span class=p>]),</span>
</span><span id=__span-48-51><a id=__codelineno-48-51 name=__codelineno-48-51></a><a href=#__codelineno-48-51><span class=linenos data-linenos="51 "></span></a>                                <span class=s2>&quot;short&quot;</span><span class=p>:</span> <span class=kc>True</span>
</span><span id=__span-48-52><a id=__codelineno-48-52 name=__codelineno-48-52></a><a href=#__codelineno-48-52><span class=linenos data-linenos="52 "></span></a>                            <span class=p>},</span>
</span><span id=__span-48-53><a id=__codelineno-48-53 name=__codelineno-48-53></a><a href=#__codelineno-48-53><span class=linenos data-linenos="53 "></span></a>                            <span class=p>{</span>
</span><span id=__span-48-54><a id=__codelineno-48-54 name=__codelineno-48-54></a><a href=#__codelineno-48-54><span class=linenos data-linenos="54 "></span></a>                                <span class=s2>&quot;title&quot;</span><span class=p>:</span> <span class=s2>&quot;Avg Cycle Time&quot;</span><span class=p>,</span>
</span><span id=__span-48-55><a id=__codelineno-48-55 name=__codelineno-48-55></a><a href=#__codelineno-48-55><span class=linenos data-linenos="55 "></span></a>                                <span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>metrics</span><span class=p>[</span><span class=s1>&#39;avg_cycle_time&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2> min&quot;</span><span class=p>,</span>
</span><span id=__span-48-56><a id=__codelineno-48-56 name=__codelineno-48-56></a><a href=#__codelineno-48-56><span class=linenos data-linenos="56 "></span></a>                                <span class=s2>&quot;short&quot;</span><span class=p>:</span> <span class=kc>True</span>
</span><span id=__span-48-57><a id=__codelineno-48-57 name=__codelineno-48-57></a><a href=#__codelineno-48-57><span class=linenos data-linenos="57 "></span></a>                            <span class=p>}</span>
</span><span id=__span-48-58><a id=__codelineno-48-58 name=__codelineno-48-58></a><a href=#__codelineno-48-58><span class=linenos data-linenos="58 "></span></a>                        <span class=p>]</span>
</span><span id=__span-48-59><a id=__codelineno-48-59 name=__codelineno-48-59></a><a href=#__codelineno-48-59><span class=linenos data-linenos="59 "></span></a>                    <span class=p>}</span>
</span><span id=__span-48-60><a id=__codelineno-48-60 name=__codelineno-48-60></a><a href=#__codelineno-48-60><span class=linenos data-linenos="60 "></span></a>                <span class=p>]</span>
</span><span id=__span-48-61><a id=__codelineno-48-61 name=__codelineno-48-61></a><a href=#__codelineno-48-61><span class=linenos data-linenos="61 "></span></a>            <span class=p>})</span>
</span><span id=__span-48-62><a id=__codelineno-48-62 name=__codelineno-48-62></a><a href=#__codelineno-48-62><span class=linenos data-linenos="62 "></span></a>            
</span><span id=__span-48-63><a id=__codelineno-48-63 name=__codelineno-48-63></a><a href=#__codelineno-48-63><span class=linenos data-linenos="63 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>send_tdd_notification</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>channel</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span><span id=__span-48-64><a id=__codelineno-48-64 name=__codelineno-48-64></a><a href=#__codelineno-48-64><span class=linenos data-linenos="64 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Send TDD event notification to Slack&quot;&quot;&quot;</span>
</span><span id=__span-48-65><a id=__codelineno-48-65 name=__codelineno-48-65></a><a href=#__codelineno-48-65><span class=linenos data-linenos="65 "></span></a>        <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;cycle_completed&#39;</span><span class=p>:</span>
</span><span id=__span-48-66><a id=__codelineno-48-66 name=__codelineno-48-66></a><a href=#__codelineno-48-66><span class=linenos data-linenos="66 "></span></a>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>send_cycle_completion</span><span class=p>(</span><span class=n>channel</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
</span><span id=__span-48-67><a id=__codelineno-48-67 name=__codelineno-48-67></a><a href=#__codelineno-48-67><span class=linenos data-linenos="67 "></span></a>        <span class=k>elif</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;cycle_blocked&#39;</span><span class=p>:</span>
</span><span id=__span-48-68><a id=__codelineno-48-68 name=__codelineno-48-68></a><a href=#__codelineno-48-68><span class=linenos data-linenos="68 "></span></a>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>send_cycle_blocked</span><span class=p>(</span><span class=n>channel</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
</span><span id=__span-48-69><a id=__codelineno-48-69 name=__codelineno-48-69></a><a href=#__codelineno-48-69><span class=linenos data-linenos="69 "></span></a>            
</span><span id=__span-48-70><a id=__codelineno-48-70 name=__codelineno-48-70></a><a href=#__codelineno-48-70><span class=linenos data-linenos="70 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>send_cycle_completion</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>channel</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span><span id=__span-48-71><a id=__codelineno-48-71 name=__codelineno-48-71></a><a href=#__codelineno-48-71><span class=linenos data-linenos="71 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Send cycle completion notification&quot;&quot;&quot;</span>
</span><span id=__span-48-72><a id=__codelineno-48-72 name=__codelineno-48-72></a><a href=#__codelineno-48-72><span class=linenos data-linenos="72 "></span></a>        <span class=n>cycle</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;cycle&#39;</span><span class=p>]</span>
</span><span id=__span-48-73><a id=__codelineno-48-73 name=__codelineno-48-73></a><a href=#__codelineno-48-73><span class=linenos data-linenos="73 "></span></a>        
</span><span id=__span-48-74><a id=__codelineno-48-74 name=__codelineno-48-74></a><a href=#__codelineno-48-74><span class=linenos data-linenos="74 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>chat_postMessage</span><span class=p>(</span>
</span><span id=__span-48-75><a id=__codelineno-48-75 name=__codelineno-48-75></a><a href=#__codelineno-48-75><span class=linenos data-linenos="75 "></span></a>            <span class=n>channel</span><span class=o>=</span><span class=n>channel</span><span class=p>,</span>
</span><span id=__span-48-76><a id=__codelineno-48-76 name=__codelineno-48-76></a><a href=#__codelineno-48-76><span class=linenos data-linenos="76 "></span></a>            <span class=n>blocks</span><span class=o>=</span><span class=p>[</span>
</span><span id=__span-48-77><a id=__codelineno-48-77 name=__codelineno-48-77></a><a href=#__codelineno-48-77><span class=linenos data-linenos="77 "></span></a>                <span class=p>{</span>
</span><span id=__span-48-78><a id=__codelineno-48-78 name=__codelineno-48-78></a><a href=#__codelineno-48-78><span class=linenos data-linenos="78 "></span></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;section&quot;</span><span class=p>,</span>
</span><span id=__span-48-79><a id=__codelineno-48-79 name=__codelineno-48-79></a><a href=#__codelineno-48-79><span class=linenos data-linenos="79 "></span></a>                    <span class=s2>&quot;text&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-48-80><a id=__codelineno-48-80 name=__codelineno-48-80></a><a href=#__codelineno-48-80><span class=linenos data-linenos="80 "></span></a>                        <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;mrkdwn&quot;</span><span class=p>,</span>
</span><span id=__span-48-81><a id=__codelineno-48-81 name=__codelineno-48-81></a><a href=#__codelineno-48-81><span class=linenos data-linenos="81 "></span></a>                        <span class=s2>&quot;text&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;🎉 *TDD Cycle Completed*</span><span class=se>\n</span><span class=s2>&quot;</span>
</span><span id=__span-48-82><a id=__codelineno-48-82 name=__codelineno-48-82></a><a href=#__codelineno-48-82><span class=linenos data-linenos="82 "></span></a>                               <span class=sa>f</span><span class=s2>&quot;*Story:* </span><span class=si>{</span><span class=n>cycle</span><span class=p>[</span><span class=s1>&#39;story_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=se>\n</span><span class=s2>&quot;</span>
</span><span id=__span-48-83><a id=__codelineno-48-83 name=__codelineno-48-83></a><a href=#__codelineno-48-83><span class=linenos data-linenos="83 "></span></a>                               <span class=sa>f</span><span class=s2>&quot;*Duration:* </span><span class=si>{</span><span class=n>cycle</span><span class=p>[</span><span class=s1>&#39;duration&#39;</span><span class=p>]</span><span class=si>}</span><span class=se>\n</span><span class=s2>&quot;</span>
</span><span id=__span-48-84><a id=__codelineno-48-84 name=__codelineno-48-84></a><a href=#__codelineno-48-84><span class=linenos data-linenos="84 "></span></a>                               <span class=sa>f</span><span class=s2>&quot;*Coverage:* </span><span class=si>{</span><span class=n>cycle</span><span class=p>[</span><span class=s1>&#39;coverage&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%&quot;</span>
</span><span id=__span-48-85><a id=__codelineno-48-85 name=__codelineno-48-85></a><a href=#__codelineno-48-85><span class=linenos data-linenos="85 "></span></a>                    <span class=p>}</span>
</span><span id=__span-48-86><a id=__codelineno-48-86 name=__codelineno-48-86></a><a href=#__codelineno-48-86><span class=linenos data-linenos="86 "></span></a>                <span class=p>},</span>
</span><span id=__span-48-87><a id=__codelineno-48-87 name=__codelineno-48-87></a><a href=#__codelineno-48-87><span class=linenos data-linenos="87 "></span></a>                <span class=p>{</span>
</span><span id=__span-48-88><a id=__codelineno-48-88 name=__codelineno-48-88></a><a href=#__codelineno-48-88><span class=linenos data-linenos="88 "></span></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;actions&quot;</span><span class=p>,</span>
</span><span id=__span-48-89><a id=__codelineno-48-89 name=__codelineno-48-89></a><a href=#__codelineno-48-89><span class=linenos data-linenos="89 "></span></a>                    <span class=s2>&quot;elements&quot;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-48-90><a id=__codelineno-48-90 name=__codelineno-48-90></a><a href=#__codelineno-48-90><span class=linenos data-linenos="90 "></span></a>                        <span class=p>{</span>
</span><span id=__span-48-91><a id=__codelineno-48-91 name=__codelineno-48-91></a><a href=#__codelineno-48-91><span class=linenos data-linenos="91 "></span></a>                            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;button&quot;</span><span class=p>,</span>
</span><span id=__span-48-92><a id=__codelineno-48-92 name=__codelineno-48-92></a><a href=#__codelineno-48-92><span class=linenos data-linenos="92 "></span></a>                            <span class=s2>&quot;text&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;plain_text&quot;</span><span class=p>,</span> <span class=s2>&quot;text&quot;</span><span class=p>:</span> <span class=s2>&quot;View Details&quot;</span><span class=p>},</span>
</span><span id=__span-48-93><a id=__codelineno-48-93 name=__codelineno-48-93></a><a href=#__codelineno-48-93><span class=linenos data-linenos="93 "></span></a>                            <span class=s2>&quot;url&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;https://dashboard.example.com/tdd/</span><span class=si>{</span><span class=n>cycle</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-48-94><a id=__codelineno-48-94 name=__codelineno-48-94></a><a href=#__codelineno-48-94><span class=linenos data-linenos="94 "></span></a>                        <span class=p>}</span>
</span><span id=__span-48-95><a id=__codelineno-48-95 name=__codelineno-48-95></a><a href=#__codelineno-48-95><span class=linenos data-linenos="95 "></span></a>                    <span class=p>]</span>
</span><span id=__span-48-96><a id=__codelineno-48-96 name=__codelineno-48-96></a><a href=#__codelineno-48-96><span class=linenos data-linenos="96 "></span></a>                <span class=p>}</span>
</span><span id=__span-48-97><a id=__codelineno-48-97 name=__codelineno-48-97></a><a href=#__codelineno-48-97><span class=linenos data-linenos="97 "></span></a>            <span class=p>]</span>
</span><span id=__span-48-98><a id=__codelineno-48-98 name=__codelineno-48-98></a><a href=#__codelineno-48-98><span class=linenos data-linenos="98 "></span></a>        <span class=p>)</span>
</span></code></pre></div><h3 id=microsoft-teams-integration>Microsoft Teams Integration<a class=headerlink href=#microsoft-teams-integration title="Permanent link">&para;</a></h3><h4 id=teams-webhook-integration>Teams Webhook Integration<a class=headerlink href=#teams-webhook-integration title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1></a><a href=#__codelineno-49-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># integrations/teams_webhook.py</span>
</span><span id=__span-49-2><a id=__codelineno-49-2 name=__codelineno-49-2></a><a href=#__codelineno-49-2><span class=linenos data-linenos=" 2 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>aiohttp</span>
</span><span id=__span-49-3><a id=__codelineno-49-3 name=__codelineno-49-3></a><a href=#__codelineno-49-3><span class=linenos data-linenos=" 3 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-49-4><a id=__codelineno-49-4 name=__codelineno-49-4></a><a href=#__codelineno-49-4><span class=linenos data-linenos=" 4 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span>
</span><span id=__span-49-5><a id=__codelineno-49-5 name=__codelineno-49-5></a><a href=#__codelineno-49-5><span class=linenos data-linenos=" 5 "></span></a>
</span><span id=__span-49-6><a id=__codelineno-49-6 name=__codelineno-49-6></a><a href=#__codelineno-49-6><span class=linenos data-linenos=" 6 "></span></a><span class=k>class</span><span class=w> </span><span class=nc>TeamsWebhookNotifier</span><span class=p>:</span>
</span><span id=__span-49-7><a id=__codelineno-49-7 name=__codelineno-49-7></a><a href=#__codelineno-49-7><span class=linenos data-linenos=" 7 "></span></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>webhook_url</span><span class=p>):</span>
</span><span id=__span-49-8><a id=__codelineno-49-8 name=__codelineno-49-8></a><a href=#__codelineno-49-8><span class=linenos data-linenos=" 8 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>webhook_url</span> <span class=o>=</span> <span class=n>webhook_url</span>
</span><span id=__span-49-9><a id=__codelineno-49-9 name=__codelineno-49-9></a><a href=#__codelineno-49-9><span class=linenos data-linenos=" 9 "></span></a>        
</span><span id=__span-49-10><a id=__codelineno-49-10 name=__codelineno-49-10></a><a href=#__codelineno-49-10><span class=linenos data-linenos="10 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>send_tdd_update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span><span id=__span-49-11><a id=__codelineno-49-11 name=__codelineno-49-11></a><a href=#__codelineno-49-11><span class=linenos data-linenos="11 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Send TDD update to Microsoft Teams&quot;&quot;&quot;</span>
</span><span id=__span-49-12><a id=__codelineno-49-12 name=__codelineno-49-12></a><a href=#__codelineno-49-12><span class=linenos data-linenos="12 "></span></a>        <span class=n>card</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_adaptive_card</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span><span id=__span-49-13><a id=__codelineno-49-13 name=__codelineno-49-13></a><a href=#__codelineno-49-13><span class=linenos data-linenos="13 "></span></a>        
</span><span id=__span-49-14><a id=__codelineno-49-14 name=__codelineno-49-14></a><a href=#__codelineno-49-14><span class=linenos data-linenos="14 "></span></a>        <span class=k>async</span> <span class=k>with</span> <span class=n>aiohttp</span><span class=o>.</span><span class=n>ClientSession</span><span class=p>()</span> <span class=k>as</span> <span class=n>session</span><span class=p>:</span>
</span><span id=__span-49-15><a id=__codelineno-49-15 name=__codelineno-49-15></a><a href=#__codelineno-49-15><span class=linenos data-linenos="15 "></span></a>            <span class=k>async</span> <span class=k>with</span> <span class=n>session</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span><span id=__span-49-16><a id=__codelineno-49-16 name=__codelineno-49-16></a><a href=#__codelineno-49-16><span class=linenos data-linenos="16 "></span></a>                <span class=bp>self</span><span class=o>.</span><span class=n>webhook_url</span><span class=p>,</span>
</span><span id=__span-49-17><a id=__codelineno-49-17 name=__codelineno-49-17></a><a href=#__codelineno-49-17><span class=linenos data-linenos="17 "></span></a>                <span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>:</span> <span class=s1>&#39;application/json&#39;</span><span class=p>},</span>
</span><span id=__span-49-18><a id=__codelineno-49-18 name=__codelineno-49-18></a><a href=#__codelineno-49-18><span class=linenos data-linenos="18 "></span></a>                <span class=n>data</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>card</span><span class=p>)</span>
</span><span id=__span-49-19><a id=__codelineno-49-19 name=__codelineno-49-19></a><a href=#__codelineno-49-19><span class=linenos data-linenos="19 "></span></a>            <span class=p>)</span> <span class=k>as</span> <span class=n>response</span><span class=p>:</span>
</span><span id=__span-49-20><a id=__codelineno-49-20 name=__codelineno-49-20></a><a href=#__codelineno-49-20><span class=linenos data-linenos="20 "></span></a>                <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>status</span> <span class=o>==</span> <span class=mi>200</span>
</span><span id=__span-49-21><a id=__codelineno-49-21 name=__codelineno-49-21></a><a href=#__codelineno-49-21><span class=linenos data-linenos="21 "></span></a>                
</span><span id=__span-49-22><a id=__codelineno-49-22 name=__codelineno-49-22></a><a href=#__codelineno-49-22><span class=linenos data-linenos="22 "></span></a>    <span class=k>def</span><span class=w> </span><span class=nf>create_adaptive_card</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span><span id=__span-49-23><a id=__codelineno-49-23 name=__codelineno-49-23></a><a href=#__codelineno-49-23><span class=linenos data-linenos="23 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create Adaptive Card for TDD event&quot;&quot;&quot;</span>
</span><span id=__span-49-24><a id=__codelineno-49-24 name=__codelineno-49-24></a><a href=#__codelineno-49-24><span class=linenos data-linenos="24 "></span></a>        <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;state_transition&#39;</span><span class=p>:</span>
</span><span id=__span-49-25><a id=__codelineno-49-25 name=__codelineno-49-25></a><a href=#__codelineno-49-25><span class=linenos data-linenos="25 "></span></a>            <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-49-26><a id=__codelineno-49-26 name=__codelineno-49-26></a><a href=#__codelineno-49-26><span class=linenos data-linenos="26 "></span></a>                <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;message&quot;</span><span class=p>,</span>
</span><span id=__span-49-27><a id=__codelineno-49-27 name=__codelineno-49-27></a><a href=#__codelineno-49-27><span class=linenos data-linenos="27 "></span></a>                <span class=s2>&quot;attachments&quot;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-49-28><a id=__codelineno-49-28 name=__codelineno-49-28></a><a href=#__codelineno-49-28><span class=linenos data-linenos="28 "></span></a>                    <span class=p>{</span>
</span><span id=__span-49-29><a id=__codelineno-49-29 name=__codelineno-49-29></a><a href=#__codelineno-49-29><span class=linenos data-linenos="29 "></span></a>                        <span class=s2>&quot;contentType&quot;</span><span class=p>:</span> <span class=s2>&quot;application/vnd.microsoft.card.adaptive&quot;</span><span class=p>,</span>
</span><span id=__span-49-30><a id=__codelineno-49-30 name=__codelineno-49-30></a><a href=#__codelineno-49-30><span class=linenos data-linenos="30 "></span></a>                        <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-49-31><a id=__codelineno-49-31 name=__codelineno-49-31></a><a href=#__codelineno-49-31><span class=linenos data-linenos="31 "></span></a>                            <span class=s2>&quot;$schema&quot;</span><span class=p>:</span> <span class=s2>&quot;http://adaptivecards.io/schemas/adaptive-card.json&quot;</span><span class=p>,</span>
</span><span id=__span-49-32><a id=__codelineno-49-32 name=__codelineno-49-32></a><a href=#__codelineno-49-32><span class=linenos data-linenos="32 "></span></a>                            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;AdaptiveCard&quot;</span><span class=p>,</span>
</span><span id=__span-49-33><a id=__codelineno-49-33 name=__codelineno-49-33></a><a href=#__codelineno-49-33><span class=linenos data-linenos="33 "></span></a>                            <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=s2>&quot;1.0&quot;</span><span class=p>,</span>
</span><span id=__span-49-34><a id=__codelineno-49-34 name=__codelineno-49-34></a><a href=#__codelineno-49-34><span class=linenos data-linenos="34 "></span></a>                            <span class=s2>&quot;body&quot;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-49-35><a id=__codelineno-49-35 name=__codelineno-49-35></a><a href=#__codelineno-49-35><span class=linenos data-linenos="35 "></span></a>                                <span class=p>{</span>
</span><span id=__span-49-36><a id=__codelineno-49-36 name=__codelineno-49-36></a><a href=#__codelineno-49-36><span class=linenos data-linenos="36 "></span></a>                                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;TextBlock&quot;</span><span class=p>,</span>
</span><span id=__span-49-37><a id=__codelineno-49-37 name=__codelineno-49-37></a><a href=#__codelineno-49-37><span class=linenos data-linenos="37 "></span></a>                                    <span class=s2>&quot;text&quot;</span><span class=p>:</span> <span class=s2>&quot;TDD State Transition&quot;</span><span class=p>,</span>
</span><span id=__span-49-38><a id=__codelineno-49-38 name=__codelineno-49-38></a><a href=#__codelineno-49-38><span class=linenos data-linenos="38 "></span></a>                                    <span class=s2>&quot;weight&quot;</span><span class=p>:</span> <span class=s2>&quot;bolder&quot;</span><span class=p>,</span>
</span><span id=__span-49-39><a id=__codelineno-49-39 name=__codelineno-49-39></a><a href=#__codelineno-49-39><span class=linenos data-linenos="39 "></span></a>                                    <span class=s2>&quot;size&quot;</span><span class=p>:</span> <span class=s2>&quot;medium&quot;</span>
</span><span id=__span-49-40><a id=__codelineno-49-40 name=__codelineno-49-40></a><a href=#__codelineno-49-40><span class=linenos data-linenos="40 "></span></a>                                <span class=p>},</span>
</span><span id=__span-49-41><a id=__codelineno-49-41 name=__codelineno-49-41></a><a href=#__codelineno-49-41><span class=linenos data-linenos="41 "></span></a>                                <span class=p>{</span>
</span><span id=__span-49-42><a id=__codelineno-49-42 name=__codelineno-49-42></a><a href=#__codelineno-49-42><span class=linenos data-linenos="42 "></span></a>                                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;FactSet&quot;</span><span class=p>,</span>
</span><span id=__span-49-43><a id=__codelineno-49-43 name=__codelineno-49-43></a><a href=#__codelineno-49-43><span class=linenos data-linenos="43 "></span></a>                                    <span class=s2>&quot;facts&quot;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-49-44><a id=__codelineno-49-44 name=__codelineno-49-44></a><a href=#__codelineno-49-44><span class=linenos data-linenos="44 "></span></a>                                        <span class=p>{</span>
</span><span id=__span-49-45><a id=__codelineno-49-45 name=__codelineno-49-45></a><a href=#__codelineno-49-45><span class=linenos data-linenos="45 "></span></a>                                            <span class=s2>&quot;title&quot;</span><span class=p>:</span> <span class=s2>&quot;Story:&quot;</span><span class=p>,</span>
</span><span id=__span-49-46><a id=__codelineno-49-46 name=__codelineno-49-46></a><a href=#__codelineno-49-46><span class=linenos data-linenos="46 "></span></a>                                            <span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;story_id&#39;</span><span class=p>]</span>
</span><span id=__span-49-47><a id=__codelineno-49-47 name=__codelineno-49-47></a><a href=#__codelineno-49-47><span class=linenos data-linenos="47 "></span></a>                                        <span class=p>},</span>
</span><span id=__span-49-48><a id=__codelineno-49-48 name=__codelineno-49-48></a><a href=#__codelineno-49-48><span class=linenos data-linenos="48 "></span></a>                                        <span class=p>{</span>
</span><span id=__span-49-49><a id=__codelineno-49-49 name=__codelineno-49-49></a><a href=#__codelineno-49-49><span class=linenos data-linenos="49 "></span></a>                                            <span class=s2>&quot;title&quot;</span><span class=p>:</span> <span class=s2>&quot;From:&quot;</span><span class=p>,</span>
</span><span id=__span-49-50><a id=__codelineno-49-50 name=__codelineno-49-50></a><a href=#__codelineno-49-50><span class=linenos data-linenos="50 "></span></a>                                            <span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;old_state&#39;</span><span class=p>]</span>
</span><span id=__span-49-51><a id=__codelineno-49-51 name=__codelineno-49-51></a><a href=#__codelineno-49-51><span class=linenos data-linenos="51 "></span></a>                                        <span class=p>},</span>
</span><span id=__span-49-52><a id=__codelineno-49-52 name=__codelineno-49-52></a><a href=#__codelineno-49-52><span class=linenos data-linenos="52 "></span></a>                                        <span class=p>{</span>
</span><span id=__span-49-53><a id=__codelineno-49-53 name=__codelineno-49-53></a><a href=#__codelineno-49-53><span class=linenos data-linenos="53 "></span></a>                                            <span class=s2>&quot;title&quot;</span><span class=p>:</span> <span class=s2>&quot;To:&quot;</span><span class=p>,</span>
</span><span id=__span-49-54><a id=__codelineno-49-54 name=__codelineno-49-54></a><a href=#__codelineno-49-54><span class=linenos data-linenos="54 "></span></a>                                            <span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;new_state&#39;</span><span class=p>]</span>
</span><span id=__span-49-55><a id=__codelineno-49-55 name=__codelineno-49-55></a><a href=#__codelineno-49-55><span class=linenos data-linenos="55 "></span></a>                                        <span class=p>},</span>
</span><span id=__span-49-56><a id=__codelineno-49-56 name=__codelineno-49-56></a><a href=#__codelineno-49-56><span class=linenos data-linenos="56 "></span></a>                                        <span class=p>{</span>
</span><span id=__span-49-57><a id=__codelineno-49-57 name=__codelineno-49-57></a><a href=#__codelineno-49-57><span class=linenos data-linenos="57 "></span></a>                                            <span class=s2>&quot;title&quot;</span><span class=p>:</span> <span class=s2>&quot;Time:&quot;</span><span class=p>,</span>
</span><span id=__span-49-58><a id=__codelineno-49-58 name=__codelineno-49-58></a><a href=#__codelineno-49-58><span class=linenos data-linenos="58 "></span></a>                                            <span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%H:%M:%S&#39;</span><span class=p>)</span>
</span><span id=__span-49-59><a id=__codelineno-49-59 name=__codelineno-49-59></a><a href=#__codelineno-49-59><span class=linenos data-linenos="59 "></span></a>                                        <span class=p>}</span>
</span><span id=__span-49-60><a id=__codelineno-49-60 name=__codelineno-49-60></a><a href=#__codelineno-49-60><span class=linenos data-linenos="60 "></span></a>                                    <span class=p>]</span>
</span><span id=__span-49-61><a id=__codelineno-49-61 name=__codelineno-49-61></a><a href=#__codelineno-49-61><span class=linenos data-linenos="61 "></span></a>                                <span class=p>}</span>
</span><span id=__span-49-62><a id=__codelineno-49-62 name=__codelineno-49-62></a><a href=#__codelineno-49-62><span class=linenos data-linenos="62 "></span></a>                            <span class=p>],</span>
</span><span id=__span-49-63><a id=__codelineno-49-63 name=__codelineno-49-63></a><a href=#__codelineno-49-63><span class=linenos data-linenos="63 "></span></a>                            <span class=s2>&quot;actions&quot;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-49-64><a id=__codelineno-49-64 name=__codelineno-49-64></a><a href=#__codelineno-49-64><span class=linenos data-linenos="64 "></span></a>                                <span class=p>{</span>
</span><span id=__span-49-65><a id=__codelineno-49-65 name=__codelineno-49-65></a><a href=#__codelineno-49-65><span class=linenos data-linenos="65 "></span></a>                                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;Action.OpenUrl&quot;</span><span class=p>,</span>
</span><span id=__span-49-66><a id=__codelineno-49-66 name=__codelineno-49-66></a><a href=#__codelineno-49-66><span class=linenos data-linenos="66 "></span></a>                                    <span class=s2>&quot;title&quot;</span><span class=p>:</span> <span class=s2>&quot;View Cycle&quot;</span><span class=p>,</span>
</span><span id=__span-49-67><a id=__codelineno-49-67 name=__codelineno-49-67></a><a href=#__codelineno-49-67><span class=linenos data-linenos="67 "></span></a>                                    <span class=s2>&quot;url&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;https://dashboard.example.com/tdd/</span><span class=si>{</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;cycle_id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-49-68><a id=__codelineno-49-68 name=__codelineno-49-68></a><a href=#__codelineno-49-68><span class=linenos data-linenos="68 "></span></a>                                <span class=p>}</span>
</span><span id=__span-49-69><a id=__codelineno-49-69 name=__codelineno-49-69></a><a href=#__codelineno-49-69><span class=linenos data-linenos="69 "></span></a>                            <span class=p>]</span>
</span><span id=__span-49-70><a id=__codelineno-49-70 name=__codelineno-49-70></a><a href=#__codelineno-49-70><span class=linenos data-linenos="70 "></span></a>                        <span class=p>}</span>
</span><span id=__span-49-71><a id=__codelineno-49-71 name=__codelineno-49-71></a><a href=#__codelineno-49-71><span class=linenos data-linenos="71 "></span></a>                    <span class=p>}</span>
</span><span id=__span-49-72><a id=__codelineno-49-72 name=__codelineno-49-72></a><a href=#__codelineno-49-72><span class=linenos data-linenos="72 "></span></a>                <span class=p>]</span>
</span><span id=__span-49-73><a id=__codelineno-49-73 name=__codelineno-49-73></a><a href=#__codelineno-49-73><span class=linenos data-linenos="73 "></span></a>            <span class=p>}</span>
</span></code></pre></div><h2 id=websocket-api-integration>WebSocket API Integration<a class=headerlink href=#websocket-api-integration title="Permanent link">&para;</a></h2><h3 id=real-time-state-monitoring>Real-Time State Monitoring<a class=headerlink href=#real-time-state-monitoring title="Permanent link">&para;</a></h3><h4 id=basic-websocket-connection>Basic WebSocket Connection<a class=headerlink href=#basic-websocket-connection title="Permanent link">&para;</a></h4><div class="language-javascript highlight"><span class=filename>JavaScript</span><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1></a><a href=#__codelineno-50-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1>// client.js - Basic WebSocket connection to monitor TDD state</span>
</span><span id=__span-50-2><a id=__codelineno-50-2 name=__codelineno-50-2></a><a href=#__codelineno-50-2><span class=linenos data-linenos=" 2 "></span></a><span class=kd>const</span><span class=w> </span><span class=nx>WebSocket</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;ws&#39;</span><span class=p>);</span>
</span><span id=__span-50-3><a id=__codelineno-50-3 name=__codelineno-50-3></a><a href=#__codelineno-50-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-50-4><a id=__codelineno-50-4 name=__codelineno-50-4></a><a href=#__codelineno-50-4><span class=linenos data-linenos=" 4 "></span></a><span class=kd>class</span><span class=w> </span><span class=nx>TDDStateMonitor</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-50-5><a id=__codelineno-50-5 name=__codelineno-50-5></a><a href=#__codelineno-50-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>    </span><span class=kr>constructor</span><span class=p>(</span><span class=nx>host</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>port</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>8765</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-50-6><a id=__codelineno-50-6 name=__codelineno-50-6></a><a href=#__codelineno-50-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=nx>wsUrl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sb>`ws://</span><span class=si>${</span><span class=nx>host</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>port</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span><span id=__span-50-7><a id=__codelineno-50-7 name=__codelineno-50-7></a><a href=#__codelineno-50-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span>
</span><span id=__span-50-8><a id=__codelineno-50-8 name=__codelineno-50-8></a><a href=#__codelineno-50-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=nx>reconnectInterval</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>5000</span><span class=p>;</span>
</span><span id=__span-50-9><a id=__codelineno-50-9 name=__codelineno-50-9></a><a href=#__codelineno-50-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-50-10><a id=__codelineno-50-10 name=__codelineno-50-10></a><a href=#__codelineno-50-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span>
</span><span id=__span-50-11><a id=__codelineno-50-11 name=__codelineno-50-11></a><a href=#__codelineno-50-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span><span class=nx>connect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-50-12><a id=__codelineno-50-12 name=__codelineno-50-12></a><a href=#__codelineno-50-12><span class=linenos data-linenos="12 "></span></a><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-50-13><a id=__codelineno-50-13 name=__codelineno-50-13></a><a href=#__codelineno-50-13><span class=linenos data-linenos="13 "></span></a><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>WebSocket</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>wsUrl</span><span class=p>);</span>
</span><span id=__span-50-14><a id=__codelineno-50-14 name=__codelineno-50-14></a><a href=#__codelineno-50-14><span class=linenos data-linenos="14 "></span></a><span class=w>            </span>
</span><span id=__span-50-15><a id=__codelineno-50-15 name=__codelineno-50-15></a><a href=#__codelineno-50-15><span class=linenos data-linenos="15 "></span></a><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;open&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-50-16><a id=__codelineno-50-16 name=__codelineno-50-16></a><a href=#__codelineno-50-16><span class=linenos data-linenos="16 "></span></a><span class=w>                </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Connected to TDD State Broadcaster&#39;</span><span class=p>);</span>
</span><span id=__span-50-17><a id=__codelineno-50-17 name=__codelineno-50-17></a><a href=#__codelineno-50-17><span class=linenos data-linenos="17 "></span></a><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=nx>requestCurrentState</span><span class=p>();</span>
</span><span id=__span-50-18><a id=__codelineno-50-18 name=__codelineno-50-18></a><a href=#__codelineno-50-18><span class=linenos data-linenos="18 "></span></a><span class=w>            </span><span class=p>});</span>
</span><span id=__span-50-19><a id=__codelineno-50-19 name=__codelineno-50-19></a><a href=#__codelineno-50-19><span class=linenos data-linenos="19 "></span></a><span class=w>            </span>
</span><span id=__span-50-20><a id=__codelineno-50-20 name=__codelineno-50-20></a><a href=#__codelineno-50-20><span class=linenos data-linenos="20 "></span></a><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>data</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-50-21><a id=__codelineno-50-21 name=__codelineno-50-21></a><a href=#__codelineno-50-21><span class=linenos data-linenos="21 "></span></a><span class=w>                </span><span class=kd>const</span><span class=w> </span><span class=nx>event</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span><span id=__span-50-22><a id=__codelineno-50-22 name=__codelineno-50-22></a><a href=#__codelineno-50-22><span class=linenos data-linenos="22 "></span></a><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=nx>handleStateEvent</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span><span id=__span-50-23><a id=__codelineno-50-23 name=__codelineno-50-23></a><a href=#__codelineno-50-23><span class=linenos data-linenos="23 "></span></a><span class=w>            </span><span class=p>});</span>
</span><span id=__span-50-24><a id=__codelineno-50-24 name=__codelineno-50-24></a><a href=#__codelineno-50-24><span class=linenos data-linenos="24 "></span></a><span class=w>            </span>
</span><span id=__span-50-25><a id=__codelineno-50-25 name=__codelineno-50-25></a><a href=#__codelineno-50-25><span class=linenos data-linenos="25 "></span></a><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;close&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-50-26><a id=__codelineno-50-26 name=__codelineno-50-26></a><a href=#__codelineno-50-26><span class=linenos data-linenos="26 "></span></a><span class=w>                </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Connection closed. Attempting to reconnect...&#39;</span><span class=p>);</span>
</span><span id=__span-50-27><a id=__codelineno-50-27 name=__codelineno-50-27></a><a href=#__codelineno-50-27><span class=linenos data-linenos="27 "></span></a><span class=w>                </span><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>connect</span><span class=p>(),</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>reconnectInterval</span><span class=p>);</span>
</span><span id=__span-50-28><a id=__codelineno-50-28 name=__codelineno-50-28></a><a href=#__codelineno-50-28><span class=linenos data-linenos="28 "></span></a><span class=w>            </span><span class=p>});</span>
</span><span id=__span-50-29><a id=__codelineno-50-29 name=__codelineno-50-29></a><a href=#__codelineno-50-29><span class=linenos data-linenos="29 "></span></a><span class=w>            </span>
</span><span id=__span-50-30><a id=__codelineno-50-30 name=__codelineno-50-30></a><a href=#__codelineno-50-30><span class=linenos data-linenos="30 "></span></a><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>error</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-50-31><a id=__codelineno-50-31 name=__codelineno-50-31></a><a href=#__codelineno-50-31><span class=linenos data-linenos="31 "></span></a><span class=w>                </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;WebSocket error:&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>error</span><span class=p>);</span>
</span><span id=__span-50-32><a id=__codelineno-50-32 name=__codelineno-50-32></a><a href=#__codelineno-50-32><span class=linenos data-linenos="32 "></span></a><span class=w>            </span><span class=p>});</span>
</span><span id=__span-50-33><a id=__codelineno-50-33 name=__codelineno-50-33></a><a href=#__codelineno-50-33><span class=linenos data-linenos="33 "></span></a><span class=w>            </span>
</span><span id=__span-50-34><a id=__codelineno-50-34 name=__codelineno-50-34></a><a href=#__codelineno-50-34><span class=linenos data-linenos="34 "></span></a><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-50-35><a id=__codelineno-50-35 name=__codelineno-50-35></a><a href=#__codelineno-50-35><span class=linenos data-linenos="35 "></span></a><span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Failed to connect:&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>error</span><span class=p>);</span>
</span><span id=__span-50-36><a id=__codelineno-50-36 name=__codelineno-50-36></a><a href=#__codelineno-50-36><span class=linenos data-linenos="36 "></span></a><span class=w>            </span><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>connect</span><span class=p>(),</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>reconnectInterval</span><span class=p>);</span>
</span><span id=__span-50-37><a id=__codelineno-50-37 name=__codelineno-50-37></a><a href=#__codelineno-50-37><span class=linenos data-linenos="37 "></span></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-50-38><a id=__codelineno-50-38 name=__codelineno-50-38></a><a href=#__codelineno-50-38><span class=linenos data-linenos="38 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-50-39><a id=__codelineno-50-39 name=__codelineno-50-39></a><a href=#__codelineno-50-39><span class=linenos data-linenos="39 "></span></a><span class=w>    </span>
</span><span id=__span-50-40><a id=__codelineno-50-40 name=__codelineno-50-40></a><a href=#__codelineno-50-40><span class=linenos data-linenos="40 "></span></a><span class=w>    </span><span class=nx>requestCurrentState</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-50-41><a id=__codelineno-50-41 name=__codelineno-50-41></a><a href=#__codelineno-50-41><span class=linenos data-linenos="41 "></span></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>readyState</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=nx>WebSocket</span><span class=p>.</span><span class=nx>OPEN</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-50-42><a id=__codelineno-50-42 name=__codelineno-50-42></a><a href=#__codelineno-50-42><span class=linenos data-linenos="42 "></span></a><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nb>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span><span id=__span-50-43><a id=__codelineno-50-43 name=__codelineno-50-43></a><a href=#__codelineno-50-43><span class=linenos data-linenos="43 "></span></a><span class=w>                </span><span class=nx>type</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;get_current_state&#39;</span>
</span><span id=__span-50-44><a id=__codelineno-50-44 name=__codelineno-50-44></a><a href=#__codelineno-50-44><span class=linenos data-linenos="44 "></span></a><span class=w>            </span><span class=p>}));</span>
</span><span id=__span-50-45><a id=__codelineno-50-45 name=__codelineno-50-45></a><a href=#__codelineno-50-45><span class=linenos data-linenos="45 "></span></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-50-46><a id=__codelineno-50-46 name=__codelineno-50-46></a><a href=#__codelineno-50-46><span class=linenos data-linenos="46 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-50-47><a id=__codelineno-50-47 name=__codelineno-50-47></a><a href=#__codelineno-50-47><span class=linenos data-linenos="47 "></span></a><span class=w>    </span>
</span><span id=__span-50-48><a id=__codelineno-50-48 name=__codelineno-50-48></a><a href=#__codelineno-50-48><span class=linenos data-linenos="48 "></span></a><span class=w>    </span><span class=nx>handleStateEvent</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-50-49><a id=__codelineno-50-49 name=__codelineno-50-49></a><a href=#__codelineno-50-49><span class=linenos data-linenos="49 "></span></a><span class=w>        </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-50-50><a id=__codelineno-50-50 name=__codelineno-50-50></a><a href=#__codelineno-50-50><span class=linenos data-linenos="50 "></span></a><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s1>&#39;workflow_state_changed&#39;</span><span class=o>:</span>
</span><span id=__span-50-51><a id=__codelineno-50-51 name=__codelineno-50-51></a><a href=#__codelineno-50-51><span class=linenos data-linenos="51 "></span></a><span class=w>                </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Workflow: </span><span class=si>${</span><span class=nx>event</span><span class=p>.</span><span class=nx>old_state</span><span class=si>}</span><span class=sb> → </span><span class=si>${</span><span class=nx>event</span><span class=p>.</span><span class=nx>new_state</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span><span id=__span-50-52><a id=__codelineno-50-52 name=__codelineno-50-52></a><a href=#__codelineno-50-52><span class=linenos data-linenos="52 "></span></a><span class=w>                </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-50-53><a id=__codelineno-50-53 name=__codelineno-50-53></a><a href=#__codelineno-50-53><span class=linenos data-linenos="53 "></span></a><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s1>&#39;tdd_state_changed&#39;</span><span class=o>:</span>
</span><span id=__span-50-54><a id=__codelineno-50-54 name=__codelineno-50-54></a><a href=#__codelineno-50-54><span class=linenos data-linenos="54 "></span></a><span class=w>                </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`TDD [</span><span class=si>${</span><span class=nx>event</span><span class=p>.</span><span class=nx>story_id</span><span class=si>}</span><span class=sb>]: </span><span class=si>${</span><span class=nx>event</span><span class=p>.</span><span class=nx>old_state</span><span class=si>}</span><span class=sb> → </span><span class=si>${</span><span class=nx>event</span><span class=p>.</span><span class=nx>new_state</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span><span id=__span-50-55><a id=__codelineno-50-55 name=__codelineno-50-55></a><a href=#__codelineno-50-55><span class=linenos data-linenos="55 "></span></a><span class=w>                </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-50-56><a id=__codelineno-50-56 name=__codelineno-50-56></a><a href=#__codelineno-50-56><span class=linenos data-linenos="56 "></span></a><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=s1>&#39;current_state&#39;</span><span class=o>:</span>
</span><span id=__span-50-57><a id=__codelineno-50-57 name=__codelineno-50-57></a><a href=#__codelineno-50-57><span class=linenos data-linenos="57 "></span></a><span class=w>                </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Current State:&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>event</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span>
</span><span id=__span-50-58><a id=__codelineno-50-58 name=__codelineno-50-58></a><a href=#__codelineno-50-58><span class=linenos data-linenos="58 "></span></a><span class=w>                </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-50-59><a id=__codelineno-50-59 name=__codelineno-50-59></a><a href=#__codelineno-50-59><span class=linenos data-linenos="59 "></span></a><span class=w>            </span><span class=k>default</span><span class=o>:</span>
</span><span id=__span-50-60><a id=__codelineno-50-60 name=__codelineno-50-60></a><a href=#__codelineno-50-60><span class=linenos data-linenos="60 "></span></a><span class=w>                </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Unknown event:&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>event</span><span class=p>);</span>
</span><span id=__span-50-61><a id=__codelineno-50-61 name=__codelineno-50-61></a><a href=#__codelineno-50-61><span class=linenos data-linenos="61 "></span></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-50-62><a id=__codelineno-50-62 name=__codelineno-50-62></a><a href=#__codelineno-50-62><span class=linenos data-linenos="62 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-50-63><a id=__codelineno-50-63 name=__codelineno-50-63></a><a href=#__codelineno-50-63><span class=linenos data-linenos="63 "></span></a><span class=p>}</span>
</span><span id=__span-50-64><a id=__codelineno-50-64 name=__codelineno-50-64></a><a href=#__codelineno-50-64><span class=linenos data-linenos="64 "></span></a>
</span><span id=__span-50-65><a id=__codelineno-50-65 name=__codelineno-50-65></a><a href=#__codelineno-50-65><span class=linenos data-linenos="65 "></span></a><span class=c1>// Usage</span>
</span><span id=__span-50-66><a id=__codelineno-50-66 name=__codelineno-50-66></a><a href=#__codelineno-50-66><span class=linenos data-linenos="66 "></span></a><span class=kd>const</span><span class=w> </span><span class=nx>monitor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>TDDStateMonitor</span><span class=p>();</span>
</span><span id=__span-50-67><a id=__codelineno-50-67 name=__codelineno-50-67></a><a href=#__codelineno-50-67><span class=linenos data-linenos="67 "></span></a><span class=nx>monitor</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
</span></code></pre></div><h4 id=python-websocket-client>Python WebSocket Client<a class=headerlink href=#python-websocket-client title="Permanent link">&para;</a></h4><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1></a><a href=#__codelineno-51-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># websocket_client.py - Python client for TDD state monitoring</span>
</span><span id=__span-51-2><a id=__codelineno-51-2 name=__codelineno-51-2></a><a href=#__codelineno-51-2><span class=linenos data-linenos=" 2 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>asyncio</span>
</span><span id=__span-51-3><a id=__codelineno-51-3 name=__codelineno-51-3></a><a href=#__codelineno-51-3><span class=linenos data-linenos=" 3 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-51-4><a id=__codelineno-51-4 name=__codelineno-51-4></a><a href=#__codelineno-51-4><span class=linenos data-linenos=" 4 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>logging</span>
</span><span id=__span-51-5><a id=__codelineno-51-5 name=__codelineno-51-5></a><a href=#__codelineno-51-5><span class=linenos data-linenos=" 5 "></span></a><span class=kn>import</span><span class=w> </span><span class=nn>websockets</span>
</span><span id=__span-51-6><a id=__codelineno-51-6 name=__codelineno-51-6></a><a href=#__codelineno-51-6><span class=linenos data-linenos=" 6 "></span></a><span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span>
</span><span id=__span-51-7><a id=__codelineno-51-7 name=__codelineno-51-7></a><a href=#__codelineno-51-7><span class=linenos data-linenos=" 7 "></span></a>
</span><span id=__span-51-8><a id=__codelineno-51-8 name=__codelineno-51-8></a><a href=#__codelineno-51-8><span class=linenos data-linenos=" 8 "></span></a><span class=k>class</span><span class=w> </span><span class=nc>TDDWebSocketClient</span><span class=p>:</span>
</span><span id=__span-51-9><a id=__codelineno-51-9 name=__codelineno-51-9></a><a href=#__codelineno-51-9><span class=linenos data-linenos=" 9 "></span></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>8765</span><span class=p>):</span>
</span><span id=__span-51-10><a id=__codelineno-51-10 name=__codelineno-51-10></a><a href=#__codelineno-51-10><span class=linenos data-linenos="10 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>uri</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;ws://</span><span class=si>{</span><span class=n>host</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>port</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-51-11><a id=__codelineno-51-11 name=__codelineno-51-11></a><a href=#__codelineno-51-11><span class=linenos data-linenos="11 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>websocket</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-51-12><a id=__codelineno-51-12 name=__codelineno-51-12></a><a href=#__codelineno-51-12><span class=linenos data-linenos="12 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span><span id=__span-51-13><a id=__codelineno-51-13 name=__codelineno-51-13></a><a href=#__codelineno-51-13><span class=linenos data-linenos="13 "></span></a>        
</span><span id=__span-51-14><a id=__codelineno-51-14 name=__codelineno-51-14></a><a href=#__codelineno-51-14><span class=linenos data-linenos="14 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>connect</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-51-15><a id=__codelineno-51-15 name=__codelineno-51-15></a><a href=#__codelineno-51-15><span class=linenos data-linenos="15 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Connect to the TDD state broadcaster&quot;&quot;&quot;</span>
</span><span id=__span-51-16><a id=__codelineno-51-16 name=__codelineno-51-16></a><a href=#__codelineno-51-16><span class=linenos data-linenos="16 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-51-17><a id=__codelineno-51-17 name=__codelineno-51-17></a><a href=#__codelineno-51-17><span class=linenos data-linenos="17 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>websocket</span> <span class=o>=</span> <span class=k>await</span> <span class=n>websockets</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>uri</span><span class=p>)</span>
</span><span id=__span-51-18><a id=__codelineno-51-18 name=__codelineno-51-18></a><a href=#__codelineno-51-18><span class=linenos data-linenos="18 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Connected to TDD State Broadcaster&quot;</span><span class=p>)</span>
</span><span id=__span-51-19><a id=__codelineno-51-19 name=__codelineno-51-19></a><a href=#__codelineno-51-19><span class=linenos data-linenos="19 "></span></a>            
</span><span id=__span-51-20><a id=__codelineno-51-20 name=__codelineno-51-20></a><a href=#__codelineno-51-20><span class=linenos data-linenos="20 "></span></a>            <span class=c1># Request current state</span>
</span><span id=__span-51-21><a id=__codelineno-51-21 name=__codelineno-51-21></a><a href=#__codelineno-51-21><span class=linenos data-linenos="21 "></span></a>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>send_message</span><span class=p>({</span>
</span><span id=__span-51-22><a id=__codelineno-51-22 name=__codelineno-51-22></a><a href=#__codelineno-51-22><span class=linenos data-linenos="22 "></span></a>                <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;get_current_state&quot;</span>
</span><span id=__span-51-23><a id=__codelineno-51-23 name=__codelineno-51-23></a><a href=#__codelineno-51-23><span class=linenos data-linenos="23 "></span></a>            <span class=p>})</span>
</span><span id=__span-51-24><a id=__codelineno-51-24 name=__codelineno-51-24></a><a href=#__codelineno-51-24><span class=linenos data-linenos="24 "></span></a>            
</span><span id=__span-51-25><a id=__codelineno-51-25 name=__codelineno-51-25></a><a href=#__codelineno-51-25><span class=linenos data-linenos="25 "></span></a>            <span class=c1># Listen for messages</span>
</span><span id=__span-51-26><a id=__codelineno-51-26 name=__codelineno-51-26></a><a href=#__codelineno-51-26><span class=linenos data-linenos="26 "></span></a>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>listen</span><span class=p>()</span>
</span><span id=__span-51-27><a id=__codelineno-51-27 name=__codelineno-51-27></a><a href=#__codelineno-51-27><span class=linenos data-linenos="27 "></span></a>            
</span><span id=__span-51-28><a id=__codelineno-51-28 name=__codelineno-51-28></a><a href=#__codelineno-51-28><span class=linenos data-linenos="28 "></span></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-51-29><a id=__codelineno-51-29 name=__codelineno-51-29></a><a href=#__codelineno-51-29><span class=linenos data-linenos="29 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Connection failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-51-30><a id=__codelineno-51-30 name=__codelineno-51-30></a><a href=#__codelineno-51-30><span class=linenos data-linenos="30 "></span></a>            
</span><span id=__span-51-31><a id=__codelineno-51-31 name=__codelineno-51-31></a><a href=#__codelineno-51-31><span class=linenos data-linenos="31 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>send_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span><span id=__span-51-32><a id=__codelineno-51-32 name=__codelineno-51-32></a><a href=#__codelineno-51-32><span class=linenos data-linenos="32 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Send message to server&quot;&quot;&quot;</span>
</span><span id=__span-51-33><a id=__codelineno-51-33 name=__codelineno-51-33></a><a href=#__codelineno-51-33><span class=linenos data-linenos="33 "></span></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>websocket</span><span class=p>:</span>
</span><span id=__span-51-34><a id=__codelineno-51-34 name=__codelineno-51-34></a><a href=#__codelineno-51-34><span class=linenos data-linenos="34 "></span></a>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>websocket</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>message</span><span class=p>))</span>
</span><span id=__span-51-35><a id=__codelineno-51-35 name=__codelineno-51-35></a><a href=#__codelineno-51-35><span class=linenos data-linenos="35 "></span></a>            
</span><span id=__span-51-36><a id=__codelineno-51-36 name=__codelineno-51-36></a><a href=#__codelineno-51-36><span class=linenos data-linenos="36 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>listen</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-51-37><a id=__codelineno-51-37 name=__codelineno-51-37></a><a href=#__codelineno-51-37><span class=linenos data-linenos="37 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Listen for state updates&quot;&quot;&quot;</span>
</span><span id=__span-51-38><a id=__codelineno-51-38 name=__codelineno-51-38></a><a href=#__codelineno-51-38><span class=linenos data-linenos="38 "></span></a>        <span class=k>async</span> <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>websocket</span><span class=p>:</span>
</span><span id=__span-51-39><a id=__codelineno-51-39 name=__codelineno-51-39></a><a href=#__codelineno-51-39><span class=linenos data-linenos="39 "></span></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-51-40><a id=__codelineno-51-40 name=__codelineno-51-40></a><a href=#__codelineno-51-40><span class=linenos data-linenos="40 "></span></a>                <span class=n>event</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span><span id=__span-51-41><a id=__codelineno-51-41 name=__codelineno-51-41></a><a href=#__codelineno-51-41><span class=linenos data-linenos="41 "></span></a>                <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>handle_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span><span id=__span-51-42><a id=__codelineno-51-42 name=__codelineno-51-42></a><a href=#__codelineno-51-42><span class=linenos data-linenos="42 "></span></a>            <span class=k>except</span> <span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-51-43><a id=__codelineno-51-43 name=__codelineno-51-43></a><a href=#__codelineno-51-43><span class=linenos data-linenos="43 "></span></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Invalid JSON received: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-51-44><a id=__codelineno-51-44 name=__codelineno-51-44></a><a href=#__codelineno-51-44><span class=linenos data-linenos="44 "></span></a>                
</span><span id=__span-51-45><a id=__codelineno-51-45 name=__codelineno-51-45></a><a href=#__codelineno-51-45><span class=linenos data-linenos="45 "></span></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>handle_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span><span id=__span-51-46><a id=__codelineno-51-46 name=__codelineno-51-46></a><a href=#__codelineno-51-46><span class=linenos data-linenos="46 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Handle incoming state events&quot;&quot;&quot;</span>
</span><span id=__span-51-47><a id=__codelineno-51-47 name=__codelineno-51-47></a><a href=#__codelineno-51-47><span class=linenos data-linenos="47 "></span></a>        <span class=n>event_type</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;type&#39;</span><span class=p>)</span>
</span><span id=__span-51-48><a id=__codelineno-51-48 name=__codelineno-51-48></a><a href=#__codelineno-51-48><span class=linenos data-linenos="48 "></span></a>        <span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%H:%M:%S&#39;</span><span class=p>)</span>
</span><span id=__span-51-49><a id=__codelineno-51-49 name=__codelineno-51-49></a><a href=#__codelineno-51-49><span class=linenos data-linenos="49 "></span></a>        
</span><span id=__span-51-50><a id=__codelineno-51-50 name=__codelineno-51-50></a><a href=#__codelineno-51-50><span class=linenos data-linenos="50 "></span></a>        <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;workflow_state_changed&#39;</span><span class=p>:</span>
</span><span id=__span-51-51><a id=__codelineno-51-51 name=__codelineno-51-51></a><a href=#__codelineno-51-51><span class=linenos data-linenos="51 "></span></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>] Workflow: </span><span class=si>{</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;old_state&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> → </span><span class=si>{</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;new_state&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-51-52><a id=__codelineno-51-52 name=__codelineno-51-52></a><a href=#__codelineno-51-52><span class=linenos data-linenos="52 "></span></a>            
</span><span id=__span-51-53><a id=__codelineno-51-53 name=__codelineno-51-53></a><a href=#__codelineno-51-53><span class=linenos data-linenos="53 "></span></a>        <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;tdd_state_changed&#39;</span><span class=p>:</span>
</span><span id=__span-51-54><a id=__codelineno-51-54 name=__codelineno-51-54></a><a href=#__codelineno-51-54><span class=linenos data-linenos="54 "></span></a>            <span class=n>story_id</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;story_id&#39;</span><span class=p>,</span> <span class=s1>&#39;Unknown&#39;</span><span class=p>)</span>
</span><span id=__span-51-55><a id=__codelineno-51-55 name=__codelineno-51-55></a><a href=#__codelineno-51-55><span class=linenos data-linenos="55 "></span></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>] TDD [</span><span class=si>{</span><span class=n>story_id</span><span class=si>}</span><span class=s2>]: </span><span class=si>{</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;old_state&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> → </span><span class=si>{</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;new_state&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-51-56><a id=__codelineno-51-56 name=__codelineno-51-56></a><a href=#__codelineno-51-56><span class=linenos data-linenos="56 "></span></a>            
</span><span id=__span-51-57><a id=__codelineno-51-57 name=__codelineno-51-57></a><a href=#__codelineno-51-57><span class=linenos data-linenos="57 "></span></a>        <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;current_state&#39;</span><span class=p>:</span>
</span><span id=__span-51-58><a id=__codelineno-51-58 name=__codelineno-51-58></a><a href=#__codelineno-51-58><span class=linenos data-linenos="58 "></span></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>] Current State:&quot;</span><span class=p>)</span>
</span><span id=__span-51-59><a id=__codelineno-51-59 name=__codelineno-51-59></a><a href=#__codelineno-51-59><span class=linenos data-linenos="59 "></span></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  Workflow: </span><span class=si>{</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>][</span><span class=s1>&#39;workflow_state&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-51-60><a id=__codelineno-51-60 name=__codelineno-51-60></a><a href=#__codelineno-51-60><span class=linenos data-linenos="60 "></span></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  Active TDD Cycles: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>][</span><span class=s1>&#39;tdd_cycles&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-51-61><a id=__codelineno-51-61 name=__codelineno-51-61></a><a href=#__codelineno-51-61><span class=linenos data-linenos="61 "></span></a>            
</span><span id=__span-51-62><a id=__codelineno-51-62 name=__codelineno-51-62></a><a href=#__codelineno-51-62><span class=linenos data-linenos="62 "></span></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-51-63><a id=__codelineno-51-63 name=__codelineno-51-63></a><a href=#__codelineno-51-63><span class=linenos data-linenos="63 "></span></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;[</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>] Unknown event: </span><span class=si>{</span><span class=n>event_type</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-51-64><a id=__codelineno-51-64 name=__codelineno-51-64></a><a href=#__codelineno-51-64><span class=linenos data-linenos="64 "></span></a>
</span><span id=__span-51-65><a id=__codelineno-51-65 name=__codelineno-51-65></a><a href=#__codelineno-51-65><span class=linenos data-linenos="65 "></span></a><span class=c1># Usage</span>
</span><span id=__span-51-66><a id=__codelineno-51-66 name=__codelineno-51-66></a><a href=#__codelineno-51-66><span class=linenos data-linenos="66 "></span></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>main</span><span class=p>():</span>
</span><span id=__span-51-67><a id=__codelineno-51-67 name=__codelineno-51-67></a><a href=#__codelineno-51-67><span class=linenos data-linenos="67 "></span></a>    <span class=n>client</span> <span class=o>=</span> <span class=n>TDDWebSocketClient</span><span class=p>()</span>
</span><span id=__span-51-68><a id=__codelineno-51-68 name=__codelineno-51-68></a><a href=#__codelineno-51-68><span class=linenos data-linenos="68 "></span></a>    <span class=k>await</span> <span class=n>client</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span>
</span><span id=__span-51-69><a id=__codelineno-51-69 name=__codelineno-51-69></a><a href=#__codelineno-51-69><span class=linenos data-linenos="69 "></span></a>
</span><span id=__span-51-70><a id=__codelineno-51-70 name=__codelineno-51-70></a><a href=#__codelineno-51-70><span class=linenos data-linenos="70 "></span></a><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&quot;__main__&quot;</span><span class=p>:</span>
</span><span id=__span-51-71><a id=__codelineno-51-71 name=__codelineno-51-71></a><a href=#__codelineno-51-71><span class=linenos data-linenos="71 "></span></a>    <span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span><span id=__span-51-72><a id=__codelineno-51-72 name=__codelineno-51-72></a><a href=#__codelineno-51-72><span class=linenos data-linenos="72 "></span></a>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></code></pre></div><h4 id=html-dashboard-integration>HTML Dashboard Integration<a class=headerlink href=#html-dashboard-integration title="Permanent link">&para;</a></h4><div class="language-html highlight"><span class=filename>HTML</span><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1></a><a href=#__codelineno-52-1><span class=linenos data-linenos="  1 "></span></a><span class=cm>&lt;!-- dashboard.html - Simple web dashboard for TDD monitoring --&gt;</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2></a><a href=#__codelineno-52-2><span class=linenos data-linenos="  2 "></span></a><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3></a><a href=#__codelineno-52-3><span class=linenos data-linenos="  3 "></span></a><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span><span id=__span-52-4><a id=__codelineno-52-4 name=__codelineno-52-4></a><a href=#__codelineno-52-4><span class=linenos data-linenos="  4 "></span></a><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span><span id=__span-52-5><a id=__codelineno-52-5 name=__codelineno-52-5></a><a href=#__codelineno-52-5><span class=linenos data-linenos="  5 "></span></a>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>TDD State Monitor<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span><span id=__span-52-6><a id=__codelineno-52-6 name=__codelineno-52-6></a><a href=#__codelineno-52-6><span class=linenos data-linenos="  6 "></span></a>    <span class=p>&lt;</span><span class=nt>style</span><span class=p>&gt;</span>
</span><span id=__span-52-7><a id=__codelineno-52-7 name=__codelineno-52-7></a><a href=#__codelineno-52-7><span class=linenos data-linenos="  7 "></span></a><span class=w>        </span><span class=nt>body</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>font-family</span><span class=p>:</span><span class=w> </span><span class=n>Arial</span><span class=p>,</span><span class=w> </span><span class=kc>sans-serif</span><span class=p>;</span><span class=w> </span><span class=k>margin</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-52-8><a id=__codelineno-52-8 name=__codelineno-52-8></a><a href=#__codelineno-52-8><span class=linenos data-linenos="  8 "></span></a><span class=w>        </span><span class=p>.</span><span class=nc>status</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>padding</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=kt>px</span><span class=p>;</span><span class=w> </span><span class=k>margin</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=kt>px</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=k>border-radius</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-52-9><a id=__codelineno-52-9 name=__codelineno-52-9></a><a href=#__codelineno-52-9><span class=linenos data-linenos="  9 "></span></a><span class=w>        </span><span class=p>.</span><span class=nc>idle</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>background-color</span><span class=p>:</span><span class=w> </span><span class=mh>#f0f0f0</span><span class=p>;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-52-10><a id=__codelineno-52-10 name=__codelineno-52-10></a><a href=#__codelineno-52-10><span class=linenos data-linenos=" 10 "></span></a><span class=w>        </span><span class=p>.</span><span class=nc>active</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>background-color</span><span class=p>:</span><span class=w> </span><span class=mh>#e7f3ff</span><span class=p>;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-52-11><a id=__codelineno-52-11 name=__codelineno-52-11></a><a href=#__codelineno-52-11><span class=linenos data-linenos=" 11 "></span></a><span class=w>        </span><span class=p>.</span><span class=nc>error</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>background-color</span><span class=p>:</span><span class=w> </span><span class=mh>#ffe7e7</span><span class=p>;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-52-12><a id=__codelineno-52-12 name=__codelineno-52-12></a><a href=#__codelineno-52-12><span class=linenos data-linenos=" 12 "></span></a><span class=w>        </span><span class=p>.</span><span class=nc>log</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>background-color</span><span class=p>:</span><span class=w> </span><span class=mh>#f9f9f9</span><span class=p>;</span><span class=w> </span><span class=k>padding</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=kt>px</span><span class=p>;</span><span class=w> </span><span class=k>height</span><span class=p>:</span><span class=w> </span><span class=mi>300</span><span class=kt>px</span><span class=p>;</span><span class=w> </span><span class=k>overflow-y</span><span class=p>:</span><span class=w> </span><span class=kc>scroll</span><span class=p>;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-52-13><a id=__codelineno-52-13 name=__codelineno-52-13></a><a href=#__codelineno-52-13><span class=linenos data-linenos=" 13 "></span></a><span class=w>    </span><span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span><span id=__span-52-14><a id=__codelineno-52-14 name=__codelineno-52-14></a><a href=#__codelineno-52-14><span class=linenos data-linenos=" 14 "></span></a><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span><span id=__span-52-15><a id=__codelineno-52-15 name=__codelineno-52-15></a><a href=#__codelineno-52-15><span class=linenos data-linenos=" 15 "></span></a><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span><span id=__span-52-16><a id=__codelineno-52-16 name=__codelineno-52-16></a><a href=#__codelineno-52-16><span class=linenos data-linenos=" 16 "></span></a>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>TDD Workflow Monitor<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span><span id=__span-52-17><a id=__codelineno-52-17 name=__codelineno-52-17></a><a href=#__codelineno-52-17><span class=linenos data-linenos=" 17 "></span></a>    
</span><span id=__span-52-18><a id=__codelineno-52-18 name=__codelineno-52-18></a><a href=#__codelineno-52-18><span class=linenos data-linenos=" 18 "></span></a>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&quot;connectionStatus&quot;</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;status idle&quot;</span><span class=p>&gt;</span>Disconnected<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span><span id=__span-52-19><a id=__codelineno-52-19 name=__codelineno-52-19></a><a href=#__codelineno-52-19><span class=linenos data-linenos=" 19 "></span></a>    
</span><span id=__span-52-20><a id=__codelineno-52-20 name=__codelineno-52-20></a><a href=#__codelineno-52-20><span class=linenos data-linenos=" 20 "></span></a>    <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span><span id=__span-52-21><a id=__codelineno-52-21 name=__codelineno-52-21></a><a href=#__codelineno-52-21><span class=linenos data-linenos=" 21 "></span></a>        <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>Current State<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span><span id=__span-52-22><a id=__codelineno-52-22 name=__codelineno-52-22></a><a href=#__codelineno-52-22><span class=linenos data-linenos=" 22 "></span></a>        <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>Workflow: <span class=p>&lt;</span><span class=nt>span</span> <span class=na>id</span><span class=o>=</span><span class=s>&quot;workflowState&quot;</span><span class=p>&gt;</span>Unknown<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span><span id=__span-52-23><a id=__codelineno-52-23 name=__codelineno-52-23></a><a href=#__codelineno-52-23><span class=linenos data-linenos=" 23 "></span></a>        <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>Active TDD Cycles: <span class=p>&lt;</span><span class=nt>span</span> <span class=na>id</span><span class=o>=</span><span class=s>&quot;activeCycles&quot;</span><span class=p>&gt;</span>0<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span><span id=__span-52-24><a id=__codelineno-52-24 name=__codelineno-52-24></a><a href=#__codelineno-52-24><span class=linenos data-linenos=" 24 "></span></a>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span><span id=__span-52-25><a id=__codelineno-52-25 name=__codelineno-52-25></a><a href=#__codelineno-52-25><span class=linenos data-linenos=" 25 "></span></a>    
</span><span id=__span-52-26><a id=__codelineno-52-26 name=__codelineno-52-26></a><a href=#__codelineno-52-26><span class=linenos data-linenos=" 26 "></span></a>    <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span><span id=__span-52-27><a id=__codelineno-52-27 name=__codelineno-52-27></a><a href=#__codelineno-52-27><span class=linenos data-linenos=" 27 "></span></a>        <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>Event Log<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span><span id=__span-52-28><a id=__codelineno-52-28 name=__codelineno-52-28></a><a href=#__codelineno-52-28><span class=linenos data-linenos=" 28 "></span></a>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&quot;eventLog&quot;</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;log&quot;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span><span id=__span-52-29><a id=__codelineno-52-29 name=__codelineno-52-29></a><a href=#__codelineno-52-29><span class=linenos data-linenos=" 29 "></span></a>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span><span id=__span-52-30><a id=__codelineno-52-30 name=__codelineno-52-30></a><a href=#__codelineno-52-30><span class=linenos data-linenos=" 30 "></span></a>    
</span><span id=__span-52-31><a id=__codelineno-52-31 name=__codelineno-52-31></a><a href=#__codelineno-52-31><span class=linenos data-linenos=" 31 "></span></a>    <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span><span id=__span-52-32><a id=__codelineno-52-32 name=__codelineno-52-32></a><a href=#__codelineno-52-32><span class=linenos data-linenos=" 32 "></span></a><span class=w>        </span><span class=kd>class</span><span class=w> </span><span class=nx>TDDDashboard</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-33><a id=__codelineno-52-33 name=__codelineno-52-33></a><a href=#__codelineno-52-33><span class=linenos data-linenos=" 33 "></span></a><span class=w>            </span><span class=kr>constructor</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-34><a id=__codelineno-52-34 name=__codelineno-52-34></a><a href=#__codelineno-52-34><span class=linenos data-linenos=" 34 "></span></a><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span>
</span><span id=__span-52-35><a id=__codelineno-52-35 name=__codelineno-52-35></a><a href=#__codelineno-52-35><span class=linenos data-linenos=" 35 "></span></a><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=nx>reconnectDelay</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>5000</span><span class=p>;</span>
</span><span id=__span-52-36><a id=__codelineno-52-36 name=__codelineno-52-36></a><a href=#__codelineno-52-36><span class=linenos data-linenos=" 36 "></span></a><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=nx>init</span><span class=p>();</span>
</span><span id=__span-52-37><a id=__codelineno-52-37 name=__codelineno-52-37></a><a href=#__codelineno-52-37><span class=linenos data-linenos=" 37 "></span></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-52-38><a id=__codelineno-52-38 name=__codelineno-52-38></a><a href=#__codelineno-52-38><span class=linenos data-linenos=" 38 "></span></a><span class=w>            </span>
</span><span id=__span-52-39><a id=__codelineno-52-39 name=__codelineno-52-39></a><a href=#__codelineno-52-39><span class=linenos data-linenos=" 39 "></span></a><span class=w>            </span><span class=nx>init</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-40><a id=__codelineno-52-40 name=__codelineno-52-40></a><a href=#__codelineno-52-40><span class=linenos data-linenos=" 40 "></span></a><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=nx>connectWebSocket</span><span class=p>();</span>
</span><span id=__span-52-41><a id=__codelineno-52-41 name=__codelineno-52-41></a><a href=#__codelineno-52-41><span class=linenos data-linenos=" 41 "></span></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-52-42><a id=__codelineno-52-42 name=__codelineno-52-42></a><a href=#__codelineno-52-42><span class=linenos data-linenos=" 42 "></span></a><span class=w>            </span>
</span><span id=__span-52-43><a id=__codelineno-52-43 name=__codelineno-52-43></a><a href=#__codelineno-52-43><span class=linenos data-linenos=" 43 "></span></a><span class=w>            </span><span class=nx>connectWebSocket</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-44><a id=__codelineno-52-44 name=__codelineno-52-44></a><a href=#__codelineno-52-44><span class=linenos data-linenos=" 44 "></span></a><span class=w>                </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-45><a id=__codelineno-52-45 name=__codelineno-52-45></a><a href=#__codelineno-52-45><span class=linenos data-linenos=" 45 "></span></a><span class=w>                    </span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>WebSocket</span><span class=p>(</span><span class=s1>&#39;ws://localhost:8765&#39;</span><span class=p>);</span>
</span><span id=__span-52-46><a id=__codelineno-52-46 name=__codelineno-52-46></a><a href=#__codelineno-52-46><span class=linenos data-linenos=" 46 "></span></a><span class=w>                    </span>
</span><span id=__span-52-47><a id=__codelineno-52-47 name=__codelineno-52-47></a><a href=#__codelineno-52-47><span class=linenos data-linenos=" 47 "></span></a><span class=w>                    </span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>onopen</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-48><a id=__codelineno-52-48 name=__codelineno-52-48></a><a href=#__codelineno-52-48><span class=linenos data-linenos=" 48 "></span></a><span class=w>                        </span><span class=k>this</span><span class=p>.</span><span class=nx>updateConnectionStatus</span><span class=p>(</span><span class=s1>&#39;Connected&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;active&#39;</span><span class=p>);</span>
</span><span id=__span-52-49><a id=__codelineno-52-49 name=__codelineno-52-49></a><a href=#__codelineno-52-49><span class=linenos data-linenos=" 49 "></span></a><span class=w>                        </span><span class=k>this</span><span class=p>.</span><span class=nx>requestCurrentState</span><span class=p>();</span>
</span><span id=__span-52-50><a id=__codelineno-52-50 name=__codelineno-52-50></a><a href=#__codelineno-52-50><span class=linenos data-linenos=" 50 "></span></a><span class=w>                    </span><span class=p>};</span>
</span><span id=__span-52-51><a id=__codelineno-52-51 name=__codelineno-52-51></a><a href=#__codelineno-52-51><span class=linenos data-linenos=" 51 "></span></a><span class=w>                    </span>
</span><span id=__span-52-52><a id=__codelineno-52-52 name=__codelineno-52-52></a><a href=#__codelineno-52-52><span class=linenos data-linenos=" 52 "></span></a><span class=w>                    </span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>onmessage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>event</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-53><a id=__codelineno-52-53 name=__codelineno-52-53></a><a href=#__codelineno-52-53><span class=linenos data-linenos=" 53 "></span></a><span class=w>                        </span><span class=kd>const</span><span class=w> </span><span class=nx>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span>
</span><span id=__span-52-54><a id=__codelineno-52-54 name=__codelineno-52-54></a><a href=#__codelineno-52-54><span class=linenos data-linenos=" 54 "></span></a><span class=w>                        </span><span class=k>this</span><span class=p>.</span><span class=nx>handleMessage</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span><span id=__span-52-55><a id=__codelineno-52-55 name=__codelineno-52-55></a><a href=#__codelineno-52-55><span class=linenos data-linenos=" 55 "></span></a><span class=w>                    </span><span class=p>};</span>
</span><span id=__span-52-56><a id=__codelineno-52-56 name=__codelineno-52-56></a><a href=#__codelineno-52-56><span class=linenos data-linenos=" 56 "></span></a><span class=w>                    </span>
</span><span id=__span-52-57><a id=__codelineno-52-57 name=__codelineno-52-57></a><a href=#__codelineno-52-57><span class=linenos data-linenos=" 57 "></span></a><span class=w>                    </span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>onclose</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-58><a id=__codelineno-52-58 name=__codelineno-52-58></a><a href=#__codelineno-52-58><span class=linenos data-linenos=" 58 "></span></a><span class=w>                        </span><span class=k>this</span><span class=p>.</span><span class=nx>updateConnectionStatus</span><span class=p>(</span><span class=s1>&#39;Disconnected&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;idle&#39;</span><span class=p>);</span>
</span><span id=__span-52-59><a id=__codelineno-52-59 name=__codelineno-52-59></a><a href=#__codelineno-52-59><span class=linenos data-linenos=" 59 "></span></a><span class=w>                        </span><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>connectWebSocket</span><span class=p>(),</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>reconnectDelay</span><span class=p>);</span>
</span><span id=__span-52-60><a id=__codelineno-52-60 name=__codelineno-52-60></a><a href=#__codelineno-52-60><span class=linenos data-linenos=" 60 "></span></a><span class=w>                    </span><span class=p>};</span>
</span><span id=__span-52-61><a id=__codelineno-52-61 name=__codelineno-52-61></a><a href=#__codelineno-52-61><span class=linenos data-linenos=" 61 "></span></a><span class=w>                    </span>
</span><span id=__span-52-62><a id=__codelineno-52-62 name=__codelineno-52-62></a><a href=#__codelineno-52-62><span class=linenos data-linenos=" 62 "></span></a><span class=w>                    </span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>onerror</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=nx>error</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-63><a id=__codelineno-52-63 name=__codelineno-52-63></a><a href=#__codelineno-52-63><span class=linenos data-linenos=" 63 "></span></a><span class=w>                        </span><span class=k>this</span><span class=p>.</span><span class=nx>updateConnectionStatus</span><span class=p>(</span><span class=s1>&#39;Error&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;error&#39;</span><span class=p>);</span>
</span><span id=__span-52-64><a id=__codelineno-52-64 name=__codelineno-52-64></a><a href=#__codelineno-52-64><span class=linenos data-linenos=" 64 "></span></a><span class=w>                        </span><span class=k>this</span><span class=p>.</span><span class=nx>logEvent</span><span class=p>(</span><span class=s1>&#39;Connection error: &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>error</span><span class=p>);</span>
</span><span id=__span-52-65><a id=__codelineno-52-65 name=__codelineno-52-65></a><a href=#__codelineno-52-65><span class=linenos data-linenos=" 65 "></span></a><span class=w>                    </span><span class=p>};</span>
</span><span id=__span-52-66><a id=__codelineno-52-66 name=__codelineno-52-66></a><a href=#__codelineno-52-66><span class=linenos data-linenos=" 66 "></span></a><span class=w>                    </span>
</span><span id=__span-52-67><a id=__codelineno-52-67 name=__codelineno-52-67></a><a href=#__codelineno-52-67><span class=linenos data-linenos=" 67 "></span></a><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=nx>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-68><a id=__codelineno-52-68 name=__codelineno-52-68></a><a href=#__codelineno-52-68><span class=linenos data-linenos=" 68 "></span></a><span class=w>                    </span><span class=k>this</span><span class=p>.</span><span class=nx>updateConnectionStatus</span><span class=p>(</span><span class=s1>&#39;Failed&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;error&#39;</span><span class=p>);</span>
</span><span id=__span-52-69><a id=__codelineno-52-69 name=__codelineno-52-69></a><a href=#__codelineno-52-69><span class=linenos data-linenos=" 69 "></span></a><span class=w>                    </span><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>connectWebSocket</span><span class=p>(),</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>reconnectDelay</span><span class=p>);</span>
</span><span id=__span-52-70><a id=__codelineno-52-70 name=__codelineno-52-70></a><a href=#__codelineno-52-70><span class=linenos data-linenos=" 70 "></span></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-52-71><a id=__codelineno-52-71 name=__codelineno-52-71></a><a href=#__codelineno-52-71><span class=linenos data-linenos=" 71 "></span></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-52-72><a id=__codelineno-52-72 name=__codelineno-52-72></a><a href=#__codelineno-52-72><span class=linenos data-linenos=" 72 "></span></a><span class=w>            </span>
</span><span id=__span-52-73><a id=__codelineno-52-73 name=__codelineno-52-73></a><a href=#__codelineno-52-73><span class=linenos data-linenos=" 73 "></span></a><span class=w>            </span><span class=nx>requestCurrentState</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-74><a id=__codelineno-52-74 name=__codelineno-52-74></a><a href=#__codelineno-52-74><span class=linenos data-linenos=" 74 "></span></a><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>readyState</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=nx>WebSocket</span><span class=p>.</span><span class=nx>OPEN</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-75><a id=__codelineno-52-75 name=__codelineno-52-75></a><a href=#__codelineno-52-75><span class=linenos data-linenos=" 75 "></span></a><span class=w>                    </span><span class=k>this</span><span class=p>.</span><span class=nx>ws</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nb>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span><span id=__span-52-76><a id=__codelineno-52-76 name=__codelineno-52-76></a><a href=#__codelineno-52-76><span class=linenos data-linenos=" 76 "></span></a><span class=w>                        </span><span class=nx>type</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;get_current_state&#39;</span>
</span><span id=__span-52-77><a id=__codelineno-52-77 name=__codelineno-52-77></a><a href=#__codelineno-52-77><span class=linenos data-linenos=" 77 "></span></a><span class=w>                    </span><span class=p>}));</span>
</span><span id=__span-52-78><a id=__codelineno-52-78 name=__codelineno-52-78></a><a href=#__codelineno-52-78><span class=linenos data-linenos=" 78 "></span></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-52-79><a id=__codelineno-52-79 name=__codelineno-52-79></a><a href=#__codelineno-52-79><span class=linenos data-linenos=" 79 "></span></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-52-80><a id=__codelineno-52-80 name=__codelineno-52-80></a><a href=#__codelineno-52-80><span class=linenos data-linenos=" 80 "></span></a><span class=w>            </span>
</span><span id=__span-52-81><a id=__codelineno-52-81 name=__codelineno-52-81></a><a href=#__codelineno-52-81><span class=linenos data-linenos=" 81 "></span></a><span class=w>            </span><span class=nx>handleMessage</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-82><a id=__codelineno-52-82 name=__codelineno-52-82></a><a href=#__codelineno-52-82><span class=linenos data-linenos=" 82 "></span></a><span class=w>                </span><span class=kd>const</span><span class=w> </span><span class=nx>timestamp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Date</span><span class=p>().</span><span class=nx>toLocaleTimeString</span><span class=p>();</span>
</span><span id=__span-52-83><a id=__codelineno-52-83 name=__codelineno-52-83></a><a href=#__codelineno-52-83><span class=linenos data-linenos=" 83 "></span></a><span class=w>                </span>
</span><span id=__span-52-84><a id=__codelineno-52-84 name=__codelineno-52-84></a><a href=#__codelineno-52-84><span class=linenos data-linenos=" 84 "></span></a><span class=w>                </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-85><a id=__codelineno-52-85 name=__codelineno-52-85></a><a href=#__codelineno-52-85><span class=linenos data-linenos=" 85 "></span></a><span class=w>                    </span><span class=k>case</span><span class=w> </span><span class=s1>&#39;workflow_state_changed&#39;</span><span class=o>:</span>
</span><span id=__span-52-86><a id=__codelineno-52-86 name=__codelineno-52-86></a><a href=#__codelineno-52-86><span class=linenos data-linenos=" 86 "></span></a><span class=w>                        </span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;workflowState&#39;</span><span class=p>).</span><span class=nx>textContent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>new_state</span><span class=p>;</span>
</span><span id=__span-52-87><a id=__codelineno-52-87 name=__codelineno-52-87></a><a href=#__codelineno-52-87><span class=linenos data-linenos=" 87 "></span></a><span class=w>                        </span><span class=k>this</span><span class=p>.</span><span class=nx>logEvent</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>timestamp</span><span class=si>}</span><span class=sb> - Workflow: </span><span class=si>${</span><span class=nx>data</span><span class=p>.</span><span class=nx>old_state</span><span class=si>}</span><span class=sb> → </span><span class=si>${</span><span class=nx>data</span><span class=p>.</span><span class=nx>new_state</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span><span id=__span-52-88><a id=__codelineno-52-88 name=__codelineno-52-88></a><a href=#__codelineno-52-88><span class=linenos data-linenos=" 88 "></span></a><span class=w>                        </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-52-89><a id=__codelineno-52-89 name=__codelineno-52-89></a><a href=#__codelineno-52-89><span class=linenos data-linenos=" 89 "></span></a><span class=w>                        </span>
</span><span id=__span-52-90><a id=__codelineno-52-90 name=__codelineno-52-90></a><a href=#__codelineno-52-90><span class=linenos data-linenos=" 90 "></span></a><span class=w>                    </span><span class=k>case</span><span class=w> </span><span class=s1>&#39;tdd_state_changed&#39;</span><span class=o>:</span>
</span><span id=__span-52-91><a id=__codelineno-52-91 name=__codelineno-52-91></a><a href=#__codelineno-52-91><span class=linenos data-linenos=" 91 "></span></a><span class=w>                        </span><span class=kd>const</span><span class=w> </span><span class=nx>storyId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>story_id</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s1>&#39;Unknown&#39;</span><span class=p>;</span>
</span><span id=__span-52-92><a id=__codelineno-52-92 name=__codelineno-52-92></a><a href=#__codelineno-52-92><span class=linenos data-linenos=" 92 "></span></a><span class=w>                        </span><span class=k>this</span><span class=p>.</span><span class=nx>logEvent</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>timestamp</span><span class=si>}</span><span class=sb> - TDD [</span><span class=si>${</span><span class=nx>storyId</span><span class=si>}</span><span class=sb>]: </span><span class=si>${</span><span class=nx>data</span><span class=p>.</span><span class=nx>old_state</span><span class=si>}</span><span class=sb> → </span><span class=si>${</span><span class=nx>data</span><span class=p>.</span><span class=nx>new_state</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span><span id=__span-52-93><a id=__codelineno-52-93 name=__codelineno-52-93></a><a href=#__codelineno-52-93><span class=linenos data-linenos=" 93 "></span></a><span class=w>                        </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-52-94><a id=__codelineno-52-94 name=__codelineno-52-94></a><a href=#__codelineno-52-94><span class=linenos data-linenos=" 94 "></span></a><span class=w>                        </span>
</span><span id=__span-52-95><a id=__codelineno-52-95 name=__codelineno-52-95></a><a href=#__codelineno-52-95><span class=linenos data-linenos=" 95 "></span></a><span class=w>                    </span><span class=k>case</span><span class=w> </span><span class=s1>&#39;current_state&#39;</span><span class=o>:</span>
</span><span id=__span-52-96><a id=__codelineno-52-96 name=__codelineno-52-96></a><a href=#__codelineno-52-96><span class=linenos data-linenos=" 96 "></span></a><span class=w>                        </span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;workflowState&#39;</span><span class=p>).</span><span class=nx>textContent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>data</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>workflow_state</span><span class=p>;</span>
</span><span id=__span-52-97><a id=__codelineno-52-97 name=__codelineno-52-97></a><a href=#__codelineno-52-97><span class=linenos data-linenos=" 97 "></span></a><span class=w>                        </span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;activeCycles&#39;</span><span class=p>).</span><span class=nx>textContent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Object</span><span class=p>.</span><span class=nx>keys</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>tdd_cycles</span><span class=p>).</span><span class=nx>length</span><span class=p>;</span>
</span><span id=__span-52-98><a id=__codelineno-52-98 name=__codelineno-52-98></a><a href=#__codelineno-52-98><span class=linenos data-linenos=" 98 "></span></a><span class=w>                        </span><span class=k>this</span><span class=p>.</span><span class=nx>logEvent</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>timestamp</span><span class=si>}</span><span class=sb> - State updated`</span><span class=p>);</span>
</span><span id=__span-52-99><a id=__codelineno-52-99 name=__codelineno-52-99></a><a href=#__codelineno-52-99><span class=linenos data-linenos=" 99 "></span></a><span class=w>                        </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-52-100><a id=__codelineno-52-100 name=__codelineno-52-100></a><a href=#__codelineno-52-100><span class=linenos data-linenos="100 "></span></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-52-101><a id=__codelineno-52-101 name=__codelineno-52-101></a><a href=#__codelineno-52-101><span class=linenos data-linenos="101 "></span></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-52-102><a id=__codelineno-52-102 name=__codelineno-52-102></a><a href=#__codelineno-52-102><span class=linenos data-linenos="102 "></span></a><span class=w>            </span>
</span><span id=__span-52-103><a id=__codelineno-52-103 name=__codelineno-52-103></a><a href=#__codelineno-52-103><span class=linenos data-linenos="103 "></span></a><span class=w>            </span><span class=nx>updateConnectionStatus</span><span class=p>(</span><span class=nx>status</span><span class=p>,</span><span class=w> </span><span class=nx>className</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-104><a id=__codelineno-52-104 name=__codelineno-52-104></a><a href=#__codelineno-52-104><span class=linenos data-linenos="104 "></span></a><span class=w>                </span><span class=kd>const</span><span class=w> </span><span class=nx>statusEl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;connectionStatus&#39;</span><span class=p>);</span>
</span><span id=__span-52-105><a id=__codelineno-52-105 name=__codelineno-52-105></a><a href=#__codelineno-52-105><span class=linenos data-linenos="105 "></span></a><span class=w>                </span><span class=nx>statusEl</span><span class=p>.</span><span class=nx>textContent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>status</span><span class=p>;</span>
</span><span id=__span-52-106><a id=__codelineno-52-106 name=__codelineno-52-106></a><a href=#__codelineno-52-106><span class=linenos data-linenos="106 "></span></a><span class=w>                </span><span class=nx>statusEl</span><span class=p>.</span><span class=nx>className</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sb>`status </span><span class=si>${</span><span class=nx>className</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span><span id=__span-52-107><a id=__codelineno-52-107 name=__codelineno-52-107></a><a href=#__codelineno-52-107><span class=linenos data-linenos="107 "></span></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-52-108><a id=__codelineno-52-108 name=__codelineno-52-108></a><a href=#__codelineno-52-108><span class=linenos data-linenos="108 "></span></a><span class=w>            </span>
</span><span id=__span-52-109><a id=__codelineno-52-109 name=__codelineno-52-109></a><a href=#__codelineno-52-109><span class=linenos data-linenos="109 "></span></a><span class=w>            </span><span class=nx>logEvent</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-110><a id=__codelineno-52-110 name=__codelineno-52-110></a><a href=#__codelineno-52-110><span class=linenos data-linenos="110 "></span></a><span class=w>                </span><span class=kd>const</span><span class=w> </span><span class=nx>logEl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;eventLog&#39;</span><span class=p>);</span>
</span><span id=__span-52-111><a id=__codelineno-52-111 name=__codelineno-52-111></a><a href=#__codelineno-52-111><span class=linenos data-linenos="111 "></span></a><span class=w>                </span><span class=nx>logEl</span><span class=p>.</span><span class=nx>innerHTML</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=nx>message</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&lt;br&gt;&#39;</span><span class=p>;</span>
</span><span id=__span-52-112><a id=__codelineno-52-112 name=__codelineno-52-112></a><a href=#__codelineno-52-112><span class=linenos data-linenos="112 "></span></a><span class=w>                </span><span class=nx>logEl</span><span class=p>.</span><span class=nx>scrollTop</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>logEl</span><span class=p>.</span><span class=nx>scrollHeight</span><span class=p>;</span>
</span><span id=__span-52-113><a id=__codelineno-52-113 name=__codelineno-52-113></a><a href=#__codelineno-52-113><span class=linenos data-linenos="113 "></span></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-52-114><a id=__codelineno-52-114 name=__codelineno-52-114></a><a href=#__codelineno-52-114><span class=linenos data-linenos="114 "></span></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-52-115><a id=__codelineno-52-115 name=__codelineno-52-115></a><a href=#__codelineno-52-115><span class=linenos data-linenos="115 "></span></a><span class=w>        </span>
</span><span id=__span-52-116><a id=__codelineno-52-116 name=__codelineno-52-116></a><a href=#__codelineno-52-116><span class=linenos data-linenos="116 "></span></a><span class=w>        </span><span class=c1>// Initialize dashboard</span>
</span><span id=__span-52-117><a id=__codelineno-52-117 name=__codelineno-52-117></a><a href=#__codelineno-52-117><span class=linenos data-linenos="117 "></span></a><span class=w>        </span><span class=ow>new</span><span class=w> </span><span class=nx>TDDDashboard</span><span class=p>();</span>
</span><span id=__span-52-118><a id=__codelineno-52-118 name=__codelineno-52-118></a><a href=#__codelineno-52-118><span class=linenos data-linenos="118 "></span></a><span class=w>    </span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span><span id=__span-52-119><a id=__codelineno-52-119 name=__codelineno-52-119></a><a href=#__codelineno-52-119><span class=linenos data-linenos="119 "></span></a><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span><span id=__span-52-120><a id=__codelineno-52-120 name=__codelineno-52-120></a><a href=#__codelineno-52-120><span class=linenos data-linenos="120 "></span></a><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></code></pre></div><h2 id=integration-summary>Integration Summary<a class=headerlink href=#integration-summary title="Permanent link">&para;</a></h2><p>This comprehensive integration guide provides practical examples for connecting the AI Agent TDD-Scrum workflow system with various tools, platforms, and services commonly used in software development workflows.</p><h3 id=quick-start-integration-checklist>Quick Start Integration Checklist<a class=headerlink href=#quick-start-integration-checklist title="Permanent link">&para;</a></h3><p><strong>WebSocket API Integration:</strong> - ✅ JavaScript client for real-time state monitoring - ✅ Python async client for TDD state tracking - ✅ HTML dashboard for web-based monitoring</p><p><strong>GitHub Integration:</strong> - ✅ Basic webhook handler for repository events - ✅ TDD-specific GitHub API integration - ✅ Pull request automation and validation</p><p><strong>CI/CD Integration:</strong> - ✅ Minimal GitHub Actions workflow - ✅ Basic Docker containerization - ✅ Complete CI/CD pipeline examples</p><p>All examples are designed to be minimal working implementations that can be extended based on specific project requirements.</p><h2 id=next-steps>Next Steps<a class=headerlink href=#next-steps title="Permanent link">&para;</a></h2><h3 id=apply-what-youve-learned>Apply What You've Learned<a class=headerlink href=#apply-what-youve-learned title="Permanent link">&para;</a></h3><ul><li><strong>Start your project</strong>: Use <a href=../cli-reference/ >CLI Reference</a> to set up your own integration</li><li><strong>Get help when stuck</strong>: Check the <a href=../troubleshooting/ >Troubleshooting Guide</a> for common solutions</li><li><strong>Scale your workflow</strong>: Explore <a href=../multi-project-orchestration/ >Multi-project Orchestration</a> for complex setups</li></ul><h3 id=see-also>See Also<a class=headerlink href=#see-also title="Permanent link">&para;</a></h3><ul><li><strong>Need the basics first?</strong> Go back to <a href=../../getting-started/quick-start/ >Quick Start</a> for setup guidance</li><li><strong>Understand the workflow</strong>: Learn about the <a href=../state-machine/ >State Machine</a> powering these examples</li><li><strong>Monitor performance</strong>: Set up <a href=../performance-monitoring/ >Performance Monitoring</a> for production use</li></ul><aside class=md-source-file><span class=md-source-file__fact><span class=md-icon title="Last update"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="June 20, 2025 03:29:02 UTC">June 20, 2025 03:29:02</span></span><span class=md-source-file__fact><span class=md-icon title=Created><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="June 18, 2025 14:09:11 UTC">June 18, 2025 14:09:11</span></span></aside><form class=md-feedback name=feedback hidden><fieldset><legend class=md-feedback__title> Was this page helpful? </legend><div class=md-feedback__inner><div class=md-feedback__list><button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg></button><button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg></button></div><div class=md-feedback__note><div data-md-value=1 hidden> Thanks for your feedback! </div><div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by <a href="https://github.com/jmontp/agent-workflow/issues/new/?title=[Feedback]+%F0%9F%94%8C%20Integration%20Examples+-+/user-guide/integration-examples/" target=_blank rel=noopener>telling us what you found confusing</a>. </div></div></div></fieldset></form></article></div><script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script><script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script></div><button type=button class="md-top md-icon" data-md-component=top hidden><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button></main><footer class=md-footer><nav class="md-footer__inner md-grid" aria-label=Footer><a href=../health-monitoring/ class="md-footer__link md-footer__link--prev" aria-label="Previous: 🏥 Health Monitoring"><div class="md-footer__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M15.41 16.58 10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg></div><div class=md-footer__title><span class=md-footer__direction> Previous </span><div class=md-ellipsis> 🏥 Health Monitoring </div></div></a><a href=../ui-portal-guide/ class="md-footer__link md-footer__link--next" aria-label="Next: 🎨 UI Portal Guide"><div class=md-footer__title><span class=md-footer__direction> Next </span><div class=md-ellipsis> 🎨 UI Portal Guide </div></div><div class="md-footer__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg></div></a></nav><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-copyright></div><div class=md-social><a href=https://github.com/jmontp/agent-workflow target=_blank rel=noopener title="GitHub Repository" class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg></a><a href=https://jmontp.github.io/agent-workflow/ target=_blank rel=noopener title="Documentation Site" class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg></a><a href=https://discord.gg/your-discord-server target=_blank rel=noopener title="Discord Community" class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3c5.5 0 10 3.58 10 8s-4.5 8-10 8c-1.24 0-2.43-.18-3.53-.5C5.55 21 2 21 2 21c2.33-2.33 2.7-3.9 2.75-4.5C3.05 15.07 2 13.13 2 11c0-4.42 4.5-8 10-8"/></svg></a><a href=https://github.com/sponsors/jmontp target=_blank rel=noopener title=Sponsor class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12 21.35-1.45-1.32C5.4 15.36 2 12.27 2 8.5 2 5.41 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.08C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53z"/></svg></a></div></div></div></footer></div><div class=md-dialog data-md-component=dialog><div class="md-dialog__inner md-typeset"></div></div><div class=md-progress data-md-component=progress role=progressbar></div><div class=md-consent data-md-component=consent id=__consent hidden><div class=md-consent__overlay></div><aside class=md-consent__inner><form class="md-consent__form md-grid md-typeset" name=consent><h4>Cookie consent</h4><p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p><input class=md-toggle type=checkbox id=__settings><div class=md-consent__settings><ul class=task-list><li class=task-list-item><label class=task-list-control><input type=checkbox name=analytics checked><span class=task-list-indicator></span> Google Analytics </label></li><li class=task-list-item><label class=task-list-control><input type=checkbox name=github checked><span class=task-list-indicator></span> GitHub </label></li></ul></div><div class=md-consent__controls><button class="md-button md-button--primary">Accept</button><button type=reset class="md-button md-button--primary">Reject</button><label class=md-button for=__settings>Manage settings</label></div></form></aside></div><script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script><script id=__config type=application/json>{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.footnote.tooltips", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": {"API": "api", "Architecture": "architecture", "CSS": "css", "Discord": "discord", "HTML5": "html", "JavaScript": "js", "Python": "python", "Scrum": "scrum", "TDD": "tdd"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script><script src=../../assets/javascripts/bundle.13a4f30d.min.js></script><script src=https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mtml-chtml.js></script><script src=../../js/mermaid-zoom.js></script><script src=../../js/universal-search.js></script><script src=../../js/enhanced-navigation.js></script><script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body></html>