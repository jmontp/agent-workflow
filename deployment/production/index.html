<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Human-In-The-Loop orchestration framework for AI-assisted software development"><meta name=author content="AI Agent Workflow Team"><link href=https://jmontp.github.io/agent-workflow/deployment/production/ rel=canonical><link href=../DISCORD_SETUP_SUMMARY/ rel=prev><link href=../github-pages/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.14"><title>Production Deployment - AI Agent TDD-Scrum Workflow</title><link rel=stylesheet href=../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><style>:root{.md-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M5.5%207A1.5%201.5%200%200%201%204%205.5%201.5%201.5%200%200%201%205.5%204%201.5%201.5%200%200%201%207%205.5%201.5%201.5%200%200%201%205.5%207m15.91%204.58-9-9C12.05%202.22%2011.55%202%2011%202H4c-1.11%200-2%20.89-2%202v7c0%20.55.22%201.05.59%201.41l8.99%209c.37.36.87.59%201.42.59s1.05-.23%201.41-.59l7-7c.37-.36.59-.86.59-1.41%200-.56-.23-1.06-.59-1.42%22/%3E%3C/svg%3E');}.md-tag.md-tag--html{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22m12%2017.56%204.07-1.13.55-6.1H9.38L9.2%208.3h7.6l.2-1.99H7l.56%206.01h6.89l-.23%202.58-2.22.6-2.22-.6-.14-1.66h-2l.29%203.19zM4.07%203h15.86L18.5%2019.2%2012%2021l-6.5-1.8z%22/%3E%3C/svg%3E');}.md-tag.md-tag--js{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M3%203h18v18H3zm4.73%2015.04c.4.85%201.19%201.55%202.54%201.55%201.5%200%202.53-.8%202.53-2.55v-5.78h-1.7V17c0%20.86-.35%201.08-.9%201.08-.58%200-.82-.4-1.09-.87zm5.98-.18c.5.98%201.51%201.73%203.09%201.73%201.6%200%202.8-.83%202.8-2.36%200-1.41-.81-2.04-2.25-2.66l-.42-.18c-.73-.31-1.04-.52-1.04-1.02%200-.41.31-.73.81-.73.48%200%20.8.21%201.09.73l1.31-.87c-.55-.96-1.33-1.33-2.4-1.33-1.51%200-2.48.96-2.48%202.23%200%201.38.81%202.03%202.03%202.55l.42.18c.78.34%201.24.55%201.24%201.13%200%20.48-.45.83-1.15.83-.83%200-1.31-.43-1.67-1.03z%22/%3E%3C/svg%3E');}.md-tag.md-tag--css{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22m5%203-.65%203.34h13.59L17.5%208.5H3.92l-.66%203.33h13.59l-.76%203.81-5.48%201.81-4.75-1.81.33-1.64H2.85l-.79%204%207.85%203%209.05-3%201.2-6.03.24-1.21L21.94%203z%22/%3E%3C/svg%3E');}.md-tag.md-tag--python{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M19.14%207.5A2.86%202.86%200%200%201%2022%2010.36v3.78A2.86%202.86%200%200%201%2019.14%2017H12c0%20.39.32.96.71.96H17v1.68a2.86%202.86%200%200%201-2.86%202.86H9.86A2.86%202.86%200%200%201%207%2019.64v-3.75a2.85%202.85%200%200%201%202.86-2.85h5.25a2.85%202.85%200%200%200%202.85-2.86V7.5zm-4.28%2011.79c-.4%200-.72.3-.72.89s.32.71.72.71a.71.71%200%200%200%20.71-.71c0-.59-.32-.89-.71-.89m-10-1.79A2.86%202.86%200%200%201%202%2014.64v-3.78A2.86%202.86%200%200%201%204.86%208H12c0-.39-.32-.96-.71-.96H7V5.36A2.86%202.86%200%200%201%209.86%202.5h4.28A2.86%202.86%200%200%201%2017%205.36v3.75a2.85%202.85%200%200%201-2.86%202.85H8.89a2.85%202.85%200%200%200-2.85%202.86v2.68zM9.14%205.71c.4%200%20.72-.3.72-.89s-.32-.71-.72-.71c-.39%200-.71.12-.71.71s.32.89.71.89%22/%3E%3C/svg%3E');}}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><link rel=stylesheet href=../../stylesheets/enhanced-navigation.css><link rel=stylesheet href=../../stylesheets/color-schemes.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script> <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head><body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=blue><input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off><input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off><label class=md-overlay for=__drawer></label><div data-md-component=skip><a href=#production-deployment class=md-skip> Skip to content </a></div><div data-md-component=announce></div><div data-md-color-scheme=default data-md-component=outdated hidden></div><header class="md-header md-header--shadow md-header--lifted" data-md-component=header><nav class="md-header__inner md-grid" aria-label=Header><a href=../.. title="AI Agent TDD-Scrum Workflow" class="md-header__button md-logo" aria-label="AI Agent TDD-Scrum Workflow" data-md-component=logo><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg></a><label class="md-header__button md-icon" for=__drawer><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg></label><div class=md-header__title data-md-component=header-title><div class=md-header__ellipsis><div class=md-header__topic><span class=md-ellipsis> AI Agent TDD-Scrum Workflow </span></div><div class=md-header__topic data-md-component=header-topic><span class=md-ellipsis> Production Deployment </span></div></div></div><form class=md-header__option data-md-component=palette><input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0><label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg></label><input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_1><label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg></label></form><script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script><div class=md-header__option><div class=md-select><button class="md-header__button md-icon" aria-label="Select language"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg></button><div class=md-select__inner><ul class=md-select__list><li class=md-select__item><a href=../../ hreflang=en class=md-select__link> English </a></li></ul></div></div></div><label class="md-header__button md-icon" for=__search><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required><label class="md-search__icon md-icon" for=__search><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M15.41 16.58 10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg></label><nav class=md-search__options aria-label=Search><a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg></a><button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button></nav><div class=md-search__suggest data-md-component=search-suggest></div></form><div class=md-search__output><div class=md-search__scrollwrap tabindex=0 data-md-scrollfix><div class=md-search-result data-md-component=search-result><div class=md-search-result__meta> Initializing search </div><ol class=md-search-result__list role=presentation></ol></div></div></div></div></div><div class=md-header__source><a href=https://github.com/jmontp/agent-workflow title="Go to repository" class=md-source data-md-component=source><div class="md-source__icon md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg></div><div class=md-source__repository> jmontp/agent-workflow </div></a></div></nav><nav class=md-tabs aria-label=Tabs data-md-component=tabs><div class=md-grid><ul class=md-tabs__list><li class=md-tabs__item><a href=../.. class=md-tabs__link> 🏠 Home </a></li><li class=md-tabs__item><a href=../../getting-started/ class=md-tabs__link> ⚡ Getting Started </a></li><li class=md-tabs__item><a href=../../user-guide/ class=md-tabs__link> 📊 User Guide </a></li><li class=md-tabs__item><a href=../../concepts/ class=md-tabs__link> 🎯 Core Concepts </a></li><li class=md-tabs__item><a href=../../architecture/ class=md-tabs__link> 🔥 Architecture </a></li><li class=md-tabs__item><a href=../../advanced/ class=md-tabs__link> ⚡ Advanced Topics </a></li><li class=md-tabs__item><a href=../../planning/ class=md-tabs__link> 🎨 Planning & Design </a></li><li class=md-tabs__item><a href=../../development/ class=md-tabs__link> 📊 Development </a></li><li class="md-tabs__item md-tabs__item--active"><a href=../ class=md-tabs__link> 🔥 Deployment </a></li><li class=md-tabs__item><a href=../../templates/ class=md-tabs__link> 📋 Templates </a></li><li class=md-tabs__item><a href=../../theme-integration-guide/ class=md-tabs__link> 🎨 Theme Integration </a></li></ul></div></nav></header><div class=md-container data-md-component=container><main class=md-main data-md-component=main><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0><label class=md-nav__title for=__drawer><a href=../.. title="AI Agent TDD-Scrum Workflow" class="md-nav__button md-logo" aria-label="AI Agent TDD-Scrum Workflow" data-md-component=logo><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg></a> AI Agent TDD-Scrum Workflow </label><div class=md-nav__source><a href=https://github.com/jmontp/agent-workflow title="Go to repository" class=md-source data-md-component=source><div class="md-source__icon md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg></div><div class=md-source__repository> jmontp/agent-workflow </div></a></div><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../.. class=md-nav__link><span class=md-ellipsis> 🏠 Home </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../getting-started/ class=md-nav__link><span class=md-ellipsis> ⚡ Getting Started </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../user-guide/ class=md-nav__link><span class=md-ellipsis> 📊 User Guide </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../concepts/ class=md-nav__link><span class=md-ellipsis> 🎯 Core Concepts </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../architecture/ class=md-nav__link><span class=md-ellipsis> 🔥 Architecture </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../advanced/ class=md-nav__link><span class=md-ellipsis> ⚡ Advanced Topics </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../planning/ class=md-nav__link><span class=md-ellipsis> 🎨 Planning & Design </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../development/ class=md-nav__link><span class=md-ellipsis> 📊 Development </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9 checked><div class="md-nav__link md-nav__container"><a href=../ class="md-nav__link "><span class=md-ellipsis> 🔥 Deployment </span></a><label class="md-nav__link " for=__nav_9 id=__nav_9_label tabindex><span class="md-nav__icon md-icon"></span></label></div><nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=true><label class=md-nav__title for=__nav_9><span class="md-nav__icon md-icon"></span> 🔥 Deployment </label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a href=../discord-setup/ class=md-nav__link><span class=md-ellipsis> Discord Setup </span></a></li><li class=md-nav__item><a href=../DISCORD_SETUP_SUMMARY/ class=md-nav__link><span class=md-ellipsis> Discord Setup Summary </span></a></li><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle" type=checkbox id=__toc><label class="md-nav__link md-nav__link--active" for=__toc><span class=md-ellipsis> Production Deployment </span><span class="md-nav__icon md-icon"></span></label><a href=./ class="md-nav__link md-nav__link--active"><span class=md-ellipsis> Production Deployment </span></a><nav class="md-nav md-nav--secondary" aria-label="On this page"><label class=md-nav__title for=__toc><span class="md-nav__icon md-icon"></span> On this page </label><ul class=md-nav__list data-md-component=toc data-md-scrollfix><li class=md-nav__item><a href=#deployment-picker class=md-nav__link><span class=md-ellipsis> Deployment Picker </span></a></li><li class=md-nav__item><a href=#one-click-deploy class=md-nav__link><span class=md-ellipsis> One-Click Deploy </span></a></li><li class=md-nav__item><a href=#cost-calculator class=md-nav__link><span class=md-ellipsis> Cost Calculator </span></a></li><li class=md-nav__item><a href=#interactive-architecture class=md-nav__link><span class=md-ellipsis> Interactive Architecture </span></a></li><li class=md-nav__item><a href=#hobby-deployment class=md-nav__link><span class=md-ellipsis> Hobby Deployment </span></a><nav class=md-nav aria-label="Hobby Deployment"><ul class=md-nav__list><li class=md-nav__item><a href=#quick-start-with-docker class=md-nav__link><span class=md-ellipsis> Quick Start with Docker </span></a></li><li class=md-nav__item><a href=#hobby-docker-compose-configuration class=md-nav__link><span class=md-ellipsis> Hobby Docker Compose Configuration </span></a></li><li class=md-nav__item><a href=#hobby-limitations class=md-nav__link><span class=md-ellipsis> Hobby Limitations </span></a></li></ul></nav></li><li class=md-nav__item><a href=#startup-deployment class=md-nav__link><span class=md-ellipsis> Startup Deployment </span></a><nav class=md-nav aria-label="Startup Deployment"><ul class=md-nav__list><li class=md-nav__item><a href=#railway-deployment class=md-nav__link><span class=md-ellipsis> Railway Deployment </span></a></li><li class=md-nav__item><a href=#heroku-deployment class=md-nav__link><span class=md-ellipsis> Heroku Deployment </span></a></li><li class=md-nav__item><a href=#startup-features class=md-nav__link><span class=md-ellipsis> Startup Features </span></a></li></ul></nav></li><li class=md-nav__item><a href=#enterprise-deployment class=md-nav__link><span class=md-ellipsis> Enterprise Deployment </span></a><nav class=md-nav aria-label="Enterprise Deployment"><ul class=md-nav__list><li class=md-nav__item><a href=#kubernetes-deployment class=md-nav__link><span class=md-ellipsis> Kubernetes Deployment </span></a></li><li class=md-nav__item><a href=#enterprise-features class=md-nav__link><span class=md-ellipsis> Enterprise Features </span></a></li></ul></nav></li><li class=md-nav__item><a href=#container-orchestration class=md-nav__link><span class=md-ellipsis> Container Orchestration </span></a><nav class=md-nav aria-label="Container Orchestration"><ul class=md-nav__list><li class=md-nav__item><a href=#docker-swarm class=md-nav__link><span class=md-ellipsis> Docker Swarm </span></a></li><li class=md-nav__item><a href=#kubernetes-with-helm class=md-nav__link><span class=md-ellipsis> Kubernetes with Helm </span></a></li></ul></nav></li><li class=md-nav__item><a href=#monitoring-observability class=md-nav__link><span class=md-ellipsis> Monitoring &amp; Observability </span></a><nav class=md-nav aria-label="Monitoring & Observability"><ul class=md-nav__list><li class=md-nav__item><a href=#prometheus-grafana-stack class=md-nav__link><span class=md-ellipsis> Prometheus + Grafana Stack </span></a></li><li class=md-nav__item><a href=#prometheus-configuration class=md-nav__link><span class=md-ellipsis> Prometheus Configuration </span></a></li><li class=md-nav__item><a href=#custom-metrics-implementation class=md-nav__link><span class=md-ellipsis> Custom Metrics Implementation </span></a></li><li class=md-nav__item><a href=#grafana-dashboards class=md-nav__link><span class=md-ellipsis> Grafana Dashboards </span></a></li></ul></nav></li><li class=md-nav__item><a href=#security-hardening class=md-nav__link><span class=md-ellipsis> Security Hardening </span></a><nav class=md-nav aria-label="Security Hardening"><ul class=md-nav__list><li class=md-nav__item><a href=#ssltls-configuration class=md-nav__link><span class=md-ellipsis> SSL/TLS Configuration </span></a></li><li class=md-nav__item><a href=#firewall-configuration class=md-nav__link><span class=md-ellipsis> Firewall Configuration </span></a></li><li class=md-nav__item><a href=#secrets-management class=md-nav__link><span class=md-ellipsis> Secrets Management </span></a></li><li class=md-nav__item><a href=#environment-security class=md-nav__link><span class=md-ellipsis> Environment Security </span></a></li></ul></nav></li><li class=md-nav__item><a href=#high-availability class=md-nav__link><span class=md-ellipsis> High Availability </span></a><nav class=md-nav aria-label="High Availability"><ul class=md-nav__list><li class=md-nav__item><a href=#load-balancer-configuration class=md-nav__link><span class=md-ellipsis> Load Balancer Configuration </span></a></li><li class=md-nav__item><a href=#database-high-availability class=md-nav__link><span class=md-ellipsis> Database High Availability </span></a></li><li class=md-nav__item><a href=#redis-high-availability class=md-nav__link><span class=md-ellipsis> Redis High Availability </span></a></li></ul></nav></li><li class=md-nav__item><a href=#performance-optimization class=md-nav__link><span class=md-ellipsis> Performance Optimization </span></a><nav class=md-nav aria-label="Performance Optimization"><ul class=md-nav__list><li class=md-nav__item><a href=#application-performance class=md-nav__link><span class=md-ellipsis> Application Performance </span></a></li><li class=md-nav__item><a href=#database-optimization class=md-nav__link><span class=md-ellipsis> Database Optimization </span></a></li><li class=md-nav__item><a href=#caching-strategy class=md-nav__link><span class=md-ellipsis> Caching Strategy </span></a></li></ul></nav></li><li class=md-nav__item><a href=#disaster-recovery class=md-nav__link><span class=md-ellipsis> Disaster Recovery </span></a><nav class=md-nav aria-label="Disaster Recovery"><ul class=md-nav__list><li class=md-nav__item><a href=#backup-strategy class=md-nav__link><span class=md-ellipsis> Backup Strategy </span></a></li><li class=md-nav__item><a href=#restore-procedures class=md-nav__link><span class=md-ellipsis> Restore Procedures </span></a></li><li class=md-nav__item><a href=#disaster-recovery-testing class=md-nav__link><span class=md-ellipsis> Disaster Recovery Testing </span></a></li></ul></nav></li><li class=md-nav__item><a href=#security-best-practices class=md-nav__link><span class=md-ellipsis> Security Best Practices </span></a><nav class=md-nav aria-label="Security Best Practices"><ul class=md-nav__list><li class=md-nav__item><a href=#security-hardening-checklist class=md-nav__link><span class=md-ellipsis> Security Hardening Checklist </span></a></li><li class=md-nav__item><a href=#owasp-security-headers class=md-nav__link><span class=md-ellipsis> OWASP Security Headers </span></a></li></ul></nav></li><li class=md-nav__item><a href=#compliance-auditing class=md-nav__link><span class=md-ellipsis> Compliance &amp; Auditing </span></a><nav class=md-nav aria-label="Compliance & Auditing"><ul class=md-nav__list><li class=md-nav__item><a href=#soc-2-compliance class=md-nav__link><span class=md-ellipsis> SOC 2 Compliance </span></a></li><li class=md-nav__item><a href=#audit-logging-implementation class=md-nav__link><span class=md-ellipsis> Audit Logging Implementation </span></a></li><li class=md-nav__item><a href=#compliance-monitoring class=md-nav__link><span class=md-ellipsis> Compliance Monitoring </span></a></li></ul></nav></li><li class=md-nav__item><a href=#deployment-checklist class=md-nav__link><span class=md-ellipsis> Deployment Checklist </span></a><nav class=md-nav aria-label="Deployment Checklist"><ul class=md-nav__list><li class=md-nav__item><a href=#pre-deployment-checklist class=md-nav__link><span class=md-ellipsis> Pre-Deployment Checklist </span></a></li><li class=md-nav__item><a href=#post-deployment-checklist class=md-nav__link><span class=md-ellipsis> Post-Deployment Checklist </span></a></li></ul></nav></li><li class=md-nav__item><a href=#troubleshooting-guide class=md-nav__link><span class=md-ellipsis> Troubleshooting Guide </span></a><nav class=md-nav aria-label="Troubleshooting Guide"><ul class=md-nav__list><li class=md-nav__item><a href=#common-issues-and-solutions class=md-nav__link><span class=md-ellipsis> Common Issues and Solutions </span></a></li><li class=md-nav__item><a href=#debugging-commands class=md-nav__link><span class=md-ellipsis> Debugging Commands </span></a></li></ul></nav></li><li class=md-nav__item><a href=#conclusion class=md-nav__link><span class=md-ellipsis> Conclusion </span></a></li></ul></nav></li><li class=md-nav__item><a href=../github-pages/ class=md-nav__link><span class=md-ellipsis> GitHub Pages </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../templates/ class=md-nav__link><span class=md-ellipsis> 📋 Templates </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a href=../../theme-integration-guide/ class=md-nav__link><span class=md-ellipsis> 🎨 Theme Integration </span><span class="md-nav__icon md-icon"></span></a></li></ul></nav></div></div></div><div class=md-content data-md-component=content><article class="md-content__inner md-typeset"><a href=https://github.com/jmontp/agent-workflow/edit/master/docs/deployment/production.md title="Edit this page" class="md-content__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg></a><a href=https://github.com/jmontp/agent-workflow/raw/master/docs/deployment/production.md title="View source of this page" class="md-content__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg></a><h1 id=production-deployment>Production Deployment<a class=headerlink href=#production-deployment title="Permanent link">&para;</a></h1><p>Deploy your AI Agent TDD-Scrum workflow system to production with enterprise-grade reliability, security, and scalability.</p><h2 id=deployment-picker>Deployment Picker<a class=headerlink href=#deployment-picker title="Permanent link">&para;</a></h2><p>Choose the perfect deployment tier for your team:</p><div class=deployment-picker><div class="tier-card hobby"><div class=tier-header><h3>🚀 Hobby</h3><div class=price>Free</div></div><div class=tier-features><ul><li>✅ Single project</li><li>✅ Community support</li><li>✅ Basic monitoring</li><li>✅ Docker deployment</li><li>⚠️ 1GB RAM limit</li><li>⚠️ Shared resources</li></ul></div><div class=tier-actions><a href=#hobby-deployment class=btn-primary>Get Started Free</a></div></div><div class="tier-card startup"><div class=tier-header><h3>⚡ Startup</h3><div class=price>$49<span>/month</span></div></div><div class=tier-features><ul><li>✅ Up to 10 projects</li><li>✅ Priority support</li><li>✅ Advanced monitoring</li><li>✅ Auto-scaling</li><li>✅ SSL certificates</li><li>✅ 8GB RAM included</li></ul></div><div class=tier-actions><a href=#startup-deployment class=btn-primary>Start Free Trial</a></div></div><div class="tier-card enterprise"><div class=tier-header><h3>🏢 Enterprise</h3><div class=price>Custom</div></div><div class=tier-features><ul><li>✅ Unlimited projects</li><li>✅ 24/7 enterprise support</li><li>✅ Full observability suite</li><li>✅ Multi-region deployment</li><li>✅ SOC 2 compliance</li><li>✅ Custom integrations</li></ul></div><div class=tier-actions><a href=#enterprise-deployment class=btn-primary>Contact Sales</a></div></div></div><h2 id=one-click-deploy>One-Click Deploy<a class=headerlink href=#one-click-deploy title="Permanent link">&para;</a></h2><p>Deploy instantly to your preferred cloud platform:</p><div class=deploy-buttons><a href="https://heroku.com/deploy?template=https://github.com/yourusername/agent-workflow" class="deploy-btn heroku"><img src=https://www.herokucdn.com/deploy/button.svg alt="Deploy to Heroku"></a><a href=https://railway.app/new/template/agent-workflow class="deploy-btn railway"><img src=https://railway.app/button.svg alt="Deploy on Railway"></a><a href="https://console.aws.amazon.com/cloudformation/home#/stacks/new?stackName=agent-workflow&templateURL=https://agent-workflow-templates.s3.amazonaws.com/cloudformation.yaml" class="deploy-btn aws"><img src=https://s3.amazonaws.com/cloudformation-examples/cloudformation-launch-stack.png alt="Launch Stack"></a><a href="https://console.cloud.google.com/cloudshell/editor?cloudshell_git_repo=https://github.com/yourusername/agent-workflow&cloudshell_tutorial=deploy/gcp/tutorial.md" class="deploy-btn gcp"><img src=https://gstatic.com/cloudssh/images/open-btn.png alt="Open in Cloud Shell"></a><a href=https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fyourusername%2Fagent-workflow%2Fmain%2Fazuredeploy.json class="deploy-btn azure"><img src=https://aka.ms/deploytoazurebutton alt="Deploy to Azure"></a></div><h2 id=cost-calculator>Cost Calculator<a class=headerlink href=#cost-calculator title="Permanent link">&para;</a></h2><p>Estimate your monthly costs across different deployment tiers:</p><div class=cost-calculator><div class=calculator-inputs><div class=input-group><label>Number of Projects</label><input type=number id=projects value=1 min=1 max=100></div><div class=input-group><label>Team Size</label><input type=number id=team-size value=5 min=1 max=1000></div><div class=input-group><label>Daily Active Hours</label><input type=number id=active-hours value=8 min=1 max=24></div><div class=input-group><label>Region</label><select id=region><option value=us-east-1>US East (N. Virginia)</option><option value=us-west-2>US West (Oregon)</option><option value=eu-west-1>Europe (Ireland)</option><option value=ap-southeast-1>Asia Pacific (Singapore)</option></select></div></div><div class=cost-breakdown><h4>Estimated Monthly Cost</h4><div class=cost-items><div class=cost-item><span>Compute (CPU + Memory)</span><span id=compute-cost>$0.00</span></div><div class=cost-item><span>Storage (Database + Files)</span><span id=storage-cost>$0.00</span></div><div class=cost-item><span>Network (Bandwidth)</span><span id=network-cost>$0.00</span></div><div class=cost-item><span>Monitoring & Logs</span><span id=monitoring-cost>$0.00</span></div><div class=cost-total><span><strong>Total Monthly Cost</strong></span><span id=total-cost><strong>$0.00</strong></span></div></div></div></div><h2 id=interactive-architecture>Interactive Architecture<a class=headerlink href=#interactive-architecture title="Permanent link">&para;</a></h2><p>Explore the system architecture with interactive, zoomable diagrams:</p><div class=architecture-viewer><div class=architecture-tabs><button class="tab-btn active" data-tab=overview>System Overview</button><button class=tab-btn data-tab=microservices>Microservices</button><button class=tab-btn data-tab=security>Security Layer</button><button class=tab-btn data-tab=data-flow>Data Flow</button></div><div class=architecture-content><div id=overview-diagram class="diagram-container active"><div class=diagram-zoom-controls><button class=zoom-btn data-action=zoom-in>+</button><button class=zoom-btn data-action=zoom-out>-</button><button class=zoom-btn data-action=reset>⌂</button></div><div class=diagram-svg><svg viewbox="0 0 1200 800" class=architecture-svg><defs><lineargradient id=blueGradient x1=0% y1=0% x2=100% y2=100%><stop offset=0% style=stop-color:#3B82F6;stop-opacity:1 /><stop offset=100% style=stop-color:#1E40AF;stop-opacity:1 /></lineargradient><lineargradient id=greenGradient x1=0% y1=0% x2=100% y2=100%><stop offset=0% style=stop-color:#10B981;stop-opacity:1 /><stop offset=100% style=stop-color:#047857;stop-opacity:1 /></lineargradient></defs><rect x=50 y=50 width=200 height=100 rx=10 fill=url(#blueGradient) class=diagram-node data-tooltip="Discord Bot - HITL Interface"><title>Discord Bot - Human-in-the-loop interface for command execution</title></rect><text x=150 y=100 text-anchor=middle fill=white font-weight=bold>Discord Bot</text><rect x=350 y=200 width=200 height=100 rx=10 fill=url(#greenGradient) class=diagram-node data-tooltip="Orchestrator - Central Coordination"><title>Orchestrator - Central workflow coordination and state management</title></rect><text x=450 y=250 text-anchor=middle fill=white font-weight=bold>Orchestrator</text><rect x=50 y=350 width=150 height=80 rx=8 fill=#F59E0B class=diagram-node data-tooltip="Design Agent"><title>Design Agent - Architecture and planning</title></rect><text x=125 y=395 text-anchor=middle fill=white font-size=12>Design Agent</text><rect x=220 y=350 width=150 height=80 rx=8 fill=#EF4444 class=diagram-node data-tooltip="Code Agent"><title>Code Agent - Implementation and development</title></rect><text x=295 y=395 text-anchor=middle fill=white font-size=12>Code Agent</text><rect x=390 y=350 width=150 height=80 rx=8 fill=#8B5CF6 class=diagram-node data-tooltip="QA Agent"><title>QA Agent - Testing and quality assurance</title></rect><text x=465 y=395 text-anchor=middle fill=white font-size=12>QA Agent</text><rect x=560 y=350 width=150 height=80 rx=8 fill=#06B6D4 class=diagram-node data-tooltip="Data Agent"><title>Data Agent - Analytics and reporting</title></rect><text x=635 y=395 text-anchor=middle fill=white font-size=12>Data Agent</text><rect x=800 y=200 width=150 height=80 rx=8 fill=#6B7280 class=diagram-node data-tooltip="PostgreSQL Database"><title>PostgreSQL - Primary data storage</title></rect><text x=875 y=245 text-anchor=middle fill=white font-size=12>PostgreSQL</text><rect x=800 y=300 width=150 height=80 rx=8 fill=#DC2626 class=diagram-node data-tooltip="Redis Cache"><title>Redis - Caching and session storage</title></rect><text x=875 y=345 text-anchor=middle fill=white font-size=12>Redis Cache</text><line x1=150 y1=150 x2=350 y2=200 stroke=#374151 stroke-width=2 marker-end=url(#arrowhead) /><line x1=450 y1=300 x2=125 y2=350 stroke=#374151 stroke-width=2 marker-end=url(#arrowhead) /><line x1=450 y1=300 x2=295 y2=350 stroke=#374151 stroke-width=2 marker-end=url(#arrowhead) /><line x1=450 y1=300 x2=465 y2=350 stroke=#374151 stroke-width=2 marker-end=url(#arrowhead) /><line x1=450 y1=300 x2=635 y2=350 stroke=#374151 stroke-width=2 marker-end=url(#arrowhead) /><line x1=550 y1=240 x2=800 y2=240 stroke=#374151 stroke-width=2 marker-end=url(#arrowhead) /><line x1=550 y1=260 x2=800 y2=340 stroke=#374151 stroke-width=2 marker-end=url(#arrowhead) /><defs><marker id=arrowhead markerwidth=10 markerheight=7 refx=9 refy=3.5 orient=auto><polygon fill=#374151 points="0 0, 10 3.5, 0 7"/></marker></defs></svg></div></div><div id=microservices-diagram class=diagram-container><div class=diagram-placeholder><h3>Microservices Architecture</h3><p>Interactive diagram showing service boundaries, APIs, and communication patterns</p></div></div><div id=security-diagram class=diagram-container><div class=diagram-placeholder><h3>Security Architecture</h3><p>Interactive diagram showing security boundaries, authentication flows, and encryption</p></div></div><div id=data-flow-diagram class=diagram-container><div class=diagram-placeholder><h3>Data Flow Architecture</h3><p>Interactive diagram showing data movement, processing, and storage patterns</p></div></div></div></div><h2 id=hobby-deployment>Hobby Deployment<a class=headerlink href=#hobby-deployment title="Permanent link">&para;</a></h2><p>Perfect for individual developers and small teams getting started.</p><h3 id=quick-start-with-docker>Quick Start with Docker<a class=headerlink href=#quick-start-with-docker title="Permanent link">&para;</a></h3><div class="language-bash highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1></a><a href=#__codelineno-0-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># Clone the repository</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2></a><a href=#__codelineno-0-2><span class=linenos data-linenos=" 2 "></span></a>git<span class=w> </span>clone<span class=w> </span>https://github.com/yourusername/agent-workflow.git
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3></a><a href=#__codelineno-0-3><span class=linenos data-linenos=" 3 "></span></a><span class=nb>cd</span><span class=w> </span>agent-workflow
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4></a><a href=#__codelineno-0-4><span class=linenos data-linenos=" 4 "></span></a>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5></a><a href=#__codelineno-0-5><span class=linenos data-linenos=" 5 "></span></a><span class=c1># Create environment file</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6></a><a href=#__codelineno-0-6><span class=linenos data-linenos=" 6 "></span></a>cp<span class=w> </span>.env.example<span class=w> </span>.env
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7></a><a href=#__codelineno-0-7><span class=linenos data-linenos=" 7 "></span></a>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8></a><a href=#__codelineno-0-8><span class=linenos data-linenos=" 8 "></span></a><span class=c1># Add your tokens</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a><a href=#__codelineno-0-9><span class=linenos data-linenos=" 9 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;DISCORD_BOT_TOKEN=your_discord_token&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>.env
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10></a><a href=#__codelineno-0-10><span class=linenos data-linenos="10 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ANTHROPIC_API_KEY=your_anthropic_key&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>.env
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11></a><a href=#__codelineno-0-11><span class=linenos data-linenos="11 "></span></a>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a><a href=#__codelineno-0-12><span class=linenos data-linenos="12 "></span></a><span class=c1># Deploy with Docker Compose</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a><a href=#__codelineno-0-13><span class=linenos data-linenos="13 "></span></a>docker-compose<span class=w> </span>-f<span class=w> </span>docker-compose.hobby.yml<span class=w> </span>up<span class=w> </span>-d
</span></code></pre></div><h3 id=hobby-docker-compose-configuration>Hobby Docker Compose Configuration<a class=headerlink href=#hobby-docker-compose-configuration title="Permanent link">&para;</a></h3><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1></a><a href=#__codelineno-1-1><span class=linenos data-linenos=" 1 "></span></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2></a><a href=#__codelineno-1-2><span class=linenos data-linenos=" 2 "></span></a>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3></a><a href=#__codelineno-1-3><span class=linenos data-linenos=" 3 "></span></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4></a><a href=#__codelineno-1-4><span class=linenos data-linenos=" 4 "></span></a><span class=w>  </span><span class=nt>orchestrator</span><span class=p>:</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5></a><a href=#__codelineno-1-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6></a><a href=#__codelineno-1-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7></a><a href=#__codelineno-1-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">DISCORD_BOT_TOKEN=${DISCORD_BOT_TOKEN}</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8></a><a href=#__codelineno-1-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9></a><a href=#__codelineno-1-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ENVIRONMENT=hobby</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10></a><a href=#__codelineno-1-10><span class=linenos data-linenos="10 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">LOG_LEVEL=INFO</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11></a><a href=#__codelineno-1-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12></a><a href=#__codelineno-1-12><span class=linenos data-linenos="12 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./projects:/app/projects</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13></a><a href=#__codelineno-1-13><span class=linenos data-linenos="13 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./logs:/app/logs</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14></a><a href=#__codelineno-1-14><span class=linenos data-linenos="14 "></span></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15></a><a href=#__codelineno-1-15><span class=linenos data-linenos="15 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:8080&quot;</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16></a><a href=#__codelineno-1-16><span class=linenos data-linenos="16 "></span></a><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17></a><a href=#__codelineno-1-17><span class=linenos data-linenos="17 "></span></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18></a><a href=#__codelineno-1-18><span class=linenos data-linenos="18 "></span></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19></a><a href=#__codelineno-1-19><span class=linenos data-linenos="19 "></span></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20></a><a href=#__codelineno-1-20><span class=linenos data-linenos="20 "></span></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21></a><a href=#__codelineno-1-21><span class=linenos data-linenos="21 "></span></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.5&#39;</span>
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22></a><a href=#__codelineno-1-22><span class=linenos data-linenos="22 "></span></a>
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23></a><a href=#__codelineno-1-23><span class=linenos data-linenos="23 "></span></a><span class=w>  </span><span class=nt>redis</span><span class=p>:</span>
</span><span id=__span-1-24><a id=__codelineno-1-24 name=__codelineno-1-24></a><a href=#__codelineno-1-24><span class=linenos data-linenos="24 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
</span><span id=__span-1-25><a id=__codelineno-1-25 name=__codelineno-1-25></a><a href=#__codelineno-1-25><span class=linenos data-linenos="25 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-1-26><a id=__codelineno-1-26 name=__codelineno-1-26></a><a href=#__codelineno-1-26><span class=linenos data-linenos="26 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis_data:/data</span>
</span><span id=__span-1-27><a id=__codelineno-1-27 name=__codelineno-1-27></a><a href=#__codelineno-1-27><span class=linenos data-linenos="27 "></span></a><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id=__span-1-28><a id=__codelineno-1-28 name=__codelineno-1-28></a><a href=#__codelineno-1-28><span class=linenos data-linenos="28 "></span></a>
</span><span id=__span-1-29><a id=__codelineno-1-29 name=__codelineno-1-29></a><a href=#__codelineno-1-29><span class=linenos data-linenos="29 "></span></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-1-30><a id=__codelineno-1-30 name=__codelineno-1-30></a><a href=#__codelineno-1-30><span class=linenos data-linenos="30 "></span></a><span class=w>  </span><span class=nt>redis_data</span><span class=p>:</span>
</span></code></pre></div><h3 id=hobby-limitations>Hobby Limitations<a class=headerlink href=#hobby-limitations title="Permanent link">&para;</a></h3><ul><li><strong>Single project</strong> support</li><li><strong>1GB RAM</strong> limit</li><li><strong>Shared CPU</strong> resources</li><li><strong>Community support</strong> only</li><li><strong>Basic monitoring</strong> (logs only)</li><li><strong>No SSL</strong> certificates included</li></ul><h2 id=startup-deployment>Startup Deployment<a class=headerlink href=#startup-deployment title="Permanent link">&para;</a></h2><p>Designed for growing teams that need reliability and scalability.</p><h3 id=railway-deployment>Railway Deployment<a class=headerlink href=#railway-deployment title="Permanent link">&para;</a></h3><p>Click the deploy button above or manually deploy:</p><div class="language-bash highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1></a><a href=#__codelineno-2-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># Install Railway CLI</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2></a><a href=#__codelineno-2-2><span class=linenos data-linenos=" 2 "></span></a>npm<span class=w> </span>install<span class=w> </span>-g<span class=w> </span>@railway/cli
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3></a><a href=#__codelineno-2-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4></a><a href=#__codelineno-2-4><span class=linenos data-linenos=" 4 "></span></a><span class=c1># Login to Railway</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5></a><a href=#__codelineno-2-5><span class=linenos data-linenos=" 5 "></span></a>railway<span class=w> </span>login
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6></a><a href=#__codelineno-2-6><span class=linenos data-linenos=" 6 "></span></a>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7></a><a href=#__codelineno-2-7><span class=linenos data-linenos=" 7 "></span></a><span class=c1># Deploy from template</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8></a><a href=#__codelineno-2-8><span class=linenos data-linenos=" 8 "></span></a>railway<span class=w> </span>deploy<span class=w> </span>--template<span class=w> </span>agent-workflow-startup
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9></a><a href=#__codelineno-2-9><span class=linenos data-linenos=" 9 "></span></a>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10></a><a href=#__codelineno-2-10><span class=linenos data-linenos="10 "></span></a><span class=c1># Configure environment variables</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11></a><a href=#__codelineno-2-11><span class=linenos data-linenos="11 "></span></a>railway<span class=w> </span>variables<span class=w> </span><span class=nb>set</span><span class=w> </span><span class=nv>DISCORD_BOT_TOKEN</span><span class=o>=</span>your_token
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12></a><a href=#__codelineno-2-12><span class=linenos data-linenos="12 "></span></a>railway<span class=w> </span>variables<span class=w> </span><span class=nb>set</span><span class=w> </span><span class=nv>ANTHROPIC_API_KEY</span><span class=o>=</span>your_key
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13></a><a href=#__codelineno-2-13><span class=linenos data-linenos="13 "></span></a>railway<span class=w> </span>variables<span class=w> </span><span class=nb>set</span><span class=w> </span><span class=nv>TIER</span><span class=o>=</span>startup
</span></code></pre></div><h3 id=heroku-deployment>Heroku Deployment<a class=headerlink href=#heroku-deployment title="Permanent link">&para;</a></h3><div class="language-bash highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1></a><a href=#__codelineno-3-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># Install Heroku CLI</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2></a><a href=#__codelineno-3-2><span class=linenos data-linenos=" 2 "></span></a>npm<span class=w> </span>install<span class=w> </span>-g<span class=w> </span>heroku
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3></a><a href=#__codelineno-3-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4></a><a href=#__codelineno-3-4><span class=linenos data-linenos=" 4 "></span></a><span class=c1># Create Heroku app</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5></a><a href=#__codelineno-3-5><span class=linenos data-linenos=" 5 "></span></a>heroku<span class=w> </span>create<span class=w> </span>your-agent-workflow
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6></a><a href=#__codelineno-3-6><span class=linenos data-linenos=" 6 "></span></a>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7></a><a href=#__codelineno-3-7><span class=linenos data-linenos=" 7 "></span></a><span class=c1># Add PostgreSQL and Redis</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8></a><a href=#__codelineno-3-8><span class=linenos data-linenos=" 8 "></span></a>heroku<span class=w> </span>addons:create<span class=w> </span>heroku-postgresql:standard-0
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9></a><a href=#__codelineno-3-9><span class=linenos data-linenos=" 9 "></span></a>heroku<span class=w> </span>addons:create<span class=w> </span>heroku-redis:premium-0
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10></a><a href=#__codelineno-3-10><span class=linenos data-linenos="10 "></span></a>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11></a><a href=#__codelineno-3-11><span class=linenos data-linenos="11 "></span></a><span class=c1># Configure environment</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12></a><a href=#__codelineno-3-12><span class=linenos data-linenos="12 "></span></a>heroku<span class=w> </span>config:set<span class=w> </span><span class=nv>DISCORD_BOT_TOKEN</span><span class=o>=</span>your_token
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13></a><a href=#__codelineno-3-13><span class=linenos data-linenos="13 "></span></a>heroku<span class=w> </span>config:set<span class=w> </span><span class=nv>ANTHROPIC_API_KEY</span><span class=o>=</span>your_key
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14></a><a href=#__codelineno-3-14><span class=linenos data-linenos="14 "></span></a>heroku<span class=w> </span>config:set<span class=w> </span><span class=nv>TIER</span><span class=o>=</span>startup
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15></a><a href=#__codelineno-3-15><span class=linenos data-linenos="15 "></span></a>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16></a><a href=#__codelineno-3-16><span class=linenos data-linenos="16 "></span></a><span class=c1># Deploy</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17></a><a href=#__codelineno-3-17><span class=linenos data-linenos="17 "></span></a>git<span class=w> </span>push<span class=w> </span>heroku<span class=w> </span>main
</span></code></pre></div><h3 id=startup-features>Startup Features<a class=headerlink href=#startup-features title="Permanent link">&para;</a></h3><ul><li><strong>Up to 10 projects</strong> with isolated environments</li><li><strong>8GB RAM</strong> with auto-scaling</li><li><strong>Dedicated CPU</strong> cores</li><li><strong>Priority support</strong> with 24-hour response</li><li><strong>Advanced monitoring</strong> with Prometheus/Grafana</li><li><strong>SSL certificates</strong> with automatic renewal</li><li><strong>Backup &amp; recovery</strong> with point-in-time restoration</li></ul><h2 id=enterprise-deployment>Enterprise Deployment<a class=headerlink href=#enterprise-deployment title="Permanent link">&para;</a></h2><p>Enterprise-grade deployment with full compliance and security features.</p><h3 id=kubernetes-deployment>Kubernetes Deployment<a class=headerlink href=#kubernetes-deployment title="Permanent link">&para;</a></h3><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1></a><a href=#__codelineno-4-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># kubernetes/namespace.yaml</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2></a><a href=#__codelineno-4-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3></a><a href=#__codelineno-4-3><span class=linenos data-linenos=" 3 "></span></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4></a><a href=#__codelineno-4-4><span class=linenos data-linenos=" 4 "></span></a><span class=nt>metadata</span><span class=p>:</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5></a><a href=#__codelineno-4-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent-workflow</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6></a><a href=#__codelineno-4-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7></a><a href=#__codelineno-4-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent-workflow</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8></a><a href=#__codelineno-4-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>    </span><span class=nt>tier</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">enterprise</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9></a><a href=#__codelineno-4-9><span class=linenos data-linenos=" 9 "></span></a><span class=nn>---</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10></a><a href=#__codelineno-4-10><span class=linenos data-linenos="10 "></span></a><span class=c1># kubernetes/deployment.yaml</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11></a><a href=#__codelineno-4-11><span class=linenos data-linenos="11 "></span></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12></a><a href=#__codelineno-4-12><span class=linenos data-linenos="12 "></span></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13></a><a href=#__codelineno-4-13><span class=linenos data-linenos="13 "></span></a><span class=nt>metadata</span><span class=p>:</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14></a><a href=#__codelineno-4-14><span class=linenos data-linenos="14 "></span></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">orchestrator</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15></a><a href=#__codelineno-4-15><span class=linenos data-linenos="15 "></span></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent-workflow</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16></a><a href=#__codelineno-4-16><span class=linenos data-linenos="16 "></span></a><span class=nt>spec</span><span class=p>:</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17></a><a href=#__codelineno-4-17><span class=linenos data-linenos="17 "></span></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18></a><a href=#__codelineno-4-18><span class=linenos data-linenos="18 "></span></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19></a><a href=#__codelineno-4-19><span class=linenos data-linenos="19 "></span></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20></a><a href=#__codelineno-4-20><span class=linenos data-linenos="20 "></span></a><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">orchestrator</span>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21></a><a href=#__codelineno-4-21><span class=linenos data-linenos="21 "></span></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22></a><a href=#__codelineno-4-22><span class=linenos data-linenos="22 "></span></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
</span><span id=__span-4-23><a id=__codelineno-4-23 name=__codelineno-4-23></a><a href=#__codelineno-4-23><span class=linenos data-linenos="23 "></span></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
</span><span id=__span-4-24><a id=__codelineno-4-24 name=__codelineno-4-24></a><a href=#__codelineno-4-24><span class=linenos data-linenos="24 "></span></a><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">orchestrator</span>
</span><span id=__span-4-25><a id=__codelineno-4-25 name=__codelineno-4-25></a><a href=#__codelineno-4-25><span class=linenos data-linenos="25 "></span></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
</span><span id=__span-4-26><a id=__codelineno-4-26 name=__codelineno-4-26></a><a href=#__codelineno-4-26><span class=linenos data-linenos="26 "></span></a><span class=w>      </span><span class=nt>securityContext</span><span class=p>:</span>
</span><span id=__span-4-27><a id=__codelineno-4-27 name=__codelineno-4-27></a><a href=#__codelineno-4-27><span class=linenos data-linenos="27 "></span></a><span class=w>        </span><span class=nt>runAsNonRoot</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-4-28><a id=__codelineno-4-28 name=__codelineno-4-28></a><a href=#__codelineno-4-28><span class=linenos data-linenos="28 "></span></a><span class=w>        </span><span class=nt>runAsUser</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1001</span>
</span><span id=__span-4-29><a id=__codelineno-4-29 name=__codelineno-4-29></a><a href=#__codelineno-4-29><span class=linenos data-linenos="29 "></span></a><span class=w>        </span><span class=nt>fsGroup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1001</span>
</span><span id=__span-4-30><a id=__codelineno-4-30 name=__codelineno-4-30></a><a href=#__codelineno-4-30><span class=linenos data-linenos="30 "></span></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
</span><span id=__span-4-31><a id=__codelineno-4-31 name=__codelineno-4-31></a><a href=#__codelineno-4-31><span class=linenos data-linenos="31 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">orchestrator</span>
</span><span id=__span-4-32><a id=__codelineno-4-32 name=__codelineno-4-32></a><a href=#__codelineno-4-32><span class=linenos data-linenos="32 "></span></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent-workflow:enterprise</span>
</span><span id=__span-4-33><a id=__codelineno-4-33 name=__codelineno-4-33></a><a href=#__codelineno-4-33><span class=linenos data-linenos="33 "></span></a><span class=w>        </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-4-34><a id=__codelineno-4-34 name=__codelineno-4-34></a><a href=#__codelineno-4-34><span class=linenos data-linenos="34 "></span></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id=__span-4-35><a id=__codelineno-4-35 name=__codelineno-4-35></a><a href=#__codelineno-4-35><span class=linenos data-linenos="35 "></span></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span>
</span><span id=__span-4-36><a id=__codelineno-4-36 name=__codelineno-4-36></a><a href=#__codelineno-4-36><span class=linenos data-linenos="36 "></span></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">DISCORD_BOT_TOKEN</span>
</span><span id=__span-4-37><a id=__codelineno-4-37 name=__codelineno-4-37></a><a href=#__codelineno-4-37><span class=linenos data-linenos="37 "></span></a><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span>
</span><span id=__span-4-38><a id=__codelineno-4-38 name=__codelineno-4-38></a><a href=#__codelineno-4-38><span class=linenos data-linenos="38 "></span></a><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span>
</span><span id=__span-4-39><a id=__codelineno-4-39 name=__codelineno-4-39></a><a href=#__codelineno-4-39><span class=linenos data-linenos="39 "></span></a><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent-workflow-secrets</span>
</span><span id=__span-4-40><a id=__codelineno-4-40 name=__codelineno-4-40></a><a href=#__codelineno-4-40><span class=linenos data-linenos="40 "></span></a><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">discord-token</span>
</span><span id=__span-4-41><a id=__codelineno-4-41 name=__codelineno-4-41></a><a href=#__codelineno-4-41><span class=linenos data-linenos="41 "></span></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ANTHROPIC_API_KEY</span>
</span><span id=__span-4-42><a id=__codelineno-4-42 name=__codelineno-4-42></a><a href=#__codelineno-4-42><span class=linenos data-linenos="42 "></span></a><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span>
</span><span id=__span-4-43><a id=__codelineno-4-43 name=__codelineno-4-43></a><a href=#__codelineno-4-43><span class=linenos data-linenos="43 "></span></a><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span>
</span><span id=__span-4-44><a id=__codelineno-4-44 name=__codelineno-4-44></a><a href=#__codelineno-4-44><span class=linenos data-linenos="44 "></span></a><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent-workflow-secrets</span>
</span><span id=__span-4-45><a id=__codelineno-4-45 name=__codelineno-4-45></a><a href=#__codelineno-4-45><span class=linenos data-linenos="45 "></span></a><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">anthropic-key</span>
</span><span id=__span-4-46><a id=__codelineno-4-46 name=__codelineno-4-46></a><a href=#__codelineno-4-46><span class=linenos data-linenos="46 "></span></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TIER</span>
</span><span id=__span-4-47><a id=__codelineno-4-47 name=__codelineno-4-47></a><a href=#__codelineno-4-47><span class=linenos data-linenos="47 "></span></a><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;enterprise&quot;</span>
</span><span id=__span-4-48><a id=__codelineno-4-48 name=__codelineno-4-48></a><a href=#__codelineno-4-48><span class=linenos data-linenos="48 "></span></a><span class=w>        </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-4-49><a id=__codelineno-4-49 name=__codelineno-4-49></a><a href=#__codelineno-4-49><span class=linenos data-linenos="49 "></span></a><span class=w>          </span><span class=nt>requests</span><span class=p>:</span>
</span><span id=__span-4-50><a id=__codelineno-4-50 name=__codelineno-4-50></a><a href=#__codelineno-4-50><span class=linenos data-linenos="50 "></span></a><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2Gi&quot;</span>
</span><span id=__span-4-51><a id=__codelineno-4-51 name=__codelineno-4-51></a><a href=#__codelineno-4-51><span class=linenos data-linenos="51 "></span></a><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1000m&quot;</span>
</span><span id=__span-4-52><a id=__codelineno-4-52 name=__codelineno-4-52></a><a href=#__codelineno-4-52><span class=linenos data-linenos="52 "></span></a><span class=w>          </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-4-53><a id=__codelineno-4-53 name=__codelineno-4-53></a><a href=#__codelineno-4-53><span class=linenos data-linenos="53 "></span></a><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;8Gi&quot;</span>
</span><span id=__span-4-54><a id=__codelineno-4-54 name=__codelineno-4-54></a><a href=#__codelineno-4-54><span class=linenos data-linenos="54 "></span></a><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>&quot;4000m&quot;</span>
</span><span id=__span-4-55><a id=__codelineno-4-55 name=__codelineno-4-55></a><a href=#__codelineno-4-55><span class=linenos data-linenos="55 "></span></a><span class=w>        </span><span class=nt>readinessProbe</span><span class=p>:</span>
</span><span id=__span-4-56><a id=__codelineno-4-56 name=__codelineno-4-56></a><a href=#__codelineno-4-56><span class=linenos data-linenos="56 "></span></a><span class=w>          </span><span class=nt>httpGet</span><span class=p>:</span>
</span><span id=__span-4-57><a id=__codelineno-4-57 name=__codelineno-4-57></a><a href=#__codelineno-4-57><span class=linenos data-linenos="57 "></span></a><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/health</span>
</span><span id=__span-4-58><a id=__codelineno-4-58 name=__codelineno-4-58></a><a href=#__codelineno-4-58><span class=linenos data-linenos="58 "></span></a><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id=__span-4-59><a id=__codelineno-4-59 name=__codelineno-4-59></a><a href=#__codelineno-4-59><span class=linenos data-linenos="59 "></span></a><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
</span><span id=__span-4-60><a id=__codelineno-4-60 name=__codelineno-4-60></a><a href=#__codelineno-4-60><span class=linenos data-linenos="60 "></span></a><span class=w>          </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</span><span id=__span-4-61><a id=__codelineno-4-61 name=__codelineno-4-61></a><a href=#__codelineno-4-61><span class=linenos data-linenos="61 "></span></a><span class=w>        </span><span class=nt>livenessProbe</span><span class=p>:</span>
</span><span id=__span-4-62><a id=__codelineno-4-62 name=__codelineno-4-62></a><a href=#__codelineno-4-62><span class=linenos data-linenos="62 "></span></a><span class=w>          </span><span class=nt>httpGet</span><span class=p>:</span>
</span><span id=__span-4-63><a id=__codelineno-4-63 name=__codelineno-4-63></a><a href=#__codelineno-4-63><span class=linenos data-linenos="63 "></span></a><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/health</span>
</span><span id=__span-4-64><a id=__codelineno-4-64 name=__codelineno-4-64></a><a href=#__codelineno-4-64><span class=linenos data-linenos="64 "></span></a><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id=__span-4-65><a id=__codelineno-4-65 name=__codelineno-4-65></a><a href=#__codelineno-4-65><span class=linenos data-linenos="65 "></span></a><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
</span><span id=__span-4-66><a id=__codelineno-4-66 name=__codelineno-4-66></a><a href=#__codelineno-4-66><span class=linenos data-linenos="66 "></span></a><span class=w>          </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
</span><span id=__span-4-67><a id=__codelineno-4-67 name=__codelineno-4-67></a><a href=#__codelineno-4-67><span class=linenos data-linenos="67 "></span></a><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span>
</span><span id=__span-4-68><a id=__codelineno-4-68 name=__codelineno-4-68></a><a href=#__codelineno-4-68><span class=linenos data-linenos="68 "></span></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">projects</span>
</span><span id=__span-4-69><a id=__codelineno-4-69 name=__codelineno-4-69></a><a href=#__codelineno-4-69><span class=linenos data-linenos="69 "></span></a><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/app/projects</span>
</span><span id=__span-4-70><a id=__codelineno-4-70 name=__codelineno-4-70></a><a href=#__codelineno-4-70><span class=linenos data-linenos="70 "></span></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">logs</span>
</span><span id=__span-4-71><a id=__codelineno-4-71 name=__codelineno-4-71></a><a href=#__codelineno-4-71><span class=linenos data-linenos="71 "></span></a><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/app/logs</span>
</span><span id=__span-4-72><a id=__codelineno-4-72 name=__codelineno-4-72></a><a href=#__codelineno-4-72><span class=linenos data-linenos="72 "></span></a><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-4-73><a id=__codelineno-4-73 name=__codelineno-4-73></a><a href=#__codelineno-4-73><span class=linenos data-linenos="73 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">projects</span>
</span><span id=__span-4-74><a id=__codelineno-4-74 name=__codelineno-4-74></a><a href=#__codelineno-4-74><span class=linenos data-linenos="74 "></span></a><span class=w>        </span><span class=nt>persistentVolumeClaim</span><span class=p>:</span>
</span><span id=__span-4-75><a id=__codelineno-4-75 name=__codelineno-4-75></a><a href=#__codelineno-4-75><span class=linenos data-linenos="75 "></span></a><span class=w>          </span><span class=nt>claimName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">projects-pvc</span>
</span><span id=__span-4-76><a id=__codelineno-4-76 name=__codelineno-4-76></a><a href=#__codelineno-4-76><span class=linenos data-linenos="76 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">logs</span>
</span><span id=__span-4-77><a id=__codelineno-4-77 name=__codelineno-4-77></a><a href=#__codelineno-4-77><span class=linenos data-linenos="77 "></span></a><span class=w>        </span><span class=nt>persistentVolumeClaim</span><span class=p>:</span>
</span><span id=__span-4-78><a id=__codelineno-4-78 name=__codelineno-4-78></a><a href=#__codelineno-4-78><span class=linenos data-linenos="78 "></span></a><span class=w>          </span><span class=nt>claimName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">logs-pvc</span>
</span><span id=__span-4-79><a id=__codelineno-4-79 name=__codelineno-4-79></a><a href=#__codelineno-4-79><span class=linenos data-linenos="79 "></span></a><span class=nn>---</span>
</span><span id=__span-4-80><a id=__codelineno-4-80 name=__codelineno-4-80></a><a href=#__codelineno-4-80><span class=linenos data-linenos="80 "></span></a><span class=c1># kubernetes/service.yaml</span>
</span><span id=__span-4-81><a id=__codelineno-4-81 name=__codelineno-4-81></a><a href=#__codelineno-4-81><span class=linenos data-linenos="81 "></span></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id=__span-4-82><a id=__codelineno-4-82 name=__codelineno-4-82></a><a href=#__codelineno-4-82><span class=linenos data-linenos="82 "></span></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id=__span-4-83><a id=__codelineno-4-83 name=__codelineno-4-83></a><a href=#__codelineno-4-83><span class=linenos data-linenos="83 "></span></a><span class=nt>metadata</span><span class=p>:</span>
</span><span id=__span-4-84><a id=__codelineno-4-84 name=__codelineno-4-84></a><a href=#__codelineno-4-84><span class=linenos data-linenos="84 "></span></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">orchestrator-service</span>
</span><span id=__span-4-85><a id=__codelineno-4-85 name=__codelineno-4-85></a><a href=#__codelineno-4-85><span class=linenos data-linenos="85 "></span></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent-workflow</span>
</span><span id=__span-4-86><a id=__codelineno-4-86 name=__codelineno-4-86></a><a href=#__codelineno-4-86><span class=linenos data-linenos="86 "></span></a><span class=nt>spec</span><span class=p>:</span>
</span><span id=__span-4-87><a id=__codelineno-4-87 name=__codelineno-4-87></a><a href=#__codelineno-4-87><span class=linenos data-linenos="87 "></span></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
</span><span id=__span-4-88><a id=__codelineno-4-88 name=__codelineno-4-88></a><a href=#__codelineno-4-88><span class=linenos data-linenos="88 "></span></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">orchestrator</span>
</span><span id=__span-4-89><a id=__codelineno-4-89 name=__codelineno-4-89></a><a href=#__codelineno-4-89><span class=linenos data-linenos="89 "></span></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-4-90><a id=__codelineno-4-90 name=__codelineno-4-90></a><a href=#__codelineno-4-90><span class=linenos data-linenos="90 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id=__span-4-91><a id=__codelineno-4-91 name=__codelineno-4-91></a><a href=#__codelineno-4-91><span class=linenos data-linenos="91 "></span></a><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id=__span-4-92><a id=__codelineno-4-92 name=__codelineno-4-92></a><a href=#__codelineno-4-92><span class=linenos data-linenos="92 "></span></a><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id=__span-4-93><a id=__codelineno-4-93 name=__codelineno-4-93></a><a href=#__codelineno-4-93><span class=linenos data-linenos="93 "></span></a><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</span></code></pre></div><h3 id=enterprise-features>Enterprise Features<a class=headerlink href=#enterprise-features title="Permanent link">&para;</a></h3><ul><li><strong>Unlimited projects</strong> with multi-tenancy</li><li><strong>Multi-region deployment</strong> for global teams</li><li><strong>24/7 enterprise support</strong> with dedicated SRE team</li><li><strong>SOC 2 Type II compliance</strong> with audit reports</li><li><strong>Custom integrations</strong> with enterprise tools</li><li><strong>Advanced security</strong> with RBAC, SSO, and audit logging</li><li><strong>SLA guarantees</strong> with 99.9% uptime commitment</li></ul><h2 id=container-orchestration>Container Orchestration<a class=headerlink href=#container-orchestration title="Permanent link">&para;</a></h2><h3 id=docker-swarm>Docker Swarm<a class=headerlink href=#docker-swarm title="Permanent link">&para;</a></h3><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1></a><a href=#__codelineno-5-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># docker-compose.swarm.yml</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2></a><a href=#__codelineno-5-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3></a><a href=#__codelineno-5-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4></a><a href=#__codelineno-5-4><span class=linenos data-linenos=" 4 "></span></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5></a><a href=#__codelineno-5-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span><span class=nt>orchestrator</span><span class=p>:</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6></a><a href=#__codelineno-5-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent-workflow:latest</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7></a><a href=#__codelineno-5-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8></a><a href=#__codelineno-5-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9></a><a href=#__codelineno-5-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>      </span><span class=nt>update_config</span><span class=p>:</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10></a><a href=#__codelineno-5-10><span class=linenos data-linenos="10 "></span></a><span class=w>        </span><span class=nt>parallelism</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11></a><a href=#__codelineno-5-11><span class=linenos data-linenos="11 "></span></a><span class=w>        </span><span class=nt>delay</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12></a><a href=#__codelineno-5-12><span class=linenos data-linenos="12 "></span></a><span class=w>        </span><span class=nt>failure_action</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rollback</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13></a><a href=#__codelineno-5-13><span class=linenos data-linenos="13 "></span></a><span class=w>      </span><span class=nt>restart_policy</span><span class=p>:</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14></a><a href=#__codelineno-5-14><span class=linenos data-linenos="14 "></span></a><span class=w>        </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">on-failure</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15></a><a href=#__codelineno-5-15><span class=linenos data-linenos="15 "></span></a><span class=w>        </span><span class=nt>delay</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16></a><a href=#__codelineno-5-16><span class=linenos data-linenos="16 "></span></a><span class=w>        </span><span class=nt>max_attempts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17></a><a href=#__codelineno-5-17><span class=linenos data-linenos="17 "></span></a><span class=w>      </span><span class=nt>placement</span><span class=p>:</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18></a><a href=#__codelineno-5-18><span class=linenos data-linenos="18 "></span></a><span class=w>        </span><span class=nt>constraints</span><span class=p>:</span>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19></a><a href=#__codelineno-5-19><span class=linenos data-linenos="19 "></span></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">node.role == worker</span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20></a><a href=#__codelineno-5-20><span class=linenos data-linenos="20 "></span></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21></a><a href=#__codelineno-5-21><span class=linenos data-linenos="21 "></span></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22></a><a href=#__codelineno-5-22><span class=linenos data-linenos="22 "></span></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;2&#39;</span>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23></a><a href=#__codelineno-5-23><span class=linenos data-linenos="23 "></span></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">4G</span>
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24></a><a href=#__codelineno-5-24><span class=linenos data-linenos="24 "></span></a><span class=w>        </span><span class=nt>reservations</span><span class=p>:</span>
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25></a><a href=#__codelineno-5-25><span class=linenos data-linenos="25 "></span></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;1&#39;</span>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26></a><a href=#__codelineno-5-26><span class=linenos data-linenos="26 "></span></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2G</span>
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27></a><a href=#__codelineno-5-27><span class=linenos data-linenos="27 "></span></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-5-28><a id=__codelineno-5-28 name=__codelineno-5-28></a><a href=#__codelineno-5-28><span class=linenos data-linenos="28 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent-network</span>
</span><span id=__span-5-29><a id=__codelineno-5-29 name=__codelineno-5-29></a><a href=#__codelineno-5-29><span class=linenos data-linenos="29 "></span></a><span class=w>    </span><span class=nt>secrets</span><span class=p>:</span>
</span><span id=__span-5-30><a id=__codelineno-5-30 name=__codelineno-5-30></a><a href=#__codelineno-5-30><span class=linenos data-linenos="30 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">discord_token</span>
</span><span id=__span-5-31><a id=__codelineno-5-31 name=__codelineno-5-31></a><a href=#__codelineno-5-31><span class=linenos data-linenos="31 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">anthropic_key</span>
</span><span id=__span-5-32><a id=__codelineno-5-32 name=__codelineno-5-32></a><a href=#__codelineno-5-32><span class=linenos data-linenos="32 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-5-33><a id=__codelineno-5-33 name=__codelineno-5-33></a><a href=#__codelineno-5-33><span class=linenos data-linenos="33 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">projects:/app/projects</span>
</span><span id=__span-5-34><a id=__codelineno-5-34 name=__codelineno-5-34></a><a href=#__codelineno-5-34><span class=linenos data-linenos="34 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tmpfs</span>
</span><span id=__span-5-35><a id=__codelineno-5-35 name=__codelineno-5-35></a><a href=#__codelineno-5-35><span class=linenos data-linenos="35 "></span></a><span class=w>        </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
</span><span id=__span-5-36><a id=__codelineno-5-36 name=__codelineno-5-36></a><a href=#__codelineno-5-36><span class=linenos data-linenos="36 "></span></a><span class=w>        </span><span class=nt>tmpfs</span><span class=p>:</span>
</span><span id=__span-5-37><a id=__codelineno-5-37 name=__codelineno-5-37></a><a href=#__codelineno-5-37><span class=linenos data-linenos="37 "></span></a><span class=w>          </span><span class=nt>size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id=__span-5-38><a id=__codelineno-5-38 name=__codelineno-5-38></a><a href=#__codelineno-5-38><span class=linenos data-linenos="38 "></span></a>
</span><span id=__span-5-39><a id=__codelineno-5-39 name=__codelineno-5-39></a><a href=#__codelineno-5-39><span class=linenos data-linenos="39 "></span></a><span class=w>  </span><span class=nt>postgres</span><span class=p>:</span>
</span><span id=__span-5-40><a id=__codelineno-5-40 name=__codelineno-5-40></a><a href=#__codelineno-5-40><span class=linenos data-linenos="40 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:15-alpine</span>
</span><span id=__span-5-41><a id=__codelineno-5-41 name=__codelineno-5-41></a><a href=#__codelineno-5-41><span class=linenos data-linenos="41 "></span></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-5-42><a id=__codelineno-5-42 name=__codelineno-5-42></a><a href=#__codelineno-5-42><span class=linenos data-linenos="42 "></span></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id=__span-5-43><a id=__codelineno-5-43 name=__codelineno-5-43></a><a href=#__codelineno-5-43><span class=linenos data-linenos="43 "></span></a><span class=w>      </span><span class=nt>placement</span><span class=p>:</span>
</span><span id=__span-5-44><a id=__codelineno-5-44 name=__codelineno-5-44></a><a href=#__codelineno-5-44><span class=linenos data-linenos="44 "></span></a><span class=w>        </span><span class=nt>constraints</span><span class=p>:</span>
</span><span id=__span-5-45><a id=__codelineno-5-45 name=__codelineno-5-45></a><a href=#__codelineno-5-45><span class=linenos data-linenos="45 "></span></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">node.labels.postgres == true</span>
</span><span id=__span-5-46><a id=__codelineno-5-46 name=__codelineno-5-46></a><a href=#__codelineno-5-46><span class=linenos data-linenos="46 "></span></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-5-47><a id=__codelineno-5-47 name=__codelineno-5-47></a><a href=#__codelineno-5-47><span class=linenos data-linenos="47 "></span></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-5-48><a id=__codelineno-5-48 name=__codelineno-5-48></a><a href=#__codelineno-5-48><span class=linenos data-linenos="48 "></span></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2G</span>
</span><span id=__span-5-49><a id=__codelineno-5-49 name=__codelineno-5-49></a><a href=#__codelineno-5-49><span class=linenos data-linenos="49 "></span></a><span class=w>        </span><span class=nt>reservations</span><span class=p>:</span>
</span><span id=__span-5-50><a id=__codelineno-5-50 name=__codelineno-5-50></a><a href=#__codelineno-5-50><span class=linenos data-linenos="50 "></span></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id=__span-5-51><a id=__codelineno-5-51 name=__codelineno-5-51></a><a href=#__codelineno-5-51><span class=linenos data-linenos="51 "></span></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-5-52><a id=__codelineno-5-52 name=__codelineno-5-52></a><a href=#__codelineno-5-52><span class=linenos data-linenos="52 "></span></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent_workflow</span>
</span><span id=__span-5-53><a id=__codelineno-5-53 name=__codelineno-5-53></a><a href=#__codelineno-5-53><span class=linenos data-linenos="53 "></span></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent_workflow</span>
</span><span id=__span-5-54><a id=__codelineno-5-54 name=__codelineno-5-54></a><a href=#__codelineno-5-54><span class=linenos data-linenos="54 "></span></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD_FILE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/run/secrets/db_password</span>
</span><span id=__span-5-55><a id=__codelineno-5-55 name=__codelineno-5-55></a><a href=#__codelineno-5-55><span class=linenos data-linenos="55 "></span></a><span class=w>    </span><span class=nt>secrets</span><span class=p>:</span>
</span><span id=__span-5-56><a id=__codelineno-5-56 name=__codelineno-5-56></a><a href=#__codelineno-5-56><span class=linenos data-linenos="56 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_password</span>
</span><span id=__span-5-57><a id=__codelineno-5-57 name=__codelineno-5-57></a><a href=#__codelineno-5-57><span class=linenos data-linenos="57 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-5-58><a id=__codelineno-5-58 name=__codelineno-5-58></a><a href=#__codelineno-5-58><span class=linenos data-linenos="58 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres_data:/var/lib/postgresql/data</span>
</span><span id=__span-5-59><a id=__codelineno-5-59 name=__codelineno-5-59></a><a href=#__codelineno-5-59><span class=linenos data-linenos="59 "></span></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-5-60><a id=__codelineno-5-60 name=__codelineno-5-60></a><a href=#__codelineno-5-60><span class=linenos data-linenos="60 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent-network</span>
</span><span id=__span-5-61><a id=__codelineno-5-61 name=__codelineno-5-61></a><a href=#__codelineno-5-61><span class=linenos data-linenos="61 "></span></a>
</span><span id=__span-5-62><a id=__codelineno-5-62 name=__codelineno-5-62></a><a href=#__codelineno-5-62><span class=linenos data-linenos="62 "></span></a><span class=w>  </span><span class=nt>redis</span><span class=p>:</span>
</span><span id=__span-5-63><a id=__codelineno-5-63 name=__codelineno-5-63></a><a href=#__codelineno-5-63><span class=linenos data-linenos="63 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
</span><span id=__span-5-64><a id=__codelineno-5-64 name=__codelineno-5-64></a><a href=#__codelineno-5-64><span class=linenos data-linenos="64 "></span></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-5-65><a id=__codelineno-5-65 name=__codelineno-5-65></a><a href=#__codelineno-5-65><span class=linenos data-linenos="65 "></span></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id=__span-5-66><a id=__codelineno-5-66 name=__codelineno-5-66></a><a href=#__codelineno-5-66><span class=linenos data-linenos="66 "></span></a><span class=w>      </span><span class=nt>placement</span><span class=p>:</span>
</span><span id=__span-5-67><a id=__codelineno-5-67 name=__codelineno-5-67></a><a href=#__codelineno-5-67><span class=linenos data-linenos="67 "></span></a><span class=w>        </span><span class=nt>constraints</span><span class=p>:</span>
</span><span id=__span-5-68><a id=__codelineno-5-68 name=__codelineno-5-68></a><a href=#__codelineno-5-68><span class=linenos data-linenos="68 "></span></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">node.labels.redis == true</span>
</span><span id=__span-5-69><a id=__codelineno-5-69 name=__codelineno-5-69></a><a href=#__codelineno-5-69><span class=linenos data-linenos="69 "></span></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-server --requirepass-file /run/secrets/redis_password</span>
</span><span id=__span-5-70><a id=__codelineno-5-70 name=__codelineno-5-70></a><a href=#__codelineno-5-70><span class=linenos data-linenos="70 "></span></a><span class=w>    </span><span class=nt>secrets</span><span class=p>:</span>
</span><span id=__span-5-71><a id=__codelineno-5-71 name=__codelineno-5-71></a><a href=#__codelineno-5-71><span class=linenos data-linenos="71 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis_password</span>
</span><span id=__span-5-72><a id=__codelineno-5-72 name=__codelineno-5-72></a><a href=#__codelineno-5-72><span class=linenos data-linenos="72 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-5-73><a id=__codelineno-5-73 name=__codelineno-5-73></a><a href=#__codelineno-5-73><span class=linenos data-linenos="73 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis_data:/data</span>
</span><span id=__span-5-74><a id=__codelineno-5-74 name=__codelineno-5-74></a><a href=#__codelineno-5-74><span class=linenos data-linenos="74 "></span></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-5-75><a id=__codelineno-5-75 name=__codelineno-5-75></a><a href=#__codelineno-5-75><span class=linenos data-linenos="75 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent-network</span>
</span><span id=__span-5-76><a id=__codelineno-5-76 name=__codelineno-5-76></a><a href=#__codelineno-5-76><span class=linenos data-linenos="76 "></span></a>
</span><span id=__span-5-77><a id=__codelineno-5-77 name=__codelineno-5-77></a><a href=#__codelineno-5-77><span class=linenos data-linenos="77 "></span></a><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-5-78><a id=__codelineno-5-78 name=__codelineno-5-78></a><a href=#__codelineno-5-78><span class=linenos data-linenos="78 "></span></a><span class=w>  </span><span class=nt>agent-network</span><span class=p>:</span>
</span><span id=__span-5-79><a id=__codelineno-5-79 name=__codelineno-5-79></a><a href=#__codelineno-5-79><span class=linenos data-linenos="79 "></span></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
</span><span id=__span-5-80><a id=__codelineno-5-80 name=__codelineno-5-80></a><a href=#__codelineno-5-80><span class=linenos data-linenos="80 "></span></a><span class=w>    </span><span class=nt>attachable</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-5-81><a id=__codelineno-5-81 name=__codelineno-5-81></a><a href=#__codelineno-5-81><span class=linenos data-linenos="81 "></span></a>
</span><span id=__span-5-82><a id=__codelineno-5-82 name=__codelineno-5-82></a><a href=#__codelineno-5-82><span class=linenos data-linenos="82 "></span></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-5-83><a id=__codelineno-5-83 name=__codelineno-5-83></a><a href=#__codelineno-5-83><span class=linenos data-linenos="83 "></span></a><span class=w>  </span><span class=nt>postgres_data</span><span class=p>:</span>
</span><span id=__span-5-84><a id=__codelineno-5-84 name=__codelineno-5-84></a><a href=#__codelineno-5-84><span class=linenos data-linenos="84 "></span></a><span class=w>  </span><span class=nt>redis_data</span><span class=p>:</span>
</span><span id=__span-5-85><a id=__codelineno-5-85 name=__codelineno-5-85></a><a href=#__codelineno-5-85><span class=linenos data-linenos="85 "></span></a><span class=w>  </span><span class=nt>projects</span><span class=p>:</span>
</span><span id=__span-5-86><a id=__codelineno-5-86 name=__codelineno-5-86></a><a href=#__codelineno-5-86><span class=linenos data-linenos="86 "></span></a>
</span><span id=__span-5-87><a id=__codelineno-5-87 name=__codelineno-5-87></a><a href=#__codelineno-5-87><span class=linenos data-linenos="87 "></span></a><span class=nt>secrets</span><span class=p>:</span>
</span><span id=__span-5-88><a id=__codelineno-5-88 name=__codelineno-5-88></a><a href=#__codelineno-5-88><span class=linenos data-linenos="88 "></span></a><span class=w>  </span><span class=nt>discord_token</span><span class=p>:</span>
</span><span id=__span-5-89><a id=__codelineno-5-89 name=__codelineno-5-89></a><a href=#__codelineno-5-89><span class=linenos data-linenos="89 "></span></a><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-5-90><a id=__codelineno-5-90 name=__codelineno-5-90></a><a href=#__codelineno-5-90><span class=linenos data-linenos="90 "></span></a><span class=w>  </span><span class=nt>anthropic_key</span><span class=p>:</span>
</span><span id=__span-5-91><a id=__codelineno-5-91 name=__codelineno-5-91></a><a href=#__codelineno-5-91><span class=linenos data-linenos="91 "></span></a><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-5-92><a id=__codelineno-5-92 name=__codelineno-5-92></a><a href=#__codelineno-5-92><span class=linenos data-linenos="92 "></span></a><span class=w>  </span><span class=nt>db_password</span><span class=p>:</span>
</span><span id=__span-5-93><a id=__codelineno-5-93 name=__codelineno-5-93></a><a href=#__codelineno-5-93><span class=linenos data-linenos="93 "></span></a><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-5-94><a id=__codelineno-5-94 name=__codelineno-5-94></a><a href=#__codelineno-5-94><span class=linenos data-linenos="94 "></span></a><span class=w>  </span><span class=nt>redis_password</span><span class=p>:</span>
</span><span id=__span-5-95><a id=__codelineno-5-95 name=__codelineno-5-95></a><a href=#__codelineno-5-95><span class=linenos data-linenos="95 "></span></a><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div><p>Deploy to Docker Swarm:</p><div class="language-bash highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1></a><a href=#__codelineno-6-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># Initialize swarm</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2></a><a href=#__codelineno-6-2><span class=linenos data-linenos=" 2 "></span></a>docker<span class=w> </span>swarm<span class=w> </span>init
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3></a><a href=#__codelineno-6-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4></a><a href=#__codelineno-6-4><span class=linenos data-linenos=" 4 "></span></a><span class=c1># Create secrets</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5></a><a href=#__codelineno-6-5><span class=linenos data-linenos=" 5 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;your_discord_token&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>docker<span class=w> </span>secret<span class=w> </span>create<span class=w> </span>discord_token<span class=w> </span>-
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6></a><a href=#__codelineno-6-6><span class=linenos data-linenos=" 6 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;your_anthropic_key&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>docker<span class=w> </span>secret<span class=w> </span>create<span class=w> </span>anthropic_key<span class=w> </span>-
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7></a><a href=#__codelineno-6-7><span class=linenos data-linenos=" 7 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;secure_db_password&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>docker<span class=w> </span>secret<span class=w> </span>create<span class=w> </span>db_password<span class=w> </span>-
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8></a><a href=#__codelineno-6-8><span class=linenos data-linenos=" 8 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;secure_redis_password&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>docker<span class=w> </span>secret<span class=w> </span>create<span class=w> </span>redis_password<span class=w> </span>-
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9></a><a href=#__codelineno-6-9><span class=linenos data-linenos=" 9 "></span></a>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10></a><a href=#__codelineno-6-10><span class=linenos data-linenos="10 "></span></a><span class=c1># Label nodes for service placement</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11></a><a href=#__codelineno-6-11><span class=linenos data-linenos="11 "></span></a>docker<span class=w> </span>node<span class=w> </span>update<span class=w> </span>--label-add<span class=w> </span><span class=nv>postgres</span><span class=o>=</span><span class=nb>true</span><span class=w> </span>&lt;node-id&gt;
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12></a><a href=#__codelineno-6-12><span class=linenos data-linenos="12 "></span></a>docker<span class=w> </span>node<span class=w> </span>update<span class=w> </span>--label-add<span class=w> </span><span class=nv>redis</span><span class=o>=</span><span class=nb>true</span><span class=w> </span>&lt;node-id&gt;
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13></a><a href=#__codelineno-6-13><span class=linenos data-linenos="13 "></span></a>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14></a><a href=#__codelineno-6-14><span class=linenos data-linenos="14 "></span></a><span class=c1># Deploy stack</span>
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15></a><a href=#__codelineno-6-15><span class=linenos data-linenos="15 "></span></a>docker<span class=w> </span>stack<span class=w> </span>deploy<span class=w> </span>-c<span class=w> </span>docker-compose.swarm.yml<span class=w> </span>agent-workflow
</span></code></pre></div><h3 id=kubernetes-with-helm>Kubernetes with Helm<a class=headerlink href=#kubernetes-with-helm title="Permanent link">&para;</a></h3><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1></a><a href=#__codelineno-7-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># helm/values.yaml</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2></a><a href=#__codelineno-7-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>replicaCount</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3></a><a href=#__codelineno-7-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4></a><a href=#__codelineno-7-4><span class=linenos data-linenos=" 4 "></span></a><span class=nt>image</span><span class=p>:</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5></a><a href=#__codelineno-7-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span><span class=nt>repository</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent-workflow</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6></a><a href=#__codelineno-7-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>  </span><span class=nt>tag</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7></a><a href=#__codelineno-7-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>  </span><span class=nt>pullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8></a><a href=#__codelineno-7-8><span class=linenos data-linenos=" 8 "></span></a>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9></a><a href=#__codelineno-7-9><span class=linenos data-linenos=" 9 "></span></a><span class=nt>service</span><span class=p>:</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10></a><a href=#__codelineno-7-10><span class=linenos data-linenos="10 "></span></a><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11></a><a href=#__codelineno-7-11><span class=linenos data-linenos="11 "></span></a><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12></a><a href=#__codelineno-7-12><span class=linenos data-linenos="12 "></span></a><span class=w>  </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13></a><a href=#__codelineno-7-13><span class=linenos data-linenos="13 "></span></a>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14></a><a href=#__codelineno-7-14><span class=linenos data-linenos="14 "></span></a><span class=nt>ingress</span><span class=p>:</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15></a><a href=#__codelineno-7-15><span class=linenos data-linenos="15 "></span></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16></a><a href=#__codelineno-7-16><span class=linenos data-linenos="16 "></span></a><span class=w>  </span><span class=nt>className</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17></a><a href=#__codelineno-7-17><span class=linenos data-linenos="17 "></span></a><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
</span><span id=__span-7-18><a id=__codelineno-7-18 name=__codelineno-7-18></a><a href=#__codelineno-7-18><span class=linenos data-linenos="18 "></span></a><span class=w>    </span><span class=nt>cert-manager.io/cluster-issuer</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
</span><span id=__span-7-19><a id=__codelineno-7-19 name=__codelineno-7-19></a><a href=#__codelineno-7-19><span class=linenos data-linenos="19 "></span></a><span class=w>    </span><span class=nt>nginx.ingress.kubernetes.io/ssl-redirect</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
</span><span id=__span-7-20><a id=__codelineno-7-20 name=__codelineno-7-20></a><a href=#__codelineno-7-20><span class=linenos data-linenos="20 "></span></a><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span>
</span><span id=__span-7-21><a id=__codelineno-7-21 name=__codelineno-7-21></a><a href=#__codelineno-7-21><span class=linenos data-linenos="21 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent-workflow.example.com</span>
</span><span id=__span-7-22><a id=__codelineno-7-22 name=__codelineno-7-22></a><a href=#__codelineno-7-22><span class=linenos data-linenos="22 "></span></a><span class=w>      </span><span class=nt>paths</span><span class=p>:</span>
</span><span id=__span-7-23><a id=__codelineno-7-23 name=__codelineno-7-23></a><a href=#__codelineno-7-23><span class=linenos data-linenos="23 "></span></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span><span id=__span-7-24><a id=__codelineno-7-24 name=__codelineno-7-24></a><a href=#__codelineno-7-24><span class=linenos data-linenos="24 "></span></a><span class=w>          </span><span class=nt>pathType</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span><span id=__span-7-25><a id=__codelineno-7-25 name=__codelineno-7-25></a><a href=#__codelineno-7-25><span class=linenos data-linenos="25 "></span></a><span class=w>  </span><span class=nt>tls</span><span class=p>:</span>
</span><span id=__span-7-26><a id=__codelineno-7-26 name=__codelineno-7-26></a><a href=#__codelineno-7-26><span class=linenos data-linenos="26 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent-workflow-tls</span>
</span><span id=__span-7-27><a id=__codelineno-7-27 name=__codelineno-7-27></a><a href=#__codelineno-7-27><span class=linenos data-linenos="27 "></span></a><span class=w>      </span><span class=nt>hosts</span><span class=p>:</span>
</span><span id=__span-7-28><a id=__codelineno-7-28 name=__codelineno-7-28></a><a href=#__codelineno-7-28><span class=linenos data-linenos="28 "></span></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent-workflow.example.com</span>
</span><span id=__span-7-29><a id=__codelineno-7-29 name=__codelineno-7-29></a><a href=#__codelineno-7-29><span class=linenos data-linenos="29 "></span></a>
</span><span id=__span-7-30><a id=__codelineno-7-30 name=__codelineno-7-30></a><a href=#__codelineno-7-30><span class=linenos data-linenos="30 "></span></a><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-7-31><a id=__codelineno-7-31 name=__codelineno-7-31></a><a href=#__codelineno-7-31><span class=linenos data-linenos="31 "></span></a><span class=w>  </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-7-32><a id=__codelineno-7-32 name=__codelineno-7-32></a><a href=#__codelineno-7-32><span class=linenos data-linenos="32 "></span></a><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">4000m</span>
</span><span id=__span-7-33><a id=__codelineno-7-33 name=__codelineno-7-33></a><a href=#__codelineno-7-33><span class=linenos data-linenos="33 "></span></a><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8Gi</span>
</span><span id=__span-7-34><a id=__codelineno-7-34 name=__codelineno-7-34></a><a href=#__codelineno-7-34><span class=linenos data-linenos="34 "></span></a><span class=w>  </span><span class=nt>requests</span><span class=p>:</span>
</span><span id=__span-7-35><a id=__codelineno-7-35 name=__codelineno-7-35></a><a href=#__codelineno-7-35><span class=linenos data-linenos="35 "></span></a><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1000m</span>
</span><span id=__span-7-36><a id=__codelineno-7-36 name=__codelineno-7-36></a><a href=#__codelineno-7-36><span class=linenos data-linenos="36 "></span></a><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2Gi</span>
</span><span id=__span-7-37><a id=__codelineno-7-37 name=__codelineno-7-37></a><a href=#__codelineno-7-37><span class=linenos data-linenos="37 "></span></a>
</span><span id=__span-7-38><a id=__codelineno-7-38 name=__codelineno-7-38></a><a href=#__codelineno-7-38><span class=linenos data-linenos="38 "></span></a><span class=nt>autoscaling</span><span class=p>:</span>
</span><span id=__span-7-39><a id=__codelineno-7-39 name=__codelineno-7-39></a><a href=#__codelineno-7-39><span class=linenos data-linenos="39 "></span></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-7-40><a id=__codelineno-7-40 name=__codelineno-7-40></a><a href=#__codelineno-7-40><span class=linenos data-linenos="40 "></span></a><span class=w>  </span><span class=nt>minReplicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-7-41><a id=__codelineno-7-41 name=__codelineno-7-41></a><a href=#__codelineno-7-41><span class=linenos data-linenos="41 "></span></a><span class=w>  </span><span class=nt>maxReplicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</span><span id=__span-7-42><a id=__codelineno-7-42 name=__codelineno-7-42></a><a href=#__codelineno-7-42><span class=linenos data-linenos="42 "></span></a><span class=w>  </span><span class=nt>targetCPUUtilizationPercentage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">70</span>
</span><span id=__span-7-43><a id=__codelineno-7-43 name=__codelineno-7-43></a><a href=#__codelineno-7-43><span class=linenos data-linenos="43 "></span></a><span class=w>  </span><span class=nt>targetMemoryUtilizationPercentage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id=__span-7-44><a id=__codelineno-7-44 name=__codelineno-7-44></a><a href=#__codelineno-7-44><span class=linenos data-linenos="44 "></span></a>
</span><span id=__span-7-45><a id=__codelineno-7-45 name=__codelineno-7-45></a><a href=#__codelineno-7-45><span class=linenos data-linenos="45 "></span></a><span class=nt>postgresql</span><span class=p>:</span>
</span><span id=__span-7-46><a id=__codelineno-7-46 name=__codelineno-7-46></a><a href=#__codelineno-7-46><span class=linenos data-linenos="46 "></span></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-7-47><a id=__codelineno-7-47 name=__codelineno-7-47></a><a href=#__codelineno-7-47><span class=linenos data-linenos="47 "></span></a><span class=w>  </span><span class=nt>auth</span><span class=p>:</span>
</span><span id=__span-7-48><a id=__codelineno-7-48 name=__codelineno-7-48></a><a href=#__codelineno-7-48><span class=linenos data-linenos="48 "></span></a><span class=w>    </span><span class=nt>postgresPassword</span><span class=p>:</span><span class=w> </span><span class=s>&quot;secure_password&quot;</span>
</span><span id=__span-7-49><a id=__codelineno-7-49 name=__codelineno-7-49></a><a href=#__codelineno-7-49><span class=linenos data-linenos="49 "></span></a><span class=w>    </span><span class=nt>database</span><span class=p>:</span><span class=w> </span><span class=s>&quot;agent_workflow&quot;</span>
</span><span id=__span-7-50><a id=__codelineno-7-50 name=__codelineno-7-50></a><a href=#__codelineno-7-50><span class=linenos data-linenos="50 "></span></a><span class=w>  </span><span class=nt>primary</span><span class=p>:</span>
</span><span id=__span-7-51><a id=__codelineno-7-51 name=__codelineno-7-51></a><a href=#__codelineno-7-51><span class=linenos data-linenos="51 "></span></a><span class=w>    </span><span class=nt>persistence</span><span class=p>:</span>
</span><span id=__span-7-52><a id=__codelineno-7-52 name=__codelineno-7-52></a><a href=#__codelineno-7-52><span class=linenos data-linenos="52 "></span></a><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-7-53><a id=__codelineno-7-53 name=__codelineno-7-53></a><a href=#__codelineno-7-53><span class=linenos data-linenos="53 "></span></a><span class=w>      </span><span class=nt>size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100Gi</span>
</span><span id=__span-7-54><a id=__codelineno-7-54 name=__codelineno-7-54></a><a href=#__codelineno-7-54><span class=linenos data-linenos="54 "></span></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-7-55><a id=__codelineno-7-55 name=__codelineno-7-55></a><a href=#__codelineno-7-55><span class=linenos data-linenos="55 "></span></a><span class=w>      </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-7-56><a id=__codelineno-7-56 name=__codelineno-7-56></a><a href=#__codelineno-7-56><span class=linenos data-linenos="56 "></span></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">4Gi</span>
</span><span id=__span-7-57><a id=__codelineno-7-57 name=__codelineno-7-57></a><a href=#__codelineno-7-57><span class=linenos data-linenos="57 "></span></a><span class=w>      </span><span class=nt>requests</span><span class=p>:</span>
</span><span id=__span-7-58><a id=__codelineno-7-58 name=__codelineno-7-58></a><a href=#__codelineno-7-58><span class=linenos data-linenos="58 "></span></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2Gi</span>
</span><span id=__span-7-59><a id=__codelineno-7-59 name=__codelineno-7-59></a><a href=#__codelineno-7-59><span class=linenos data-linenos="59 "></span></a>
</span><span id=__span-7-60><a id=__codelineno-7-60 name=__codelineno-7-60></a><a href=#__codelineno-7-60><span class=linenos data-linenos="60 "></span></a><span class=nt>redis</span><span class=p>:</span>
</span><span id=__span-7-61><a id=__codelineno-7-61 name=__codelineno-7-61></a><a href=#__codelineno-7-61><span class=linenos data-linenos="61 "></span></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-7-62><a id=__codelineno-7-62 name=__codelineno-7-62></a><a href=#__codelineno-7-62><span class=linenos data-linenos="62 "></span></a><span class=w>  </span><span class=nt>auth</span><span class=p>:</span>
</span><span id=__span-7-63><a id=__codelineno-7-63 name=__codelineno-7-63></a><a href=#__codelineno-7-63><span class=linenos data-linenos="63 "></span></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-7-64><a id=__codelineno-7-64 name=__codelineno-7-64></a><a href=#__codelineno-7-64><span class=linenos data-linenos="64 "></span></a><span class=w>    </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=s>&quot;secure_redis_password&quot;</span>
</span><span id=__span-7-65><a id=__codelineno-7-65 name=__codelineno-7-65></a><a href=#__codelineno-7-65><span class=linenos data-linenos="65 "></span></a><span class=w>  </span><span class=nt>master</span><span class=p>:</span>
</span><span id=__span-7-66><a id=__codelineno-7-66 name=__codelineno-7-66></a><a href=#__codelineno-7-66><span class=linenos data-linenos="66 "></span></a><span class=w>    </span><span class=nt>persistence</span><span class=p>:</span>
</span><span id=__span-7-67><a id=__codelineno-7-67 name=__codelineno-7-67></a><a href=#__codelineno-7-67><span class=linenos data-linenos="67 "></span></a><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-7-68><a id=__codelineno-7-68 name=__codelineno-7-68></a><a href=#__codelineno-7-68><span class=linenos data-linenos="68 "></span></a><span class=w>      </span><span class=nt>size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">20Gi</span>
</span></code></pre></div><p>Install with Helm:</p><div class="language-bash highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1></a><a href=#__codelineno-8-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># Add Helm repository</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2></a><a href=#__codelineno-8-2><span class=linenos data-linenos=" 2 "></span></a>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>agent-workflow<span class=w> </span>https://charts.agent-workflow.com
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3></a><a href=#__codelineno-8-3><span class=linenos data-linenos=" 3 "></span></a>helm<span class=w> </span>repo<span class=w> </span>update
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4></a><a href=#__codelineno-8-4><span class=linenos data-linenos=" 4 "></span></a>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5></a><a href=#__codelineno-8-5><span class=linenos data-linenos=" 5 "></span></a><span class=c1># Install with custom values</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6></a><a href=#__codelineno-8-6><span class=linenos data-linenos=" 6 "></span></a>helm<span class=w> </span>install<span class=w> </span>agent-workflow<span class=w> </span>agent-workflow/agent-workflow<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7></a><a href=#__codelineno-8-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>  </span>--namespace<span class=w> </span>agent-workflow<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8></a><a href=#__codelineno-8-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>  </span>--create-namespace<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9></a><a href=#__codelineno-8-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>  </span>--values<span class=w> </span>values.yaml<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10></a><a href=#__codelineno-8-10><span class=linenos data-linenos="10 "></span></a><span class=w>  </span>--set<span class=w> </span>secrets.discordToken<span class=o>=</span><span class=s2>&quot;your_discord_token&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11></a><a href=#__codelineno-8-11><span class=linenos data-linenos="11 "></span></a><span class=w>  </span>--set<span class=w> </span>secrets.anthropicKey<span class=o>=</span><span class=s2>&quot;your_anthropic_key&quot;</span>
</span></code></pre></div><h2 id=monitoring-observability>Monitoring &amp; Observability<a class=headerlink href=#monitoring-observability title="Permanent link">&para;</a></h2><h3 id=prometheus-grafana-stack>Prometheus + Grafana Stack<a class=headerlink href=#prometheus-grafana-stack title="Permanent link">&para;</a></h3><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1></a><a href=#__codelineno-9-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># monitoring/docker-compose.yml</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2></a><a href=#__codelineno-9-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3></a><a href=#__codelineno-9-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4></a><a href=#__codelineno-9-4><span class=linenos data-linenos=" 4 "></span></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5></a><a href=#__codelineno-9-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span><span class=nt>prometheus</span><span class=p>:</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6></a><a href=#__codelineno-9-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prom/prometheus:latest</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7></a><a href=#__codelineno-9-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prometheus</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8></a><a href=#__codelineno-9-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9></a><a href=#__codelineno-9-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;9090:9090&quot;</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10></a><a href=#__codelineno-9-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11></a><a href=#__codelineno-9-11><span class=linenos data-linenos="11 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./prometheus.yml:/etc/prometheus/prometheus.yml</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12></a><a href=#__codelineno-9-12><span class=linenos data-linenos="12 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prometheus_data:/prometheus</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13></a><a href=#__codelineno-9-13><span class=linenos data-linenos="13 "></span></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14></a><a href=#__codelineno-9-14><span class=linenos data-linenos="14 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--config.file=/etc/prometheus/prometheus.yml&#39;</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15></a><a href=#__codelineno-9-15><span class=linenos data-linenos="15 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--storage.tsdb.path=/prometheus&#39;</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16></a><a href=#__codelineno-9-16><span class=linenos data-linenos="16 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--web.console.libraries=/usr/share/prometheus/console_libraries&#39;</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17></a><a href=#__codelineno-9-17><span class=linenos data-linenos="17 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--web.console.templates=/usr/share/prometheus/consoles&#39;</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18></a><a href=#__codelineno-9-18><span class=linenos data-linenos="18 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--storage.tsdb.retention.time=30d&#39;</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19></a><a href=#__codelineno-9-19><span class=linenos data-linenos="19 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--web.enable-lifecycle&#39;</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20></a><a href=#__codelineno-9-20><span class=linenos data-linenos="20 "></span></a>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21></a><a href=#__codelineno-9-21><span class=linenos data-linenos="21 "></span></a><span class=w>  </span><span class=nt>grafana</span><span class=p>:</span>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22></a><a href=#__codelineno-9-22><span class=linenos data-linenos="22 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grafana/grafana:latest</span>
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23></a><a href=#__codelineno-9-23><span class=linenos data-linenos="23 "></span></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
</span><span id=__span-9-24><a id=__codelineno-9-24 name=__codelineno-9-24></a><a href=#__codelineno-9-24><span class=linenos data-linenos="24 "></span></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-9-25><a id=__codelineno-9-25 name=__codelineno-9-25></a><a href=#__codelineno-9-25><span class=linenos data-linenos="25 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;3000:3000&quot;</span>
</span><span id=__span-9-26><a id=__codelineno-9-26 name=__codelineno-9-26></a><a href=#__codelineno-9-26><span class=linenos data-linenos="26 "></span></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-9-27><a id=__codelineno-9-27 name=__codelineno-9-27></a><a href=#__codelineno-9-27><span class=linenos data-linenos="27 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GF_SECURITY_ADMIN_PASSWORD=admin</span>
</span><span id=__span-9-28><a id=__codelineno-9-28 name=__codelineno-9-28></a><a href=#__codelineno-9-28><span class=linenos data-linenos="28 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GF_USERS_ALLOW_SIGN_UP=false</span>
</span><span id=__span-9-29><a id=__codelineno-9-29 name=__codelineno-9-29></a><a href=#__codelineno-9-29><span class=linenos data-linenos="29 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-9-30><a id=__codelineno-9-30 name=__codelineno-9-30></a><a href=#__codelineno-9-30><span class=linenos data-linenos="30 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grafana_data:/var/lib/grafana</span>
</span><span id=__span-9-31><a id=__codelineno-9-31 name=__codelineno-9-31></a><a href=#__codelineno-9-31><span class=linenos data-linenos="31 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./grafana/dashboards:/etc/grafana/provisioning/dashboards</span>
</span><span id=__span-9-32><a id=__codelineno-9-32 name=__codelineno-9-32></a><a href=#__codelineno-9-32><span class=linenos data-linenos="32 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./grafana/datasources:/etc/grafana/provisioning/datasources</span>
</span><span id=__span-9-33><a id=__codelineno-9-33 name=__codelineno-9-33></a><a href=#__codelineno-9-33><span class=linenos data-linenos="33 "></span></a>
</span><span id=__span-9-34><a id=__codelineno-9-34 name=__codelineno-9-34></a><a href=#__codelineno-9-34><span class=linenos data-linenos="34 "></span></a><span class=w>  </span><span class=nt>node-exporter</span><span class=p>:</span>
</span><span id=__span-9-35><a id=__codelineno-9-35 name=__codelineno-9-35></a><a href=#__codelineno-9-35><span class=linenos data-linenos="35 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prom/node-exporter:latest</span>
</span><span id=__span-9-36><a id=__codelineno-9-36 name=__codelineno-9-36></a><a href=#__codelineno-9-36><span class=linenos data-linenos="36 "></span></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">node-exporter</span>
</span><span id=__span-9-37><a id=__codelineno-9-37 name=__codelineno-9-37></a><a href=#__codelineno-9-37><span class=linenos data-linenos="37 "></span></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-9-38><a id=__codelineno-9-38 name=__codelineno-9-38></a><a href=#__codelineno-9-38><span class=linenos data-linenos="38 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;9100:9100&quot;</span>
</span><span id=__span-9-39><a id=__codelineno-9-39 name=__codelineno-9-39></a><a href=#__codelineno-9-39><span class=linenos data-linenos="39 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-9-40><a id=__codelineno-9-40 name=__codelineno-9-40></a><a href=#__codelineno-9-40><span class=linenos data-linenos="40 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/proc:/host/proc:ro</span>
</span><span id=__span-9-41><a id=__codelineno-9-41 name=__codelineno-9-41></a><a href=#__codelineno-9-41><span class=linenos data-linenos="41 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/sys:/host/sys:ro</span>
</span><span id=__span-9-42><a id=__codelineno-9-42 name=__codelineno-9-42></a><a href=#__codelineno-9-42><span class=linenos data-linenos="42 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/:/rootfs:ro</span>
</span><span id=__span-9-43><a id=__codelineno-9-43 name=__codelineno-9-43></a><a href=#__codelineno-9-43><span class=linenos data-linenos="43 "></span></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span>
</span><span id=__span-9-44><a id=__codelineno-9-44 name=__codelineno-9-44></a><a href=#__codelineno-9-44><span class=linenos data-linenos="44 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--path.procfs=/host/proc&#39;</span>
</span><span id=__span-9-45><a id=__codelineno-9-45 name=__codelineno-9-45></a><a href=#__codelineno-9-45><span class=linenos data-linenos="45 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--path.rootfs=/rootfs&#39;</span>
</span><span id=__span-9-46><a id=__codelineno-9-46 name=__codelineno-9-46></a><a href=#__codelineno-9-46><span class=linenos data-linenos="46 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--path.sysfs=/host/sys&#39;</span>
</span><span id=__span-9-47><a id=__codelineno-9-47 name=__codelineno-9-47></a><a href=#__codelineno-9-47><span class=linenos data-linenos="47 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)&#39;</span>
</span><span id=__span-9-48><a id=__codelineno-9-48 name=__codelineno-9-48></a><a href=#__codelineno-9-48><span class=linenos data-linenos="48 "></span></a>
</span><span id=__span-9-49><a id=__codelineno-9-49 name=__codelineno-9-49></a><a href=#__codelineno-9-49><span class=linenos data-linenos="49 "></span></a><span class=w>  </span><span class=nt>cadvisor</span><span class=p>:</span>
</span><span id=__span-9-50><a id=__codelineno-9-50 name=__codelineno-9-50></a><a href=#__codelineno-9-50><span class=linenos data-linenos="50 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gcr.io/cadvisor/cadvisor:latest</span>
</span><span id=__span-9-51><a id=__codelineno-9-51 name=__codelineno-9-51></a><a href=#__codelineno-9-51><span class=linenos data-linenos="51 "></span></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cadvisor</span>
</span><span id=__span-9-52><a id=__codelineno-9-52 name=__codelineno-9-52></a><a href=#__codelineno-9-52><span class=linenos data-linenos="52 "></span></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-9-53><a id=__codelineno-9-53 name=__codelineno-9-53></a><a href=#__codelineno-9-53><span class=linenos data-linenos="53 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8081:8080&quot;</span>
</span><span id=__span-9-54><a id=__codelineno-9-54 name=__codelineno-9-54></a><a href=#__codelineno-9-54><span class=linenos data-linenos="54 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-9-55><a id=__codelineno-9-55 name=__codelineno-9-55></a><a href=#__codelineno-9-55><span class=linenos data-linenos="55 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/:/rootfs:ro</span>
</span><span id=__span-9-56><a id=__codelineno-9-56 name=__codelineno-9-56></a><a href=#__codelineno-9-56><span class=linenos data-linenos="56 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/run:/var/run:ro</span>
</span><span id=__span-9-57><a id=__codelineno-9-57 name=__codelineno-9-57></a><a href=#__codelineno-9-57><span class=linenos data-linenos="57 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/sys:/sys:ro</span>
</span><span id=__span-9-58><a id=__codelineno-9-58 name=__codelineno-9-58></a><a href=#__codelineno-9-58><span class=linenos data-linenos="58 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/docker/:/var/lib/docker:ro</span>
</span><span id=__span-9-59><a id=__codelineno-9-59 name=__codelineno-9-59></a><a href=#__codelineno-9-59><span class=linenos data-linenos="59 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/dev/disk/:/dev/disk:ro</span>
</span><span id=__span-9-60><a id=__codelineno-9-60 name=__codelineno-9-60></a><a href=#__codelineno-9-60><span class=linenos data-linenos="60 "></span></a><span class=w>    </span><span class=nt>privileged</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-9-61><a id=__codelineno-9-61 name=__codelineno-9-61></a><a href=#__codelineno-9-61><span class=linenos data-linenos="61 "></span></a><span class=w>    </span><span class=nt>devices</span><span class=p>:</span>
</span><span id=__span-9-62><a id=__codelineno-9-62 name=__codelineno-9-62></a><a href=#__codelineno-9-62><span class=linenos data-linenos="62 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/dev/kmsg</span>
</span><span id=__span-9-63><a id=__codelineno-9-63 name=__codelineno-9-63></a><a href=#__codelineno-9-63><span class=linenos data-linenos="63 "></span></a>
</span><span id=__span-9-64><a id=__codelineno-9-64 name=__codelineno-9-64></a><a href=#__codelineno-9-64><span class=linenos data-linenos="64 "></span></a><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span>
</span><span id=__span-9-65><a id=__codelineno-9-65 name=__codelineno-9-65></a><a href=#__codelineno-9-65><span class=linenos data-linenos="65 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">jaegertracing/all-in-one:latest</span>
</span><span id=__span-9-66><a id=__codelineno-9-66 name=__codelineno-9-66></a><a href=#__codelineno-9-66><span class=linenos data-linenos="66 "></span></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">jaeger</span>
</span><span id=__span-9-67><a id=__codelineno-9-67 name=__codelineno-9-67></a><a href=#__codelineno-9-67><span class=linenos data-linenos="67 "></span></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-9-68><a id=__codelineno-9-68 name=__codelineno-9-68></a><a href=#__codelineno-9-68><span class=linenos data-linenos="68 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;14268:14268&quot;</span>
</span><span id=__span-9-69><a id=__codelineno-9-69 name=__codelineno-9-69></a><a href=#__codelineno-9-69><span class=linenos data-linenos="69 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;16686:16686&quot;</span>
</span><span id=__span-9-70><a id=__codelineno-9-70 name=__codelineno-9-70></a><a href=#__codelineno-9-70><span class=linenos data-linenos="70 "></span></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-9-71><a id=__codelineno-9-71 name=__codelineno-9-71></a><a href=#__codelineno-9-71><span class=linenos data-linenos="71 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">COLLECTOR_OTLP_ENABLED=true</span>
</span><span id=__span-9-72><a id=__codelineno-9-72 name=__codelineno-9-72></a><a href=#__codelineno-9-72><span class=linenos data-linenos="72 "></span></a>
</span><span id=__span-9-73><a id=__codelineno-9-73 name=__codelineno-9-73></a><a href=#__codelineno-9-73><span class=linenos data-linenos="73 "></span></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-9-74><a id=__codelineno-9-74 name=__codelineno-9-74></a><a href=#__codelineno-9-74><span class=linenos data-linenos="74 "></span></a><span class=w>  </span><span class=nt>prometheus_data</span><span class=p>:</span>
</span><span id=__span-9-75><a id=__codelineno-9-75 name=__codelineno-9-75></a><a href=#__codelineno-9-75><span class=linenos data-linenos="75 "></span></a><span class=w>  </span><span class=nt>grafana_data</span><span class=p>:</span>
</span></code></pre></div><h3 id=prometheus-configuration>Prometheus Configuration<a class=headerlink href=#prometheus-configuration title="Permanent link">&para;</a></h3><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1></a><a href=#__codelineno-10-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># monitoring/prometheus.yml</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2></a><a href=#__codelineno-10-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>global</span><span class=p>:</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3></a><a href=#__codelineno-10-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>  </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">15s</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4></a><a href=#__codelineno-10-4><span class=linenos data-linenos=" 4 "></span></a><span class=w>  </span><span class=nt>evaluation_interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">15s</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5></a><a href=#__codelineno-10-5><span class=linenos data-linenos=" 5 "></span></a>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6></a><a href=#__codelineno-10-6><span class=linenos data-linenos=" 6 "></span></a><span class=nt>rule_files</span><span class=p>:</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7></a><a href=#__codelineno-10-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;alerts.yml&quot;</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8></a><a href=#__codelineno-10-8><span class=linenos data-linenos=" 8 "></span></a>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9></a><a href=#__codelineno-10-9><span class=linenos data-linenos=" 9 "></span></a><span class=nt>alerting</span><span class=p>:</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10></a><a href=#__codelineno-10-10><span class=linenos data-linenos="10 "></span></a><span class=w>  </span><span class=nt>alertmanagers</span><span class=p>:</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11></a><a href=#__codelineno-10-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>static_configs</span><span class=p>:</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12></a><a href=#__codelineno-10-12><span class=linenos data-linenos="12 "></span></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13></a><a href=#__codelineno-10-13><span class=linenos data-linenos="13 "></span></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alertmanager:9093</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14></a><a href=#__codelineno-10-14><span class=linenos data-linenos="14 "></span></a>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15></a><a href=#__codelineno-10-15><span class=linenos data-linenos="15 "></span></a><span class=nt>scrape_configs</span><span class=p>:</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16></a><a href=#__codelineno-10-16><span class=linenos data-linenos="16 "></span></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;prometheus&#39;</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17></a><a href=#__codelineno-10-17><span class=linenos data-linenos="17 "></span></a><span class=w>    </span><span class=nt>static_configs</span><span class=p>:</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18></a><a href=#__codelineno-10-18><span class=linenos data-linenos="18 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&#39;localhost:9090&#39;</span><span class="p p-Indicator">]</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19></a><a href=#__codelineno-10-19><span class=linenos data-linenos="19 "></span></a>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20></a><a href=#__codelineno-10-20><span class=linenos data-linenos="20 "></span></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;agent-workflow&#39;</span>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21></a><a href=#__codelineno-10-21><span class=linenos data-linenos="21 "></span></a><span class=w>    </span><span class=nt>static_configs</span><span class=p>:</span>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22></a><a href=#__codelineno-10-22><span class=linenos data-linenos="22 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&#39;orchestrator:8080&#39;</span><span class="p p-Indicator">]</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23></a><a href=#__codelineno-10-23><span class=linenos data-linenos="23 "></span></a><span class=w>    </span><span class=nt>metrics_path</span><span class=p>:</span><span class=w> </span><span class=s>&#39;/metrics&#39;</span>
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24></a><a href=#__codelineno-10-24><span class=linenos data-linenos="24 "></span></a><span class=w>    </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25></a><a href=#__codelineno-10-25><span class=linenos data-linenos="25 "></span></a>
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26></a><a href=#__codelineno-10-26><span class=linenos data-linenos="26 "></span></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;node-exporter&#39;</span>
</span><span id=__span-10-27><a id=__codelineno-10-27 name=__codelineno-10-27></a><a href=#__codelineno-10-27><span class=linenos data-linenos="27 "></span></a><span class=w>    </span><span class=nt>static_configs</span><span class=p>:</span>
</span><span id=__span-10-28><a id=__codelineno-10-28 name=__codelineno-10-28></a><a href=#__codelineno-10-28><span class=linenos data-linenos="28 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&#39;node-exporter:9100&#39;</span><span class="p p-Indicator">]</span>
</span><span id=__span-10-29><a id=__codelineno-10-29 name=__codelineno-10-29></a><a href=#__codelineno-10-29><span class=linenos data-linenos="29 "></span></a>
</span><span id=__span-10-30><a id=__codelineno-10-30 name=__codelineno-10-30></a><a href=#__codelineno-10-30><span class=linenos data-linenos="30 "></span></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;cadvisor&#39;</span>
</span><span id=__span-10-31><a id=__codelineno-10-31 name=__codelineno-10-31></a><a href=#__codelineno-10-31><span class=linenos data-linenos="31 "></span></a><span class=w>    </span><span class=nt>static_configs</span><span class=p>:</span>
</span><span id=__span-10-32><a id=__codelineno-10-32 name=__codelineno-10-32></a><a href=#__codelineno-10-32><span class=linenos data-linenos="32 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&#39;cadvisor:8080&#39;</span><span class="p p-Indicator">]</span>
</span><span id=__span-10-33><a id=__codelineno-10-33 name=__codelineno-10-33></a><a href=#__codelineno-10-33><span class=linenos data-linenos="33 "></span></a>
</span><span id=__span-10-34><a id=__codelineno-10-34 name=__codelineno-10-34></a><a href=#__codelineno-10-34><span class=linenos data-linenos="34 "></span></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;redis&#39;</span>
</span><span id=__span-10-35><a id=__codelineno-10-35 name=__codelineno-10-35></a><a href=#__codelineno-10-35><span class=linenos data-linenos="35 "></span></a><span class=w>    </span><span class=nt>static_configs</span><span class=p>:</span>
</span><span id=__span-10-36><a id=__codelineno-10-36 name=__codelineno-10-36></a><a href=#__codelineno-10-36><span class=linenos data-linenos="36 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&#39;redis:6379&#39;</span><span class="p p-Indicator">]</span>
</span><span id=__span-10-37><a id=__codelineno-10-37 name=__codelineno-10-37></a><a href=#__codelineno-10-37><span class=linenos data-linenos="37 "></span></a>
</span><span id=__span-10-38><a id=__codelineno-10-38 name=__codelineno-10-38></a><a href=#__codelineno-10-38><span class=linenos data-linenos="38 "></span></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&#39;postgres&#39;</span>
</span><span id=__span-10-39><a id=__codelineno-10-39 name=__codelineno-10-39></a><a href=#__codelineno-10-39><span class=linenos data-linenos="39 "></span></a><span class=w>    </span><span class=nt>static_configs</span><span class=p>:</span>
</span><span id=__span-10-40><a id=__codelineno-10-40 name=__codelineno-10-40></a><a href=#__codelineno-10-40><span class=linenos data-linenos="40 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&#39;postgres:5432&#39;</span><span class="p p-Indicator">]</span>
</span></code></pre></div><h3 id=custom-metrics-implementation>Custom Metrics Implementation<a class=headerlink href=#custom-metrics-implementation title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1></a><a href=#__codelineno-11-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># lib/metrics.py</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2></a><a href=#__codelineno-11-2><span class=linenos data-linenos=" 2 "></span></a><span class=kn>from</span> <span class=nn>prometheus_client</span> <span class=kn>import</span> <span class=n>Counter</span><span class=p>,</span> <span class=n>Histogram</span><span class=p>,</span> <span class=n>Gauge</span><span class=p>,</span> <span class=n>start_http_server</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3></a><a href=#__codelineno-11-3><span class=linenos data-linenos=" 3 "></span></a><span class=kn>import</span> <span class=nn>time</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4></a><a href=#__codelineno-11-4><span class=linenos data-linenos=" 4 "></span></a>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5></a><a href=#__codelineno-11-5><span class=linenos data-linenos=" 5 "></span></a><span class=c1># Custom metrics for agent workflow</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6></a><a href=#__codelineno-11-6><span class=linenos data-linenos=" 6 "></span></a><span class=n>agent_tasks_total</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>(</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7></a><a href=#__codelineno-11-7><span class=linenos data-linenos=" 7 "></span></a>    <span class=s1>&#39;agent_tasks_total&#39;</span><span class=p>,</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8></a><a href=#__codelineno-11-8><span class=linenos data-linenos=" 8 "></span></a>    <span class=s1>&#39;Total number of agent tasks executed&#39;</span><span class=p>,</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9></a><a href=#__codelineno-11-9><span class=linenos data-linenos=" 9 "></span></a>    <span class=p>[</span><span class=s1>&#39;agent_type&#39;</span><span class=p>,</span> <span class=s1>&#39;status&#39;</span><span class=p>]</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10></a><a href=#__codelineno-11-10><span class=linenos data-linenos="10 "></span></a><span class=p>)</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11></a><a href=#__codelineno-11-11><span class=linenos data-linenos="11 "></span></a>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12></a><a href=#__codelineno-11-12><span class=linenos data-linenos="12 "></span></a><span class=n>agent_task_duration</span> <span class=o>=</span> <span class=n>Histogram</span><span class=p>(</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13></a><a href=#__codelineno-11-13><span class=linenos data-linenos="13 "></span></a>    <span class=s1>&#39;agent_task_duration_seconds&#39;</span><span class=p>,</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14></a><a href=#__codelineno-11-14><span class=linenos data-linenos="14 "></span></a>    <span class=s1>&#39;Time spent executing agent tasks&#39;</span><span class=p>,</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15></a><a href=#__codelineno-11-15><span class=linenos data-linenos="15 "></span></a>    <span class=p>[</span><span class=s1>&#39;agent_type&#39;</span><span class=p>],</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16></a><a href=#__codelineno-11-16><span class=linenos data-linenos="16 "></span></a>    <span class=n>buckets</span><span class=o>=</span><span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>2.5</span><span class=p>,</span> <span class=mf>5.0</span><span class=p>,</span> <span class=mf>10.0</span><span class=p>,</span> <span class=mf>30.0</span><span class=p>,</span> <span class=mf>60.0</span><span class=p>,</span> <span class=mf>300.0</span><span class=p>]</span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17></a><a href=#__codelineno-11-17><span class=linenos data-linenos="17 "></span></a><span class=p>)</span>
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18></a><a href=#__codelineno-11-18><span class=linenos data-linenos="18 "></span></a>
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19></a><a href=#__codelineno-11-19><span class=linenos data-linenos="19 "></span></a><span class=n>active_projects</span> <span class=o>=</span> <span class=n>Gauge</span><span class=p>(</span>
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20></a><a href=#__codelineno-11-20><span class=linenos data-linenos="20 "></span></a>    <span class=s1>&#39;active_projects&#39;</span><span class=p>,</span>
</span><span id=__span-11-21><a id=__codelineno-11-21 name=__codelineno-11-21></a><a href=#__codelineno-11-21><span class=linenos data-linenos="21 "></span></a>    <span class=s1>&#39;Number of active projects being managed&#39;</span>
</span><span id=__span-11-22><a id=__codelineno-11-22 name=__codelineno-11-22></a><a href=#__codelineno-11-22><span class=linenos data-linenos="22 "></span></a><span class=p>)</span>
</span><span id=__span-11-23><a id=__codelineno-11-23 name=__codelineno-11-23></a><a href=#__codelineno-11-23><span class=linenos data-linenos="23 "></span></a>
</span><span id=__span-11-24><a id=__codelineno-11-24 name=__codelineno-11-24></a><a href=#__codelineno-11-24><span class=linenos data-linenos="24 "></span></a><span class=n>discord_commands_total</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>(</span>
</span><span id=__span-11-25><a id=__codelineno-11-25 name=__codelineno-11-25></a><a href=#__codelineno-11-25><span class=linenos data-linenos="25 "></span></a>    <span class=s1>&#39;discord_commands_total&#39;</span><span class=p>,</span>
</span><span id=__span-11-26><a id=__codelineno-11-26 name=__codelineno-11-26></a><a href=#__codelineno-11-26><span class=linenos data-linenos="26 "></span></a>    <span class=s1>&#39;Total number of Discord commands received&#39;</span><span class=p>,</span>
</span><span id=__span-11-27><a id=__codelineno-11-27 name=__codelineno-11-27></a><a href=#__codelineno-11-27><span class=linenos data-linenos="27 "></span></a>    <span class=p>[</span><span class=s1>&#39;command&#39;</span><span class=p>,</span> <span class=s1>&#39;status&#39;</span><span class=p>]</span>
</span><span id=__span-11-28><a id=__codelineno-11-28 name=__codelineno-11-28></a><a href=#__codelineno-11-28><span class=linenos data-linenos="28 "></span></a><span class=p>)</span>
</span><span id=__span-11-29><a id=__codelineno-11-29 name=__codelineno-11-29></a><a href=#__codelineno-11-29><span class=linenos data-linenos="29 "></span></a>
</span><span id=__span-11-30><a id=__codelineno-11-30 name=__codelineno-11-30></a><a href=#__codelineno-11-30><span class=linenos data-linenos="30 "></span></a><span class=n>orchestrator_state</span> <span class=o>=</span> <span class=n>Gauge</span><span class=p>(</span>
</span><span id=__span-11-31><a id=__codelineno-11-31 name=__codelineno-11-31></a><a href=#__codelineno-11-31><span class=linenos data-linenos="31 "></span></a>    <span class=s1>&#39;orchestrator_state&#39;</span><span class=p>,</span>
</span><span id=__span-11-32><a id=__codelineno-11-32 name=__codelineno-11-32></a><a href=#__codelineno-11-32><span class=linenos data-linenos="32 "></span></a>    <span class=s1>&#39;Current state of the orchestrator&#39;</span><span class=p>,</span>
</span><span id=__span-11-33><a id=__codelineno-11-33 name=__codelineno-11-33></a><a href=#__codelineno-11-33><span class=linenos data-linenos="33 "></span></a>    <span class=p>[</span><span class=s1>&#39;project_name&#39;</span><span class=p>,</span> <span class=s1>&#39;state&#39;</span><span class=p>]</span>
</span><span id=__span-11-34><a id=__codelineno-11-34 name=__codelineno-11-34></a><a href=#__codelineno-11-34><span class=linenos data-linenos="34 "></span></a><span class=p>)</span>
</span><span id=__span-11-35><a id=__codelineno-11-35 name=__codelineno-11-35></a><a href=#__codelineno-11-35><span class=linenos data-linenos="35 "></span></a>
</span><span id=__span-11-36><a id=__codelineno-11-36 name=__codelineno-11-36></a><a href=#__codelineno-11-36><span class=linenos data-linenos="36 "></span></a><span class=k>def</span> <span class=nf>track_agent_task</span><span class=p>(</span><span class=n>agent_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-11-37><a id=__codelineno-11-37 name=__codelineno-11-37></a><a href=#__codelineno-11-37><span class=linenos data-linenos="37 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Decorator to track agent task execution&quot;&quot;&quot;</span>
</span><span id=__span-11-38><a id=__codelineno-11-38 name=__codelineno-11-38></a><a href=#__codelineno-11-38><span class=linenos data-linenos="38 "></span></a>    <span class=k>def</span> <span class=nf>decorator</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
</span><span id=__span-11-39><a id=__codelineno-11-39 name=__codelineno-11-39></a><a href=#__codelineno-11-39><span class=linenos data-linenos="39 "></span></a>        <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-11-40><a id=__codelineno-11-40 name=__codelineno-11-40></a><a href=#__codelineno-11-40><span class=linenos data-linenos="40 "></span></a>            <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-11-41><a id=__codelineno-11-41 name=__codelineno-11-41></a><a href=#__codelineno-11-41><span class=linenos data-linenos="41 "></span></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-11-42><a id=__codelineno-11-42 name=__codelineno-11-42></a><a href=#__codelineno-11-42><span class=linenos data-linenos="42 "></span></a>                <span class=n>result</span> <span class=o>=</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-11-43><a id=__codelineno-11-43 name=__codelineno-11-43></a><a href=#__codelineno-11-43><span class=linenos data-linenos="43 "></span></a>                <span class=n>agent_tasks_total</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>agent_type</span><span class=o>=</span><span class=n>agent_type</span><span class=p>,</span> <span class=n>status</span><span class=o>=</span><span class=s1>&#39;success&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>inc</span><span class=p>()</span>
</span><span id=__span-11-44><a id=__codelineno-11-44 name=__codelineno-11-44></a><a href=#__codelineno-11-44><span class=linenos data-linenos="44 "></span></a>                <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-11-45><a id=__codelineno-11-45 name=__codelineno-11-45></a><a href=#__codelineno-11-45><span class=linenos data-linenos="45 "></span></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-11-46><a id=__codelineno-11-46 name=__codelineno-11-46></a><a href=#__codelineno-11-46><span class=linenos data-linenos="46 "></span></a>                <span class=n>agent_tasks_total</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>agent_type</span><span class=o>=</span><span class=n>agent_type</span><span class=p>,</span> <span class=n>status</span><span class=o>=</span><span class=s1>&#39;error&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>inc</span><span class=p>()</span>
</span><span id=__span-11-47><a id=__codelineno-11-47 name=__codelineno-11-47></a><a href=#__codelineno-11-47><span class=linenos data-linenos="47 "></span></a>                <span class=k>raise</span>
</span><span id=__span-11-48><a id=__codelineno-11-48 name=__codelineno-11-48></a><a href=#__codelineno-11-48><span class=linenos data-linenos="48 "></span></a>            <span class=k>finally</span><span class=p>:</span>
</span><span id=__span-11-49><a id=__codelineno-11-49 name=__codelineno-11-49></a><a href=#__codelineno-11-49><span class=linenos data-linenos="49 "></span></a>                <span class=n>duration</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span><span id=__span-11-50><a id=__codelineno-11-50 name=__codelineno-11-50></a><a href=#__codelineno-11-50><span class=linenos data-linenos="50 "></span></a>                <span class=n>agent_task_duration</span><span class=o>.</span><span class=n>labels</span><span class=p>(</span><span class=n>agent_type</span><span class=o>=</span><span class=n>agent_type</span><span class=p>)</span><span class=o>.</span><span class=n>observe</span><span class=p>(</span><span class=n>duration</span><span class=p>)</span>
</span><span id=__span-11-51><a id=__codelineno-11-51 name=__codelineno-11-51></a><a href=#__codelineno-11-51><span class=linenos data-linenos="51 "></span></a>        <span class=k>return</span> <span class=n>wrapper</span>
</span><span id=__span-11-52><a id=__codelineno-11-52 name=__codelineno-11-52></a><a href=#__codelineno-11-52><span class=linenos data-linenos="52 "></span></a>    <span class=k>return</span> <span class=n>decorator</span>
</span><span id=__span-11-53><a id=__codelineno-11-53 name=__codelineno-11-53></a><a href=#__codelineno-11-53><span class=linenos data-linenos="53 "></span></a>
</span><span id=__span-11-54><a id=__codelineno-11-54 name=__codelineno-11-54></a><a href=#__codelineno-11-54><span class=linenos data-linenos="54 "></span></a><span class=k>def</span> <span class=nf>start_metrics_server</span><span class=p>(</span><span class=n>port</span><span class=o>=</span><span class=mi>8000</span><span class=p>):</span>
</span><span id=__span-11-55><a id=__codelineno-11-55 name=__codelineno-11-55></a><a href=#__codelineno-11-55><span class=linenos data-linenos="55 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Start Prometheus metrics server&quot;&quot;&quot;</span>
</span><span id=__span-11-56><a id=__codelineno-11-56 name=__codelineno-11-56></a><a href=#__codelineno-11-56><span class=linenos data-linenos="56 "></span></a>    <span class=n>start_http_server</span><span class=p>(</span><span class=n>port</span><span class=p>)</span>
</span></code></pre></div><h3 id=grafana-dashboards>Grafana Dashboards<a class=headerlink href=#grafana-dashboards title="Permanent link">&para;</a></h3><div class="language-json highlight"><span class=filename>JSON</span><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1></a><a href=#__codelineno-12-1><span class=linenos data-linenos=" 1 "></span></a><span class=p>{</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2></a><a href=#__codelineno-12-2><span class=linenos data-linenos=" 2 "></span></a><span class=w>  </span><span class=nt>&quot;dashboard&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3></a><a href=#__codelineno-12-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>    </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Agent Workflow Overview&quot;</span><span class=p>,</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4></a><a href=#__codelineno-12-4><span class=linenos data-linenos=" 4 "></span></a><span class=w>    </span><span class=nt>&quot;panels&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5></a><a href=#__codelineno-12-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>      </span><span class=p>{</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6></a><a href=#__codelineno-12-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>        </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Agent Task Success Rate&quot;</span><span class=p>,</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7></a><a href=#__codelineno-12-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>        </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;stat&quot;</span><span class=p>,</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8></a><a href=#__codelineno-12-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>        </span><span class=nt>&quot;targets&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9></a><a href=#__codelineno-12-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>          </span><span class=p>{</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10></a><a href=#__codelineno-12-10><span class=linenos data-linenos="10 "></span></a><span class=w>            </span><span class=nt>&quot;expr&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;rate(agent_tasks_total{status=\&quot;success\&quot;}[5m]) / rate(agent_tasks_total[5m])&quot;</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11></a><a href=#__codelineno-12-11><span class=linenos data-linenos="11 "></span></a><span class=w>          </span><span class=p>}</span>
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12></a><a href=#__codelineno-12-12><span class=linenos data-linenos="12 "></span></a><span class=w>        </span><span class=p>]</span>
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13></a><a href=#__codelineno-12-13><span class=linenos data-linenos="13 "></span></a><span class=w>      </span><span class=p>},</span>
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14></a><a href=#__codelineno-12-14><span class=linenos data-linenos="14 "></span></a><span class=w>      </span><span class=p>{</span>
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15></a><a href=#__codelineno-12-15><span class=linenos data-linenos="15 "></span></a><span class=w>        </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Active Projects&quot;</span><span class=p>,</span>
</span><span id=__span-12-16><a id=__codelineno-12-16 name=__codelineno-12-16></a><a href=#__codelineno-12-16><span class=linenos data-linenos="16 "></span></a><span class=w>        </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;singlestat&quot;</span><span class=p>,</span>
</span><span id=__span-12-17><a id=__codelineno-12-17 name=__codelineno-12-17></a><a href=#__codelineno-12-17><span class=linenos data-linenos="17 "></span></a><span class=w>        </span><span class=nt>&quot;targets&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-12-18><a id=__codelineno-12-18 name=__codelineno-12-18></a><a href=#__codelineno-12-18><span class=linenos data-linenos="18 "></span></a><span class=w>          </span><span class=p>{</span>
</span><span id=__span-12-19><a id=__codelineno-12-19 name=__codelineno-12-19></a><a href=#__codelineno-12-19><span class=linenos data-linenos="19 "></span></a><span class=w>            </span><span class=nt>&quot;expr&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;active_projects&quot;</span>
</span><span id=__span-12-20><a id=__codelineno-12-20 name=__codelineno-12-20></a><a href=#__codelineno-12-20><span class=linenos data-linenos="20 "></span></a><span class=w>          </span><span class=p>}</span>
</span><span id=__span-12-21><a id=__codelineno-12-21 name=__codelineno-12-21></a><a href=#__codelineno-12-21><span class=linenos data-linenos="21 "></span></a><span class=w>        </span><span class=p>]</span>
</span><span id=__span-12-22><a id=__codelineno-12-22 name=__codelineno-12-22></a><a href=#__codelineno-12-22><span class=linenos data-linenos="22 "></span></a><span class=w>      </span><span class=p>},</span>
</span><span id=__span-12-23><a id=__codelineno-12-23 name=__codelineno-12-23></a><a href=#__codelineno-12-23><span class=linenos data-linenos="23 "></span></a><span class=w>      </span><span class=p>{</span>
</span><span id=__span-12-24><a id=__codelineno-12-24 name=__codelineno-12-24></a><a href=#__codelineno-12-24><span class=linenos data-linenos="24 "></span></a><span class=w>        </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Agent Task Duration&quot;</span><span class=p>,</span>
</span><span id=__span-12-25><a id=__codelineno-12-25 name=__codelineno-12-25></a><a href=#__codelineno-12-25><span class=linenos data-linenos="25 "></span></a><span class=w>        </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;graph&quot;</span><span class=p>,</span>
</span><span id=__span-12-26><a id=__codelineno-12-26 name=__codelineno-12-26></a><a href=#__codelineno-12-26><span class=linenos data-linenos="26 "></span></a><span class=w>        </span><span class=nt>&quot;targets&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-12-27><a id=__codelineno-12-27 name=__codelineno-12-27></a><a href=#__codelineno-12-27><span class=linenos data-linenos="27 "></span></a><span class=w>          </span><span class=p>{</span>
</span><span id=__span-12-28><a id=__codelineno-12-28 name=__codelineno-12-28></a><a href=#__codelineno-12-28><span class=linenos data-linenos="28 "></span></a><span class=w>            </span><span class=nt>&quot;expr&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;histogram_quantile(0.95, agent_task_duration_seconds_bucket)&quot;</span>
</span><span id=__span-12-29><a id=__codelineno-12-29 name=__codelineno-12-29></a><a href=#__codelineno-12-29><span class=linenos data-linenos="29 "></span></a><span class=w>          </span><span class=p>}</span>
</span><span id=__span-12-30><a id=__codelineno-12-30 name=__codelineno-12-30></a><a href=#__codelineno-12-30><span class=linenos data-linenos="30 "></span></a><span class=w>        </span><span class=p>]</span>
</span><span id=__span-12-31><a id=__codelineno-12-31 name=__codelineno-12-31></a><a href=#__codelineno-12-31><span class=linenos data-linenos="31 "></span></a><span class=w>      </span><span class=p>},</span>
</span><span id=__span-12-32><a id=__codelineno-12-32 name=__codelineno-12-32></a><a href=#__codelineno-12-32><span class=linenos data-linenos="32 "></span></a><span class=w>      </span><span class=p>{</span>
</span><span id=__span-12-33><a id=__codelineno-12-33 name=__codelineno-12-33></a><a href=#__codelineno-12-33><span class=linenos data-linenos="33 "></span></a><span class=w>        </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Discord Commands&quot;</span><span class=p>,</span>
</span><span id=__span-12-34><a id=__codelineno-12-34 name=__codelineno-12-34></a><a href=#__codelineno-12-34><span class=linenos data-linenos="34 "></span></a><span class=w>        </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;graph&quot;</span><span class=p>,</span>
</span><span id=__span-12-35><a id=__codelineno-12-35 name=__codelineno-12-35></a><a href=#__codelineno-12-35><span class=linenos data-linenos="35 "></span></a><span class=w>        </span><span class=nt>&quot;targets&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-12-36><a id=__codelineno-12-36 name=__codelineno-12-36></a><a href=#__codelineno-12-36><span class=linenos data-linenos="36 "></span></a><span class=w>          </span><span class=p>{</span>
</span><span id=__span-12-37><a id=__codelineno-12-37 name=__codelineno-12-37></a><a href=#__codelineno-12-37><span class=linenos data-linenos="37 "></span></a><span class=w>            </span><span class=nt>&quot;expr&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;rate(discord_commands_total[5m])&quot;</span>
</span><span id=__span-12-38><a id=__codelineno-12-38 name=__codelineno-12-38></a><a href=#__codelineno-12-38><span class=linenos data-linenos="38 "></span></a><span class=w>          </span><span class=p>}</span>
</span><span id=__span-12-39><a id=__codelineno-12-39 name=__codelineno-12-39></a><a href=#__codelineno-12-39><span class=linenos data-linenos="39 "></span></a><span class=w>        </span><span class=p>]</span>
</span><span id=__span-12-40><a id=__codelineno-12-40 name=__codelineno-12-40></a><a href=#__codelineno-12-40><span class=linenos data-linenos="40 "></span></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-12-41><a id=__codelineno-12-41 name=__codelineno-12-41></a><a href=#__codelineno-12-41><span class=linenos data-linenos="41 "></span></a><span class=w>    </span><span class=p>]</span>
</span><span id=__span-12-42><a id=__codelineno-12-42 name=__codelineno-12-42></a><a href=#__codelineno-12-42><span class=linenos data-linenos="42 "></span></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-12-43><a id=__codelineno-12-43 name=__codelineno-12-43></a><a href=#__codelineno-12-43><span class=linenos data-linenos="43 "></span></a><span class=p>}</span>
</span></code></pre></div><h2 id=security-hardening>Security Hardening<a class=headerlink href=#security-hardening title="Permanent link">&para;</a></h2><h3 id=ssltls-configuration>SSL/TLS Configuration<a class=headerlink href=#ssltls-configuration title="Permanent link">&para;</a></h3><div class="language-nginx highlight"><span class=filename>Nginx Configuration File</span><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1></a><a href=#__codelineno-13-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># nginx/ssl.conf</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2></a><a href=#__codelineno-13-2><span class=linenos data-linenos=" 2 "></span></a><span class=k>server</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3></a><a href=#__codelineno-13-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>    </span><span class=kn>listen</span><span class=w> </span><span class=mi>80</span><span class=p>;</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4></a><a href=#__codelineno-13-4><span class=linenos data-linenos=" 4 "></span></a><span class=w>    </span><span class=kn>server_name</span><span class=w> </span><span class=s>agent-workflow.yourdomain.com</span><span class=p>;</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5></a><a href=#__codelineno-13-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>    </span><span class=kn>return</span><span class=w> </span><span class=mi>301</span><span class=w> </span><span class=s>https://</span><span class=nv>$server_name$request_uri</span><span class=p>;</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6></a><a href=#__codelineno-13-6><span class=linenos data-linenos=" 6 "></span></a><span class=p>}</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7></a><a href=#__codelineno-13-7><span class=linenos data-linenos=" 7 "></span></a>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8></a><a href=#__codelineno-13-8><span class=linenos data-linenos=" 8 "></span></a><span class=k>server</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9></a><a href=#__codelineno-13-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>    </span><span class=kn>listen</span><span class=w> </span><span class=mi>443</span><span class=w> </span><span class=s>ssl</span><span class=w> </span><span class=s>http2</span><span class=p>;</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10></a><a href=#__codelineno-13-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span><span class=kn>server_name</span><span class=w> </span><span class=s>agent-workflow.yourdomain.com</span><span class=p>;</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11></a><a href=#__codelineno-13-11><span class=linenos data-linenos="11 "></span></a>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12></a><a href=#__codelineno-13-12><span class=linenos data-linenos="12 "></span></a><span class=w>    </span><span class=c1># SSL configuration</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13></a><a href=#__codelineno-13-13><span class=linenos data-linenos="13 "></span></a><span class=w>    </span><span class=kn>ssl_certificate</span><span class=w> </span><span class=s>/etc/letsencrypt/live/agent-workflow.yourdomain.com/fullchain.pem</span><span class=p>;</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14></a><a href=#__codelineno-13-14><span class=linenos data-linenos="14 "></span></a><span class=w>    </span><span class=kn>ssl_certificate_key</span><span class=w> </span><span class=s>/etc/letsencrypt/live/agent-workflow.yourdomain.com/privkey.pem</span><span class=p>;</span>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15></a><a href=#__codelineno-13-15><span class=linenos data-linenos="15 "></span></a><span class=w>    </span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16></a><a href=#__codelineno-13-16><span class=linenos data-linenos="16 "></span></a><span class=w>    </span><span class=c1># SSL security settings</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17></a><a href=#__codelineno-13-17><span class=linenos data-linenos="17 "></span></a><span class=w>    </span><span class=kn>ssl_protocols</span><span class=w> </span><span class=s>TLSv1.2</span><span class=w> </span><span class=s>TLSv1.3</span><span class=p>;</span>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18></a><a href=#__codelineno-13-18><span class=linenos data-linenos="18 "></span></a><span class=w>    </span><span class=kn>ssl_ciphers</span><span class=w> </span><span class=s>ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384</span><span class=p>;</span>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19></a><a href=#__codelineno-13-19><span class=linenos data-linenos="19 "></span></a><span class=w>    </span><span class=kn>ssl_prefer_server_ciphers</span><span class=w> </span><span class=no>on</span><span class=p>;</span>
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20></a><a href=#__codelineno-13-20><span class=linenos data-linenos="20 "></span></a><span class=w>    </span><span class=kn>ssl_session_cache</span><span class=w> </span><span class=s>shared:SSL:10m</span><span class=p>;</span>
</span><span id=__span-13-21><a id=__codelineno-13-21 name=__codelineno-13-21></a><a href=#__codelineno-13-21><span class=linenos data-linenos="21 "></span></a><span class=w>    </span><span class=kn>ssl_session_timeout</span><span class=w> </span><span class=mi>10m</span><span class=p>;</span>
</span><span id=__span-13-22><a id=__codelineno-13-22 name=__codelineno-13-22></a><a href=#__codelineno-13-22><span class=linenos data-linenos="22 "></span></a><span class=w>    </span>
</span><span id=__span-13-23><a id=__codelineno-13-23 name=__codelineno-13-23></a><a href=#__codelineno-13-23><span class=linenos data-linenos="23 "></span></a><span class=w>    </span><span class=c1># HSTS</span>
</span><span id=__span-13-24><a id=__codelineno-13-24 name=__codelineno-13-24></a><a href=#__codelineno-13-24><span class=linenos data-linenos="24 "></span></a><span class=w>    </span><span class=kn>add_header</span><span class=w> </span><span class=s>Strict-Transport-Security</span><span class=w> </span><span class=s>&quot;max-age=63072000</span><span class=p>;</span><span class=w> </span><span class=kn>includeSubDomains</span><span class=p>;</span><span class=w> </span><span class=kn>preload&quot;</span><span class=w> </span><span class=s>always</span><span class=p>;</span>
</span><span id=__span-13-25><a id=__codelineno-13-25 name=__codelineno-13-25></a><a href=#__codelineno-13-25><span class=linenos data-linenos="25 "></span></a><span class=w>    </span>
</span><span id=__span-13-26><a id=__codelineno-13-26 name=__codelineno-13-26></a><a href=#__codelineno-13-26><span class=linenos data-linenos="26 "></span></a><span class=w>    </span><span class=c1># Security headers</span>
</span><span id=__span-13-27><a id=__codelineno-13-27 name=__codelineno-13-27></a><a href=#__codelineno-13-27><span class=linenos data-linenos="27 "></span></a><span class=w>    </span><span class=kn>add_header</span><span class=w> </span><span class=s>X-Frame-Options</span><span class=w> </span><span class=s>DENY</span><span class=w> </span><span class=s>always</span><span class=p>;</span>
</span><span id=__span-13-28><a id=__codelineno-13-28 name=__codelineno-13-28></a><a href=#__codelineno-13-28><span class=linenos data-linenos="28 "></span></a><span class=w>    </span><span class=kn>add_header</span><span class=w> </span><span class=s>X-Content-Type-Options</span><span class=w> </span><span class=s>nosniff</span><span class=w> </span><span class=s>always</span><span class=p>;</span>
</span><span id=__span-13-29><a id=__codelineno-13-29 name=__codelineno-13-29></a><a href=#__codelineno-13-29><span class=linenos data-linenos="29 "></span></a><span class=w>    </span><span class=kn>add_header</span><span class=w> </span><span class=s>X-XSS-Protection</span><span class=w> </span><span class=s>&quot;1</span><span class=p>;</span><span class=w> </span><span class=kn>mode=block&quot;</span><span class=w> </span><span class=s>always</span><span class=p>;</span>
</span><span id=__span-13-30><a id=__codelineno-13-30 name=__codelineno-13-30></a><a href=#__codelineno-13-30><span class=linenos data-linenos="30 "></span></a><span class=w>    </span><span class=kn>add_header</span><span class=w> </span><span class=s>Referrer-Policy</span><span class=w> </span><span class=s>&quot;strict-origin-when-cross-origin&quot;</span><span class=w> </span><span class=s>always</span><span class=p>;</span>
</span><span id=__span-13-31><a id=__codelineno-13-31 name=__codelineno-13-31></a><a href=#__codelineno-13-31><span class=linenos data-linenos="31 "></span></a><span class=w>    </span><span class=kn>add_header</span><span class=w> </span><span class=s>Content-Security-Policy</span><span class=w> </span><span class=s>&quot;default-src</span><span class=w> </span><span class=s>&#39;self&#39;</span><span class=p>;</span><span class=w> </span><span class=kn>script-src</span><span class=w> </span><span class=s>&#39;self&#39;</span><span class=w> </span><span class=s>&#39;unsafe-inline&#39;</span><span class=p>;</span><span class=w> </span><span class=kn>style-src</span><span class=w> </span><span class=s>&#39;self&#39;</span><span class=w> </span><span class=s>&#39;unsafe-inline&#39;</span><span class=p>;</span><span class=kn>&quot;</span><span class=w> </span><span class=s>always</span><span class=p>;</span>
</span><span id=__span-13-32><a id=__codelineno-13-32 name=__codelineno-13-32></a><a href=#__codelineno-13-32><span class=linenos data-linenos="32 "></span></a>
</span><span id=__span-13-33><a id=__codelineno-13-33 name=__codelineno-13-33></a><a href=#__codelineno-13-33><span class=linenos data-linenos="33 "></span></a><span class=w>    </span><span class=c1># Rate limiting</span>
</span><span id=__span-13-34><a id=__codelineno-13-34 name=__codelineno-13-34></a><a href=#__codelineno-13-34><span class=linenos data-linenos="34 "></span></a><span class=w>    </span><span class=kn>limit_req_zone</span><span class=w> </span><span class=nv>$binary_remote_addr</span><span class=w> </span><span class=s>zone=api:10m</span><span class=w> </span><span class=s>rate=10r/s</span><span class=p>;</span>
</span><span id=__span-13-35><a id=__codelineno-13-35 name=__codelineno-13-35></a><a href=#__codelineno-13-35><span class=linenos data-linenos="35 "></span></a><span class=w>    </span><span class=kn>limit_req</span><span class=w> </span><span class=s>zone=api</span><span class=w> </span><span class=s>burst=20</span><span class=w> </span><span class=s>nodelay</span><span class=p>;</span>
</span><span id=__span-13-36><a id=__codelineno-13-36 name=__codelineno-13-36></a><a href=#__codelineno-13-36><span class=linenos data-linenos="36 "></span></a>
</span><span id=__span-13-37><a id=__codelineno-13-37 name=__codelineno-13-37></a><a href=#__codelineno-13-37><span class=linenos data-linenos="37 "></span></a><span class=w>    </span><span class=kn>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-38><a id=__codelineno-13-38 name=__codelineno-13-38></a><a href=#__codelineno-13-38><span class=linenos data-linenos="38 "></span></a><span class=w>        </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://orchestrator:8080</span><span class=p>;</span>
</span><span id=__span-13-39><a id=__codelineno-13-39 name=__codelineno-13-39></a><a href=#__codelineno-13-39><span class=linenos data-linenos="39 "></span></a><span class=w>        </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span>
</span><span id=__span-13-40><a id=__codelineno-13-40 name=__codelineno-13-40></a><a href=#__codelineno-13-40><span class=linenos data-linenos="40 "></span></a><span class=w>        </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span>
</span><span id=__span-13-41><a id=__codelineno-13-41 name=__codelineno-13-41></a><a href=#__codelineno-13-41><span class=linenos data-linenos="41 "></span></a><span class=w>        </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Forwarded-For</span><span class=w> </span><span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span><span id=__span-13-42><a id=__codelineno-13-42 name=__codelineno-13-42></a><a href=#__codelineno-13-42><span class=linenos data-linenos="42 "></span></a><span class=w>        </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Forwarded-Proto</span><span class=w> </span><span class=nv>$scheme</span><span class=p>;</span>
</span><span id=__span-13-43><a id=__codelineno-13-43 name=__codelineno-13-43></a><a href=#__codelineno-13-43><span class=linenos data-linenos="43 "></span></a><span class=w>        </span>
</span><span id=__span-13-44><a id=__codelineno-13-44 name=__codelineno-13-44></a><a href=#__codelineno-13-44><span class=linenos data-linenos="44 "></span></a><span class=w>        </span><span class=c1># Timeouts</span>
</span><span id=__span-13-45><a id=__codelineno-13-45 name=__codelineno-13-45></a><a href=#__codelineno-13-45><span class=linenos data-linenos="45 "></span></a><span class=w>        </span><span class=kn>proxy_connect_timeout</span><span class=w> </span><span class=s>30s</span><span class=p>;</span>
</span><span id=__span-13-46><a id=__codelineno-13-46 name=__codelineno-13-46></a><a href=#__codelineno-13-46><span class=linenos data-linenos="46 "></span></a><span class=w>        </span><span class=kn>proxy_send_timeout</span><span class=w> </span><span class=s>30s</span><span class=p>;</span>
</span><span id=__span-13-47><a id=__codelineno-13-47 name=__codelineno-13-47></a><a href=#__codelineno-13-47><span class=linenos data-linenos="47 "></span></a><span class=w>        </span><span class=kn>proxy_read_timeout</span><span class=w> </span><span class=s>30s</span><span class=p>;</span>
</span><span id=__span-13-48><a id=__codelineno-13-48 name=__codelineno-13-48></a><a href=#__codelineno-13-48><span class=linenos data-linenos="48 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-13-49><a id=__codelineno-13-49 name=__codelineno-13-49></a><a href=#__codelineno-13-49><span class=linenos data-linenos="49 "></span></a><span class=w>    </span>
</span><span id=__span-13-50><a id=__codelineno-13-50 name=__codelineno-13-50></a><a href=#__codelineno-13-50><span class=linenos data-linenos="50 "></span></a><span class=w>    </span><span class=c1># Health check endpoint</span>
</span><span id=__span-13-51><a id=__codelineno-13-51 name=__codelineno-13-51></a><a href=#__codelineno-13-51><span class=linenos data-linenos="51 "></span></a><span class=w>    </span><span class=kn>location</span><span class=w> </span><span class=s>/health</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-52><a id=__codelineno-13-52 name=__codelineno-13-52></a><a href=#__codelineno-13-52><span class=linenos data-linenos="52 "></span></a><span class=w>        </span><span class=kn>access_log</span><span class=w> </span><span class=no>off</span><span class=p>;</span>
</span><span id=__span-13-53><a id=__codelineno-13-53 name=__codelineno-13-53></a><a href=#__codelineno-13-53><span class=linenos data-linenos="53 "></span></a><span class=w>        </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://orchestrator:8080/health</span><span class=p>;</span>
</span><span id=__span-13-54><a id=__codelineno-13-54 name=__codelineno-13-54></a><a href=#__codelineno-13-54><span class=linenos data-linenos="54 "></span></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-13-55><a id=__codelineno-13-55 name=__codelineno-13-55></a><a href=#__codelineno-13-55><span class=linenos data-linenos="55 "></span></a><span class=p>}</span>
</span></code></pre></div><h3 id=firewall-configuration>Firewall Configuration<a class=headerlink href=#firewall-configuration title="Permanent link">&para;</a></h3><div class="language-bash highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1></a><a href=#__codelineno-14-1><span class=linenos data-linenos=" 1 "></span></a><span class=ch>#!/bin/bash</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2></a><a href=#__codelineno-14-2><span class=linenos data-linenos=" 2 "></span></a><span class=c1># security/firewall-setup.sh</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3></a><a href=#__codelineno-14-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4></a><a href=#__codelineno-14-4><span class=linenos data-linenos=" 4 "></span></a><span class=c1># UFW firewall rules for production deployment</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5></a><a href=#__codelineno-14-5><span class=linenos data-linenos=" 5 "></span></a>sudo<span class=w> </span>ufw<span class=w> </span>--force<span class=w> </span>reset
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6></a><a href=#__codelineno-14-6><span class=linenos data-linenos=" 6 "></span></a>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7></a><a href=#__codelineno-14-7><span class=linenos data-linenos=" 7 "></span></a><span class=c1># Default policies</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8></a><a href=#__codelineno-14-8><span class=linenos data-linenos=" 8 "></span></a>sudo<span class=w> </span>ufw<span class=w> </span>default<span class=w> </span>deny<span class=w> </span>incoming
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9></a><a href=#__codelineno-14-9><span class=linenos data-linenos=" 9 "></span></a>sudo<span class=w> </span>ufw<span class=w> </span>default<span class=w> </span>allow<span class=w> </span>outgoing
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10></a><a href=#__codelineno-14-10><span class=linenos data-linenos="10 "></span></a>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11></a><a href=#__codelineno-14-11><span class=linenos data-linenos="11 "></span></a><span class=c1># SSH access (change port as needed)</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12></a><a href=#__codelineno-14-12><span class=linenos data-linenos="12 "></span></a>sudo<span class=w> </span>ufw<span class=w> </span>allow<span class=w> </span><span class=m>22</span>/tcp
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13></a><a href=#__codelineno-14-13><span class=linenos data-linenos="13 "></span></a>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14></a><a href=#__codelineno-14-14><span class=linenos data-linenos="14 "></span></a><span class=c1># HTTP/HTTPS</span>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15></a><a href=#__codelineno-14-15><span class=linenos data-linenos="15 "></span></a>sudo<span class=w> </span>ufw<span class=w> </span>allow<span class=w> </span><span class=m>80</span>/tcp
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16></a><a href=#__codelineno-14-16><span class=linenos data-linenos="16 "></span></a>sudo<span class=w> </span>ufw<span class=w> </span>allow<span class=w> </span><span class=m>443</span>/tcp
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17></a><a href=#__codelineno-14-17><span class=linenos data-linenos="17 "></span></a>
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18></a><a href=#__codelineno-14-18><span class=linenos data-linenos="18 "></span></a><span class=c1># Monitoring (restrict to internal network)</span>
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19></a><a href=#__codelineno-14-19><span class=linenos data-linenos="19 "></span></a>sudo<span class=w> </span>ufw<span class=w> </span>allow<span class=w> </span>from<span class=w> </span><span class=m>10</span>.0.0.0/8<span class=w> </span>to<span class=w> </span>any<span class=w> </span>port<span class=w> </span><span class=m>9090</span>
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20></a><a href=#__codelineno-14-20><span class=linenos data-linenos="20 "></span></a>sudo<span class=w> </span>ufw<span class=w> </span>allow<span class=w> </span>from<span class=w> </span><span class=m>10</span>.0.0.0/8<span class=w> </span>to<span class=w> </span>any<span class=w> </span>port<span class=w> </span><span class=m>3000</span>
</span><span id=__span-14-21><a id=__codelineno-14-21 name=__codelineno-14-21></a><a href=#__codelineno-14-21><span class=linenos data-linenos="21 "></span></a>
</span><span id=__span-14-22><a id=__codelineno-14-22 name=__codelineno-14-22></a><a href=#__codelineno-14-22><span class=linenos data-linenos="22 "></span></a><span class=c1># Database access (internal only)</span>
</span><span id=__span-14-23><a id=__codelineno-14-23 name=__codelineno-14-23></a><a href=#__codelineno-14-23><span class=linenos data-linenos="23 "></span></a>sudo<span class=w> </span>ufw<span class=w> </span>allow<span class=w> </span>from<span class=w> </span><span class=m>10</span>.0.0.0/8<span class=w> </span>to<span class=w> </span>any<span class=w> </span>port<span class=w> </span><span class=m>5432</span>
</span><span id=__span-14-24><a id=__codelineno-14-24 name=__codelineno-14-24></a><a href=#__codelineno-14-24><span class=linenos data-linenos="24 "></span></a>sudo<span class=w> </span>ufw<span class=w> </span>allow<span class=w> </span>from<span class=w> </span><span class=m>10</span>.0.0.0/8<span class=w> </span>to<span class=w> </span>any<span class=w> </span>port<span class=w> </span><span class=m>6379</span>
</span><span id=__span-14-25><a id=__codelineno-14-25 name=__codelineno-14-25></a><a href=#__codelineno-14-25><span class=linenos data-linenos="25 "></span></a>
</span><span id=__span-14-26><a id=__codelineno-14-26 name=__codelineno-14-26></a><a href=#__codelineno-14-26><span class=linenos data-linenos="26 "></span></a><span class=c1># Enable firewall</span>
</span><span id=__span-14-27><a id=__codelineno-14-27 name=__codelineno-14-27></a><a href=#__codelineno-14-27><span class=linenos data-linenos="27 "></span></a>sudo<span class=w> </span>ufw<span class=w> </span>--force<span class=w> </span><span class=nb>enable</span>
</span><span id=__span-14-28><a id=__codelineno-14-28 name=__codelineno-14-28></a><a href=#__codelineno-14-28><span class=linenos data-linenos="28 "></span></a>
</span><span id=__span-14-29><a id=__codelineno-14-29 name=__codelineno-14-29></a><a href=#__codelineno-14-29><span class=linenos data-linenos="29 "></span></a><span class=c1># Log firewall events</span>
</span><span id=__span-14-30><a id=__codelineno-14-30 name=__codelineno-14-30></a><a href=#__codelineno-14-30><span class=linenos data-linenos="30 "></span></a>sudo<span class=w> </span>ufw<span class=w> </span>logging<span class=w> </span>on
</span></code></pre></div><h3 id=secrets-management>Secrets Management<a class=headerlink href=#secrets-management title="Permanent link">&para;</a></h3><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1></a><a href=#__codelineno-15-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># secrets/docker-compose.secrets.yml</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2></a><a href=#__codelineno-15-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3></a><a href=#__codelineno-15-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4></a><a href=#__codelineno-15-4><span class=linenos data-linenos=" 4 "></span></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5></a><a href=#__codelineno-15-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span><span class=nt>vault</span><span class=p>:</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6></a><a href=#__codelineno-15-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">vault:latest</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7></a><a href=#__codelineno-15-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">vault</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8></a><a href=#__codelineno-15-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9></a><a href=#__codelineno-15-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8200:8200&quot;</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10></a><a href=#__codelineno-15-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11></a><a href=#__codelineno-15-11><span class=linenos data-linenos="11 "></span></a><span class=w>      </span><span class=nt>VAULT_DEV_ROOT_TOKEN_ID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myroot</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12></a><a href=#__codelineno-15-12><span class=linenos data-linenos="12 "></span></a><span class=w>      </span><span class=nt>VAULT_DEV_LISTEN_ADDRESS</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0:8200</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13></a><a href=#__codelineno-15-13><span class=linenos data-linenos="13 "></span></a><span class=w>    </span><span class=nt>cap_add</span><span class=p>:</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14></a><a href=#__codelineno-15-14><span class=linenos data-linenos="14 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IPC_LOCK</span>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15></a><a href=#__codelineno-15-15><span class=linenos data-linenos="15 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16></a><a href=#__codelineno-15-16><span class=linenos data-linenos="16 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">vault_data:/vault/data</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17></a><a href=#__codelineno-15-17><span class=linenos data-linenos="17 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./vault/config:/vault/config</span>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18></a><a href=#__codelineno-15-18><span class=linenos data-linenos="18 "></span></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">vault server -config=/vault/config/vault.hcl</span>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19></a><a href=#__codelineno-15-19><span class=linenos data-linenos="19 "></span></a>
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20></a><a href=#__codelineno-15-20><span class=linenos data-linenos="20 "></span></a><span class=w>  </span><span class=nt>consul</span><span class=p>:</span>
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21></a><a href=#__codelineno-15-21><span class=linenos data-linenos="21 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">consul:latest</span>
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22></a><a href=#__codelineno-15-22><span class=linenos data-linenos="22 "></span></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">consul</span>
</span><span id=__span-15-23><a id=__codelineno-15-23 name=__codelineno-15-23></a><a href=#__codelineno-15-23><span class=linenos data-linenos="23 "></span></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-15-24><a id=__codelineno-15-24 name=__codelineno-15-24></a><a href=#__codelineno-15-24><span class=linenos data-linenos="24 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8500:8500&quot;</span>
</span><span id=__span-15-25><a id=__codelineno-15-25 name=__codelineno-15-25></a><a href=#__codelineno-15-25><span class=linenos data-linenos="25 "></span></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-15-26><a id=__codelineno-15-26 name=__codelineno-15-26></a><a href=#__codelineno-15-26><span class=linenos data-linenos="26 "></span></a><span class=w>      </span><span class=nt>CONSUL_BIND_INTERFACE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">eth0</span>
</span><span id=__span-15-27><a id=__codelineno-15-27 name=__codelineno-15-27></a><a href=#__codelineno-15-27><span class=linenos data-linenos="27 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-15-28><a id=__codelineno-15-28 name=__codelineno-15-28></a><a href=#__codelineno-15-28><span class=linenos data-linenos="28 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">consul_data:/consul/data</span>
</span><span id=__span-15-29><a id=__codelineno-15-29 name=__codelineno-15-29></a><a href=#__codelineno-15-29><span class=linenos data-linenos="29 "></span></a>
</span><span id=__span-15-30><a id=__codelineno-15-30 name=__codelineno-15-30></a><a href=#__codelineno-15-30><span class=linenos data-linenos="30 "></span></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-15-31><a id=__codelineno-15-31 name=__codelineno-15-31></a><a href=#__codelineno-15-31><span class=linenos data-linenos="31 "></span></a><span class=w>  </span><span class=nt>vault_data</span><span class=p>:</span>
</span><span id=__span-15-32><a id=__codelineno-15-32 name=__codelineno-15-32></a><a href=#__codelineno-15-32><span class=linenos data-linenos="32 "></span></a><span class=w>  </span><span class=nt>consul_data</span><span class=p>:</span>
</span></code></pre></div><h3 id=environment-security>Environment Security<a class=headerlink href=#environment-security title="Permanent link">&para;</a></h3><div class="language-bash highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1></a><a href=#__codelineno-16-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># security/env-setup.sh</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2></a><a href=#__codelineno-16-2><span class=linenos data-linenos=" 2 "></span></a><span class=c1>#!/bin/bash</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3></a><a href=#__codelineno-16-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4></a><a href=#__codelineno-16-4><span class=linenos data-linenos=" 4 "></span></a><span class=c1># Create secure environment file</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5></a><a href=#__codelineno-16-5><span class=linenos data-linenos=" 5 "></span></a>cat<span class=w> </span>&gt;<span class=w> </span>.env.production<span class=w> </span><span class=s>&lt;&lt; EOF</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6></a><a href=#__codelineno-16-6><span class=linenos data-linenos=" 6 "></span></a><span class=s># Environment Configuration</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7></a><a href=#__codelineno-16-7><span class=linenos data-linenos=" 7 "></span></a><span class=s>ENVIRONMENT=production</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8></a><a href=#__codelineno-16-8><span class=linenos data-linenos=" 8 "></span></a><span class=s>DEBUG=false</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9></a><a href=#__codelineno-16-9><span class=linenos data-linenos=" 9 "></span></a><span class=s>LOG_LEVEL=INFO</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10></a><a href=#__codelineno-16-10><span class=linenos data-linenos="10 "></span></a>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11></a><a href=#__codelineno-16-11><span class=linenos data-linenos="11 "></span></a><span class=s># Discord Configuration</span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12></a><a href=#__codelineno-16-12><span class=linenos data-linenos="12 "></span></a><span class=s>DISCORD_BOT_TOKEN=\${DISCORD_BOT_TOKEN}</span>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13></a><a href=#__codelineno-16-13><span class=linenos data-linenos="13 "></span></a><span class=s>DISCORD_CLIENT_ID=\${DISCORD_CLIENT_ID}</span>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14></a><a href=#__codelineno-16-14><span class=linenos data-linenos="14 "></span></a><span class=s>DISCORD_CLIENT_SECRET=\${DISCORD_CLIENT_SECRET}</span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15></a><a href=#__codelineno-16-15><span class=linenos data-linenos="15 "></span></a>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16></a><a href=#__codelineno-16-16><span class=linenos data-linenos="16 "></span></a><span class=s># Anthropic Configuration</span>
</span><span id=__span-16-17><a id=__codelineno-16-17 name=__codelineno-16-17></a><a href=#__codelineno-16-17><span class=linenos data-linenos="17 "></span></a><span class=s>ANTHROPIC_API_KEY=\${ANTHROPIC_API_KEY}</span>
</span><span id=__span-16-18><a id=__codelineno-16-18 name=__codelineno-16-18></a><a href=#__codelineno-16-18><span class=linenos data-linenos="18 "></span></a>
</span><span id=__span-16-19><a id=__codelineno-16-19 name=__codelineno-16-19></a><a href=#__codelineno-16-19><span class=linenos data-linenos="19 "></span></a><span class=s># Database Configuration</span>
</span><span id=__span-16-20><a id=__codelineno-16-20 name=__codelineno-16-20></a><a href=#__codelineno-16-20><span class=linenos data-linenos="20 "></span></a><span class=s>POSTGRES_HOST=postgres</span>
</span><span id=__span-16-21><a id=__codelineno-16-21 name=__codelineno-16-21></a><a href=#__codelineno-16-21><span class=linenos data-linenos="21 "></span></a><span class=s>POSTGRES_PORT=5432</span>
</span><span id=__span-16-22><a id=__codelineno-16-22 name=__codelineno-16-22></a><a href=#__codelineno-16-22><span class=linenos data-linenos="22 "></span></a><span class=s>POSTGRES_DB=agent_workflow</span>
</span><span id=__span-16-23><a id=__codelineno-16-23 name=__codelineno-16-23></a><a href=#__codelineno-16-23><span class=linenos data-linenos="23 "></span></a><span class=s>POSTGRES_USER=agent_workflow</span>
</span><span id=__span-16-24><a id=__codelineno-16-24 name=__codelineno-16-24></a><a href=#__codelineno-16-24><span class=linenos data-linenos="24 "></span></a><span class=s>POSTGRES_PASSWORD=\${POSTGRES_PASSWORD}</span>
</span><span id=__span-16-25><a id=__codelineno-16-25 name=__codelineno-16-25></a><a href=#__codelineno-16-25><span class=linenos data-linenos="25 "></span></a>
</span><span id=__span-16-26><a id=__codelineno-16-26 name=__codelineno-16-26></a><a href=#__codelineno-16-26><span class=linenos data-linenos="26 "></span></a><span class=s># Redis Configuration</span>
</span><span id=__span-16-27><a id=__codelineno-16-27 name=__codelineno-16-27></a><a href=#__codelineno-16-27><span class=linenos data-linenos="27 "></span></a><span class=s>REDIS_HOST=redis</span>
</span><span id=__span-16-28><a id=__codelineno-16-28 name=__codelineno-16-28></a><a href=#__codelineno-16-28><span class=linenos data-linenos="28 "></span></a><span class=s>REDIS_PORT=6379</span>
</span><span id=__span-16-29><a id=__codelineno-16-29 name=__codelineno-16-29></a><a href=#__codelineno-16-29><span class=linenos data-linenos="29 "></span></a><span class=s>REDIS_PASSWORD=\${REDIS_PASSWORD}</span>
</span><span id=__span-16-30><a id=__codelineno-16-30 name=__codelineno-16-30></a><a href=#__codelineno-16-30><span class=linenos data-linenos="30 "></span></a>
</span><span id=__span-16-31><a id=__codelineno-16-31 name=__codelineno-16-31></a><a href=#__codelineno-16-31><span class=linenos data-linenos="31 "></span></a><span class=s># Security Configuration</span>
</span><span id=__span-16-32><a id=__codelineno-16-32 name=__codelineno-16-32></a><a href=#__codelineno-16-32><span class=linenos data-linenos="32 "></span></a><span class=s>SECRET_KEY=\${SECRET_KEY}</span>
</span><span id=__span-16-33><a id=__codelineno-16-33 name=__codelineno-16-33></a><a href=#__codelineno-16-33><span class=linenos data-linenos="33 "></span></a><span class=s>ENCRYPTION_KEY=\${ENCRYPTION_KEY}</span>
</span><span id=__span-16-34><a id=__codelineno-16-34 name=__codelineno-16-34></a><a href=#__codelineno-16-34><span class=linenos data-linenos="34 "></span></a><span class=s>JWT_SECRET=\${JWT_SECRET}</span>
</span><span id=__span-16-35><a id=__codelineno-16-35 name=__codelineno-16-35></a><a href=#__codelineno-16-35><span class=linenos data-linenos="35 "></span></a>
</span><span id=__span-16-36><a id=__codelineno-16-36 name=__codelineno-16-36></a><a href=#__codelineno-16-36><span class=linenos data-linenos="36 "></span></a><span class=s># Monitoring Configuration</span>
</span><span id=__span-16-37><a id=__codelineno-16-37 name=__codelineno-16-37></a><a href=#__codelineno-16-37><span class=linenos data-linenos="37 "></span></a><span class=s>PROMETHEUS_ENABLED=true</span>
</span><span id=__span-16-38><a id=__codelineno-16-38 name=__codelineno-16-38></a><a href=#__codelineno-16-38><span class=linenos data-linenos="38 "></span></a><span class=s>GRAFANA_ENABLED=true</span>
</span><span id=__span-16-39><a id=__codelineno-16-39 name=__codelineno-16-39></a><a href=#__codelineno-16-39><span class=linenos data-linenos="39 "></span></a><span class=s>JAEGER_ENABLED=true</span>
</span><span id=__span-16-40><a id=__codelineno-16-40 name=__codelineno-16-40></a><a href=#__codelineno-16-40><span class=linenos data-linenos="40 "></span></a>
</span><span id=__span-16-41><a id=__codelineno-16-41 name=__codelineno-16-41></a><a href=#__codelineno-16-41><span class=linenos data-linenos="41 "></span></a><span class=s># Rate Limiting</span>
</span><span id=__span-16-42><a id=__codelineno-16-42 name=__codelineno-16-42></a><a href=#__codelineno-16-42><span class=linenos data-linenos="42 "></span></a><span class=s>RATE_LIMIT_ENABLED=true</span>
</span><span id=__span-16-43><a id=__codelineno-16-43 name=__codelineno-16-43></a><a href=#__codelineno-16-43><span class=linenos data-linenos="43 "></span></a><span class=s>RATE_LIMIT_REQUESTS_PER_MINUTE=60</span>
</span><span id=__span-16-44><a id=__codelineno-16-44 name=__codelineno-16-44></a><a href=#__codelineno-16-44><span class=linenos data-linenos="44 "></span></a><span class=s>EOF</span>
</span><span id=__span-16-45><a id=__codelineno-16-45 name=__codelineno-16-45></a><a href=#__codelineno-16-45><span class=linenos data-linenos="45 "></span></a>
</span><span id=__span-16-46><a id=__codelineno-16-46 name=__codelineno-16-46></a><a href=#__codelineno-16-46><span class=linenos data-linenos="46 "></span></a><span class=c1># Set secure permissions</span>
</span><span id=__span-16-47><a id=__codelineno-16-47 name=__codelineno-16-47></a><a href=#__codelineno-16-47><span class=linenos data-linenos="47 "></span></a>chmod<span class=w> </span><span class=m>600</span><span class=w> </span>.env.production
</span></code></pre></div><h2 id=high-availability>High Availability<a class=headerlink href=#high-availability title="Permanent link">&para;</a></h2><h3 id=load-balancer-configuration>Load Balancer Configuration<a class=headerlink href=#load-balancer-configuration title="Permanent link">&para;</a></h3><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1></a><a href=#__codelineno-17-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># ha/haproxy.cfg</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2></a><a href=#__codelineno-17-2><span class=linenos data-linenos=" 2 "></span></a><span class="l l-Scalar l-Scalar-Plain">global</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3></a><a href=#__codelineno-17-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">daemon</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4></a><a href=#__codelineno-17-4><span class=linenos data-linenos=" 4 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">maxconn 4096</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5></a><a href=#__codelineno-17-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">log stdout local0</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6></a><a href=#__codelineno-17-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>    </span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7></a><a href=#__codelineno-17-7><span class=linenos data-linenos=" 7 "></span></a><span class="l l-Scalar l-Scalar-Plain">defaults</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8></a><a href=#__codelineno-17-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">mode http</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9></a><a href=#__codelineno-17-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">timeout connect 5000ms</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10></a><a href=#__codelineno-17-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">timeout client 50000ms</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11></a><a href=#__codelineno-17-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">timeout server 50000ms</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12></a><a href=#__codelineno-17-12><span class=linenos data-linenos="12 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">option httplog</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13></a><a href=#__codelineno-17-13><span class=linenos data-linenos="13 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">option dontlognull</span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14></a><a href=#__codelineno-17-14><span class=linenos data-linenos="14 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">option redispatch</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15></a><a href=#__codelineno-17-15><span class=linenos data-linenos="15 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">retries 3</span>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16></a><a href=#__codelineno-17-16><span class=linenos data-linenos="16 "></span></a>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17></a><a href=#__codelineno-17-17><span class=linenos data-linenos="17 "></span></a><span class="l l-Scalar l-Scalar-Plain"># Frontend configuration</span>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18></a><a href=#__codelineno-17-18><span class=linenos data-linenos="18 "></span></a><span class="l l-Scalar l-Scalar-Plain">frontend agent_workflow_frontend</span>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19></a><a href=#__codelineno-17-19><span class=linenos data-linenos="19 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">bind *:80</span>
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20></a><a href=#__codelineno-17-20><span class=linenos data-linenos="20 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">bind *:443 ssl crt /etc/ssl/certs/agent-workflow.pem</span>
</span><span id=__span-17-21><a id=__codelineno-17-21 name=__codelineno-17-21></a><a href=#__codelineno-17-21><span class=linenos data-linenos="21 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">redirect scheme https if !{ ssl_fc }</span>
</span><span id=__span-17-22><a id=__codelineno-17-22 name=__codelineno-17-22></a><a href=#__codelineno-17-22><span class=linenos data-linenos="22 "></span></a><span class=w>    </span>
</span><span id=__span-17-23><a id=__codelineno-17-23 name=__codelineno-17-23></a><a href=#__codelineno-17-23><span class=linenos data-linenos="23 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain"># Health check endpoint</span>
</span><span id=__span-17-24><a id=__codelineno-17-24 name=__codelineno-17-24></a><a href=#__codelineno-17-24><span class=linenos data-linenos="24 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">acl health_check path_beg /health</span>
</span><span id=__span-17-25><a id=__codelineno-17-25 name=__codelineno-17-25></a><a href=#__codelineno-17-25><span class=linenos data-linenos="25 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">use_backend health_backend if health_check</span>
</span><span id=__span-17-26><a id=__codelineno-17-26 name=__codelineno-17-26></a><a href=#__codelineno-17-26><span class=linenos data-linenos="26 "></span></a><span class=w>    </span>
</span><span id=__span-17-27><a id=__codelineno-17-27 name=__codelineno-17-27></a><a href=#__codelineno-17-27><span class=linenos data-linenos="27 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain"># Default backend</span>
</span><span id=__span-17-28><a id=__codelineno-17-28 name=__codelineno-17-28></a><a href=#__codelineno-17-28><span class=linenos data-linenos="28 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">default_backend agent_workflow_backend</span>
</span><span id=__span-17-29><a id=__codelineno-17-29 name=__codelineno-17-29></a><a href=#__codelineno-17-29><span class=linenos data-linenos="29 "></span></a>
</span><span id=__span-17-30><a id=__codelineno-17-30 name=__codelineno-17-30></a><a href=#__codelineno-17-30><span class=linenos data-linenos="30 "></span></a><span class="l l-Scalar l-Scalar-Plain"># Backend configuration</span>
</span><span id=__span-17-31><a id=__codelineno-17-31 name=__codelineno-17-31></a><a href=#__codelineno-17-31><span class=linenos data-linenos="31 "></span></a><span class="l l-Scalar l-Scalar-Plain">backend agent_workflow_backend</span>
</span><span id=__span-17-32><a id=__codelineno-17-32 name=__codelineno-17-32></a><a href=#__codelineno-17-32><span class=linenos data-linenos="32 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">balance roundrobin</span>
</span><span id=__span-17-33><a id=__codelineno-17-33 name=__codelineno-17-33></a><a href=#__codelineno-17-33><span class=linenos data-linenos="33 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">option httpchk GET /health</span>
</span><span id=__span-17-34><a id=__codelineno-17-34 name=__codelineno-17-34></a><a href=#__codelineno-17-34><span class=linenos data-linenos="34 "></span></a><span class=w>    </span>
</span><span id=__span-17-35><a id=__codelineno-17-35 name=__codelineno-17-35></a><a href=#__codelineno-17-35><span class=linenos data-linenos="35 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain"># Orchestrator instances</span>
</span><span id=__span-17-36><a id=__codelineno-17-36 name=__codelineno-17-36></a><a href=#__codelineno-17-36><span class=linenos data-linenos="36 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">server orchestrator-1 orchestrator-1:8080 check</span>
</span><span id=__span-17-37><a id=__codelineno-17-37 name=__codelineno-17-37></a><a href=#__codelineno-17-37><span class=linenos data-linenos="37 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">server orchestrator-2 orchestrator-2:8080 check</span>
</span><span id=__span-17-38><a id=__codelineno-17-38 name=__codelineno-17-38></a><a href=#__codelineno-17-38><span class=linenos data-linenos="38 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">server orchestrator-3 orchestrator-3:8080 check</span>
</span><span id=__span-17-39><a id=__codelineno-17-39 name=__codelineno-17-39></a><a href=#__codelineno-17-39><span class=linenos data-linenos="39 "></span></a>
</span><span id=__span-17-40><a id=__codelineno-17-40 name=__codelineno-17-40></a><a href=#__codelineno-17-40><span class=linenos data-linenos="40 "></span></a><span class="l l-Scalar l-Scalar-Plain"># Health check backend</span>
</span><span id=__span-17-41><a id=__codelineno-17-41 name=__codelineno-17-41></a><a href=#__codelineno-17-41><span class=linenos data-linenos="41 "></span></a><span class="l l-Scalar l-Scalar-Plain">backend health_backend</span>
</span><span id=__span-17-42><a id=__codelineno-17-42 name=__codelineno-17-42></a><a href=#__codelineno-17-42><span class=linenos data-linenos="42 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">balance roundrobin</span>
</span><span id=__span-17-43><a id=__codelineno-17-43 name=__codelineno-17-43></a><a href=#__codelineno-17-43><span class=linenos data-linenos="43 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">server health-1 orchestrator-1:8080 check</span>
</span><span id=__span-17-44><a id=__codelineno-17-44 name=__codelineno-17-44></a><a href=#__codelineno-17-44><span class=linenos data-linenos="44 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">server health-2 orchestrator-2:8080 check</span>
</span><span id=__span-17-45><a id=__codelineno-17-45 name=__codelineno-17-45></a><a href=#__codelineno-17-45><span class=linenos data-linenos="45 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">server health-3 orchestrator-3:8080 check</span>
</span><span id=__span-17-46><a id=__codelineno-17-46 name=__codelineno-17-46></a><a href=#__codelineno-17-46><span class=linenos data-linenos="46 "></span></a>
</span><span id=__span-17-47><a id=__codelineno-17-47 name=__codelineno-17-47></a><a href=#__codelineno-17-47><span class=linenos data-linenos="47 "></span></a><span class="l l-Scalar l-Scalar-Plain"># Statistics</span>
</span><span id=__span-17-48><a id=__codelineno-17-48 name=__codelineno-17-48></a><a href=#__codelineno-17-48><span class=linenos data-linenos="48 "></span></a><span class="l l-Scalar l-Scalar-Plain">listen stats</span>
</span><span id=__span-17-49><a id=__codelineno-17-49 name=__codelineno-17-49></a><a href=#__codelineno-17-49><span class=linenos data-linenos="49 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">bind *:8404</span>
</span><span id=__span-17-50><a id=__codelineno-17-50 name=__codelineno-17-50></a><a href=#__codelineno-17-50><span class=linenos data-linenos="50 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">stats enable</span>
</span><span id=__span-17-51><a id=__codelineno-17-51 name=__codelineno-17-51></a><a href=#__codelineno-17-51><span class=linenos data-linenos="51 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">stats uri /stats</span>
</span><span id=__span-17-52><a id=__codelineno-17-52 name=__codelineno-17-52></a><a href=#__codelineno-17-52><span class=linenos data-linenos="52 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">stats refresh 30s</span>
</span><span id=__span-17-53><a id=__codelineno-17-53 name=__codelineno-17-53></a><a href=#__codelineno-17-53><span class=linenos data-linenos="53 "></span></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">stats hide-version</span>
</span></code></pre></div><h3 id=database-high-availability>Database High Availability<a class=headerlink href=#database-high-availability title="Permanent link">&para;</a></h3><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1></a><a href=#__codelineno-18-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># ha/postgres-ha.yml</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2></a><a href=#__codelineno-18-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3></a><a href=#__codelineno-18-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4></a><a href=#__codelineno-18-4><span class=linenos data-linenos=" 4 "></span></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5></a><a href=#__codelineno-18-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span><span class=nt>postgres-master</span><span class=p>:</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6></a><a href=#__codelineno-18-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:15-alpine</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7></a><a href=#__codelineno-18-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8></a><a href=#__codelineno-18-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent_workflow</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9></a><a href=#__codelineno-18-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">agent_workflow</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10></a><a href=#__codelineno-18-10><span class=linenos data-linenos="10 "></span></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${POSTGRES_PASSWORD}</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11></a><a href=#__codelineno-18-11><span class=linenos data-linenos="11 "></span></a><span class=w>      </span><span class=nt>POSTGRES_REPLICATION_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">replicator</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12></a><a href=#__codelineno-18-12><span class=linenos data-linenos="12 "></span></a><span class=w>      </span><span class=nt>POSTGRES_REPLICATION_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${REPLICATION_PASSWORD}</span>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13></a><a href=#__codelineno-18-13><span class=linenos data-linenos="13 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14></a><a href=#__codelineno-18-14><span class=linenos data-linenos="14 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres_master_data:/var/lib/postgresql/data</span>
</span><span id=__span-18-15><a id=__codelineno-18-15 name=__codelineno-18-15></a><a href=#__codelineno-18-15><span class=linenos data-linenos="15 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./postgres/master-setup.sql:/docker-entrypoint-initdb.d/master-setup.sql</span>
</span><span id=__span-18-16><a id=__codelineno-18-16 name=__codelineno-18-16></a><a href=#__codelineno-18-16><span class=linenos data-linenos="16 "></span></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-18-17><a id=__codelineno-18-17 name=__codelineno-18-17></a><a href=#__codelineno-18-17><span class=linenos data-linenos="17 "></span></a><span class=w>      </span><span class=no>postgres</span>
</span><span id=__span-18-18><a id=__codelineno-18-18 name=__codelineno-18-18></a><a href=#__codelineno-18-18><span class=linenos data-linenos="18 "></span></a><span class=w>      </span><span class=no>-c wal_level=replica</span>
</span><span id=__span-18-19><a id=__codelineno-18-19 name=__codelineno-18-19></a><a href=#__codelineno-18-19><span class=linenos data-linenos="19 "></span></a><span class=w>      </span><span class=no>-c max_wal_senders=3</span>
</span><span id=__span-18-20><a id=__codelineno-18-20 name=__codelineno-18-20></a><a href=#__codelineno-18-20><span class=linenos data-linenos="20 "></span></a><span class=w>      </span><span class=no>-c max_replication_slots=3</span>
</span><span id=__span-18-21><a id=__codelineno-18-21 name=__codelineno-18-21></a><a href=#__codelineno-18-21><span class=linenos data-linenos="21 "></span></a><span class=w>      </span><span class=no>-c hot_standby=on</span>
</span><span id=__span-18-22><a id=__codelineno-18-22 name=__codelineno-18-22></a><a href=#__codelineno-18-22><span class=linenos data-linenos="22 "></span></a><span class=w>      </span><span class=no>-c archive_mode=on</span>
</span><span id=__span-18-23><a id=__codelineno-18-23 name=__codelineno-18-23></a><a href=#__codelineno-18-23><span class=linenos data-linenos="23 "></span></a><span class=w>      </span><span class=no>-c archive_command=&#39;cp %p /var/lib/postgresql/archive/%f&#39;</span>
</span><span id=__span-18-24><a id=__codelineno-18-24 name=__codelineno-18-24></a><a href=#__codelineno-18-24><span class=linenos data-linenos="24 "></span></a>
</span><span id=__span-18-25><a id=__codelineno-18-25 name=__codelineno-18-25></a><a href=#__codelineno-18-25><span class=linenos data-linenos="25 "></span></a><span class=w>  </span><span class=nt>postgres-replica-1</span><span class=p>:</span>
</span><span id=__span-18-26><a id=__codelineno-18-26 name=__codelineno-18-26></a><a href=#__codelineno-18-26><span class=linenos data-linenos="26 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:15-alpine</span>
</span><span id=__span-18-27><a id=__codelineno-18-27 name=__codelineno-18-27></a><a href=#__codelineno-18-27><span class=linenos data-linenos="27 "></span></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-18-28><a id=__codelineno-18-28 name=__codelineno-18-28></a><a href=#__codelineno-18-28><span class=linenos data-linenos="28 "></span></a><span class=w>      </span><span class=nt>PGUSER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">replicator</span>
</span><span id=__span-18-29><a id=__codelineno-18-29 name=__codelineno-18-29></a><a href=#__codelineno-18-29><span class=linenos data-linenos="29 "></span></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${REPLICATION_PASSWORD}</span>
</span><span id=__span-18-30><a id=__codelineno-18-30 name=__codelineno-18-30></a><a href=#__codelineno-18-30><span class=linenos data-linenos="30 "></span></a><span class=w>      </span><span class=nt>POSTGRES_MASTER_SERVICE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres-master</span>
</span><span id=__span-18-31><a id=__codelineno-18-31 name=__codelineno-18-31></a><a href=#__codelineno-18-31><span class=linenos data-linenos="31 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-18-32><a id=__codelineno-18-32 name=__codelineno-18-32></a><a href=#__codelineno-18-32><span class=linenos data-linenos="32 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres_replica1_data:/var/lib/postgresql/data</span>
</span><span id=__span-18-33><a id=__codelineno-18-33 name=__codelineno-18-33></a><a href=#__codelineno-18-33><span class=linenos data-linenos="33 "></span></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-18-34><a id=__codelineno-18-34 name=__codelineno-18-34></a><a href=#__codelineno-18-34><span class=linenos data-linenos="34 "></span></a><span class=w>      </span><span class=no>bash -c &quot;</span>
</span><span id=__span-18-35><a id=__codelineno-18-35 name=__codelineno-18-35></a><a href=#__codelineno-18-35><span class=linenos data-linenos="35 "></span></a><span class=w>      </span><span class=no>pg_basebackup -h postgres-master -D /var/lib/postgresql/data -U replicator -v -P -W</span>
</span><span id=__span-18-36><a id=__codelineno-18-36 name=__codelineno-18-36></a><a href=#__codelineno-18-36><span class=linenos data-linenos="36 "></span></a><span class=w>      </span><span class=no>echo &#39;standby_mode = on&#39; &gt;&gt; /var/lib/postgresql/data/recovery.conf</span>
</span><span id=__span-18-37><a id=__codelineno-18-37 name=__codelineno-18-37></a><a href=#__codelineno-18-37><span class=linenos data-linenos="37 "></span></a><span class=w>      </span><span class=no>echo &#39;primary_conninfo = host=postgres-master port=5432 user=replicator&#39; &gt;&gt; /var/lib/postgresql/data/recovery.conf</span>
</span><span id=__span-18-38><a id=__codelineno-18-38 name=__codelineno-18-38></a><a href=#__codelineno-18-38><span class=linenos data-linenos="38 "></span></a><span class=w>      </span><span class=no>postgres</span>
</span><span id=__span-18-39><a id=__codelineno-18-39 name=__codelineno-18-39></a><a href=#__codelineno-18-39><span class=linenos data-linenos="39 "></span></a><span class=w>      </span><span class=no>&quot;</span>
</span><span id=__span-18-40><a id=__codelineno-18-40 name=__codelineno-18-40></a><a href=#__codelineno-18-40><span class=linenos data-linenos="40 "></span></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-18-41><a id=__codelineno-18-41 name=__codelineno-18-41></a><a href=#__codelineno-18-41><span class=linenos data-linenos="41 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres-master</span>
</span><span id=__span-18-42><a id=__codelineno-18-42 name=__codelineno-18-42></a><a href=#__codelineno-18-42><span class=linenos data-linenos="42 "></span></a>
</span><span id=__span-18-43><a id=__codelineno-18-43 name=__codelineno-18-43></a><a href=#__codelineno-18-43><span class=linenos data-linenos="43 "></span></a><span class=w>  </span><span class=nt>postgres-replica-2</span><span class=p>:</span>
</span><span id=__span-18-44><a id=__codelineno-18-44 name=__codelineno-18-44></a><a href=#__codelineno-18-44><span class=linenos data-linenos="44 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:15-alpine</span>
</span><span id=__span-18-45><a id=__codelineno-18-45 name=__codelineno-18-45></a><a href=#__codelineno-18-45><span class=linenos data-linenos="45 "></span></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-18-46><a id=__codelineno-18-46 name=__codelineno-18-46></a><a href=#__codelineno-18-46><span class=linenos data-linenos="46 "></span></a><span class=w>      </span><span class=nt>PGUSER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">replicator</span>
</span><span id=__span-18-47><a id=__codelineno-18-47 name=__codelineno-18-47></a><a href=#__codelineno-18-47><span class=linenos data-linenos="47 "></span></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${REPLICATION_PASSWORD}</span>
</span><span id=__span-18-48><a id=__codelineno-18-48 name=__codelineno-18-48></a><a href=#__codelineno-18-48><span class=linenos data-linenos="48 "></span></a><span class=w>      </span><span class=nt>POSTGRES_MASTER_SERVICE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres-master</span>
</span><span id=__span-18-49><a id=__codelineno-18-49 name=__codelineno-18-49></a><a href=#__codelineno-18-49><span class=linenos data-linenos="49 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-18-50><a id=__codelineno-18-50 name=__codelineno-18-50></a><a href=#__codelineno-18-50><span class=linenos data-linenos="50 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres_replica2_data:/var/lib/postgresql/data</span>
</span><span id=__span-18-51><a id=__codelineno-18-51 name=__codelineno-18-51></a><a href=#__codelineno-18-51><span class=linenos data-linenos="51 "></span></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-18-52><a id=__codelineno-18-52 name=__codelineno-18-52></a><a href=#__codelineno-18-52><span class=linenos data-linenos="52 "></span></a><span class=w>      </span><span class=no>bash -c &quot;</span>
</span><span id=__span-18-53><a id=__codelineno-18-53 name=__codelineno-18-53></a><a href=#__codelineno-18-53><span class=linenos data-linenos="53 "></span></a><span class=w>      </span><span class=no>pg_basebackup -h postgres-master -D /var/lib/postgresql/data -U replicator -v -P -W</span>
</span><span id=__span-18-54><a id=__codelineno-18-54 name=__codelineno-18-54></a><a href=#__codelineno-18-54><span class=linenos data-linenos="54 "></span></a><span class=w>      </span><span class=no>echo &#39;standby_mode = on&#39; &gt;&gt; /var/lib/postgresql/data/recovery.conf</span>
</span><span id=__span-18-55><a id=__codelineno-18-55 name=__codelineno-18-55></a><a href=#__codelineno-18-55><span class=linenos data-linenos="55 "></span></a><span class=w>      </span><span class=no>echo &#39;primary_conninfo = host=postgres-master port=5432 user=replicator&#39; &gt;&gt; /var/lib/postgresql/data/recovery.conf</span>
</span><span id=__span-18-56><a id=__codelineno-18-56 name=__codelineno-18-56></a><a href=#__codelineno-18-56><span class=linenos data-linenos="56 "></span></a><span class=w>      </span><span class=no>postgres</span>
</span><span id=__span-18-57><a id=__codelineno-18-57 name=__codelineno-18-57></a><a href=#__codelineno-18-57><span class=linenos data-linenos="57 "></span></a><span class=w>      </span><span class=no>&quot;</span>
</span><span id=__span-18-58><a id=__codelineno-18-58 name=__codelineno-18-58></a><a href=#__codelineno-18-58><span class=linenos data-linenos="58 "></span></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-18-59><a id=__codelineno-18-59 name=__codelineno-18-59></a><a href=#__codelineno-18-59><span class=linenos data-linenos="59 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres-master</span>
</span><span id=__span-18-60><a id=__codelineno-18-60 name=__codelineno-18-60></a><a href=#__codelineno-18-60><span class=linenos data-linenos="60 "></span></a>
</span><span id=__span-18-61><a id=__codelineno-18-61 name=__codelineno-18-61></a><a href=#__codelineno-18-61><span class=linenos data-linenos="61 "></span></a><span class=w>  </span><span class=nt>pgpool</span><span class=p>:</span>
</span><span id=__span-18-62><a id=__codelineno-18-62 name=__codelineno-18-62></a><a href=#__codelineno-18-62><span class=linenos data-linenos="62 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pgpool/pgpool:latest</span>
</span><span id=__span-18-63><a id=__codelineno-18-63 name=__codelineno-18-63></a><a href=#__codelineno-18-63><span class=linenos data-linenos="63 "></span></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-18-64><a id=__codelineno-18-64 name=__codelineno-18-64></a><a href=#__codelineno-18-64><span class=linenos data-linenos="64 "></span></a><span class=w>      </span><span class=nt>PGPOOL_BACKEND_HOSTNAME0</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres-master</span>
</span><span id=__span-18-65><a id=__codelineno-18-65 name=__codelineno-18-65></a><a href=#__codelineno-18-65><span class=linenos data-linenos="65 "></span></a><span class=w>      </span><span class=nt>PGPOOL_BACKEND_PORT0</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
</span><span id=__span-18-66><a id=__codelineno-18-66 name=__codelineno-18-66></a><a href=#__codelineno-18-66><span class=linenos data-linenos="66 "></span></a><span class=w>      </span><span class=nt>PGPOOL_BACKEND_WEIGHT0</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id=__span-18-67><a id=__codelineno-18-67 name=__codelineno-18-67></a><a href=#__codelineno-18-67><span class=linenos data-linenos="67 "></span></a><span class=w>      </span><span class=nt>PGPOOL_BACKEND_HOSTNAME1</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres-replica-1</span>
</span><span id=__span-18-68><a id=__codelineno-18-68 name=__codelineno-18-68></a><a href=#__codelineno-18-68><span class=linenos data-linenos="68 "></span></a><span class=w>      </span><span class=nt>PGPOOL_BACKEND_PORT1</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
</span><span id=__span-18-69><a id=__codelineno-18-69 name=__codelineno-18-69></a><a href=#__codelineno-18-69><span class=linenos data-linenos="69 "></span></a><span class=w>      </span><span class=nt>PGPOOL_BACKEND_WEIGHT1</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id=__span-18-70><a id=__codelineno-18-70 name=__codelineno-18-70></a><a href=#__codelineno-18-70><span class=linenos data-linenos="70 "></span></a><span class=w>      </span><span class=nt>PGPOOL_BACKEND_HOSTNAME2</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres-replica-2</span>
</span><span id=__span-18-71><a id=__codelineno-18-71 name=__codelineno-18-71></a><a href=#__codelineno-18-71><span class=linenos data-linenos="71 "></span></a><span class=w>      </span><span class=nt>PGPOOL_BACKEND_PORT2</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
</span><span id=__span-18-72><a id=__codelineno-18-72 name=__codelineno-18-72></a><a href=#__codelineno-18-72><span class=linenos data-linenos="72 "></span></a><span class=w>      </span><span class=nt>PGPOOL_BACKEND_WEIGHT2</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id=__span-18-73><a id=__codelineno-18-73 name=__codelineno-18-73></a><a href=#__codelineno-18-73><span class=linenos data-linenos="73 "></span></a><span class=w>      </span><span class=nt>PGPOOL_ENABLE_LOAD_BALANCING</span><span class=p>:</span><span class=w> </span><span class=s>&quot;yes&quot;</span>
</span><span id=__span-18-74><a id=__codelineno-18-74 name=__codelineno-18-74></a><a href=#__codelineno-18-74><span class=linenos data-linenos="74 "></span></a><span class=w>      </span><span class=nt>PGPOOL_MASTER_SLAVE_MODE</span><span class=p>:</span><span class=w> </span><span class=s>&quot;on&quot;</span>
</span><span id=__span-18-75><a id=__codelineno-18-75 name=__codelineno-18-75></a><a href=#__codelineno-18-75><span class=linenos data-linenos="75 "></span></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-18-76><a id=__codelineno-18-76 name=__codelineno-18-76></a><a href=#__codelineno-18-76><span class=linenos data-linenos="76 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;5432:5432&quot;</span>
</span><span id=__span-18-77><a id=__codelineno-18-77 name=__codelineno-18-77></a><a href=#__codelineno-18-77><span class=linenos data-linenos="77 "></span></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-18-78><a id=__codelineno-18-78 name=__codelineno-18-78></a><a href=#__codelineno-18-78><span class=linenos data-linenos="78 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres-master</span>
</span><span id=__span-18-79><a id=__codelineno-18-79 name=__codelineno-18-79></a><a href=#__codelineno-18-79><span class=linenos data-linenos="79 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres-replica-1</span>
</span><span id=__span-18-80><a id=__codelineno-18-80 name=__codelineno-18-80></a><a href=#__codelineno-18-80><span class=linenos data-linenos="80 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres-replica-2</span>
</span><span id=__span-18-81><a id=__codelineno-18-81 name=__codelineno-18-81></a><a href=#__codelineno-18-81><span class=linenos data-linenos="81 "></span></a>
</span><span id=__span-18-82><a id=__codelineno-18-82 name=__codelineno-18-82></a><a href=#__codelineno-18-82><span class=linenos data-linenos="82 "></span></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-18-83><a id=__codelineno-18-83 name=__codelineno-18-83></a><a href=#__codelineno-18-83><span class=linenos data-linenos="83 "></span></a><span class=w>  </span><span class=nt>postgres_master_data</span><span class=p>:</span>
</span><span id=__span-18-84><a id=__codelineno-18-84 name=__codelineno-18-84></a><a href=#__codelineno-18-84><span class=linenos data-linenos="84 "></span></a><span class=w>  </span><span class=nt>postgres_replica1_data</span><span class=p>:</span>
</span><span id=__span-18-85><a id=__codelineno-18-85 name=__codelineno-18-85></a><a href=#__codelineno-18-85><span class=linenos data-linenos="85 "></span></a><span class=w>  </span><span class=nt>postgres_replica2_data</span><span class=p>:</span>
</span></code></pre></div><h3 id=redis-high-availability>Redis High Availability<a class=headerlink href=#redis-high-availability title="Permanent link">&para;</a></h3><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1></a><a href=#__codelineno-19-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># ha/redis-ha.yml</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2></a><a href=#__codelineno-19-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3></a><a href=#__codelineno-19-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4></a><a href=#__codelineno-19-4><span class=linenos data-linenos=" 4 "></span></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5></a><a href=#__codelineno-19-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>  </span><span class=nt>redis-master</span><span class=p>:</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6></a><a href=#__codelineno-19-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7></a><a href=#__codelineno-19-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-master</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8></a><a href=#__codelineno-19-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9></a><a href=#__codelineno-19-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;6379:6379&quot;</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10></a><a href=#__codelineno-19-10><span class=linenos data-linenos="10 "></span></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-server --appendonly yes --requirepass ${REDIS_PASSWORD}</span>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11></a><a href=#__codelineno-19-11><span class=linenos data-linenos="11 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12></a><a href=#__codelineno-19-12><span class=linenos data-linenos="12 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis_master_data:/data</span>
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13></a><a href=#__codelineno-19-13><span class=linenos data-linenos="13 "></span></a>
</span><span id=__span-19-14><a id=__codelineno-19-14 name=__codelineno-19-14></a><a href=#__codelineno-19-14><span class=linenos data-linenos="14 "></span></a><span class=w>  </span><span class=nt>redis-replica-1</span><span class=p>:</span>
</span><span id=__span-19-15><a id=__codelineno-19-15 name=__codelineno-19-15></a><a href=#__codelineno-19-15><span class=linenos data-linenos="15 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
</span><span id=__span-19-16><a id=__codelineno-19-16 name=__codelineno-19-16></a><a href=#__codelineno-19-16><span class=linenos data-linenos="16 "></span></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-replica-1</span>
</span><span id=__span-19-17><a id=__codelineno-19-17 name=__codelineno-19-17></a><a href=#__codelineno-19-17><span class=linenos data-linenos="17 "></span></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-19-18><a id=__codelineno-19-18 name=__codelineno-19-18></a><a href=#__codelineno-19-18><span class=linenos data-linenos="18 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;6380:6379&quot;</span>
</span><span id=__span-19-19><a id=__codelineno-19-19 name=__codelineno-19-19></a><a href=#__codelineno-19-19><span class=linenos data-linenos="19 "></span></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-server --appendonly yes --requirepass ${REDIS_PASSWORD} --slaveof redis-master 6379 --masterauth ${REDIS_PASSWORD}</span>
</span><span id=__span-19-20><a id=__codelineno-19-20 name=__codelineno-19-20></a><a href=#__codelineno-19-20><span class=linenos data-linenos="20 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-19-21><a id=__codelineno-19-21 name=__codelineno-19-21></a><a href=#__codelineno-19-21><span class=linenos data-linenos="21 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis_replica1_data:/data</span>
</span><span id=__span-19-22><a id=__codelineno-19-22 name=__codelineno-19-22></a><a href=#__codelineno-19-22><span class=linenos data-linenos="22 "></span></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-19-23><a id=__codelineno-19-23 name=__codelineno-19-23></a><a href=#__codelineno-19-23><span class=linenos data-linenos="23 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-master</span>
</span><span id=__span-19-24><a id=__codelineno-19-24 name=__codelineno-19-24></a><a href=#__codelineno-19-24><span class=linenos data-linenos="24 "></span></a>
</span><span id=__span-19-25><a id=__codelineno-19-25 name=__codelineno-19-25></a><a href=#__codelineno-19-25><span class=linenos data-linenos="25 "></span></a><span class=w>  </span><span class=nt>redis-replica-2</span><span class=p>:</span>
</span><span id=__span-19-26><a id=__codelineno-19-26 name=__codelineno-19-26></a><a href=#__codelineno-19-26><span class=linenos data-linenos="26 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
</span><span id=__span-19-27><a id=__codelineno-19-27 name=__codelineno-19-27></a><a href=#__codelineno-19-27><span class=linenos data-linenos="27 "></span></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-replica-2</span>
</span><span id=__span-19-28><a id=__codelineno-19-28 name=__codelineno-19-28></a><a href=#__codelineno-19-28><span class=linenos data-linenos="28 "></span></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-19-29><a id=__codelineno-19-29 name=__codelineno-19-29></a><a href=#__codelineno-19-29><span class=linenos data-linenos="29 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;6381:6379&quot;</span>
</span><span id=__span-19-30><a id=__codelineno-19-30 name=__codelineno-19-30></a><a href=#__codelineno-19-30><span class=linenos data-linenos="30 "></span></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-server --appendonly yes --requirepass ${REDIS_PASSWORD} --slaveof redis-master 6379 --masterauth ${REDIS_PASSWORD}</span>
</span><span id=__span-19-31><a id=__codelineno-19-31 name=__codelineno-19-31></a><a href=#__codelineno-19-31><span class=linenos data-linenos="31 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-19-32><a id=__codelineno-19-32 name=__codelineno-19-32></a><a href=#__codelineno-19-32><span class=linenos data-linenos="32 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis_replica2_data:/data</span>
</span><span id=__span-19-33><a id=__codelineno-19-33 name=__codelineno-19-33></a><a href=#__codelineno-19-33><span class=linenos data-linenos="33 "></span></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-19-34><a id=__codelineno-19-34 name=__codelineno-19-34></a><a href=#__codelineno-19-34><span class=linenos data-linenos="34 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-master</span>
</span><span id=__span-19-35><a id=__codelineno-19-35 name=__codelineno-19-35></a><a href=#__codelineno-19-35><span class=linenos data-linenos="35 "></span></a>
</span><span id=__span-19-36><a id=__codelineno-19-36 name=__codelineno-19-36></a><a href=#__codelineno-19-36><span class=linenos data-linenos="36 "></span></a><span class=w>  </span><span class=nt>redis-sentinel-1</span><span class=p>:</span>
</span><span id=__span-19-37><a id=__codelineno-19-37 name=__codelineno-19-37></a><a href=#__codelineno-19-37><span class=linenos data-linenos="37 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
</span><span id=__span-19-38><a id=__codelineno-19-38 name=__codelineno-19-38></a><a href=#__codelineno-19-38><span class=linenos data-linenos="38 "></span></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-sentinel-1</span>
</span><span id=__span-19-39><a id=__codelineno-19-39 name=__codelineno-19-39></a><a href=#__codelineno-19-39><span class=linenos data-linenos="39 "></span></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-19-40><a id=__codelineno-19-40 name=__codelineno-19-40></a><a href=#__codelineno-19-40><span class=linenos data-linenos="40 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;26379:26379&quot;</span>
</span><span id=__span-19-41><a id=__codelineno-19-41 name=__codelineno-19-41></a><a href=#__codelineno-19-41><span class=linenos data-linenos="41 "></span></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-sentinel /usr/local/etc/redis/sentinel.conf</span>
</span><span id=__span-19-42><a id=__codelineno-19-42 name=__codelineno-19-42></a><a href=#__codelineno-19-42><span class=linenos data-linenos="42 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-19-43><a id=__codelineno-19-43 name=__codelineno-19-43></a><a href=#__codelineno-19-43><span class=linenos data-linenos="43 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./redis/sentinel.conf:/usr/local/etc/redis/sentinel.conf</span>
</span><span id=__span-19-44><a id=__codelineno-19-44 name=__codelineno-19-44></a><a href=#__codelineno-19-44><span class=linenos data-linenos="44 "></span></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-19-45><a id=__codelineno-19-45 name=__codelineno-19-45></a><a href=#__codelineno-19-45><span class=linenos data-linenos="45 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-master</span>
</span><span id=__span-19-46><a id=__codelineno-19-46 name=__codelineno-19-46></a><a href=#__codelineno-19-46><span class=linenos data-linenos="46 "></span></a>
</span><span id=__span-19-47><a id=__codelineno-19-47 name=__codelineno-19-47></a><a href=#__codelineno-19-47><span class=linenos data-linenos="47 "></span></a><span class=w>  </span><span class=nt>redis-sentinel-2</span><span class=p>:</span>
</span><span id=__span-19-48><a id=__codelineno-19-48 name=__codelineno-19-48></a><a href=#__codelineno-19-48><span class=linenos data-linenos="48 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
</span><span id=__span-19-49><a id=__codelineno-19-49 name=__codelineno-19-49></a><a href=#__codelineno-19-49><span class=linenos data-linenos="49 "></span></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-sentinel-2</span>
</span><span id=__span-19-50><a id=__codelineno-19-50 name=__codelineno-19-50></a><a href=#__codelineno-19-50><span class=linenos data-linenos="50 "></span></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-19-51><a id=__codelineno-19-51 name=__codelineno-19-51></a><a href=#__codelineno-19-51><span class=linenos data-linenos="51 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;26380:26379&quot;</span>
</span><span id=__span-19-52><a id=__codelineno-19-52 name=__codelineno-19-52></a><a href=#__codelineno-19-52><span class=linenos data-linenos="52 "></span></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-sentinel /usr/local/etc/redis/sentinel.conf</span>
</span><span id=__span-19-53><a id=__codelineno-19-53 name=__codelineno-19-53></a><a href=#__codelineno-19-53><span class=linenos data-linenos="53 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-19-54><a id=__codelineno-19-54 name=__codelineno-19-54></a><a href=#__codelineno-19-54><span class=linenos data-linenos="54 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./redis/sentinel.conf:/usr/local/etc/redis/sentinel.conf</span>
</span><span id=__span-19-55><a id=__codelineno-19-55 name=__codelineno-19-55></a><a href=#__codelineno-19-55><span class=linenos data-linenos="55 "></span></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-19-56><a id=__codelineno-19-56 name=__codelineno-19-56></a><a href=#__codelineno-19-56><span class=linenos data-linenos="56 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-master</span>
</span><span id=__span-19-57><a id=__codelineno-19-57 name=__codelineno-19-57></a><a href=#__codelineno-19-57><span class=linenos data-linenos="57 "></span></a>
</span><span id=__span-19-58><a id=__codelineno-19-58 name=__codelineno-19-58></a><a href=#__codelineno-19-58><span class=linenos data-linenos="58 "></span></a><span class=w>  </span><span class=nt>redis-sentinel-3</span><span class=p>:</span>
</span><span id=__span-19-59><a id=__codelineno-19-59 name=__codelineno-19-59></a><a href=#__codelineno-19-59><span class=linenos data-linenos="59 "></span></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
</span><span id=__span-19-60><a id=__codelineno-19-60 name=__codelineno-19-60></a><a href=#__codelineno-19-60><span class=linenos data-linenos="60 "></span></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-sentinel-3</span>
</span><span id=__span-19-61><a id=__codelineno-19-61 name=__codelineno-19-61></a><a href=#__codelineno-19-61><span class=linenos data-linenos="61 "></span></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-19-62><a id=__codelineno-19-62 name=__codelineno-19-62></a><a href=#__codelineno-19-62><span class=linenos data-linenos="62 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;26381:26379&quot;</span>
</span><span id=__span-19-63><a id=__codelineno-19-63 name=__codelineno-19-63></a><a href=#__codelineno-19-63><span class=linenos data-linenos="63 "></span></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-sentinel /usr/local/etc/redis/sentinel.conf</span>
</span><span id=__span-19-64><a id=__codelineno-19-64 name=__codelineno-19-64></a><a href=#__codelineno-19-64><span class=linenos data-linenos="64 "></span></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-19-65><a id=__codelineno-19-65 name=__codelineno-19-65></a><a href=#__codelineno-19-65><span class=linenos data-linenos="65 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./redis/sentinel.conf:/usr/local/etc/redis/sentinel.conf</span>
</span><span id=__span-19-66><a id=__codelineno-19-66 name=__codelineno-19-66></a><a href=#__codelineno-19-66><span class=linenos data-linenos="66 "></span></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-19-67><a id=__codelineno-19-67 name=__codelineno-19-67></a><a href=#__codelineno-19-67><span class=linenos data-linenos="67 "></span></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-master</span>
</span><span id=__span-19-68><a id=__codelineno-19-68 name=__codelineno-19-68></a><a href=#__codelineno-19-68><span class=linenos data-linenos="68 "></span></a>
</span><span id=__span-19-69><a id=__codelineno-19-69 name=__codelineno-19-69></a><a href=#__codelineno-19-69><span class=linenos data-linenos="69 "></span></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-19-70><a id=__codelineno-19-70 name=__codelineno-19-70></a><a href=#__codelineno-19-70><span class=linenos data-linenos="70 "></span></a><span class=w>  </span><span class=nt>redis_master_data</span><span class=p>:</span>
</span><span id=__span-19-71><a id=__codelineno-19-71 name=__codelineno-19-71></a><a href=#__codelineno-19-71><span class=linenos data-linenos="71 "></span></a><span class=w>  </span><span class=nt>redis_replica1_data</span><span class=p>:</span>
</span><span id=__span-19-72><a id=__codelineno-19-72 name=__codelineno-19-72></a><a href=#__codelineno-19-72><span class=linenos data-linenos="72 "></span></a><span class=w>  </span><span class=nt>redis_replica2_data</span><span class=p>:</span>
</span></code></pre></div><h2 id=performance-optimization>Performance Optimization<a class=headerlink href=#performance-optimization title="Permanent link">&para;</a></h2><h3 id=application-performance>Application Performance<a class=headerlink href=#application-performance title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1></a><a href=#__codelineno-20-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># lib/performance.py</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2></a><a href=#__codelineno-20-2><span class=linenos data-linenos=" 2 "></span></a><span class=kn>import</span> <span class=nn>asyncio</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3></a><a href=#__codelineno-20-3><span class=linenos data-linenos=" 3 "></span></a><span class=kn>import</span> <span class=nn>aiohttp</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4></a><a href=#__codelineno-20-4><span class=linenos data-linenos=" 4 "></span></a><span class=kn>import</span> <span class=nn>aiocache</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5></a><a href=#__codelineno-20-5><span class=linenos data-linenos=" 5 "></span></a><span class=kn>from</span> <span class=nn>functools</span> <span class=kn>import</span> <span class=n>wraps</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6></a><a href=#__codelineno-20-6><span class=linenos data-linenos=" 6 "></span></a><span class=kn>import</span> <span class=nn>time</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7></a><a href=#__codelineno-20-7><span class=linenos data-linenos=" 7 "></span></a>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8></a><a href=#__codelineno-20-8><span class=linenos data-linenos=" 8 "></span></a><span class=c1># Cache configuration</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9></a><a href=#__codelineno-20-9><span class=linenos data-linenos=" 9 "></span></a><span class=n>cache</span> <span class=o>=</span> <span class=n>aiocache</span><span class=o>.</span><span class=n>Cache</span><span class=p>(</span><span class=n>aiocache</span><span class=o>.</span><span class=n>SimpleMemoryCache</span><span class=p>)</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10></a><a href=#__codelineno-20-10><span class=linenos data-linenos="10 "></span></a>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11></a><a href=#__codelineno-20-11><span class=linenos data-linenos="11 "></span></a><span class=k>def</span> <span class=nf>async_cached</span><span class=p>(</span><span class=n>ttl</span><span class=o>=</span><span class=mi>300</span><span class=p>):</span>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12></a><a href=#__codelineno-20-12><span class=linenos data-linenos="12 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Async cache decorator with TTL&quot;&quot;&quot;</span>
</span><span id=__span-20-13><a id=__codelineno-20-13 name=__codelineno-20-13></a><a href=#__codelineno-20-13><span class=linenos data-linenos="13 "></span></a>    <span class=k>def</span> <span class=nf>decorator</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
</span><span id=__span-20-14><a id=__codelineno-20-14 name=__codelineno-20-14></a><a href=#__codelineno-20-14><span class=linenos data-linenos="14 "></span></a>        <span class=nd>@wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
</span><span id=__span-20-15><a id=__codelineno-20-15 name=__codelineno-20-15></a><a href=#__codelineno-20-15><span class=linenos data-linenos="15 "></span></a>        <span class=k>async</span> <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-20-16><a id=__codelineno-20-16 name=__codelineno-20-16></a><a href=#__codelineno-20-16><span class=linenos data-linenos="16 "></span></a>            <span class=n>cache_key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>func</span><span class=o>.</span><span class=vm>__name__</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=nb>hash</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>str</span><span class=p>(</span><span class=n>kwargs</span><span class=p>))</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-20-17><a id=__codelineno-20-17 name=__codelineno-20-17></a><a href=#__codelineno-20-17><span class=linenos data-linenos="17 "></span></a>            <span class=n>cached_result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>cache</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>cache_key</span><span class=p>)</span>
</span><span id=__span-20-18><a id=__codelineno-20-18 name=__codelineno-20-18></a><a href=#__codelineno-20-18><span class=linenos data-linenos="18 "></span></a>            <span class=k>if</span> <span class=n>cached_result</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-20-19><a id=__codelineno-20-19 name=__codelineno-20-19></a><a href=#__codelineno-20-19><span class=linenos data-linenos="19 "></span></a>                <span class=k>return</span> <span class=n>cached_result</span>
</span><span id=__span-20-20><a id=__codelineno-20-20 name=__codelineno-20-20></a><a href=#__codelineno-20-20><span class=linenos data-linenos="20 "></span></a>            
</span><span id=__span-20-21><a id=__codelineno-20-21 name=__codelineno-20-21></a><a href=#__codelineno-20-21><span class=linenos data-linenos="21 "></span></a>            <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-20-22><a id=__codelineno-20-22 name=__codelineno-20-22></a><a href=#__codelineno-20-22><span class=linenos data-linenos="22 "></span></a>            <span class=k>await</span> <span class=n>cache</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>cache_key</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=n>ttl</span><span class=o>=</span><span class=n>ttl</span><span class=p>)</span>
</span><span id=__span-20-23><a id=__codelineno-20-23 name=__codelineno-20-23></a><a href=#__codelineno-20-23><span class=linenos data-linenos="23 "></span></a>            <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-20-24><a id=__codelineno-20-24 name=__codelineno-20-24></a><a href=#__codelineno-20-24><span class=linenos data-linenos="24 "></span></a>        <span class=k>return</span> <span class=n>wrapper</span>
</span><span id=__span-20-25><a id=__codelineno-20-25 name=__codelineno-20-25></a><a href=#__codelineno-20-25><span class=linenos data-linenos="25 "></span></a>    <span class=k>return</span> <span class=n>decorator</span>
</span><span id=__span-20-26><a id=__codelineno-20-26 name=__codelineno-20-26></a><a href=#__codelineno-20-26><span class=linenos data-linenos="26 "></span></a>
</span><span id=__span-20-27><a id=__codelineno-20-27 name=__codelineno-20-27></a><a href=#__codelineno-20-27><span class=linenos data-linenos="27 "></span></a><span class=k>def</span> <span class=nf>rate_limit</span><span class=p>(</span><span class=n>calls_per_second</span><span class=o>=</span><span class=mi>10</span><span class=p>):</span>
</span><span id=__span-20-28><a id=__codelineno-20-28 name=__codelineno-20-28></a><a href=#__codelineno-20-28><span class=linenos data-linenos="28 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Rate limiting decorator&quot;&quot;&quot;</span>
</span><span id=__span-20-29><a id=__codelineno-20-29 name=__codelineno-20-29></a><a href=#__codelineno-20-29><span class=linenos data-linenos="29 "></span></a>    <span class=k>def</span> <span class=nf>decorator</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
</span><span id=__span-20-30><a id=__codelineno-20-30 name=__codelineno-20-30></a><a href=#__codelineno-20-30><span class=linenos data-linenos="30 "></span></a>        <span class=n>last_called</span> <span class=o>=</span> <span class=p>[</span><span class=mf>0.0</span><span class=p>]</span>
</span><span id=__span-20-31><a id=__codelineno-20-31 name=__codelineno-20-31></a><a href=#__codelineno-20-31><span class=linenos data-linenos="31 "></span></a>        
</span><span id=__span-20-32><a id=__codelineno-20-32 name=__codelineno-20-32></a><a href=#__codelineno-20-32><span class=linenos data-linenos="32 "></span></a>        <span class=nd>@wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
</span><span id=__span-20-33><a id=__codelineno-20-33 name=__codelineno-20-33></a><a href=#__codelineno-20-33><span class=linenos data-linenos="33 "></span></a>        <span class=k>async</span> <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-20-34><a id=__codelineno-20-34 name=__codelineno-20-34></a><a href=#__codelineno-20-34><span class=linenos data-linenos="34 "></span></a>            <span class=n>elapsed</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>last_called</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-20-35><a id=__codelineno-20-35 name=__codelineno-20-35></a><a href=#__codelineno-20-35><span class=linenos data-linenos="35 "></span></a>            <span class=n>left_to_wait</span> <span class=o>=</span> <span class=mf>1.0</span> <span class=o>/</span> <span class=n>calls_per_second</span> <span class=o>-</span> <span class=n>elapsed</span>
</span><span id=__span-20-36><a id=__codelineno-20-36 name=__codelineno-20-36></a><a href=#__codelineno-20-36><span class=linenos data-linenos="36 "></span></a>            <span class=k>if</span> <span class=n>left_to_wait</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-20-37><a id=__codelineno-20-37 name=__codelineno-20-37></a><a href=#__codelineno-20-37><span class=linenos data-linenos="37 "></span></a>                <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>left_to_wait</span><span class=p>)</span>
</span><span id=__span-20-38><a id=__codelineno-20-38 name=__codelineno-20-38></a><a href=#__codelineno-20-38><span class=linenos data-linenos="38 "></span></a>            <span class=n>ret</span> <span class=o>=</span> <span class=k>await</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-20-39><a id=__codelineno-20-39 name=__codelineno-20-39></a><a href=#__codelineno-20-39><span class=linenos data-linenos="39 "></span></a>            <span class=n>last_called</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-20-40><a id=__codelineno-20-40 name=__codelineno-20-40></a><a href=#__codelineno-20-40><span class=linenos data-linenos="40 "></span></a>            <span class=k>return</span> <span class=n>ret</span>
</span><span id=__span-20-41><a id=__codelineno-20-41 name=__codelineno-20-41></a><a href=#__codelineno-20-41><span class=linenos data-linenos="41 "></span></a>        <span class=k>return</span> <span class=n>wrapper</span>
</span><span id=__span-20-42><a id=__codelineno-20-42 name=__codelineno-20-42></a><a href=#__codelineno-20-42><span class=linenos data-linenos="42 "></span></a>    <span class=k>return</span> <span class=n>decorator</span>
</span><span id=__span-20-43><a id=__codelineno-20-43 name=__codelineno-20-43></a><a href=#__codelineno-20-43><span class=linenos data-linenos="43 "></span></a>
</span><span id=__span-20-44><a id=__codelineno-20-44 name=__codelineno-20-44></a><a href=#__codelineno-20-44><span class=linenos data-linenos="44 "></span></a><span class=k>class</span> <span class=nc>ConnectionPool</span><span class=p>:</span>
</span><span id=__span-20-45><a id=__codelineno-20-45 name=__codelineno-20-45></a><a href=#__codelineno-20-45><span class=linenos data-linenos="45 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;HTTP connection pool for external APIs&quot;&quot;&quot;</span>
</span><span id=__span-20-46><a id=__codelineno-20-46 name=__codelineno-20-46></a><a href=#__codelineno-20-46><span class=linenos data-linenos="46 "></span></a>    
</span><span id=__span-20-47><a id=__codelineno-20-47 name=__codelineno-20-47></a><a href=#__codelineno-20-47><span class=linenos data-linenos="47 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>max_connections</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span> <span class=n>max_connections_per_host</span><span class=o>=</span><span class=mi>30</span><span class=p>):</span>
</span><span id=__span-20-48><a id=__codelineno-20-48 name=__codelineno-20-48></a><a href=#__codelineno-20-48><span class=linenos data-linenos="48 "></span></a>        <span class=n>connector</span> <span class=o>=</span> <span class=n>aiohttp</span><span class=o>.</span><span class=n>TCPConnector</span><span class=p>(</span>
</span><span id=__span-20-49><a id=__codelineno-20-49 name=__codelineno-20-49></a><a href=#__codelineno-20-49><span class=linenos data-linenos="49 "></span></a>            <span class=n>limit</span><span class=o>=</span><span class=n>max_connections</span><span class=p>,</span>
</span><span id=__span-20-50><a id=__codelineno-20-50 name=__codelineno-20-50></a><a href=#__codelineno-20-50><span class=linenos data-linenos="50 "></span></a>            <span class=n>limit_per_host</span><span class=o>=</span><span class=n>max_connections_per_host</span><span class=p>,</span>
</span><span id=__span-20-51><a id=__codelineno-20-51 name=__codelineno-20-51></a><a href=#__codelineno-20-51><span class=linenos data-linenos="51 "></span></a>            <span class=n>ttl_dns_cache</span><span class=o>=</span><span class=mi>300</span><span class=p>,</span>
</span><span id=__span-20-52><a id=__codelineno-20-52 name=__codelineno-20-52></a><a href=#__codelineno-20-52><span class=linenos data-linenos="52 "></span></a>            <span class=n>use_dns_cache</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-20-53><a id=__codelineno-20-53 name=__codelineno-20-53></a><a href=#__codelineno-20-53><span class=linenos data-linenos="53 "></span></a>            <span class=n>keepalive_timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>
</span><span id=__span-20-54><a id=__codelineno-20-54 name=__codelineno-20-54></a><a href=#__codelineno-20-54><span class=linenos data-linenos="54 "></span></a>            <span class=n>enable_cleanup_closed</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-20-55><a id=__codelineno-20-55 name=__codelineno-20-55></a><a href=#__codelineno-20-55><span class=linenos data-linenos="55 "></span></a>        <span class=p>)</span>
</span><span id=__span-20-56><a id=__codelineno-20-56 name=__codelineno-20-56></a><a href=#__codelineno-20-56><span class=linenos data-linenos="56 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>session</span> <span class=o>=</span> <span class=n>aiohttp</span><span class=o>.</span><span class=n>ClientSession</span><span class=p>(</span>
</span><span id=__span-20-57><a id=__codelineno-20-57 name=__codelineno-20-57></a><a href=#__codelineno-20-57><span class=linenos data-linenos="57 "></span></a>            <span class=n>connector</span><span class=o>=</span><span class=n>connector</span><span class=p>,</span>
</span><span id=__span-20-58><a id=__codelineno-20-58 name=__codelineno-20-58></a><a href=#__codelineno-20-58><span class=linenos data-linenos="58 "></span></a>            <span class=n>timeout</span><span class=o>=</span><span class=n>aiohttp</span><span class=o>.</span><span class=n>ClientTimeout</span><span class=p>(</span><span class=n>total</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span> <span class=n>connect</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span><span id=__span-20-59><a id=__codelineno-20-59 name=__codelineno-20-59></a><a href=#__codelineno-20-59><span class=linenos data-linenos="59 "></span></a>        <span class=p>)</span>
</span><span id=__span-20-60><a id=__codelineno-20-60 name=__codelineno-20-60></a><a href=#__codelineno-20-60><span class=linenos data-linenos="60 "></span></a>    
</span><span id=__span-20-61><a id=__codelineno-20-61 name=__codelineno-20-61></a><a href=#__codelineno-20-61><span class=linenos data-linenos="61 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>close</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-20-62><a id=__codelineno-20-62 name=__codelineno-20-62></a><a href=#__codelineno-20-62><span class=linenos data-linenos="62 "></span></a>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></code></pre></div><h3 id=database-optimization>Database Optimization<a class=headerlink href=#database-optimization title="Permanent link">&para;</a></h3><div class="language-sql highlight"><span class=filename>SQL</span><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1></a><a href=#__codelineno-21-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1>-- database/performance.sql</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2></a><a href=#__codelineno-21-2><span class=linenos data-linenos=" 2 "></span></a>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3></a><a href=#__codelineno-21-3><span class=linenos data-linenos=" 3 "></span></a><span class=c1>-- Indexes for common queries</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4></a><a href=#__codelineno-21-4><span class=linenos data-linenos=" 4 "></span></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>CONCURRENTLY</span><span class=w> </span><span class=n>idx_projects_status</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>projects</span><span class=p>(</span><span class=n>status</span><span class=p>);</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5></a><a href=#__codelineno-21-5><span class=linenos data-linenos=" 5 "></span></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>CONCURRENTLY</span><span class=w> </span><span class=n>idx_tasks_agent_type</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>tasks</span><span class=p>(</span><span class=n>agent_type</span><span class=p>);</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6></a><a href=#__codelineno-21-6><span class=linenos data-linenos=" 6 "></span></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>CONCURRENTLY</span><span class=w> </span><span class=n>idx_tasks_created_at</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>tasks</span><span class=p>(</span><span class=n>created_at</span><span class=p>);</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7></a><a href=#__codelineno-21-7><span class=linenos data-linenos=" 7 "></span></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>CONCURRENTLY</span><span class=w> </span><span class=n>idx_executions_status_created</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>executions</span><span class=p>(</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>created_at</span><span class=p>);</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8></a><a href=#__codelineno-21-8><span class=linenos data-linenos=" 8 "></span></a>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9></a><a href=#__codelineno-21-9><span class=linenos data-linenos=" 9 "></span></a><span class=c1>-- Partial indexes for active records</span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10></a><a href=#__codelineno-21-10><span class=linenos data-linenos="10 "></span></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>CONCURRENTLY</span><span class=w> </span><span class=n>idx_active_projects</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>projects</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;active&#39;</span><span class=p>;</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11></a><a href=#__codelineno-21-11><span class=linenos data-linenos="11 "></span></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>CONCURRENTLY</span><span class=w> </span><span class=n>idx_pending_tasks</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>tasks</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;pending&#39;</span><span class=p>;</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12></a><a href=#__codelineno-21-12><span class=linenos data-linenos="12 "></span></a>
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13></a><a href=#__codelineno-21-13><span class=linenos data-linenos="13 "></span></a><span class=c1>-- Composite indexes for complex queries</span>
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14></a><a href=#__codelineno-21-14><span class=linenos data-linenos="14 "></span></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>CONCURRENTLY</span><span class=w> </span><span class=n>idx_tasks_project_status</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>tasks</span><span class=p>(</span><span class=n>project_id</span><span class=p>,</span><span class=w> </span><span class=n>status</span><span class=p>);</span>
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15></a><a href=#__codelineno-21-15><span class=linenos data-linenos="15 "></span></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>CONCURRENTLY</span><span class=w> </span><span class=n>idx_executions_task_status</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>executions</span><span class=p>(</span><span class=n>task_id</span><span class=p>,</span><span class=w> </span><span class=n>status</span><span class=p>);</span>
</span><span id=__span-21-16><a id=__codelineno-21-16 name=__codelineno-21-16></a><a href=#__codelineno-21-16><span class=linenos data-linenos="16 "></span></a>
</span><span id=__span-21-17><a id=__codelineno-21-17 name=__codelineno-21-17></a><a href=#__codelineno-21-17><span class=linenos data-linenos="17 "></span></a><span class=c1>-- Text search indexes</span>
</span><span id=__span-21-18><a id=__codelineno-21-18 name=__codelineno-21-18></a><a href=#__codelineno-21-18><span class=linenos data-linenos="18 "></span></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>CONCURRENTLY</span><span class=w> </span><span class=n>idx_projects_name_gin</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>projects</span><span class=w> </span><span class=k>USING</span><span class=w> </span><span class=n>gin</span><span class=p>(</span><span class=n>to_tsvector</span><span class=p>(</span><span class=s1>&#39;english&#39;</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>));</span>
</span><span id=__span-21-19><a id=__codelineno-21-19 name=__codelineno-21-19></a><a href=#__codelineno-21-19><span class=linenos data-linenos="19 "></span></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>CONCURRENTLY</span><span class=w> </span><span class=n>idx_tasks_description_gin</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>tasks</span><span class=w> </span><span class=k>USING</span><span class=w> </span><span class=n>gin</span><span class=p>(</span><span class=n>to_tsvector</span><span class=p>(</span><span class=s1>&#39;english&#39;</span><span class=p>,</span><span class=w> </span><span class=n>description</span><span class=p>));</span>
</span><span id=__span-21-20><a id=__codelineno-21-20 name=__codelineno-21-20></a><a href=#__codelineno-21-20><span class=linenos data-linenos="20 "></span></a>
</span><span id=__span-21-21><a id=__codelineno-21-21 name=__codelineno-21-21></a><a href=#__codelineno-21-21><span class=linenos data-linenos="21 "></span></a><span class=c1>-- Analyze tables for better query planning</span>
</span><span id=__span-21-22><a id=__codelineno-21-22 name=__codelineno-21-22></a><a href=#__codelineno-21-22><span class=linenos data-linenos="22 "></span></a><span class=k>ANALYZE</span><span class=w> </span><span class=n>projects</span><span class=p>;</span>
</span><span id=__span-21-23><a id=__codelineno-21-23 name=__codelineno-21-23></a><a href=#__codelineno-21-23><span class=linenos data-linenos="23 "></span></a><span class=k>ANALYZE</span><span class=w> </span><span class=n>tasks</span><span class=p>;</span>
</span><span id=__span-21-24><a id=__codelineno-21-24 name=__codelineno-21-24></a><a href=#__codelineno-21-24><span class=linenos data-linenos="24 "></span></a><span class=k>ANALYZE</span><span class=w> </span><span class=n>executions</span><span class=p>;</span>
</span><span id=__span-21-25><a id=__codelineno-21-25 name=__codelineno-21-25></a><a href=#__codelineno-21-25><span class=linenos data-linenos="25 "></span></a><span class=k>ANALYZE</span><span class=w> </span><span class=n>agents</span><span class=p>;</span>
</span><span id=__span-21-26><a id=__codelineno-21-26 name=__codelineno-21-26></a><a href=#__codelineno-21-26><span class=linenos data-linenos="26 "></span></a>
</span><span id=__span-21-27><a id=__codelineno-21-27 name=__codelineno-21-27></a><a href=#__codelineno-21-27><span class=linenos data-linenos="27 "></span></a><span class=c1>-- Vacuum and reindex maintenance</span>
</span><span id=__span-21-28><a id=__codelineno-21-28 name=__codelineno-21-28></a><a href=#__codelineno-21-28><span class=linenos data-linenos="28 "></span></a><span class=k>VACUUM</span><span class=w> </span><span class=k>ANALYZE</span><span class=p>;</span>
</span><span id=__span-21-29><a id=__codelineno-21-29 name=__codelineno-21-29></a><a href=#__codelineno-21-29><span class=linenos data-linenos="29 "></span></a><span class=k>REINDEX</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=n>agent_workflow</span><span class=p>;</span>
</span></code></pre></div><h3 id=caching-strategy>Caching Strategy<a class=headerlink href=#caching-strategy title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1></a><a href=#__codelineno-22-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># lib/cache.py</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2></a><a href=#__codelineno-22-2><span class=linenos data-linenos=" 2 "></span></a><span class=kn>import</span> <span class=nn>redis</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3></a><a href=#__codelineno-22-3><span class=linenos data-linenos=" 3 "></span></a><span class=kn>import</span> <span class=nn>json</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4></a><a href=#__codelineno-22-4><span class=linenos data-linenos=" 4 "></span></a><span class=kn>import</span> <span class=nn>pickle</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5></a><a href=#__codelineno-22-5><span class=linenos data-linenos=" 5 "></span></a><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Optional</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6></a><a href=#__codelineno-22-6><span class=linenos data-linenos=" 6 "></span></a><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>timedelta</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7></a><a href=#__codelineno-22-7><span class=linenos data-linenos=" 7 "></span></a>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8></a><a href=#__codelineno-22-8><span class=linenos data-linenos=" 8 "></span></a><span class=k>class</span> <span class=nc>CacheManager</span><span class=p>:</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9></a><a href=#__codelineno-22-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Multi-level caching with Redis and in-memory fallback&quot;&quot;&quot;</span>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10></a><a href=#__codelineno-22-10><span class=linenos data-linenos="10 "></span></a>    
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11></a><a href=#__codelineno-22-11><span class=linenos data-linenos="11 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>redis_url</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span><span id=__span-22-12><a id=__codelineno-22-12 name=__codelineno-22-12></a><a href=#__codelineno-22-12><span class=linenos data-linenos="12 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>from_url</span><span class=p>(</span><span class=n>redis_url</span><span class=p>)</span> <span class=k>if</span> <span class=n>redis_url</span> <span class=k>else</span> <span class=kc>None</span>
</span><span id=__span-22-13><a id=__codelineno-22-13 name=__codelineno-22-13></a><a href=#__codelineno-22-13><span class=linenos data-linenos="13 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>local_cache</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-22-14><a id=__codelineno-22-14 name=__codelineno-22-14></a><a href=#__codelineno-22-14><span class=linenos data-linenos="14 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>cache_stats</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-22-15><a id=__codelineno-22-15 name=__codelineno-22-15></a><a href=#__codelineno-22-15><span class=linenos data-linenos="15 "></span></a>            <span class=s1>&#39;hits&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-22-16><a id=__codelineno-22-16 name=__codelineno-22-16></a><a href=#__codelineno-22-16><span class=linenos data-linenos="16 "></span></a>            <span class=s1>&#39;misses&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-22-17><a id=__codelineno-22-17 name=__codelineno-22-17></a><a href=#__codelineno-22-17><span class=linenos data-linenos="17 "></span></a>            <span class=s1>&#39;redis_hits&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-22-18><a id=__codelineno-22-18 name=__codelineno-22-18></a><a href=#__codelineno-22-18><span class=linenos data-linenos="18 "></span></a>            <span class=s1>&#39;local_hits&#39;</span><span class=p>:</span> <span class=mi>0</span>
</span><span id=__span-22-19><a id=__codelineno-22-19 name=__codelineno-22-19></a><a href=#__codelineno-22-19><span class=linenos data-linenos="19 "></span></a>        <span class=p>}</span>
</span><span id=__span-22-20><a id=__codelineno-22-20 name=__codelineno-22-20></a><a href=#__codelineno-22-20><span class=linenos data-linenos="20 "></span></a>    
</span><span id=__span-22-21><a id=__codelineno-22-21 name=__codelineno-22-21></a><a href=#__codelineno-22-21><span class=linenos data-linenos="21 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-22-22><a id=__codelineno-22-22 name=__codelineno-22-22></a><a href=#__codelineno-22-22><span class=linenos data-linenos="22 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get value from cache with fallback strategy&quot;&quot;&quot;</span>
</span><span id=__span-22-23><a id=__codelineno-22-23 name=__codelineno-22-23></a><a href=#__codelineno-22-23><span class=linenos data-linenos="23 "></span></a>        <span class=c1># Try local cache first</span>
</span><span id=__span-22-24><a id=__codelineno-22-24 name=__codelineno-22-24></a><a href=#__codelineno-22-24><span class=linenos data-linenos="24 "></span></a>        <span class=k>if</span> <span class=n>key</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>local_cache</span><span class=p>:</span>
</span><span id=__span-22-25><a id=__codelineno-22-25 name=__codelineno-22-25></a><a href=#__codelineno-22-25><span class=linenos data-linenos="25 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>cache_stats</span><span class=p>[</span><span class=s1>&#39;hits&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-22-26><a id=__codelineno-22-26 name=__codelineno-22-26></a><a href=#__codelineno-22-26><span class=linenos data-linenos="26 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>cache_stats</span><span class=p>[</span><span class=s1>&#39;local_hits&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-22-27><a id=__codelineno-22-27 name=__codelineno-22-27></a><a href=#__codelineno-22-27><span class=linenos data-linenos="27 "></span></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>local_cache</span><span class=p>[</span><span class=n>key</span><span class=p>][</span><span class=s1>&#39;value&#39;</span><span class=p>]</span>
</span><span id=__span-22-28><a id=__codelineno-22-28 name=__codelineno-22-28></a><a href=#__codelineno-22-28><span class=linenos data-linenos="28 "></span></a>        
</span><span id=__span-22-29><a id=__codelineno-22-29 name=__codelineno-22-29></a><a href=#__codelineno-22-29><span class=linenos data-linenos="29 "></span></a>        <span class=c1># Try Redis cache</span>
</span><span id=__span-22-30><a id=__codelineno-22-30 name=__codelineno-22-30></a><a href=#__codelineno-22-30><span class=linenos data-linenos="30 "></span></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=p>:</span>
</span><span id=__span-22-31><a id=__codelineno-22-31 name=__codelineno-22-31></a><a href=#__codelineno-22-31><span class=linenos data-linenos="31 "></span></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-22-32><a id=__codelineno-22-32 name=__codelineno-22-32></a><a href=#__codelineno-22-32><span class=linenos data-linenos="32 "></span></a>                <span class=n>value</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span><span id=__span-22-33><a id=__codelineno-22-33 name=__codelineno-22-33></a><a href=#__codelineno-22-33><span class=linenos data-linenos="33 "></span></a>                <span class=k>if</span> <span class=n>value</span><span class=p>:</span>
</span><span id=__span-22-34><a id=__codelineno-22-34 name=__codelineno-22-34></a><a href=#__codelineno-22-34><span class=linenos data-linenos="34 "></span></a>                    <span class=n>decoded_value</span> <span class=o>=</span> <span class=n>pickle</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span><span id=__span-22-35><a id=__codelineno-22-35 name=__codelineno-22-35></a><a href=#__codelineno-22-35><span class=linenos data-linenos="35 "></span></a>                    <span class=c1># Store in local cache for faster access</span>
</span><span id=__span-22-36><a id=__codelineno-22-36 name=__codelineno-22-36></a><a href=#__codelineno-22-36><span class=linenos data-linenos="36 "></span></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>local_cache</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-22-37><a id=__codelineno-22-37 name=__codelineno-22-37></a><a href=#__codelineno-22-37><span class=linenos data-linenos="37 "></span></a>                        <span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=n>decoded_value</span><span class=p>,</span>
</span><span id=__span-22-38><a id=__codelineno-22-38 name=__codelineno-22-38></a><a href=#__codelineno-22-38><span class=linenos data-linenos="38 "></span></a>                        <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-22-39><a id=__codelineno-22-39 name=__codelineno-22-39></a><a href=#__codelineno-22-39><span class=linenos data-linenos="39 "></span></a>                    <span class=p>}</span>
</span><span id=__span-22-40><a id=__codelineno-22-40 name=__codelineno-22-40></a><a href=#__codelineno-22-40><span class=linenos data-linenos="40 "></span></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>cache_stats</span><span class=p>[</span><span class=s1>&#39;hits&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-22-41><a id=__codelineno-22-41 name=__codelineno-22-41></a><a href=#__codelineno-22-41><span class=linenos data-linenos="41 "></span></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>cache_stats</span><span class=p>[</span><span class=s1>&#39;redis_hits&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-22-42><a id=__codelineno-22-42 name=__codelineno-22-42></a><a href=#__codelineno-22-42><span class=linenos data-linenos="42 "></span></a>                    <span class=k>return</span> <span class=n>decoded_value</span>
</span><span id=__span-22-43><a id=__codelineno-22-43 name=__codelineno-22-43></a><a href=#__codelineno-22-43><span class=linenos data-linenos="43 "></span></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-22-44><a id=__codelineno-22-44 name=__codelineno-22-44></a><a href=#__codelineno-22-44><span class=linenos data-linenos="44 "></span></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Redis cache error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-22-45><a id=__codelineno-22-45 name=__codelineno-22-45></a><a href=#__codelineno-22-45><span class=linenos data-linenos="45 "></span></a>        
</span><span id=__span-22-46><a id=__codelineno-22-46 name=__codelineno-22-46></a><a href=#__codelineno-22-46><span class=linenos data-linenos="46 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>cache_stats</span><span class=p>[</span><span class=s1>&#39;misses&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-22-47><a id=__codelineno-22-47 name=__codelineno-22-47></a><a href=#__codelineno-22-47><span class=linenos data-linenos="47 "></span></a>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-22-48><a id=__codelineno-22-48 name=__codelineno-22-48></a><a href=#__codelineno-22-48><span class=linenos data-linenos="48 "></span></a>    
</span><span id=__span-22-49><a id=__codelineno-22-49 name=__codelineno-22-49></a><a href=#__codelineno-22-49><span class=linenos data-linenos="49 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>set</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span> <span class=n>ttl</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>300</span><span class=p>):</span>
</span><span id=__span-22-50><a id=__codelineno-22-50 name=__codelineno-22-50></a><a href=#__codelineno-22-50><span class=linenos data-linenos="50 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Set value in cache with TTL&quot;&quot;&quot;</span>
</span><span id=__span-22-51><a id=__codelineno-22-51 name=__codelineno-22-51></a><a href=#__codelineno-22-51><span class=linenos data-linenos="51 "></span></a>        <span class=c1># Store in local cache</span>
</span><span id=__span-22-52><a id=__codelineno-22-52 name=__codelineno-22-52></a><a href=#__codelineno-22-52><span class=linenos data-linenos="52 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>local_cache</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-22-53><a id=__codelineno-22-53 name=__codelineno-22-53></a><a href=#__codelineno-22-53><span class=linenos data-linenos="53 "></span></a>            <span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=n>value</span><span class=p>,</span>
</span><span id=__span-22-54><a id=__codelineno-22-54 name=__codelineno-22-54></a><a href=#__codelineno-22-54><span class=linenos data-linenos="54 "></span></a>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>(),</span>
</span><span id=__span-22-55><a id=__codelineno-22-55 name=__codelineno-22-55></a><a href=#__codelineno-22-55><span class=linenos data-linenos="55 "></span></a>            <span class=s1>&#39;ttl&#39;</span><span class=p>:</span> <span class=n>ttl</span>
</span><span id=__span-22-56><a id=__codelineno-22-56 name=__codelineno-22-56></a><a href=#__codelineno-22-56><span class=linenos data-linenos="56 "></span></a>        <span class=p>}</span>
</span><span id=__span-22-57><a id=__codelineno-22-57 name=__codelineno-22-57></a><a href=#__codelineno-22-57><span class=linenos data-linenos="57 "></span></a>        
</span><span id=__span-22-58><a id=__codelineno-22-58 name=__codelineno-22-58></a><a href=#__codelineno-22-58><span class=linenos data-linenos="58 "></span></a>        <span class=c1># Store in Redis cache</span>
</span><span id=__span-22-59><a id=__codelineno-22-59 name=__codelineno-22-59></a><a href=#__codelineno-22-59><span class=linenos data-linenos="59 "></span></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=p>:</span>
</span><span id=__span-22-60><a id=__codelineno-22-60 name=__codelineno-22-60></a><a href=#__codelineno-22-60><span class=linenos data-linenos="60 "></span></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-22-61><a id=__codelineno-22-61 name=__codelineno-22-61></a><a href=#__codelineno-22-61><span class=linenos data-linenos="61 "></span></a>                <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>setex</span><span class=p>(</span>
</span><span id=__span-22-62><a id=__codelineno-22-62 name=__codelineno-22-62></a><a href=#__codelineno-22-62><span class=linenos data-linenos="62 "></span></a>                    <span class=n>key</span><span class=p>,</span> 
</span><span id=__span-22-63><a id=__codelineno-22-63 name=__codelineno-22-63></a><a href=#__codelineno-22-63><span class=linenos data-linenos="63 "></span></a>                    <span class=n>ttl</span><span class=p>,</span> 
</span><span id=__span-22-64><a id=__codelineno-22-64 name=__codelineno-22-64></a><a href=#__codelineno-22-64><span class=linenos data-linenos="64 "></span></a>                    <span class=n>pickle</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span><span id=__span-22-65><a id=__codelineno-22-65 name=__codelineno-22-65></a><a href=#__codelineno-22-65><span class=linenos data-linenos="65 "></span></a>                <span class=p>)</span>
</span><span id=__span-22-66><a id=__codelineno-22-66 name=__codelineno-22-66></a><a href=#__codelineno-22-66><span class=linenos data-linenos="66 "></span></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-22-67><a id=__codelineno-22-67 name=__codelineno-22-67></a><a href=#__codelineno-22-67><span class=linenos data-linenos="67 "></span></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Redis cache error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-22-68><a id=__codelineno-22-68 name=__codelineno-22-68></a><a href=#__codelineno-22-68><span class=linenos data-linenos="68 "></span></a>    
</span><span id=__span-22-69><a id=__codelineno-22-69 name=__codelineno-22-69></a><a href=#__codelineno-22-69><span class=linenos data-linenos="69 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>invalidate</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>pattern</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-22-70><a id=__codelineno-22-70 name=__codelineno-22-70></a><a href=#__codelineno-22-70><span class=linenos data-linenos="70 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Invalidate cache entries matching pattern&quot;&quot;&quot;</span>
</span><span id=__span-22-71><a id=__codelineno-22-71 name=__codelineno-22-71></a><a href=#__codelineno-22-71><span class=linenos data-linenos="71 "></span></a>        <span class=c1># Clear local cache</span>
</span><span id=__span-22-72><a id=__codelineno-22-72 name=__codelineno-22-72></a><a href=#__codelineno-22-72><span class=linenos data-linenos="72 "></span></a>        <span class=n>keys_to_remove</span> <span class=o>=</span> <span class=p>[</span><span class=n>k</span> <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>local_cache</span><span class=o>.</span><span class=n>keys</span><span class=p>()</span> <span class=k>if</span> <span class=n>pattern</span> <span class=ow>in</span> <span class=n>k</span><span class=p>]</span>
</span><span id=__span-22-73><a id=__codelineno-22-73 name=__codelineno-22-73></a><a href=#__codelineno-22-73><span class=linenos data-linenos="73 "></span></a>        <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>keys_to_remove</span><span class=p>:</span>
</span><span id=__span-22-74><a id=__codelineno-22-74 name=__codelineno-22-74></a><a href=#__codelineno-22-74><span class=linenos data-linenos="74 "></span></a>            <span class=k>del</span> <span class=bp>self</span><span class=o>.</span><span class=n>local_cache</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
</span><span id=__span-22-75><a id=__codelineno-22-75 name=__codelineno-22-75></a><a href=#__codelineno-22-75><span class=linenos data-linenos="75 "></span></a>        
</span><span id=__span-22-76><a id=__codelineno-22-76 name=__codelineno-22-76></a><a href=#__codelineno-22-76><span class=linenos data-linenos="76 "></span></a>        <span class=c1># Clear Redis cache</span>
</span><span id=__span-22-77><a id=__codelineno-22-77 name=__codelineno-22-77></a><a href=#__codelineno-22-77><span class=linenos data-linenos="77 "></span></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=p>:</span>
</span><span id=__span-22-78><a id=__codelineno-22-78 name=__codelineno-22-78></a><a href=#__codelineno-22-78><span class=linenos data-linenos="78 "></span></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-22-79><a id=__codelineno-22-79 name=__codelineno-22-79></a><a href=#__codelineno-22-79><span class=linenos data-linenos="79 "></span></a>                <span class=n>keys</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>keys</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;*</span><span class=si>{</span><span class=n>pattern</span><span class=si>}</span><span class=s2>*&quot;</span><span class=p>)</span>
</span><span id=__span-22-80><a id=__codelineno-22-80 name=__codelineno-22-80></a><a href=#__codelineno-22-80><span class=linenos data-linenos="80 "></span></a>                <span class=k>if</span> <span class=n>keys</span><span class=p>:</span>
</span><span id=__span-22-81><a id=__codelineno-22-81 name=__codelineno-22-81></a><a href=#__codelineno-22-81><span class=linenos data-linenos="81 "></span></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>redis_client</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=o>*</span><span class=n>keys</span><span class=p>)</span>
</span><span id=__span-22-82><a id=__codelineno-22-82 name=__codelineno-22-82></a><a href=#__codelineno-22-82><span class=linenos data-linenos="82 "></span></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-22-83><a id=__codelineno-22-83 name=__codelineno-22-83></a><a href=#__codelineno-22-83><span class=linenos data-linenos="83 "></span></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Redis cache error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-22-84><a id=__codelineno-22-84 name=__codelineno-22-84></a><a href=#__codelineno-22-84><span class=linenos data-linenos="84 "></span></a>    
</span><span id=__span-22-85><a id=__codelineno-22-85 name=__codelineno-22-85></a><a href=#__codelineno-22-85><span class=linenos data-linenos="85 "></span></a>    <span class=k>def</span> <span class=nf>get_stats</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span><span id=__span-22-86><a id=__codelineno-22-86 name=__codelineno-22-86></a><a href=#__codelineno-22-86><span class=linenos data-linenos="86 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get cache performance statistics&quot;&quot;&quot;</span>
</span><span id=__span-22-87><a id=__codelineno-22-87 name=__codelineno-22-87></a><a href=#__codelineno-22-87><span class=linenos data-linenos="87 "></span></a>        <span class=n>total_requests</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache_stats</span><span class=p>[</span><span class=s1>&#39;hits&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache_stats</span><span class=p>[</span><span class=s1>&#39;misses&#39;</span><span class=p>]</span>
</span><span id=__span-22-88><a id=__codelineno-22-88 name=__codelineno-22-88></a><a href=#__codelineno-22-88><span class=linenos data-linenos="88 "></span></a>        <span class=n>hit_rate</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>cache_stats</span><span class=p>[</span><span class=s1>&#39;hits&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>total_requests</span> <span class=o>*</span> <span class=mi>100</span><span class=p>)</span> <span class=k>if</span> <span class=n>total_requests</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
</span><span id=__span-22-89><a id=__codelineno-22-89 name=__codelineno-22-89></a><a href=#__codelineno-22-89><span class=linenos data-linenos="89 "></span></a>        
</span><span id=__span-22-90><a id=__codelineno-22-90 name=__codelineno-22-90></a><a href=#__codelineno-22-90><span class=linenos data-linenos="90 "></span></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-22-91><a id=__codelineno-22-91 name=__codelineno-22-91></a><a href=#__codelineno-22-91><span class=linenos data-linenos="91 "></span></a>            <span class=s1>&#39;hit_rate&#39;</span><span class=p>:</span> <span class=nb>round</span><span class=p>(</span><span class=n>hit_rate</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span>
</span><span id=__span-22-92><a id=__codelineno-22-92 name=__codelineno-22-92></a><a href=#__codelineno-22-92><span class=linenos data-linenos="92 "></span></a>            <span class=s1>&#39;total_requests&#39;</span><span class=p>:</span> <span class=n>total_requests</span><span class=p>,</span>
</span><span id=__span-22-93><a id=__codelineno-22-93 name=__codelineno-22-93></a><a href=#__codelineno-22-93><span class=linenos data-linenos="93 "></span></a>            <span class=s1>&#39;cache_size&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>local_cache</span><span class=p>),</span>
</span><span id=__span-22-94><a id=__codelineno-22-94 name=__codelineno-22-94></a><a href=#__codelineno-22-94><span class=linenos data-linenos="94 "></span></a>            <span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>cache_stats</span>
</span><span id=__span-22-95><a id=__codelineno-22-95 name=__codelineno-22-95></a><a href=#__codelineno-22-95><span class=linenos data-linenos="95 "></span></a>        <span class=p>}</span>
</span><span id=__span-22-96><a id=__codelineno-22-96 name=__codelineno-22-96></a><a href=#__codelineno-22-96><span class=linenos data-linenos="96 "></span></a>
</span><span id=__span-22-97><a id=__codelineno-22-97 name=__codelineno-22-97></a><a href=#__codelineno-22-97><span class=linenos data-linenos="97 "></span></a><span class=c1># Global cache instance</span>
</span><span id=__span-22-98><a id=__codelineno-22-98 name=__codelineno-22-98></a><a href=#__codelineno-22-98><span class=linenos data-linenos="98 "></span></a><span class=n>cache_manager</span> <span class=o>=</span> <span class=n>CacheManager</span><span class=p>()</span>
</span></code></pre></div><h2 id=disaster-recovery>Disaster Recovery<a class=headerlink href=#disaster-recovery title="Permanent link">&para;</a></h2><h3 id=backup-strategy>Backup Strategy<a class=headerlink href=#backup-strategy title="Permanent link">&para;</a></h3><div class="language-bash highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1></a><a href=#__codelineno-23-1><span class=linenos data-linenos=" 1 "></span></a><span class=ch>#!/bin/bash</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2></a><a href=#__codelineno-23-2><span class=linenos data-linenos=" 2 "></span></a><span class=c1># backup/backup.sh</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3></a><a href=#__codelineno-23-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4></a><a href=#__codelineno-23-4><span class=linenos data-linenos=" 4 "></span></a><span class=nb>set</span><span class=w> </span>-e
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5></a><a href=#__codelineno-23-5><span class=linenos data-linenos=" 5 "></span></a>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6></a><a href=#__codelineno-23-6><span class=linenos data-linenos=" 6 "></span></a><span class=c1># Configuration</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7></a><a href=#__codelineno-23-7><span class=linenos data-linenos=" 7 "></span></a><span class=nv>BACKUP_DIR</span><span class=o>=</span><span class=s2>&quot;/var/backups/agent-workflow&quot;</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8></a><a href=#__codelineno-23-8><span class=linenos data-linenos=" 8 "></span></a><span class=nv>POSTGRES_CONTAINER</span><span class=o>=</span><span class=s2>&quot;agent-workflow-postgres&quot;</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9></a><a href=#__codelineno-23-9><span class=linenos data-linenos=" 9 "></span></a><span class=nv>REDIS_CONTAINER</span><span class=o>=</span><span class=s2>&quot;agent-workflow-redis&quot;</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10></a><a href=#__codelineno-23-10><span class=linenos data-linenos="10 "></span></a><span class=nv>S3_BUCKET</span><span class=o>=</span><span class=s2>&quot;agent-workflow-backups&quot;</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11></a><a href=#__codelineno-23-11><span class=linenos data-linenos="11 "></span></a><span class=nv>RETENTION_DAYS</span><span class=o>=</span><span class=m>30</span>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12></a><a href=#__codelineno-23-12><span class=linenos data-linenos="12 "></span></a>
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13></a><a href=#__codelineno-23-13><span class=linenos data-linenos="13 "></span></a><span class=c1># Create backup directory</span>
</span><span id=__span-23-14><a id=__codelineno-23-14 name=__codelineno-23-14></a><a href=#__codelineno-23-14><span class=linenos data-linenos="14 "></span></a>mkdir<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>
</span><span id=__span-23-15><a id=__codelineno-23-15 name=__codelineno-23-15></a><a href=#__codelineno-23-15><span class=linenos data-linenos="15 "></span></a>
</span><span id=__span-23-16><a id=__codelineno-23-16 name=__codelineno-23-16></a><a href=#__codelineno-23-16><span class=linenos data-linenos="16 "></span></a><span class=c1># Timestamp for this backup</span>
</span><span id=__span-23-17><a id=__codelineno-23-17 name=__codelineno-23-17></a><a href=#__codelineno-23-17><span class=linenos data-linenos="17 "></span></a><span class=nv>TIMESTAMP</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%Y%m%d_%H%M%S<span class=k>)</span>
</span><span id=__span-23-18><a id=__codelineno-23-18 name=__codelineno-23-18></a><a href=#__codelineno-23-18><span class=linenos data-linenos="18 "></span></a>
</span><span id=__span-23-19><a id=__codelineno-23-19 name=__codelineno-23-19></a><a href=#__codelineno-23-19><span class=linenos data-linenos="19 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Starting backup at </span><span class=k>$(</span>date<span class=k>)</span><span class=s2>&quot;</span>
</span><span id=__span-23-20><a id=__codelineno-23-20 name=__codelineno-23-20></a><a href=#__codelineno-23-20><span class=linenos data-linenos="20 "></span></a>
</span><span id=__span-23-21><a id=__codelineno-23-21 name=__codelineno-23-21></a><a href=#__codelineno-23-21><span class=linenos data-linenos="21 "></span></a><span class=c1># PostgreSQL backup</span>
</span><span id=__span-23-22><a id=__codelineno-23-22 name=__codelineno-23-22></a><a href=#__codelineno-23-22><span class=linenos data-linenos="22 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Backing up PostgreSQL database...&quot;</span>
</span><span id=__span-23-23><a id=__codelineno-23-23 name=__codelineno-23-23></a><a href=#__codelineno-23-23><span class=linenos data-linenos="23 "></span></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$POSTGRES_CONTAINER</span><span class=s2>&quot;</span><span class=w> </span>pg_dump<span class=w> </span>-U<span class=w> </span>agent_workflow<span class=w> </span>agent_workflow<span class=w> </span><span class=p>|</span><span class=w> </span>gzip<span class=w> </span>&gt;<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>/postgres_</span><span class=nv>$TIMESTAMP</span><span class=s2>.sql.gz&quot;</span>
</span><span id=__span-23-24><a id=__codelineno-23-24 name=__codelineno-23-24></a><a href=#__codelineno-23-24><span class=linenos data-linenos="24 "></span></a>
</span><span id=__span-23-25><a id=__codelineno-23-25 name=__codelineno-23-25></a><a href=#__codelineno-23-25><span class=linenos data-linenos="25 "></span></a><span class=c1># Redis backup</span>
</span><span id=__span-23-26><a id=__codelineno-23-26 name=__codelineno-23-26></a><a href=#__codelineno-23-26><span class=linenos data-linenos="26 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Backing up Redis data...&quot;</span>
</span><span id=__span-23-27><a id=__codelineno-23-27 name=__codelineno-23-27></a><a href=#__codelineno-23-27><span class=linenos data-linenos="27 "></span></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$REDIS_CONTAINER</span><span class=s2>&quot;</span><span class=w> </span>redis-cli<span class=w> </span>--rdb<span class=w> </span>/tmp/dump.rdb
</span><span id=__span-23-28><a id=__codelineno-23-28 name=__codelineno-23-28></a><a href=#__codelineno-23-28><span class=linenos data-linenos="28 "></span></a>docker<span class=w> </span>cp<span class=w> </span><span class=s2>&quot;</span><span class=nv>$REDIS_CONTAINER</span><span class=s2>:/tmp/dump.rdb&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>/redis_</span><span class=nv>$TIMESTAMP</span><span class=s2>.rdb&quot;</span>
</span><span id=__span-23-29><a id=__codelineno-23-29 name=__codelineno-23-29></a><a href=#__codelineno-23-29><span class=linenos data-linenos="29 "></span></a>
</span><span id=__span-23-30><a id=__codelineno-23-30 name=__codelineno-23-30></a><a href=#__codelineno-23-30><span class=linenos data-linenos="30 "></span></a><span class=c1># Application data backup</span>
</span><span id=__span-23-31><a id=__codelineno-23-31 name=__codelineno-23-31></a><a href=#__codelineno-23-31><span class=linenos data-linenos="31 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Backing up application data...&quot;</span>
</span><span id=__span-23-32><a id=__codelineno-23-32 name=__codelineno-23-32></a><a href=#__codelineno-23-32><span class=linenos data-linenos="32 "></span></a>tar<span class=w> </span>-czf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>/projects_</span><span class=nv>$TIMESTAMP</span><span class=s2>.tar.gz&quot;</span><span class=w> </span>-C<span class=w> </span>/var/lib/docker/volumes/agent-workflow_projects/_data<span class=w> </span>.
</span><span id=__span-23-33><a id=__codelineno-23-33 name=__codelineno-23-33></a><a href=#__codelineno-23-33><span class=linenos data-linenos="33 "></span></a>tar<span class=w> </span>-czf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>/logs_</span><span class=nv>$TIMESTAMP</span><span class=s2>.tar.gz&quot;</span><span class=w> </span>-C<span class=w> </span>/var/lib/docker/volumes/agent-workflow_logs/_data<span class=w> </span>.
</span><span id=__span-23-34><a id=__codelineno-23-34 name=__codelineno-23-34></a><a href=#__codelineno-23-34><span class=linenos data-linenos="34 "></span></a>
</span><span id=__span-23-35><a id=__codelineno-23-35 name=__codelineno-23-35></a><a href=#__codelineno-23-35><span class=linenos data-linenos="35 "></span></a><span class=c1># Configuration backup</span>
</span><span id=__span-23-36><a id=__codelineno-23-36 name=__codelineno-23-36></a><a href=#__codelineno-23-36><span class=linenos data-linenos="36 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Backing up configuration...&quot;</span>
</span><span id=__span-23-37><a id=__codelineno-23-37 name=__codelineno-23-37></a><a href=#__codelineno-23-37><span class=linenos data-linenos="37 "></span></a>tar<span class=w> </span>-czf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>/config_</span><span class=nv>$TIMESTAMP</span><span class=s2>.tar.gz&quot;</span><span class=w> </span>docker-compose.yml<span class=w> </span>.env<span class=w> </span>nginx/<span class=w> </span>monitoring/
</span><span id=__span-23-38><a id=__codelineno-23-38 name=__codelineno-23-38></a><a href=#__codelineno-23-38><span class=linenos data-linenos="38 "></span></a>
</span><span id=__span-23-39><a id=__codelineno-23-39 name=__codelineno-23-39></a><a href=#__codelineno-23-39><span class=linenos data-linenos="39 "></span></a><span class=c1># Upload to S3</span>
</span><span id=__span-23-40><a id=__codelineno-23-40 name=__codelineno-23-40></a><a href=#__codelineno-23-40><span class=linenos data-linenos="40 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Uploading backups to S3...&quot;</span>
</span><span id=__span-23-41><a id=__codelineno-23-41 name=__codelineno-23-41></a><a href=#__codelineno-23-41><span class=linenos data-linenos="41 "></span></a>aws<span class=w> </span>s3<span class=w> </span>sync<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;s3://</span><span class=nv>$S3_BUCKET</span><span class=s2>/</span><span class=k>$(</span>date<span class=w> </span>+%Y/%m/%d<span class=k>)</span><span class=s2>/&quot;</span>
</span><span id=__span-23-42><a id=__codelineno-23-42 name=__codelineno-23-42></a><a href=#__codelineno-23-42><span class=linenos data-linenos="42 "></span></a>
</span><span id=__span-23-43><a id=__codelineno-23-43 name=__codelineno-23-43></a><a href=#__codelineno-23-43><span class=linenos data-linenos="43 "></span></a><span class=c1># Cleanup old backups</span>
</span><span id=__span-23-44><a id=__codelineno-23-44 name=__codelineno-23-44></a><a href=#__codelineno-23-44><span class=linenos data-linenos="44 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Cleaning up old backups...&quot;</span>
</span><span id=__span-23-45><a id=__codelineno-23-45 name=__codelineno-23-45></a><a href=#__codelineno-23-45><span class=linenos data-linenos="45 "></span></a>find<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span><span class=w> </span>-name<span class=w> </span><span class=s2>&quot;*.gz&quot;</span><span class=w> </span>-mtime<span class=w> </span>+<span class=nv>$RETENTION_DAYS</span><span class=w> </span>-delete
</span><span id=__span-23-46><a id=__codelineno-23-46 name=__codelineno-23-46></a><a href=#__codelineno-23-46><span class=linenos data-linenos="46 "></span></a>find<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span><span class=w> </span>-name<span class=w> </span><span class=s2>&quot;*.rdb&quot;</span><span class=w> </span>-mtime<span class=w> </span>+<span class=nv>$RETENTION_DAYS</span><span class=w> </span>-delete
</span><span id=__span-23-47><a id=__codelineno-23-47 name=__codelineno-23-47></a><a href=#__codelineno-23-47><span class=linenos data-linenos="47 "></span></a>
</span><span id=__span-23-48><a id=__codelineno-23-48 name=__codelineno-23-48></a><a href=#__codelineno-23-48><span class=linenos data-linenos="48 "></span></a><span class=c1># Verify backup integrity</span>
</span><span id=__span-23-49><a id=__codelineno-23-49 name=__codelineno-23-49></a><a href=#__codelineno-23-49><span class=linenos data-linenos="49 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Verifying backup integrity...&quot;</span>
</span><span id=__span-23-50><a id=__codelineno-23-50 name=__codelineno-23-50></a><a href=#__codelineno-23-50><span class=linenos data-linenos="50 "></span></a>gunzip<span class=w> </span>-t<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>/postgres_</span><span class=nv>$TIMESTAMP</span><span class=s2>.sql.gz&quot;</span>
</span><span id=__span-23-51><a id=__codelineno-23-51 name=__codelineno-23-51></a><a href=#__codelineno-23-51><span class=linenos data-linenos="51 "></span></a>tar<span class=w> </span>-tzf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>/projects_</span><span class=nv>$TIMESTAMP</span><span class=s2>.tar.gz&quot;</span><span class=w> </span>&gt;<span class=w> </span>/dev/null
</span><span id=__span-23-52><a id=__codelineno-23-52 name=__codelineno-23-52></a><a href=#__codelineno-23-52><span class=linenos data-linenos="52 "></span></a>
</span><span id=__span-23-53><a id=__codelineno-23-53 name=__codelineno-23-53></a><a href=#__codelineno-23-53><span class=linenos data-linenos="53 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Backup completed successfully at </span><span class=k>$(</span>date<span class=k>)</span><span class=s2>&quot;</span>
</span><span id=__span-23-54><a id=__codelineno-23-54 name=__codelineno-23-54></a><a href=#__codelineno-23-54><span class=linenos data-linenos="54 "></span></a>
</span><span id=__span-23-55><a id=__codelineno-23-55 name=__codelineno-23-55></a><a href=#__codelineno-23-55><span class=linenos data-linenos="55 "></span></a><span class=c1># Send notification</span>
</span><span id=__span-23-56><a id=__codelineno-23-56 name=__codelineno-23-56></a><a href=#__codelineno-23-56><span class=linenos data-linenos="56 "></span></a>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span><span class=s2>&quot;</span><span class=nv>$SLACK_WEBHOOK_URL</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-23-57><a id=__codelineno-23-57 name=__codelineno-23-57></a><a href=#__codelineno-23-57><span class=linenos data-linenos="57 "></span></a><span class=w>  </span>-H<span class=w> </span><span class=s1>&#39;Content-type: application/json&#39;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-23-58><a id=__codelineno-23-58 name=__codelineno-23-58></a><a href=#__codelineno-23-58><span class=linenos data-linenos="58 "></span></a><span class=w>  </span>--data<span class=w> </span><span class=s2>&quot;{\&quot;text\&quot;:\&quot;✅ Backup completed successfully for agent-workflow at </span><span class=k>$(</span>date<span class=k>)</span><span class=s2>\&quot;}&quot;</span>
</span></code></pre></div><h3 id=restore-procedures>Restore Procedures<a class=headerlink href=#restore-procedures title="Permanent link">&para;</a></h3><div class="language-bash highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1></a><a href=#__codelineno-24-1><span class=linenos data-linenos=" 1 "></span></a><span class=ch>#!/bin/bash</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2></a><a href=#__codelineno-24-2><span class=linenos data-linenos=" 2 "></span></a><span class=c1># backup/restore.sh</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3></a><a href=#__codelineno-24-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4></a><a href=#__codelineno-24-4><span class=linenos data-linenos=" 4 "></span></a><span class=nb>set</span><span class=w> </span>-e
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5></a><a href=#__codelineno-24-5><span class=linenos data-linenos=" 5 "></span></a>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6></a><a href=#__codelineno-24-6><span class=linenos data-linenos=" 6 "></span></a><span class=c1># Configuration</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7></a><a href=#__codelineno-24-7><span class=linenos data-linenos=" 7 "></span></a><span class=nv>BACKUP_DIR</span><span class=o>=</span><span class=s2>&quot;/var/backups/agent-workflow&quot;</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8></a><a href=#__codelineno-24-8><span class=linenos data-linenos=" 8 "></span></a><span class=nv>POSTGRES_CONTAINER</span><span class=o>=</span><span class=s2>&quot;agent-workflow-postgres&quot;</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9></a><a href=#__codelineno-24-9><span class=linenos data-linenos=" 9 "></span></a><span class=nv>REDIS_CONTAINER</span><span class=o>=</span><span class=s2>&quot;agent-workflow-redis&quot;</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10></a><a href=#__codelineno-24-10><span class=linenos data-linenos="10 "></span></a>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11></a><a href=#__codelineno-24-11><span class=linenos data-linenos="11 "></span></a><span class=c1># Check if backup timestamp is provided</span>
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12></a><a href=#__codelineno-24-12><span class=linenos data-linenos="12 "></span></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13></a><a href=#__codelineno-24-13><span class=linenos data-linenos="13 "></span></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Usage: </span><span class=nv>$0</span><span class=s2> &lt;backup_timestamp&gt;&quot;</span>
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14></a><a href=#__codelineno-24-14><span class=linenos data-linenos="14 "></span></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Available backups:&quot;</span>
</span><span id=__span-24-15><a id=__codelineno-24-15 name=__codelineno-24-15></a><a href=#__codelineno-24-15><span class=linenos data-linenos="15 "></span></a><span class=w>    </span>ls<span class=w> </span>-la<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;(postgres|redis|projects|logs|config)_[0-9]{8}_[0-9]{6}&quot;</span>
</span><span id=__span-24-16><a id=__codelineno-24-16 name=__codelineno-24-16></a><a href=#__codelineno-24-16><span class=linenos data-linenos="16 "></span></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
</span><span id=__span-24-17><a id=__codelineno-24-17 name=__codelineno-24-17></a><a href=#__codelineno-24-17><span class=linenos data-linenos="17 "></span></a><span class=k>fi</span>
</span><span id=__span-24-18><a id=__codelineno-24-18 name=__codelineno-24-18></a><a href=#__codelineno-24-18><span class=linenos data-linenos="18 "></span></a>
</span><span id=__span-24-19><a id=__codelineno-24-19 name=__codelineno-24-19></a><a href=#__codelineno-24-19><span class=linenos data-linenos="19 "></span></a><span class=nv>TIMESTAMP</span><span class=o>=</span><span class=nv>$1</span>
</span><span id=__span-24-20><a id=__codelineno-24-20 name=__codelineno-24-20></a><a href=#__codelineno-24-20><span class=linenos data-linenos="20 "></span></a>
</span><span id=__span-24-21><a id=__codelineno-24-21 name=__codelineno-24-21></a><a href=#__codelineno-24-21><span class=linenos data-linenos="21 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Starting restore from backup timestamp: </span><span class=nv>$TIMESTAMP</span><span class=s2>&quot;</span>
</span><span id=__span-24-22><a id=__codelineno-24-22 name=__codelineno-24-22></a><a href=#__codelineno-24-22><span class=linenos data-linenos="22 "></span></a>
</span><span id=__span-24-23><a id=__codelineno-24-23 name=__codelineno-24-23></a><a href=#__codelineno-24-23><span class=linenos data-linenos="23 "></span></a><span class=c1># Stop services</span>
</span><span id=__span-24-24><a id=__codelineno-24-24 name=__codelineno-24-24></a><a href=#__codelineno-24-24><span class=linenos data-linenos="24 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Stopping services...&quot;</span>
</span><span id=__span-24-25><a id=__codelineno-24-25 name=__codelineno-24-25></a><a href=#__codelineno-24-25><span class=linenos data-linenos="25 "></span></a>docker-compose<span class=w> </span>down
</span><span id=__span-24-26><a id=__codelineno-24-26 name=__codelineno-24-26></a><a href=#__codelineno-24-26><span class=linenos data-linenos="26 "></span></a>
</span><span id=__span-24-27><a id=__codelineno-24-27 name=__codelineno-24-27></a><a href=#__codelineno-24-27><span class=linenos data-linenos="27 "></span></a><span class=c1># Restore PostgreSQL</span>
</span><span id=__span-24-28><a id=__codelineno-24-28 name=__codelineno-24-28></a><a href=#__codelineno-24-28><span class=linenos data-linenos="28 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Restoring PostgreSQL database...&quot;</span>
</span><span id=__span-24-29><a id=__codelineno-24-29 name=__codelineno-24-29></a><a href=#__codelineno-24-29><span class=linenos data-linenos="29 "></span></a>docker-compose<span class=w> </span>up<span class=w> </span>-d<span class=w> </span>postgres
</span><span id=__span-24-30><a id=__codelineno-24-30 name=__codelineno-24-30></a><a href=#__codelineno-24-30><span class=linenos data-linenos="30 "></span></a>sleep<span class=w> </span><span class=m>10</span>
</span><span id=__span-24-31><a id=__codelineno-24-31 name=__codelineno-24-31></a><a href=#__codelineno-24-31><span class=linenos data-linenos="31 "></span></a>gunzip<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>/postgres_</span><span class=nv>$TIMESTAMP</span><span class=s2>.sql.gz&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-i<span class=w> </span><span class=s2>&quot;</span><span class=nv>$POSTGRES_CONTAINER</span><span class=s2>&quot;</span><span class=w> </span>psql<span class=w> </span>-U<span class=w> </span>agent_workflow<span class=w> </span>-d<span class=w> </span>agent_workflow
</span><span id=__span-24-32><a id=__codelineno-24-32 name=__codelineno-24-32></a><a href=#__codelineno-24-32><span class=linenos data-linenos="32 "></span></a>
</span><span id=__span-24-33><a id=__codelineno-24-33 name=__codelineno-24-33></a><a href=#__codelineno-24-33><span class=linenos data-linenos="33 "></span></a><span class=c1># Restore Redis</span>
</span><span id=__span-24-34><a id=__codelineno-24-34 name=__codelineno-24-34></a><a href=#__codelineno-24-34><span class=linenos data-linenos="34 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Restoring Redis data...&quot;</span>
</span><span id=__span-24-35><a id=__codelineno-24-35 name=__codelineno-24-35></a><a href=#__codelineno-24-35><span class=linenos data-linenos="35 "></span></a>docker<span class=w> </span>cp<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>/redis_</span><span class=nv>$TIMESTAMP</span><span class=s2>.rdb&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$REDIS_CONTAINER</span><span class=s2>:/data/dump.rdb&quot;</span>
</span><span id=__span-24-36><a id=__codelineno-24-36 name=__codelineno-24-36></a><a href=#__codelineno-24-36><span class=linenos data-linenos="36 "></span></a>docker-compose<span class=w> </span>restart<span class=w> </span>redis
</span><span id=__span-24-37><a id=__codelineno-24-37 name=__codelineno-24-37></a><a href=#__codelineno-24-37><span class=linenos data-linenos="37 "></span></a>
</span><span id=__span-24-38><a id=__codelineno-24-38 name=__codelineno-24-38></a><a href=#__codelineno-24-38><span class=linenos data-linenos="38 "></span></a><span class=c1># Restore application data</span>
</span><span id=__span-24-39><a id=__codelineno-24-39 name=__codelineno-24-39></a><a href=#__codelineno-24-39><span class=linenos data-linenos="39 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Restoring application data...&quot;</span>
</span><span id=__span-24-40><a id=__codelineno-24-40 name=__codelineno-24-40></a><a href=#__codelineno-24-40><span class=linenos data-linenos="40 "></span></a>docker<span class=w> </span>volume<span class=w> </span>rm<span class=w> </span>agent-workflow_projects<span class=w> </span>agent-workflow_logs
</span><span id=__span-24-41><a id=__codelineno-24-41 name=__codelineno-24-41></a><a href=#__codelineno-24-41><span class=linenos data-linenos="41 "></span></a>docker<span class=w> </span>volume<span class=w> </span>create<span class=w> </span>agent-workflow_projects
</span><span id=__span-24-42><a id=__codelineno-24-42 name=__codelineno-24-42></a><a href=#__codelineno-24-42><span class=linenos data-linenos="42 "></span></a>docker<span class=w> </span>volume<span class=w> </span>create<span class=w> </span>agent-workflow_logs
</span><span id=__span-24-43><a id=__codelineno-24-43 name=__codelineno-24-43></a><a href=#__codelineno-24-43><span class=linenos data-linenos="43 "></span></a>
</span><span id=__span-24-44><a id=__codelineno-24-44 name=__codelineno-24-44></a><a href=#__codelineno-24-44><span class=linenos data-linenos="44 "></span></a><span class=c1># Extract to temporary container</span>
</span><span id=__span-24-45><a id=__codelineno-24-45 name=__codelineno-24-45></a><a href=#__codelineno-24-45><span class=linenos data-linenos="45 "></span></a>docker<span class=w> </span>run<span class=w> </span>--rm<span class=w> </span>-v<span class=w> </span>agent-workflow_projects:/data<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>:/backup<span class=w> </span>alpine<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;cd /data &amp;&amp; tar -xzf /backup/projects_</span><span class=nv>$TIMESTAMP</span><span class=s2>.tar.gz&quot;</span>
</span><span id=__span-24-46><a id=__codelineno-24-46 name=__codelineno-24-46></a><a href=#__codelineno-24-46><span class=linenos data-linenos="46 "></span></a>docker<span class=w> </span>run<span class=w> </span>--rm<span class=w> </span>-v<span class=w> </span>agent-workflow_logs:/data<span class=w> </span>-v<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>:/backup<span class=w> </span>alpine<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;cd /data &amp;&amp; tar -xzf /backup/logs_</span><span class=nv>$TIMESTAMP</span><span class=s2>.tar.gz&quot;</span>
</span><span id=__span-24-47><a id=__codelineno-24-47 name=__codelineno-24-47></a><a href=#__codelineno-24-47><span class=linenos data-linenos="47 "></span></a>
</span><span id=__span-24-48><a id=__codelineno-24-48 name=__codelineno-24-48></a><a href=#__codelineno-24-48><span class=linenos data-linenos="48 "></span></a><span class=c1># Restore configuration</span>
</span><span id=__span-24-49><a id=__codelineno-24-49 name=__codelineno-24-49></a><a href=#__codelineno-24-49><span class=linenos data-linenos="49 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Restoring configuration...&quot;</span>
</span><span id=__span-24-50><a id=__codelineno-24-50 name=__codelineno-24-50></a><a href=#__codelineno-24-50><span class=linenos data-linenos="50 "></span></a>tar<span class=w> </span>-xzf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>/config_</span><span class=nv>$TIMESTAMP</span><span class=s2>.tar.gz&quot;</span>
</span><span id=__span-24-51><a id=__codelineno-24-51 name=__codelineno-24-51></a><a href=#__codelineno-24-51><span class=linenos data-linenos="51 "></span></a>
</span><span id=__span-24-52><a id=__codelineno-24-52 name=__codelineno-24-52></a><a href=#__codelineno-24-52><span class=linenos data-linenos="52 "></span></a><span class=c1># Start all services</span>
</span><span id=__span-24-53><a id=__codelineno-24-53 name=__codelineno-24-53></a><a href=#__codelineno-24-53><span class=linenos data-linenos="53 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Starting all services...&quot;</span>
</span><span id=__span-24-54><a id=__codelineno-24-54 name=__codelineno-24-54></a><a href=#__codelineno-24-54><span class=linenos data-linenos="54 "></span></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-24-55><a id=__codelineno-24-55 name=__codelineno-24-55></a><a href=#__codelineno-24-55><span class=linenos data-linenos="55 "></span></a>
</span><span id=__span-24-56><a id=__codelineno-24-56 name=__codelineno-24-56></a><a href=#__codelineno-24-56><span class=linenos data-linenos="56 "></span></a><span class=c1># Wait for services to be ready</span>
</span><span id=__span-24-57><a id=__codelineno-24-57 name=__codelineno-24-57></a><a href=#__codelineno-24-57><span class=linenos data-linenos="57 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Waiting for services to be ready...&quot;</span>
</span><span id=__span-24-58><a id=__codelineno-24-58 name=__codelineno-24-58></a><a href=#__codelineno-24-58><span class=linenos data-linenos="58 "></span></a>sleep<span class=w> </span><span class=m>30</span>
</span><span id=__span-24-59><a id=__codelineno-24-59 name=__codelineno-24-59></a><a href=#__codelineno-24-59><span class=linenos data-linenos="59 "></span></a>
</span><span id=__span-24-60><a id=__codelineno-24-60 name=__codelineno-24-60></a><a href=#__codelineno-24-60><span class=linenos data-linenos="60 "></span></a><span class=c1># Verify restore</span>
</span><span id=__span-24-61><a id=__codelineno-24-61 name=__codelineno-24-61></a><a href=#__codelineno-24-61><span class=linenos data-linenos="61 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Verifying restore...&quot;</span>
</span><span id=__span-24-62><a id=__codelineno-24-62 name=__codelineno-24-62></a><a href=#__codelineno-24-62><span class=linenos data-linenos="62 "></span></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>orchestrator<span class=w> </span>python<span class=w> </span>scripts/health-check.py
</span><span id=__span-24-63><a id=__codelineno-24-63 name=__codelineno-24-63></a><a href=#__codelineno-24-63><span class=linenos data-linenos="63 "></span></a>
</span><span id=__span-24-64><a id=__codelineno-24-64 name=__codelineno-24-64></a><a href=#__codelineno-24-64><span class=linenos data-linenos="64 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Restore completed successfully!&quot;</span>
</span></code></pre></div><h3 id=disaster-recovery-testing>Disaster Recovery Testing<a class=headerlink href=#disaster-recovery-testing title="Permanent link">&para;</a></h3><div class="language-bash highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1></a><a href=#__codelineno-25-1><span class=linenos data-linenos=" 1 "></span></a><span class=ch>#!/bin/bash</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2></a><a href=#__codelineno-25-2><span class=linenos data-linenos=" 2 "></span></a><span class=c1># dr/test-disaster-recovery.sh</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3></a><a href=#__codelineno-25-3><span class=linenos data-linenos=" 3 "></span></a>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4></a><a href=#__codelineno-25-4><span class=linenos data-linenos=" 4 "></span></a><span class=nb>set</span><span class=w> </span>-e
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5></a><a href=#__codelineno-25-5><span class=linenos data-linenos=" 5 "></span></a>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6></a><a href=#__codelineno-25-6><span class=linenos data-linenos=" 6 "></span></a><span class=c1># Configuration</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7></a><a href=#__codelineno-25-7><span class=linenos data-linenos=" 7 "></span></a><span class=nv>DR_ENVIRONMENT</span><span class=o>=</span><span class=s2>&quot;dr-test&quot;</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8></a><a href=#__codelineno-25-8><span class=linenos data-linenos=" 8 "></span></a><span class=nv>PRODUCTION_BACKUP_S3</span><span class=o>=</span><span class=s2>&quot;s3://agent-workflow-backups/latest/&quot;</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9></a><a href=#__codelineno-25-9><span class=linenos data-linenos=" 9 "></span></a><span class=nv>DR_STACK_NAME</span><span class=o>=</span><span class=s2>&quot;agent-workflow-dr&quot;</span>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10></a><a href=#__codelineno-25-10><span class=linenos data-linenos="10 "></span></a>
</span><span id=__span-25-11><a id=__codelineno-25-11 name=__codelineno-25-11></a><a href=#__codelineno-25-11><span class=linenos data-linenos="11 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Starting disaster recovery test...&quot;</span>
</span><span id=__span-25-12><a id=__codelineno-25-12 name=__codelineno-25-12></a><a href=#__codelineno-25-12><span class=linenos data-linenos="12 "></span></a>
</span><span id=__span-25-13><a id=__codelineno-25-13 name=__codelineno-25-13></a><a href=#__codelineno-25-13><span class=linenos data-linenos="13 "></span></a><span class=c1># Create DR environment</span>
</span><span id=__span-25-14><a id=__codelineno-25-14 name=__codelineno-25-14></a><a href=#__codelineno-25-14><span class=linenos data-linenos="14 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Creating DR environment...&quot;</span>
</span><span id=__span-25-15><a id=__codelineno-25-15 name=__codelineno-25-15></a><a href=#__codelineno-25-15><span class=linenos data-linenos="15 "></span></a>aws<span class=w> </span>cloudformation<span class=w> </span>create-stack<span class=w> </span><span class=se>\</span>
</span><span id=__span-25-16><a id=__codelineno-25-16 name=__codelineno-25-16></a><a href=#__codelineno-25-16><span class=linenos data-linenos="16 "></span></a><span class=w>  </span>--stack-name<span class=w> </span><span class=s2>&quot;</span><span class=nv>$DR_STACK_NAME</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-25-17><a id=__codelineno-25-17 name=__codelineno-25-17></a><a href=#__codelineno-25-17><span class=linenos data-linenos="17 "></span></a><span class=w>  </span>--template-body<span class=w> </span>file://cloudformation/dr-template.yaml<span class=w> </span><span class=se>\</span>
</span><span id=__span-25-18><a id=__codelineno-25-18 name=__codelineno-25-18></a><a href=#__codelineno-25-18><span class=linenos data-linenos="18 "></span></a><span class=w>  </span>--parameters<span class=w> </span><span class=nv>ParameterKey</span><span class=o>=</span>Environment,ParameterValue<span class=o>=</span><span class=s2>&quot;</span><span class=nv>$DR_ENVIRONMENT</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-25-19><a id=__codelineno-25-19 name=__codelineno-25-19></a><a href=#__codelineno-25-19><span class=linenos data-linenos="19 "></span></a><span class=w>  </span>--capabilities<span class=w> </span>CAPABILITY_IAM
</span><span id=__span-25-20><a id=__codelineno-25-20 name=__codelineno-25-20></a><a href=#__codelineno-25-20><span class=linenos data-linenos="20 "></span></a>
</span><span id=__span-25-21><a id=__codelineno-25-21 name=__codelineno-25-21></a><a href=#__codelineno-25-21><span class=linenos data-linenos="21 "></span></a><span class=c1># Wait for stack creation</span>
</span><span id=__span-25-22><a id=__codelineno-25-22 name=__codelineno-25-22></a><a href=#__codelineno-25-22><span class=linenos data-linenos="22 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Waiting for stack creation...&quot;</span>
</span><span id=__span-25-23><a id=__codelineno-25-23 name=__codelineno-25-23></a><a href=#__codelineno-25-23><span class=linenos data-linenos="23 "></span></a>aws<span class=w> </span>cloudformation<span class=w> </span><span class=nb>wait</span><span class=w> </span>stack-create-complete<span class=w> </span>--stack-name<span class=w> </span><span class=s2>&quot;</span><span class=nv>$DR_STACK_NAME</span><span class=s2>&quot;</span>
</span><span id=__span-25-24><a id=__codelineno-25-24 name=__codelineno-25-24></a><a href=#__codelineno-25-24><span class=linenos data-linenos="24 "></span></a>
</span><span id=__span-25-25><a id=__codelineno-25-25 name=__codelineno-25-25></a><a href=#__codelineno-25-25><span class=linenos data-linenos="25 "></span></a><span class=c1># Get DR environment details</span>
</span><span id=__span-25-26><a id=__codelineno-25-26 name=__codelineno-25-26></a><a href=#__codelineno-25-26><span class=linenos data-linenos="26 "></span></a><span class=nv>DR_INSTANCE_ID</span><span class=o>=</span><span class=k>$(</span>aws<span class=w> </span>cloudformation<span class=w> </span>describe-stacks<span class=w> </span><span class=se>\</span>
</span><span id=__span-25-27><a id=__codelineno-25-27 name=__codelineno-25-27></a><a href=#__codelineno-25-27><span class=linenos data-linenos="27 "></span></a><span class=w>  </span>--stack-name<span class=w> </span><span class=s2>&quot;</span><span class=nv>$DR_STACK_NAME</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-25-28><a id=__codelineno-25-28 name=__codelineno-25-28></a><a href=#__codelineno-25-28><span class=linenos data-linenos="28 "></span></a><span class=w>  </span>--query<span class=w> </span><span class=s1>&#39;Stacks[0].Outputs[?OutputKey==`InstanceId`].OutputValue&#39;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-25-29><a id=__codelineno-25-29 name=__codelineno-25-29></a><a href=#__codelineno-25-29><span class=linenos data-linenos="29 "></span></a><span class=w>  </span>--output<span class=w> </span>text<span class=k>)</span>
</span><span id=__span-25-30><a id=__codelineno-25-30 name=__codelineno-25-30></a><a href=#__codelineno-25-30><span class=linenos data-linenos="30 "></span></a>
</span><span id=__span-25-31><a id=__codelineno-25-31 name=__codelineno-25-31></a><a href=#__codelineno-25-31><span class=linenos data-linenos="31 "></span></a><span class=nv>DR_PUBLIC_IP</span><span class=o>=</span><span class=k>$(</span>aws<span class=w> </span>cloudformation<span class=w> </span>describe-stacks<span class=w> </span><span class=se>\</span>
</span><span id=__span-25-32><a id=__codelineno-25-32 name=__codelineno-25-32></a><a href=#__codelineno-25-32><span class=linenos data-linenos="32 "></span></a><span class=w>  </span>--stack-name<span class=w> </span><span class=s2>&quot;</span><span class=nv>$DR_STACK_NAME</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-25-33><a id=__codelineno-25-33 name=__codelineno-25-33></a><a href=#__codelineno-25-33><span class=linenos data-linenos="33 "></span></a><span class=w>  </span>--query<span class=w> </span><span class=s1>&#39;Stacks[0].Outputs[?OutputKey==`PublicIP`].OutputValue&#39;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-25-34><a id=__codelineno-25-34 name=__codelineno-25-34></a><a href=#__codelineno-25-34><span class=linenos data-linenos="34 "></span></a><span class=w>  </span>--output<span class=w> </span>text<span class=k>)</span>
</span><span id=__span-25-35><a id=__codelineno-25-35 name=__codelineno-25-35></a><a href=#__codelineno-25-35><span class=linenos data-linenos="35 "></span></a>
</span><span id=__span-25-36><a id=__codelineno-25-36 name=__codelineno-25-36></a><a href=#__codelineno-25-36><span class=linenos data-linenos="36 "></span></a><span class=c1># Deploy application to DR environment</span>
</span><span id=__span-25-37><a id=__codelineno-25-37 name=__codelineno-25-37></a><a href=#__codelineno-25-37><span class=linenos data-linenos="37 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Deploying application to DR environment...&quot;</span>
</span><span id=__span-25-38><a id=__codelineno-25-38 name=__codelineno-25-38></a><a href=#__codelineno-25-38><span class=linenos data-linenos="38 "></span></a>ssh<span class=w> </span>-i<span class=w> </span>~/.ssh/agent-workflow-key.pem<span class=w> </span>ec2-user@<span class=s2>&quot;</span><span class=nv>$DR_PUBLIC_IP</span><span class=s2>&quot;</span><span class=w> </span><span class=s>&lt;&lt; &#39;EOF&#39;</span>
</span><span id=__span-25-39><a id=__codelineno-25-39 name=__codelineno-25-39></a><a href=#__codelineno-25-39><span class=linenos data-linenos="39 "></span></a><span class=s>  # Clone repository</span>
</span><span id=__span-25-40><a id=__codelineno-25-40 name=__codelineno-25-40></a><a href=#__codelineno-25-40><span class=linenos data-linenos="40 "></span></a><span class=s>  git clone https://github.com/yourusername/agent-workflow.git</span>
</span><span id=__span-25-41><a id=__codelineno-25-41 name=__codelineno-25-41></a><a href=#__codelineno-25-41><span class=linenos data-linenos="41 "></span></a><span class=s>  cd agent-workflow</span>
</span><span id=__span-25-42><a id=__codelineno-25-42 name=__codelineno-25-42></a><a href=#__codelineno-25-42><span class=linenos data-linenos="42 "></span></a><span class=s>  </span>
</span><span id=__span-25-43><a id=__codelineno-25-43 name=__codelineno-25-43></a><a href=#__codelineno-25-43><span class=linenos data-linenos="43 "></span></a><span class=s>  # Download latest backup</span>
</span><span id=__span-25-44><a id=__codelineno-25-44 name=__codelineno-25-44></a><a href=#__codelineno-25-44><span class=linenos data-linenos="44 "></span></a><span class=s>  aws s3 sync s3://agent-workflow-backups/latest/ ./backups/</span>
</span><span id=__span-25-45><a id=__codelineno-25-45 name=__codelineno-25-45></a><a href=#__codelineno-25-45><span class=linenos data-linenos="45 "></span></a><span class=s>  </span>
</span><span id=__span-25-46><a id=__codelineno-25-46 name=__codelineno-25-46></a><a href=#__codelineno-25-46><span class=linenos data-linenos="46 "></span></a><span class=s>  # Restore from backup</span>
</span><span id=__span-25-47><a id=__codelineno-25-47 name=__codelineno-25-47></a><a href=#__codelineno-25-47><span class=linenos data-linenos="47 "></span></a><span class=s>  ./backup/restore.sh $(ls backups/postgres_*.sql.gz | head -1 | sed &#39;s/.*postgres_\([0-9_]*\)\.sql\.gz/\1/&#39;)</span>
</span><span id=__span-25-48><a id=__codelineno-25-48 name=__codelineno-25-48></a><a href=#__codelineno-25-48><span class=linenos data-linenos="48 "></span></a><span class=s>  </span>
</span><span id=__span-25-49><a id=__codelineno-25-49 name=__codelineno-25-49></a><a href=#__codelineno-25-49><span class=linenos data-linenos="49 "></span></a><span class=s>  # Start services</span>
</span><span id=__span-25-50><a id=__codelineno-25-50 name=__codelineno-25-50></a><a href=#__codelineno-25-50><span class=linenos data-linenos="50 "></span></a><span class=s>  docker-compose up -d</span>
</span><span id=__span-25-51><a id=__codelineno-25-51 name=__codelineno-25-51></a><a href=#__codelineno-25-51><span class=linenos data-linenos="51 "></span></a><span class=s>EOF</span>
</span><span id=__span-25-52><a id=__codelineno-25-52 name=__codelineno-25-52></a><a href=#__codelineno-25-52><span class=linenos data-linenos="52 "></span></a>
</span><span id=__span-25-53><a id=__codelineno-25-53 name=__codelineno-25-53></a><a href=#__codelineno-25-53><span class=linenos data-linenos="53 "></span></a><span class=c1># Run DR tests</span>
</span><span id=__span-25-54><a id=__codelineno-25-54 name=__codelineno-25-54></a><a href=#__codelineno-25-54><span class=linenos data-linenos="54 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Running DR tests...&quot;</span>
</span><span id=__span-25-55><a id=__codelineno-25-55 name=__codelineno-25-55></a><a href=#__codelineno-25-55><span class=linenos data-linenos="55 "></span></a>./tests/dr-tests.sh<span class=w> </span><span class=s2>&quot;</span><span class=nv>$DR_PUBLIC_IP</span><span class=s2>&quot;</span>
</span><span id=__span-25-56><a id=__codelineno-25-56 name=__codelineno-25-56></a><a href=#__codelineno-25-56><span class=linenos data-linenos="56 "></span></a>
</span><span id=__span-25-57><a id=__codelineno-25-57 name=__codelineno-25-57></a><a href=#__codelineno-25-57><span class=linenos data-linenos="57 "></span></a><span class=c1># Cleanup DR environment</span>
</span><span id=__span-25-58><a id=__codelineno-25-58 name=__codelineno-25-58></a><a href=#__codelineno-25-58><span class=linenos data-linenos="58 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Cleaning up DR environment...&quot;</span>
</span><span id=__span-25-59><a id=__codelineno-25-59 name=__codelineno-25-59></a><a href=#__codelineno-25-59><span class=linenos data-linenos="59 "></span></a>aws<span class=w> </span>cloudformation<span class=w> </span>delete-stack<span class=w> </span>--stack-name<span class=w> </span><span class=s2>&quot;</span><span class=nv>$DR_STACK_NAME</span><span class=s2>&quot;</span>
</span><span id=__span-25-60><a id=__codelineno-25-60 name=__codelineno-25-60></a><a href=#__codelineno-25-60><span class=linenos data-linenos="60 "></span></a>
</span><span id=__span-25-61><a id=__codelineno-25-61 name=__codelineno-25-61></a><a href=#__codelineno-25-61><span class=linenos data-linenos="61 "></span></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Disaster recovery test completed successfully!&quot;</span>
</span></code></pre></div><h2 id=security-best-practices>Security Best Practices<a class=headerlink href=#security-best-practices title="Permanent link">&para;</a></h2><h3 id=security-hardening-checklist>Security Hardening Checklist<a class=headerlink href=#security-hardening-checklist title="Permanent link">&para;</a></h3><div class="language-markdown highlight"><span class=filename>Markdown</span><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1></a><a href=#__codelineno-26-1><span class=linenos data-linenos=" 1 "></span></a><span class=gu>## Security Hardening Checklist</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2></a><a href=#__codelineno-26-2><span class=linenos data-linenos=" 2 "></span></a>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3></a><a href=#__codelineno-26-3><span class=linenos data-linenos=" 3 "></span></a><span class=gu>### Infrastructure Security</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4></a><a href=#__codelineno-26-4><span class=linenos data-linenos=" 4 "></span></a><span class=k>- [ ]</span> Use non-root containers with specific user IDs
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5></a><a href=#__codelineno-26-5><span class=linenos data-linenos=" 5 "></span></a><span class=k>- [ ]</span> Enable read-only root filesystem where possible
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6></a><a href=#__codelineno-26-6><span class=linenos data-linenos=" 6 "></span></a><span class=k>- [ ]</span> Implement resource limits and quotas
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7></a><a href=#__codelineno-26-7><span class=linenos data-linenos=" 7 "></span></a><span class=k>- [ ]</span> Use secrets management (Vault, AWS Secrets Manager)
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8></a><a href=#__codelineno-26-8><span class=linenos data-linenos=" 8 "></span></a><span class=k>- [ ]</span> Enable container image scanning
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9></a><a href=#__codelineno-26-9><span class=linenos data-linenos=" 9 "></span></a><span class=k>- [ ]</span> Implement network segmentation
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10></a><a href=#__codelineno-26-10><span class=linenos data-linenos="10 "></span></a><span class=k>- [ ]</span> Use private container registries
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11></a><a href=#__codelineno-26-11><span class=linenos data-linenos="11 "></span></a><span class=k>- [ ]</span> Enable audit logging for all services
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12></a><a href=#__codelineno-26-12><span class=linenos data-linenos="12 "></span></a>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13></a><a href=#__codelineno-26-13><span class=linenos data-linenos="13 "></span></a><span class=gu>### Application Security</span>
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14></a><a href=#__codelineno-26-14><span class=linenos data-linenos="14 "></span></a><span class=k>- [ ]</span> Implement input validation and sanitization
</span><span id=__span-26-15><a id=__codelineno-26-15 name=__codelineno-26-15></a><a href=#__codelineno-26-15><span class=linenos data-linenos="15 "></span></a><span class=k>- [ ]</span> Use parameterized queries to prevent SQL injection
</span><span id=__span-26-16><a id=__codelineno-26-16 name=__codelineno-26-16></a><a href=#__codelineno-26-16><span class=linenos data-linenos="16 "></span></a><span class=k>- [ ]</span> Enable CSRF protection
</span><span id=__span-26-17><a id=__codelineno-26-17 name=__codelineno-26-17></a><a href=#__codelineno-26-17><span class=linenos data-linenos="17 "></span></a><span class=k>- [ ]</span> Implement rate limiting
</span><span id=__span-26-18><a id=__codelineno-26-18 name=__codelineno-26-18></a><a href=#__codelineno-26-18><span class=linenos data-linenos="18 "></span></a><span class=k>- [ ]</span> Use secure session management
</span><span id=__span-26-19><a id=__codelineno-26-19 name=__codelineno-26-19></a><a href=#__codelineno-26-19><span class=linenos data-linenos="19 "></span></a><span class=k>- [ ]</span> Enable HTTPS everywhere with HSTS
</span><span id=__span-26-20><a id=__codelineno-26-20 name=__codelineno-26-20></a><a href=#__codelineno-26-20><span class=linenos data-linenos="20 "></span></a><span class=k>- [ ]</span> Implement proper error handling (no sensitive data in errors)
</span><span id=__span-26-21><a id=__codelineno-26-21 name=__codelineno-26-21></a><a href=#__codelineno-26-21><span class=linenos data-linenos="21 "></span></a><span class=k>- [ ]</span> Use secure random number generation
</span><span id=__span-26-22><a id=__codelineno-26-22 name=__codelineno-26-22></a><a href=#__codelineno-26-22><span class=linenos data-linenos="22 "></span></a>
</span><span id=__span-26-23><a id=__codelineno-26-23 name=__codelineno-26-23></a><a href=#__codelineno-26-23><span class=linenos data-linenos="23 "></span></a><span class=gu>### Authentication &amp; Authorization</span>
</span><span id=__span-26-24><a id=__codelineno-26-24 name=__codelineno-26-24></a><a href=#__codelineno-26-24><span class=linenos data-linenos="24 "></span></a><span class=k>- [ ]</span> Implement multi-factor authentication
</span><span id=__span-26-25><a id=__codelineno-26-25 name=__codelineno-26-25></a><a href=#__codelineno-26-25><span class=linenos data-linenos="25 "></span></a><span class=k>- [ ]</span> Use OAuth 2.0 with PKCE for API access
</span><span id=__span-26-26><a id=__codelineno-26-26 name=__codelineno-26-26></a><a href=#__codelineno-26-26><span class=linenos data-linenos="26 "></span></a><span class=k>- [ ]</span> Implement role-based access control (RBAC)
</span><span id=__span-26-27><a id=__codelineno-26-27 name=__codelineno-26-27></a><a href=#__codelineno-26-27><span class=linenos data-linenos="27 "></span></a><span class=k>- [ ]</span> Use JWT tokens with proper expiration
</span><span id=__span-26-28><a id=__codelineno-26-28 name=__codelineno-26-28></a><a href=#__codelineno-26-28><span class=linenos data-linenos="28 "></span></a><span class=k>- [ ]</span> Implement session timeout
</span><span id=__span-26-29><a id=__codelineno-26-29 name=__codelineno-26-29></a><a href=#__codelineno-26-29><span class=linenos data-linenos="29 "></span></a><span class=k>- [ ]</span> Use strong password policies
</span><span id=__span-26-30><a id=__codelineno-26-30 name=__codelineno-26-30></a><a href=#__codelineno-26-30><span class=linenos data-linenos="30 "></span></a><span class=k>- [ ]</span> Enable account lockout after failed attempts
</span><span id=__span-26-31><a id=__codelineno-26-31 name=__codelineno-26-31></a><a href=#__codelineno-26-31><span class=linenos data-linenos="31 "></span></a><span class=k>- [ ]</span> Implement privilege escalation controls
</span><span id=__span-26-32><a id=__codelineno-26-32 name=__codelineno-26-32></a><a href=#__codelineno-26-32><span class=linenos data-linenos="32 "></span></a>
</span><span id=__span-26-33><a id=__codelineno-26-33 name=__codelineno-26-33></a><a href=#__codelineno-26-33><span class=linenos data-linenos="33 "></span></a><span class=gu>### Data Protection</span>
</span><span id=__span-26-34><a id=__codelineno-26-34 name=__codelineno-26-34></a><a href=#__codelineno-26-34><span class=linenos data-linenos="34 "></span></a><span class=k>- [ ]</span> Encrypt data at rest using AES-256
</span><span id=__span-26-35><a id=__codelineno-26-35 name=__codelineno-26-35></a><a href=#__codelineno-26-35><span class=linenos data-linenos="35 "></span></a><span class=k>- [ ]</span> Encrypt data in transit using TLS 1.3
</span><span id=__span-26-36><a id=__codelineno-26-36 name=__codelineno-26-36></a><a href=#__codelineno-26-36><span class=linenos data-linenos="36 "></span></a><span class=k>- [ ]</span> Implement key rotation policies
</span><span id=__span-26-37><a id=__codelineno-26-37 name=__codelineno-26-37></a><a href=#__codelineno-26-37><span class=linenos data-linenos="37 "></span></a><span class=k>- [ ]</span> Use secure key management
</span><span id=__span-26-38><a id=__codelineno-26-38 name=__codelineno-26-38></a><a href=#__codelineno-26-38><span class=linenos data-linenos="38 "></span></a><span class=k>- [ ]</span> Implement data backup encryption
</span><span id=__span-26-39><a id=__codelineno-26-39 name=__codelineno-26-39></a><a href=#__codelineno-26-39><span class=linenos data-linenos="39 "></span></a><span class=k>- [ ]</span> Enable database encryption
</span><span id=__span-26-40><a id=__codelineno-26-40 name=__codelineno-26-40></a><a href=#__codelineno-26-40><span class=linenos data-linenos="40 "></span></a><span class=k>- [ ]</span> Implement PII data classification
</span><span id=__span-26-41><a id=__codelineno-26-41 name=__codelineno-26-41></a><a href=#__codelineno-26-41><span class=linenos data-linenos="41 "></span></a><span class=k>- [ ]</span> Use data masking for non-production environments
</span><span id=__span-26-42><a id=__codelineno-26-42 name=__codelineno-26-42></a><a href=#__codelineno-26-42><span class=linenos data-linenos="42 "></span></a>
</span><span id=__span-26-43><a id=__codelineno-26-43 name=__codelineno-26-43></a><a href=#__codelineno-26-43><span class=linenos data-linenos="43 "></span></a><span class=gu>### Monitoring &amp; Compliance</span>
</span><span id=__span-26-44><a id=__codelineno-26-44 name=__codelineno-26-44></a><a href=#__codelineno-26-44><span class=linenos data-linenos="44 "></span></a><span class=k>- [ ]</span> Enable security event logging
</span><span id=__span-26-45><a id=__codelineno-26-45 name=__codelineno-26-45></a><a href=#__codelineno-26-45><span class=linenos data-linenos="45 "></span></a><span class=k>- [ ]</span> Implement intrusion detection
</span><span id=__span-26-46><a id=__codelineno-26-46 name=__codelineno-26-46></a><a href=#__codelineno-26-46><span class=linenos data-linenos="46 "></span></a><span class=k>- [ ]</span> Set up vulnerability scanning
</span><span id=__span-26-47><a id=__codelineno-26-47 name=__codelineno-26-47></a><a href=#__codelineno-26-47><span class=linenos data-linenos="47 "></span></a><span class=k>- [ ]</span> Implement compliance monitoring
</span><span id=__span-26-48><a id=__codelineno-26-48 name=__codelineno-26-48></a><a href=#__codelineno-26-48><span class=linenos data-linenos="48 "></span></a><span class=k>- [ ]</span> Enable audit trail logging
</span><span id=__span-26-49><a id=__codelineno-26-49 name=__codelineno-26-49></a><a href=#__codelineno-26-49><span class=linenos data-linenos="49 "></span></a><span class=k>- [ ]</span> Set up security alerting
</span><span id=__span-26-50><a id=__codelineno-26-50 name=__codelineno-26-50></a><a href=#__codelineno-26-50><span class=linenos data-linenos="50 "></span></a><span class=k>- [ ]</span> Implement incident response procedures
</span><span id=__span-26-51><a id=__codelineno-26-51 name=__codelineno-26-51></a><a href=#__codelineno-26-51><span class=linenos data-linenos="51 "></span></a><span class=k>- [ ]</span> Regular security assessments
</span></code></pre></div><h3 id=owasp-security-headers>OWASP Security Headers<a class=headerlink href=#owasp-security-headers title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1></a><a href=#__codelineno-27-1><span class=linenos data-linenos="  1 "></span></a><span class=c1># lib/security_middleware.py</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2></a><a href=#__codelineno-27-2><span class=linenos data-linenos="  2 "></span></a><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>g</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3></a><a href=#__codelineno-27-3><span class=linenos data-linenos="  3 "></span></a><span class=kn>import</span> <span class=nn>time</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4></a><a href=#__codelineno-27-4><span class=linenos data-linenos="  4 "></span></a><span class=kn>import</span> <span class=nn>hashlib</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5></a><a href=#__codelineno-27-5><span class=linenos data-linenos="  5 "></span></a><span class=kn>import</span> <span class=nn>secrets</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6></a><a href=#__codelineno-27-6><span class=linenos data-linenos="  6 "></span></a>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7></a><a href=#__codelineno-27-7><span class=linenos data-linenos="  7 "></span></a><span class=k>class</span> <span class=nc>SecurityMiddleware</span><span class=p>:</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8></a><a href=#__codelineno-27-8><span class=linenos data-linenos="  8 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Security middleware for Flask applications&quot;&quot;&quot;</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9></a><a href=#__codelineno-27-9><span class=linenos data-linenos="  9 "></span></a>    
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10></a><a href=#__codelineno-27-10><span class=linenos data-linenos=" 10 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>app</span><span class=p>:</span> <span class=n>Flask</span><span class=p>):</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11></a><a href=#__codelineno-27-11><span class=linenos data-linenos=" 11 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>app</span> <span class=o>=</span> <span class=n>app</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12></a><a href=#__codelineno-27-12><span class=linenos data-linenos=" 12 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>setup_security_headers</span><span class=p>()</span>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13></a><a href=#__codelineno-27-13><span class=linenos data-linenos=" 13 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>setup_rate_limiting</span><span class=p>()</span>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14></a><a href=#__codelineno-27-14><span class=linenos data-linenos=" 14 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>setup_csrf_protection</span><span class=p>()</span>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15></a><a href=#__codelineno-27-15><span class=linenos data-linenos=" 15 "></span></a>    
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16></a><a href=#__codelineno-27-16><span class=linenos data-linenos=" 16 "></span></a>    <span class=k>def</span> <span class=nf>setup_security_headers</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17></a><a href=#__codelineno-27-17><span class=linenos data-linenos=" 17 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Configure security headers&quot;&quot;&quot;</span>
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18></a><a href=#__codelineno-27-18><span class=linenos data-linenos=" 18 "></span></a>        <span class=nd>@self</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>after_request</span>
</span><span id=__span-27-19><a id=__codelineno-27-19 name=__codelineno-27-19></a><a href=#__codelineno-27-19><span class=linenos data-linenos=" 19 "></span></a>        <span class=k>def</span> <span class=nf>add_security_headers</span><span class=p>(</span><span class=n>response</span><span class=p>):</span>
</span><span id=__span-27-20><a id=__codelineno-27-20 name=__codelineno-27-20></a><a href=#__codelineno-27-20><span class=linenos data-linenos=" 20 "></span></a>            <span class=c1># HSTS</span>
</span><span id=__span-27-21><a id=__codelineno-27-21 name=__codelineno-27-21></a><a href=#__codelineno-27-21><span class=linenos data-linenos=" 21 "></span></a>            <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;Strict-Transport-Security&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;max-age=31536000; includeSubDomains; preload&#39;</span>
</span><span id=__span-27-22><a id=__codelineno-27-22 name=__codelineno-27-22></a><a href=#__codelineno-27-22><span class=linenos data-linenos=" 22 "></span></a>            
</span><span id=__span-27-23><a id=__codelineno-27-23 name=__codelineno-27-23></a><a href=#__codelineno-27-23><span class=linenos data-linenos=" 23 "></span></a>            <span class=c1># XSS Protection</span>
</span><span id=__span-27-24><a id=__codelineno-27-24 name=__codelineno-27-24></a><a href=#__codelineno-27-24><span class=linenos data-linenos=" 24 "></span></a>            <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;X-XSS-Protection&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;1; mode=block&#39;</span>
</span><span id=__span-27-25><a id=__codelineno-27-25 name=__codelineno-27-25></a><a href=#__codelineno-27-25><span class=linenos data-linenos=" 25 "></span></a>            
</span><span id=__span-27-26><a id=__codelineno-27-26 name=__codelineno-27-26></a><a href=#__codelineno-27-26><span class=linenos data-linenos=" 26 "></span></a>            <span class=c1># Content Type Options</span>
</span><span id=__span-27-27><a id=__codelineno-27-27 name=__codelineno-27-27></a><a href=#__codelineno-27-27><span class=linenos data-linenos=" 27 "></span></a>            <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;X-Content-Type-Options&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;nosniff&#39;</span>
</span><span id=__span-27-28><a id=__codelineno-27-28 name=__codelineno-27-28></a><a href=#__codelineno-27-28><span class=linenos data-linenos=" 28 "></span></a>            
</span><span id=__span-27-29><a id=__codelineno-27-29 name=__codelineno-27-29></a><a href=#__codelineno-27-29><span class=linenos data-linenos=" 29 "></span></a>            <span class=c1># Frame Options</span>
</span><span id=__span-27-30><a id=__codelineno-27-30 name=__codelineno-27-30></a><a href=#__codelineno-27-30><span class=linenos data-linenos=" 30 "></span></a>            <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;X-Frame-Options&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;DENY&#39;</span>
</span><span id=__span-27-31><a id=__codelineno-27-31 name=__codelineno-27-31></a><a href=#__codelineno-27-31><span class=linenos data-linenos=" 31 "></span></a>            
</span><span id=__span-27-32><a id=__codelineno-27-32 name=__codelineno-27-32></a><a href=#__codelineno-27-32><span class=linenos data-linenos=" 32 "></span></a>            <span class=c1># Referrer Policy</span>
</span><span id=__span-27-33><a id=__codelineno-27-33 name=__codelineno-27-33></a><a href=#__codelineno-27-33><span class=linenos data-linenos=" 33 "></span></a>            <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;Referrer-Policy&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;strict-origin-when-cross-origin&#39;</span>
</span><span id=__span-27-34><a id=__codelineno-27-34 name=__codelineno-27-34></a><a href=#__codelineno-27-34><span class=linenos data-linenos=" 34 "></span></a>            
</span><span id=__span-27-35><a id=__codelineno-27-35 name=__codelineno-27-35></a><a href=#__codelineno-27-35><span class=linenos data-linenos=" 35 "></span></a>            <span class=c1># Content Security Policy</span>
</span><span id=__span-27-36><a id=__codelineno-27-36 name=__codelineno-27-36></a><a href=#__codelineno-27-36><span class=linenos data-linenos=" 36 "></span></a>            <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;Content-Security-Policy&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
</span><span id=__span-27-37><a id=__codelineno-27-37 name=__codelineno-27-37></a><a href=#__codelineno-27-37><span class=linenos data-linenos=" 37 "></span></a>                <span class=s2>&quot;default-src &#39;self&#39;; &quot;</span>
</span><span id=__span-27-38><a id=__codelineno-27-38 name=__codelineno-27-38></a><a href=#__codelineno-27-38><span class=linenos data-linenos=" 38 "></span></a>                <span class=s2>&quot;script-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;; &quot;</span>
</span><span id=__span-27-39><a id=__codelineno-27-39 name=__codelineno-27-39></a><a href=#__codelineno-27-39><span class=linenos data-linenos=" 39 "></span></a>                <span class=s2>&quot;style-src &#39;self&#39; &#39;unsafe-inline&#39;; &quot;</span>
</span><span id=__span-27-40><a id=__codelineno-27-40 name=__codelineno-27-40></a><a href=#__codelineno-27-40><span class=linenos data-linenos=" 40 "></span></a>                <span class=s2>&quot;img-src &#39;self&#39; data: https:; &quot;</span>
</span><span id=__span-27-41><a id=__codelineno-27-41 name=__codelineno-27-41></a><a href=#__codelineno-27-41><span class=linenos data-linenos=" 41 "></span></a>                <span class=s2>&quot;font-src &#39;self&#39; data:; &quot;</span>
</span><span id=__span-27-42><a id=__codelineno-27-42 name=__codelineno-27-42></a><a href=#__codelineno-27-42><span class=linenos data-linenos=" 42 "></span></a>                <span class=s2>&quot;connect-src &#39;self&#39; https://api.anthropic.com; &quot;</span>
</span><span id=__span-27-43><a id=__codelineno-27-43 name=__codelineno-27-43></a><a href=#__codelineno-27-43><span class=linenos data-linenos=" 43 "></span></a>                <span class=s2>&quot;frame-ancestors &#39;none&#39;; &quot;</span>
</span><span id=__span-27-44><a id=__codelineno-27-44 name=__codelineno-27-44></a><a href=#__codelineno-27-44><span class=linenos data-linenos=" 44 "></span></a>                <span class=s2>&quot;base-uri &#39;self&#39;;&quot;</span>
</span><span id=__span-27-45><a id=__codelineno-27-45 name=__codelineno-27-45></a><a href=#__codelineno-27-45><span class=linenos data-linenos=" 45 "></span></a>            <span class=p>)</span>
</span><span id=__span-27-46><a id=__codelineno-27-46 name=__codelineno-27-46></a><a href=#__codelineno-27-46><span class=linenos data-linenos=" 46 "></span></a>            
</span><span id=__span-27-47><a id=__codelineno-27-47 name=__codelineno-27-47></a><a href=#__codelineno-27-47><span class=linenos data-linenos=" 47 "></span></a>            <span class=c1># Permissions Policy</span>
</span><span id=__span-27-48><a id=__codelineno-27-48 name=__codelineno-27-48></a><a href=#__codelineno-27-48><span class=linenos data-linenos=" 48 "></span></a>            <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;Permissions-Policy&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
</span><span id=__span-27-49><a id=__codelineno-27-49 name=__codelineno-27-49></a><a href=#__codelineno-27-49><span class=linenos data-linenos=" 49 "></span></a>                <span class=s2>&quot;geolocation=(), &quot;</span>
</span><span id=__span-27-50><a id=__codelineno-27-50 name=__codelineno-27-50></a><a href=#__codelineno-27-50><span class=linenos data-linenos=" 50 "></span></a>                <span class=s2>&quot;microphone=(), &quot;</span>
</span><span id=__span-27-51><a id=__codelineno-27-51 name=__codelineno-27-51></a><a href=#__codelineno-27-51><span class=linenos data-linenos=" 51 "></span></a>                <span class=s2>&quot;camera=(), &quot;</span>
</span><span id=__span-27-52><a id=__codelineno-27-52 name=__codelineno-27-52></a><a href=#__codelineno-27-52><span class=linenos data-linenos=" 52 "></span></a>                <span class=s2>&quot;payment=(), &quot;</span>
</span><span id=__span-27-53><a id=__codelineno-27-53 name=__codelineno-27-53></a><a href=#__codelineno-27-53><span class=linenos data-linenos=" 53 "></span></a>                <span class=s2>&quot;usb=(), &quot;</span>
</span><span id=__span-27-54><a id=__codelineno-27-54 name=__codelineno-27-54></a><a href=#__codelineno-27-54><span class=linenos data-linenos=" 54 "></span></a>                <span class=s2>&quot;bluetooth=()&quot;</span>
</span><span id=__span-27-55><a id=__codelineno-27-55 name=__codelineno-27-55></a><a href=#__codelineno-27-55><span class=linenos data-linenos=" 55 "></span></a>            <span class=p>)</span>
</span><span id=__span-27-56><a id=__codelineno-27-56 name=__codelineno-27-56></a><a href=#__codelineno-27-56><span class=linenos data-linenos=" 56 "></span></a>            
</span><span id=__span-27-57><a id=__codelineno-27-57 name=__codelineno-27-57></a><a href=#__codelineno-27-57><span class=linenos data-linenos=" 57 "></span></a>            <span class=k>return</span> <span class=n>response</span>
</span><span id=__span-27-58><a id=__codelineno-27-58 name=__codelineno-27-58></a><a href=#__codelineno-27-58><span class=linenos data-linenos=" 58 "></span></a>    
</span><span id=__span-27-59><a id=__codelineno-27-59 name=__codelineno-27-59></a><a href=#__codelineno-27-59><span class=linenos data-linenos=" 59 "></span></a>    <span class=k>def</span> <span class=nf>setup_rate_limiting</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-27-60><a id=__codelineno-27-60 name=__codelineno-27-60></a><a href=#__codelineno-27-60><span class=linenos data-linenos=" 60 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Configure rate limiting&quot;&quot;&quot;</span>
</span><span id=__span-27-61><a id=__codelineno-27-61 name=__codelineno-27-61></a><a href=#__codelineno-27-61><span class=linenos data-linenos=" 61 "></span></a>        <span class=n>rate_limit_storage</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-27-62><a id=__codelineno-27-62 name=__codelineno-27-62></a><a href=#__codelineno-27-62><span class=linenos data-linenos=" 62 "></span></a>        
</span><span id=__span-27-63><a id=__codelineno-27-63 name=__codelineno-27-63></a><a href=#__codelineno-27-63><span class=linenos data-linenos=" 63 "></span></a>        <span class=nd>@self</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>before_request</span>
</span><span id=__span-27-64><a id=__codelineno-27-64 name=__codelineno-27-64></a><a href=#__codelineno-27-64><span class=linenos data-linenos=" 64 "></span></a>        <span class=k>def</span> <span class=nf>check_rate_limit</span><span class=p>():</span>
</span><span id=__span-27-65><a id=__codelineno-27-65 name=__codelineno-27-65></a><a href=#__codelineno-27-65><span class=linenos data-linenos=" 65 "></span></a>            <span class=n>client_ip</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class=p>,</span> <span class=n>request</span><span class=o>.</span><span class=n>remote_addr</span><span class=p>)</span>
</span><span id=__span-27-66><a id=__codelineno-27-66 name=__codelineno-27-66></a><a href=#__codelineno-27-66><span class=linenos data-linenos=" 66 "></span></a>            <span class=n>current_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-27-67><a id=__codelineno-27-67 name=__codelineno-27-67></a><a href=#__codelineno-27-67><span class=linenos data-linenos=" 67 "></span></a>            
</span><span id=__span-27-68><a id=__codelineno-27-68 name=__codelineno-27-68></a><a href=#__codelineno-27-68><span class=linenos data-linenos=" 68 "></span></a>            <span class=c1># Clean old entries</span>
</span><span id=__span-27-69><a id=__codelineno-27-69 name=__codelineno-27-69></a><a href=#__codelineno-27-69><span class=linenos data-linenos=" 69 "></span></a>            <span class=n>cutoff_time</span> <span class=o>=</span> <span class=n>current_time</span> <span class=o>-</span> <span class=mi>60</span>  <span class=c1># 1 minute window</span>
</span><span id=__span-27-70><a id=__codelineno-27-70 name=__codelineno-27-70></a><a href=#__codelineno-27-70><span class=linenos data-linenos=" 70 "></span></a>            <span class=n>rate_limit_storage</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-27-71><a id=__codelineno-27-71 name=__codelineno-27-71></a><a href=#__codelineno-27-71><span class=linenos data-linenos=" 71 "></span></a>                <span class=n>ip</span><span class=p>:</span> <span class=n>requests</span> <span class=k>for</span> <span class=n>ip</span><span class=p>,</span> <span class=n>requests</span> <span class=ow>in</span> <span class=n>rate_limit_storage</span><span class=o>.</span><span class=n>items</span><span class=p>()</span>
</span><span id=__span-27-72><a id=__codelineno-27-72 name=__codelineno-27-72></a><a href=#__codelineno-27-72><span class=linenos data-linenos=" 72 "></span></a>                <span class=k>if</span> <span class=nb>any</span><span class=p>(</span><span class=n>req_time</span> <span class=o>&gt;</span> <span class=n>cutoff_time</span> <span class=k>for</span> <span class=n>req_time</span> <span class=ow>in</span> <span class=n>requests</span><span class=p>)</span>
</span><span id=__span-27-73><a id=__codelineno-27-73 name=__codelineno-27-73></a><a href=#__codelineno-27-73><span class=linenos data-linenos=" 73 "></span></a>            <span class=p>}</span>
</span><span id=__span-27-74><a id=__codelineno-27-74 name=__codelineno-27-74></a><a href=#__codelineno-27-74><span class=linenos data-linenos=" 74 "></span></a>            
</span><span id=__span-27-75><a id=__codelineno-27-75 name=__codelineno-27-75></a><a href=#__codelineno-27-75><span class=linenos data-linenos=" 75 "></span></a>            <span class=c1># Check rate limit</span>
</span><span id=__span-27-76><a id=__codelineno-27-76 name=__codelineno-27-76></a><a href=#__codelineno-27-76><span class=linenos data-linenos=" 76 "></span></a>            <span class=k>if</span> <span class=n>client_ip</span> <span class=ow>in</span> <span class=n>rate_limit_storage</span><span class=p>:</span>
</span><span id=__span-27-77><a id=__codelineno-27-77 name=__codelineno-27-77></a><a href=#__codelineno-27-77><span class=linenos data-linenos=" 77 "></span></a>                <span class=n>requests_in_window</span> <span class=o>=</span> <span class=p>[</span><span class=n>req_time</span> <span class=k>for</span> <span class=n>req_time</span> <span class=ow>in</span> <span class=n>rate_limit_storage</span><span class=p>[</span><span class=n>client_ip</span><span class=p>]</span> <span class=k>if</span> <span class=n>req_time</span> <span class=o>&gt;</span> <span class=n>cutoff_time</span><span class=p>]</span>
</span><span id=__span-27-78><a id=__codelineno-27-78 name=__codelineno-27-78></a><a href=#__codelineno-27-78><span class=linenos data-linenos=" 78 "></span></a>                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>requests_in_window</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>100</span><span class=p>:</span>  <span class=c1># 100 requests per minute</span>
</span><span id=__span-27-79><a id=__codelineno-27-79 name=__codelineno-27-79></a><a href=#__codelineno-27-79><span class=linenos data-linenos=" 79 "></span></a>                    <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=s1>&#39;Rate limit exceeded&#39;</span><span class=p>},</span> <span class=mi>429</span>
</span><span id=__span-27-80><a id=__codelineno-27-80 name=__codelineno-27-80></a><a href=#__codelineno-27-80><span class=linenos data-linenos=" 80 "></span></a>            
</span><span id=__span-27-81><a id=__codelineno-27-81 name=__codelineno-27-81></a><a href=#__codelineno-27-81><span class=linenos data-linenos=" 81 "></span></a>            <span class=c1># Record request</span>
</span><span id=__span-27-82><a id=__codelineno-27-82 name=__codelineno-27-82></a><a href=#__codelineno-27-82><span class=linenos data-linenos=" 82 "></span></a>            <span class=k>if</span> <span class=n>client_ip</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>rate_limit_storage</span><span class=p>:</span>
</span><span id=__span-27-83><a id=__codelineno-27-83 name=__codelineno-27-83></a><a href=#__codelineno-27-83><span class=linenos data-linenos=" 83 "></span></a>                <span class=n>rate_limit_storage</span><span class=p>[</span><span class=n>client_ip</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-27-84><a id=__codelineno-27-84 name=__codelineno-27-84></a><a href=#__codelineno-27-84><span class=linenos data-linenos=" 84 "></span></a>            <span class=n>rate_limit_storage</span><span class=p>[</span><span class=n>client_ip</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>current_time</span><span class=p>)</span>
</span><span id=__span-27-85><a id=__codelineno-27-85 name=__codelineno-27-85></a><a href=#__codelineno-27-85><span class=linenos data-linenos=" 85 "></span></a>    
</span><span id=__span-27-86><a id=__codelineno-27-86 name=__codelineno-27-86></a><a href=#__codelineno-27-86><span class=linenos data-linenos=" 86 "></span></a>    <span class=k>def</span> <span class=nf>setup_csrf_protection</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-27-87><a id=__codelineno-27-87 name=__codelineno-27-87></a><a href=#__codelineno-27-87><span class=linenos data-linenos=" 87 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Configure CSRF protection&quot;&quot;&quot;</span>
</span><span id=__span-27-88><a id=__codelineno-27-88 name=__codelineno-27-88></a><a href=#__codelineno-27-88><span class=linenos data-linenos=" 88 "></span></a>        <span class=nd>@self</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>before_request</span>
</span><span id=__span-27-89><a id=__codelineno-27-89 name=__codelineno-27-89></a><a href=#__codelineno-27-89><span class=linenos data-linenos=" 89 "></span></a>        <span class=k>def</span> <span class=nf>check_csrf</span><span class=p>():</span>
</span><span id=__span-27-90><a id=__codelineno-27-90 name=__codelineno-27-90></a><a href=#__codelineno-27-90><span class=linenos data-linenos=" 90 "></span></a>            <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>,</span> <span class=s1>&#39;PUT&#39;</span><span class=p>,</span> <span class=s1>&#39;DELETE&#39;</span><span class=p>,</span> <span class=s1>&#39;PATCH&#39;</span><span class=p>]:</span>
</span><span id=__span-27-91><a id=__codelineno-27-91 name=__codelineno-27-91></a><a href=#__codelineno-27-91><span class=linenos data-linenos=" 91 "></span></a>                <span class=n>token</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;csrf_token&#39;</span><span class=p>)</span> <span class=ow>or</span> <span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;X-CSRF-Token&#39;</span><span class=p>)</span>
</span><span id=__span-27-92><a id=__codelineno-27-92 name=__codelineno-27-92></a><a href=#__codelineno-27-92><span class=linenos data-linenos=" 92 "></span></a>                <span class=k>if</span> <span class=ow>not</span> <span class=n>token</span> <span class=ow>or</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>validate_csrf_token</span><span class=p>(</span><span class=n>token</span><span class=p>):</span>
</span><span id=__span-27-93><a id=__codelineno-27-93 name=__codelineno-27-93></a><a href=#__codelineno-27-93><span class=linenos data-linenos=" 93 "></span></a>                    <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=s1>&#39;CSRF token validation failed&#39;</span><span class=p>},</span> <span class=mi>403</span>
</span><span id=__span-27-94><a id=__codelineno-27-94 name=__codelineno-27-94></a><a href=#__codelineno-27-94><span class=linenos data-linenos=" 94 "></span></a>    
</span><span id=__span-27-95><a id=__codelineno-27-95 name=__codelineno-27-95></a><a href=#__codelineno-27-95><span class=linenos data-linenos=" 95 "></span></a>    <span class=k>def</span> <span class=nf>validate_csrf_token</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>token</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span><span id=__span-27-96><a id=__codelineno-27-96 name=__codelineno-27-96></a><a href=#__codelineno-27-96><span class=linenos data-linenos=" 96 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Validate CSRF token&quot;&quot;&quot;</span>
</span><span id=__span-27-97><a id=__codelineno-27-97 name=__codelineno-27-97></a><a href=#__codelineno-27-97><span class=linenos data-linenos=" 97 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-27-98><a id=__codelineno-27-98 name=__codelineno-27-98></a><a href=#__codelineno-27-98><span class=linenos data-linenos=" 98 "></span></a>            <span class=c1># Implement proper CSRF token validation</span>
</span><span id=__span-27-99><a id=__codelineno-27-99 name=__codelineno-27-99></a><a href=#__codelineno-27-99><span class=linenos data-linenos=" 99 "></span></a>            <span class=c1># This is a simplified example</span>
</span><span id=__span-27-100><a id=__codelineno-27-100 name=__codelineno-27-100></a><a href=#__codelineno-27-100><span class=linenos data-linenos="100 "></span></a>            <span class=n>expected_token</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span>
</span><span id=__span-27-101><a id=__codelineno-27-101 name=__codelineno-27-101></a><a href=#__codelineno-27-101><span class=linenos data-linenos="101 "></span></a>                <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>g</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;user_id&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;anonymous&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>app</span><span class=o>.</span><span class=n>secret_key</span><span class=si>}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span>
</span><span id=__span-27-102><a id=__codelineno-27-102 name=__codelineno-27-102></a><a href=#__codelineno-27-102><span class=linenos data-linenos="102 "></span></a>            <span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span><span id=__span-27-103><a id=__codelineno-27-103 name=__codelineno-27-103></a><a href=#__codelineno-27-103><span class=linenos data-linenos="103 "></span></a>            <span class=k>return</span> <span class=n>secrets</span><span class=o>.</span><span class=n>compare_digest</span><span class=p>(</span><span class=n>token</span><span class=p>,</span> <span class=n>expected_token</span><span class=p>)</span>
</span><span id=__span-27-104><a id=__codelineno-27-104 name=__codelineno-27-104></a><a href=#__codelineno-27-104><span class=linenos data-linenos="104 "></span></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-27-105><a id=__codelineno-27-105 name=__codelineno-27-105></a><a href=#__codelineno-27-105><span class=linenos data-linenos="105 "></span></a>            <span class=k>return</span> <span class=kc>False</span>
</span></code></pre></div><h2 id=compliance-auditing>Compliance &amp; Auditing<a class=headerlink href=#compliance-auditing title="Permanent link">&para;</a></h2><h3 id=soc-2-compliance>SOC 2 Compliance<a class=headerlink href=#soc-2-compliance title="Permanent link">&para;</a></h3><div class="language-yaml highlight"><span class=filename>YAML</span><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1></a><a href=#__codelineno-28-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># compliance/soc2-controls.yml</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2></a><a href=#__codelineno-28-2><span class=linenos data-linenos=" 2 "></span></a><span class=nt>soc2_controls</span><span class=p>:</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3></a><a href=#__codelineno-28-3><span class=linenos data-linenos=" 3 "></span></a><span class=w>  </span><span class=nt>cc1_control_environment</span><span class=p>:</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4></a><a href=#__codelineno-28-4><span class=linenos data-linenos=" 4 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Security</span><span class=nv> </span><span class=s>Policies&quot;</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5></a><a href=#__codelineno-28-5><span class=linenos data-linenos=" 5 "></span></a><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Documented</span><span class=nv> </span><span class=s>security</span><span class=nv> </span><span class=s>policies</span><span class=nv> </span><span class=s>and</span><span class=nv> </span><span class=s>procedures&quot;</span>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6></a><a href=#__codelineno-28-6><span class=linenos data-linenos=" 6 "></span></a><span class=w>      </span><span class=nt>implementation</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Security</span><span class=nv> </span><span class=s>policy</span><span class=nv> </span><span class=s>documentation</span><span class=nv> </span><span class=s>in</span><span class=nv> </span><span class=s>/docs/security/&quot;</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7></a><a href=#__codelineno-28-7><span class=linenos data-linenos=" 7 "></span></a><span class=w>      </span><span class=nt>evidence</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Policy</span><span class=nv> </span><span class=s>documents,</span><span class=nv> </span><span class=s>training</span><span class=nv> </span><span class=s>records&quot;</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8></a><a href=#__codelineno-28-8><span class=linenos data-linenos=" 8 "></span></a><span class=w>      </span>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9></a><a href=#__codelineno-28-9><span class=linenos data-linenos=" 9 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Access</span><span class=nv> </span><span class=s>Controls&quot;</span>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10></a><a href=#__codelineno-28-10><span class=linenos data-linenos="10 "></span></a><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Role-based</span><span class=nv> </span><span class=s>access</span><span class=nv> </span><span class=s>control</span><span class=nv> </span><span class=s>implementation&quot;</span>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11></a><a href=#__codelineno-28-11><span class=linenos data-linenos="11 "></span></a><span class=w>      </span><span class=nt>implementation</span><span class=p>:</span><span class=w> </span><span class=s>&quot;RBAC</span><span class=nv> </span><span class=s>in</span><span class=nv> </span><span class=s>lib/auth.py</span><span class=nv> </span><span class=s>with</span><span class=nv> </span><span class=s>Discord</span><span class=nv> </span><span class=s>integration&quot;</span>
</span><span id=__span-28-12><a id=__codelineno-28-12 name=__codelineno-28-12></a><a href=#__codelineno-28-12><span class=linenos data-linenos="12 "></span></a><span class=w>      </span><span class=nt>evidence</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Access</span><span class=nv> </span><span class=s>logs,</span><span class=nv> </span><span class=s>role</span><span class=nv> </span><span class=s>assignments&quot;</span>
</span><span id=__span-28-13><a id=__codelineno-28-13 name=__codelineno-28-13></a><a href=#__codelineno-28-13><span class=linenos data-linenos="13 "></span></a><span class=w>      </span>
</span><span id=__span-28-14><a id=__codelineno-28-14 name=__codelineno-28-14></a><a href=#__codelineno-28-14><span class=linenos data-linenos="14 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Risk</span><span class=nv> </span><span class=s>Assessment&quot;</span>
</span><span id=__span-28-15><a id=__codelineno-28-15 name=__codelineno-28-15></a><a href=#__codelineno-28-15><span class=linenos data-linenos="15 "></span></a><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Regular</span><span class=nv> </span><span class=s>security</span><span class=nv> </span><span class=s>risk</span><span class=nv> </span><span class=s>assessments&quot;</span>
</span><span id=__span-28-16><a id=__codelineno-28-16 name=__codelineno-28-16></a><a href=#__codelineno-28-16><span class=linenos data-linenos="16 "></span></a><span class=w>      </span><span class=nt>implementation</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Quarterly</span><span class=nv> </span><span class=s>security</span><span class=nv> </span><span class=s>reviews</span><span class=nv> </span><span class=s>and</span><span class=nv> </span><span class=s>vulnerability</span><span class=nv> </span><span class=s>scans&quot;</span>
</span><span id=__span-28-17><a id=__codelineno-28-17 name=__codelineno-28-17></a><a href=#__codelineno-28-17><span class=linenos data-linenos="17 "></span></a><span class=w>      </span><span class=nt>evidence</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Risk</span><span class=nv> </span><span class=s>assessment</span><span class=nv> </span><span class=s>reports,</span><span class=nv> </span><span class=s>scan</span><span class=nv> </span><span class=s>results&quot;</span>
</span><span id=__span-28-18><a id=__codelineno-28-18 name=__codelineno-28-18></a><a href=#__codelineno-28-18><span class=linenos data-linenos="18 "></span></a>
</span><span id=__span-28-19><a id=__codelineno-28-19 name=__codelineno-28-19></a><a href=#__codelineno-28-19><span class=linenos data-linenos="19 "></span></a><span class=w>  </span><span class=nt>cc2_communication</span><span class=p>:</span>
</span><span id=__span-28-20><a id=__codelineno-28-20 name=__codelineno-28-20></a><a href=#__codelineno-28-20><span class=linenos data-linenos="20 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Security</span><span class=nv> </span><span class=s>Awareness&quot;</span>
</span><span id=__span-28-21><a id=__codelineno-28-21 name=__codelineno-28-21></a><a href=#__codelineno-28-21><span class=linenos data-linenos="21 "></span></a><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Security</span><span class=nv> </span><span class=s>awareness</span><span class=nv> </span><span class=s>training</span><span class=nv> </span><span class=s>for</span><span class=nv> </span><span class=s>team</span><span class=nv> </span><span class=s>members&quot;</span>
</span><span id=__span-28-22><a id=__codelineno-28-22 name=__codelineno-28-22></a><a href=#__codelineno-28-22><span class=linenos data-linenos="22 "></span></a><span class=w>      </span><span class=nt>implementation</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Monthly</span><span class=nv> </span><span class=s>security</span><span class=nv> </span><span class=s>training</span><span class=nv> </span><span class=s>sessions&quot;</span>
</span><span id=__span-28-23><a id=__codelineno-28-23 name=__codelineno-28-23></a><a href=#__codelineno-28-23><span class=linenos data-linenos="23 "></span></a><span class=w>      </span><span class=nt>evidence</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Training</span><span class=nv> </span><span class=s>materials,</span><span class=nv> </span><span class=s>completion</span><span class=nv> </span><span class=s>records&quot;</span>
</span><span id=__span-28-24><a id=__codelineno-28-24 name=__codelineno-28-24></a><a href=#__codelineno-28-24><span class=linenos data-linenos="24 "></span></a><span class=w>      </span>
</span><span id=__span-28-25><a id=__codelineno-28-25 name=__codelineno-28-25></a><a href=#__codelineno-28-25><span class=linenos data-linenos="25 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Incident</span><span class=nv> </span><span class=s>Communication&quot;</span>
</span><span id=__span-28-26><a id=__codelineno-28-26 name=__codelineno-28-26></a><a href=#__codelineno-28-26><span class=linenos data-linenos="26 "></span></a><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Incident</span><span class=nv> </span><span class=s>response</span><span class=nv> </span><span class=s>communication</span><span class=nv> </span><span class=s>procedures&quot;</span>
</span><span id=__span-28-27><a id=__codelineno-28-27 name=__codelineno-28-27></a><a href=#__codelineno-28-27><span class=linenos data-linenos="27 "></span></a><span class=w>      </span><span class=nt>implementation</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Incident</span><span class=nv> </span><span class=s>response</span><span class=nv> </span><span class=s>playbook</span><span class=nv> </span><span class=s>in</span><span class=nv> </span><span class=s>/docs/incident-response/&quot;</span>
</span><span id=__span-28-28><a id=__codelineno-28-28 name=__codelineno-28-28></a><a href=#__codelineno-28-28><span class=linenos data-linenos="28 "></span></a><span class=w>      </span><span class=nt>evidence</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Incident</span><span class=nv> </span><span class=s>reports,</span><span class=nv> </span><span class=s>communication</span><span class=nv> </span><span class=s>logs&quot;</span>
</span><span id=__span-28-29><a id=__codelineno-28-29 name=__codelineno-28-29></a><a href=#__codelineno-28-29><span class=linenos data-linenos="29 "></span></a>
</span><span id=__span-28-30><a id=__codelineno-28-30 name=__codelineno-28-30></a><a href=#__codelineno-28-30><span class=linenos data-linenos="30 "></span></a><span class=w>  </span><span class=nt>cc3_risk_assessment</span><span class=p>:</span>
</span><span id=__span-28-31><a id=__codelineno-28-31 name=__codelineno-28-31></a><a href=#__codelineno-28-31><span class=linenos data-linenos="31 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Threat</span><span class=nv> </span><span class=s>Modeling&quot;</span>
</span><span id=__span-28-32><a id=__codelineno-28-32 name=__codelineno-28-32></a><a href=#__codelineno-28-32><span class=linenos data-linenos="32 "></span></a><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Regular</span><span class=nv> </span><span class=s>threat</span><span class=nv> </span><span class=s>modeling</span><span class=nv> </span><span class=s>exercises&quot;</span>
</span><span id=__span-28-33><a id=__codelineno-28-33 name=__codelineno-28-33></a><a href=#__codelineno-28-33><span class=linenos data-linenos="33 "></span></a><span class=w>      </span><span class=nt>implementation</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Quarterly</span><span class=nv> </span><span class=s>threat</span><span class=nv> </span><span class=s>modeling</span><span class=nv> </span><span class=s>sessions&quot;</span>
</span><span id=__span-28-34><a id=__codelineno-28-34 name=__codelineno-28-34></a><a href=#__codelineno-28-34><span class=linenos data-linenos="34 "></span></a><span class=w>      </span><span class=nt>evidence</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Threat</span><span class=nv> </span><span class=s>model</span><span class=nv> </span><span class=s>documents,</span><span class=nv> </span><span class=s>mitigation</span><span class=nv> </span><span class=s>plans&quot;</span>
</span><span id=__span-28-35><a id=__codelineno-28-35 name=__codelineno-28-35></a><a href=#__codelineno-28-35><span class=linenos data-linenos="35 "></span></a><span class=w>      </span>
</span><span id=__span-28-36><a id=__codelineno-28-36 name=__codelineno-28-36></a><a href=#__codelineno-28-36><span class=linenos data-linenos="36 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Vulnerability</span><span class=nv> </span><span class=s>Management&quot;</span>
</span><span id=__span-28-37><a id=__codelineno-28-37 name=__codelineno-28-37></a><a href=#__codelineno-28-37><span class=linenos data-linenos="37 "></span></a><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Continuous</span><span class=nv> </span><span class=s>vulnerability</span><span class=nv> </span><span class=s>scanning</span><span class=nv> </span><span class=s>and</span><span class=nv> </span><span class=s>remediation&quot;</span>
</span><span id=__span-28-38><a id=__codelineno-28-38 name=__codelineno-28-38></a><a href=#__codelineno-28-38><span class=linenos data-linenos="38 "></span></a><span class=w>      </span><span class=nt>implementation</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Automated</span><span class=nv> </span><span class=s>vulnerability</span><span class=nv> </span><span class=s>scanning</span><span class=nv> </span><span class=s>with</span><span class=nv> </span><span class=s>Nessus/OpenVAS&quot;</span>
</span><span id=__span-28-39><a id=__codelineno-28-39 name=__codelineno-28-39></a><a href=#__codelineno-28-39><span class=linenos data-linenos="39 "></span></a><span class=w>      </span><span class=nt>evidence</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Scan</span><span class=nv> </span><span class=s>reports,</span><span class=nv> </span><span class=s>remediation</span><span class=nv> </span><span class=s>tracking&quot;</span>
</span><span id=__span-28-40><a id=__codelineno-28-40 name=__codelineno-28-40></a><a href=#__codelineno-28-40><span class=linenos data-linenos="40 "></span></a>
</span><span id=__span-28-41><a id=__codelineno-28-41 name=__codelineno-28-41></a><a href=#__codelineno-28-41><span class=linenos data-linenos="41 "></span></a><span class=w>  </span><span class=nt>cc4_monitoring</span><span class=p>:</span>
</span><span id=__span-28-42><a id=__codelineno-28-42 name=__codelineno-28-42></a><a href=#__codelineno-28-42><span class=linenos data-linenos="42 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Security</span><span class=nv> </span><span class=s>Monitoring&quot;</span>
</span><span id=__span-28-43><a id=__codelineno-28-43 name=__codelineno-28-43></a><a href=#__codelineno-28-43><span class=linenos data-linenos="43 "></span></a><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;24/7</span><span class=nv> </span><span class=s>security</span><span class=nv> </span><span class=s>monitoring</span><span class=nv> </span><span class=s>and</span><span class=nv> </span><span class=s>alerting&quot;</span>
</span><span id=__span-28-44><a id=__codelineno-28-44 name=__codelineno-28-44></a><a href=#__codelineno-28-44><span class=linenos data-linenos="44 "></span></a><span class=w>      </span><span class=nt>implementation</span><span class=p>:</span><span class=w> </span><span class=s>&quot;SIEM</span><span class=nv> </span><span class=s>integration</span><span class=nv> </span><span class=s>with</span><span class=nv> </span><span class=s>Splunk/ELK</span><span class=nv> </span><span class=s>stack&quot;</span>
</span><span id=__span-28-45><a id=__codelineno-28-45 name=__codelineno-28-45></a><a href=#__codelineno-28-45><span class=linenos data-linenos="45 "></span></a><span class=w>      </span><span class=nt>evidence</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Monitoring</span><span class=nv> </span><span class=s>logs,</span><span class=nv> </span><span class=s>alert</span><span class=nv> </span><span class=s>configurations&quot;</span>
</span><span id=__span-28-46><a id=__codelineno-28-46 name=__codelineno-28-46></a><a href=#__codelineno-28-46><span class=linenos data-linenos="46 "></span></a><span class=w>      </span>
</span><span id=__span-28-47><a id=__codelineno-28-47 name=__codelineno-28-47></a><a href=#__codelineno-28-47><span class=linenos data-linenos="47 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Audit</span><span class=nv> </span><span class=s>Logging&quot;</span>
</span><span id=__span-28-48><a id=__codelineno-28-48 name=__codelineno-28-48></a><a href=#__codelineno-28-48><span class=linenos data-linenos="48 "></span></a><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Comprehensive</span><span class=nv> </span><span class=s>audit</span><span class=nv> </span><span class=s>logging&quot;</span>
</span><span id=__span-28-49><a id=__codelineno-28-49 name=__codelineno-28-49></a><a href=#__codelineno-28-49><span class=linenos data-linenos="49 "></span></a><span class=w>      </span><span class=nt>implementation</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Centralized</span><span class=nv> </span><span class=s>logging</span><span class=nv> </span><span class=s>with</span><span class=nv> </span><span class=s>immutable</span><span class=nv> </span><span class=s>audit</span><span class=nv> </span><span class=s>trails&quot;</span>
</span><span id=__span-28-50><a id=__codelineno-28-50 name=__codelineno-28-50></a><a href=#__codelineno-28-50><span class=linenos data-linenos="50 "></span></a><span class=w>      </span><span class=nt>evidence</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Log</span><span class=nv> </span><span class=s>retention</span><span class=nv> </span><span class=s>policies,</span><span class=nv> </span><span class=s>audit</span><span class=nv> </span><span class=s>reports&quot;</span>
</span><span id=__span-28-51><a id=__codelineno-28-51 name=__codelineno-28-51></a><a href=#__codelineno-28-51><span class=linenos data-linenos="51 "></span></a>
</span><span id=__span-28-52><a id=__codelineno-28-52 name=__codelineno-28-52></a><a href=#__codelineno-28-52><span class=linenos data-linenos="52 "></span></a><span class=w>  </span><span class=nt>cc5_logical_access</span><span class=p>:</span>
</span><span id=__span-28-53><a id=__codelineno-28-53 name=__codelineno-28-53></a><a href=#__codelineno-28-53><span class=linenos data-linenos="53 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;User</span><span class=nv> </span><span class=s>Provisioning&quot;</span>
</span><span id=__span-28-54><a id=__codelineno-28-54 name=__codelineno-28-54></a><a href=#__codelineno-28-54><span class=linenos data-linenos="54 "></span></a><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Automated</span><span class=nv> </span><span class=s>user</span><span class=nv> </span><span class=s>provisioning</span><span class=nv> </span><span class=s>and</span><span class=nv> </span><span class=s>deprovisioning&quot;</span>
</span><span id=__span-28-55><a id=__codelineno-28-55 name=__codelineno-28-55></a><a href=#__codelineno-28-55><span class=linenos data-linenos="55 "></span></a><span class=w>      </span><span class=nt>implementation</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Identity</span><span class=nv> </span><span class=s>management</span><span class=nv> </span><span class=s>with</span><span class=nv> </span><span class=s>SCIM</span><span class=nv> </span><span class=s>integration&quot;</span>
</span><span id=__span-28-56><a id=__codelineno-28-56 name=__codelineno-28-56></a><a href=#__codelineno-28-56><span class=linenos data-linenos="56 "></span></a><span class=w>      </span><span class=nt>evidence</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Provisioning</span><span class=nv> </span><span class=s>logs,</span><span class=nv> </span><span class=s>access</span><span class=nv> </span><span class=s>reviews&quot;</span>
</span><span id=__span-28-57><a id=__codelineno-28-57 name=__codelineno-28-57></a><a href=#__codelineno-28-57><span class=linenos data-linenos="57 "></span></a><span class=w>      </span>
</span><span id=__span-28-58><a id=__codelineno-28-58 name=__codelineno-28-58></a><a href=#__codelineno-28-58><span class=linenos data-linenos="58 "></span></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Privileged</span><span class=nv> </span><span class=s>Access&quot;</span>
</span><span id=__span-28-59><a id=__codelineno-28-59 name=__codelineno-28-59></a><a href=#__codelineno-28-59><span class=linenos data-linenos="59 "></span></a><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Privileged</span><span class=nv> </span><span class=s>access</span><span class=nv> </span><span class=s>management&quot;</span>
</span><span id=__span-28-60><a id=__codelineno-28-60 name=__codelineno-28-60></a><a href=#__codelineno-28-60><span class=linenos data-linenos="60 "></span></a><span class=w>      </span><span class=nt>implementation</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Just-in-time</span><span class=nv> </span><span class=s>privileged</span><span class=nv> </span><span class=s>access</span><span class=nv> </span><span class=s>with</span><span class=nv> </span><span class=s>HashiCorp</span><span class=nv> </span><span class=s>Vault&quot;</span>
</span><span id=__span-28-61><a id=__codelineno-28-61 name=__codelineno-28-61></a><a href=#__codelineno-28-61><span class=linenos data-linenos="61 "></span></a><span class=w>      </span><span class=nt>evidence</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Access</span><span class=nv> </span><span class=s>logs,</span><span class=nv> </span><span class=s>privilege</span><span class=nv> </span><span class=s>escalation</span><span class=nv> </span><span class=s>records&quot;</span>
</span></code></pre></div><h3 id=audit-logging-implementation>Audit Logging Implementation<a class=headerlink href=#audit-logging-implementation title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1></a><a href=#__codelineno-29-1><span class=linenos data-linenos="  1 "></span></a><span class=c1># lib/audit_logger.py</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2></a><a href=#__codelineno-29-2><span class=linenos data-linenos="  2 "></span></a><span class=kn>import</span> <span class=nn>json</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3></a><a href=#__codelineno-29-3><span class=linenos data-linenos="  3 "></span></a><span class=kn>import</span> <span class=nn>time</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4></a><a href=#__codelineno-29-4><span class=linenos data-linenos="  4 "></span></a><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5></a><a href=#__codelineno-29-5><span class=linenos data-linenos="  5 "></span></a><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Optional</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6></a><a href=#__codelineno-29-6><span class=linenos data-linenos="  6 "></span></a><span class=kn>from</span> <span class=nn>cryptography.fernet</span> <span class=kn>import</span> <span class=n>Fernet</span>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7></a><a href=#__codelineno-29-7><span class=linenos data-linenos="  7 "></span></a><span class=kn>import</span> <span class=nn>hashlib</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8></a><a href=#__codelineno-29-8><span class=linenos data-linenos="  8 "></span></a>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9></a><a href=#__codelineno-29-9><span class=linenos data-linenos="  9 "></span></a><span class=k>class</span> <span class=nc>AuditLogger</span><span class=p>:</span>
</span><span id=__span-29-10><a id=__codelineno-29-10 name=__codelineno-29-10></a><a href=#__codelineno-29-10><span class=linenos data-linenos=" 10 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Secure audit logging with encryption and integrity verification&quot;&quot;&quot;</span>
</span><span id=__span-29-11><a id=__codelineno-29-11 name=__codelineno-29-11></a><a href=#__codelineno-29-11><span class=linenos data-linenos=" 11 "></span></a>    
</span><span id=__span-29-12><a id=__codelineno-29-12 name=__codelineno-29-12></a><a href=#__codelineno-29-12><span class=linenos data-linenos=" 12 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>encryption_key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>log_file</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;/var/log/agent-workflow/audit.log&quot;</span><span class=p>):</span>
</span><span id=__span-29-13><a id=__codelineno-29-13 name=__codelineno-29-13></a><a href=#__codelineno-29-13><span class=linenos data-linenos=" 13 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>fernet</span> <span class=o>=</span> <span class=n>Fernet</span><span class=p>(</span><span class=n>encryption_key</span><span class=p>)</span>
</span><span id=__span-29-14><a id=__codelineno-29-14 name=__codelineno-29-14></a><a href=#__codelineno-29-14><span class=linenos data-linenos=" 14 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>log_file</span> <span class=o>=</span> <span class=n>log_file</span>
</span><span id=__span-29-15><a id=__codelineno-29-15 name=__codelineno-29-15></a><a href=#__codelineno-29-15><span class=linenos data-linenos=" 15 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>sequence_number</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-29-16><a id=__codelineno-29-16 name=__codelineno-29-16></a><a href=#__codelineno-29-16><span class=linenos data-linenos=" 16 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>last_hash</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-29-17><a id=__codelineno-29-17 name=__codelineno-29-17></a><a href=#__codelineno-29-17><span class=linenos data-linenos=" 17 "></span></a>    
</span><span id=__span-29-18><a id=__codelineno-29-18 name=__codelineno-29-18></a><a href=#__codelineno-29-18><span class=linenos data-linenos=" 18 "></span></a>    <span class=k>def</span> <span class=nf>log_event</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>details</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> 
</span><span id=__span-29-19><a id=__codelineno-29-19 name=__codelineno-29-19></a><a href=#__codelineno-29-19><span class=linenos data-linenos=" 19 "></span></a>                  <span class=n>sensitive_data</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span><span id=__span-29-20><a id=__codelineno-29-20 name=__codelineno-29-20></a><a href=#__codelineno-29-20><span class=linenos data-linenos=" 20 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Log audit event with encryption and chaining&quot;&quot;&quot;</span>
</span><span id=__span-29-21><a id=__codelineno-29-21 name=__codelineno-29-21></a><a href=#__codelineno-29-21><span class=linenos data-linenos=" 21 "></span></a>        
</span><span id=__span-29-22><a id=__codelineno-29-22 name=__codelineno-29-22></a><a href=#__codelineno-29-22><span class=linenos data-linenos=" 22 "></span></a>        <span class=c1># Create audit record</span>
</span><span id=__span-29-23><a id=__codelineno-29-23 name=__codelineno-29-23></a><a href=#__codelineno-29-23><span class=linenos data-linenos=" 23 "></span></a>        <span class=n>audit_record</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-29-24><a id=__codelineno-29-24 name=__codelineno-29-24></a><a href=#__codelineno-29-24><span class=linenos data-linenos=" 24 "></span></a>            <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span><span id=__span-29-25><a id=__codelineno-29-25 name=__codelineno-29-25></a><a href=#__codelineno-29-25><span class=linenos data-linenos=" 25 "></span></a>            <span class=s1>&#39;sequence_number&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>sequence_number</span><span class=p>,</span>
</span><span id=__span-29-26><a id=__codelineno-29-26 name=__codelineno-29-26></a><a href=#__codelineno-29-26><span class=linenos data-linenos=" 26 "></span></a>            <span class=s1>&#39;event_type&#39;</span><span class=p>:</span> <span class=n>event_type</span><span class=p>,</span>
</span><span id=__span-29-27><a id=__codelineno-29-27 name=__codelineno-29-27></a><a href=#__codelineno-29-27><span class=linenos data-linenos=" 27 "></span></a>            <span class=s1>&#39;user_id&#39;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span>
</span><span id=__span-29-28><a id=__codelineno-29-28 name=__codelineno-29-28></a><a href=#__codelineno-29-28><span class=linenos data-linenos=" 28 "></span></a>            <span class=s1>&#39;details&#39;</span><span class=p>:</span> <span class=n>details</span><span class=p>,</span>
</span><span id=__span-29-29><a id=__codelineno-29-29 name=__codelineno-29-29></a><a href=#__codelineno-29-29><span class=linenos data-linenos=" 29 "></span></a>            <span class=s1>&#39;session_id&#39;</span><span class=p>:</span> <span class=n>details</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;session_id&#39;</span><span class=p>),</span>
</span><span id=__span-29-30><a id=__codelineno-29-30 name=__codelineno-29-30></a><a href=#__codelineno-29-30><span class=linenos data-linenos=" 30 "></span></a>            <span class=s1>&#39;ip_address&#39;</span><span class=p>:</span> <span class=n>details</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;ip_address&#39;</span><span class=p>),</span>
</span><span id=__span-29-31><a id=__codelineno-29-31 name=__codelineno-29-31></a><a href=#__codelineno-29-31><span class=linenos data-linenos=" 31 "></span></a>            <span class=s1>&#39;user_agent&#39;</span><span class=p>:</span> <span class=n>details</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;user_agent&#39;</span><span class=p>),</span>
</span><span id=__span-29-32><a id=__codelineno-29-32 name=__codelineno-29-32></a><a href=#__codelineno-29-32><span class=linenos data-linenos=" 32 "></span></a>            <span class=s1>&#39;previous_hash&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_hash</span>
</span><span id=__span-29-33><a id=__codelineno-29-33 name=__codelineno-29-33></a><a href=#__codelineno-29-33><span class=linenos data-linenos=" 33 "></span></a>        <span class=p>}</span>
</span><span id=__span-29-34><a id=__codelineno-29-34 name=__codelineno-29-34></a><a href=#__codelineno-29-34><span class=linenos data-linenos=" 34 "></span></a>        
</span><span id=__span-29-35><a id=__codelineno-29-35 name=__codelineno-29-35></a><a href=#__codelineno-29-35><span class=linenos data-linenos=" 35 "></span></a>        <span class=c1># Encrypt sensitive data if provided</span>
</span><span id=__span-29-36><a id=__codelineno-29-36 name=__codelineno-29-36></a><a href=#__codelineno-29-36><span class=linenos data-linenos=" 36 "></span></a>        <span class=k>if</span> <span class=n>sensitive_data</span><span class=p>:</span>
</span><span id=__span-29-37><a id=__codelineno-29-37 name=__codelineno-29-37></a><a href=#__codelineno-29-37><span class=linenos data-linenos=" 37 "></span></a>            <span class=n>encrypted_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>fernet</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>sensitive_data</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
</span><span id=__span-29-38><a id=__codelineno-29-38 name=__codelineno-29-38></a><a href=#__codelineno-29-38><span class=linenos data-linenos=" 38 "></span></a>            <span class=n>audit_record</span><span class=p>[</span><span class=s1>&#39;encrypted_data&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>encrypted_data</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span><span id=__span-29-39><a id=__codelineno-29-39 name=__codelineno-29-39></a><a href=#__codelineno-29-39><span class=linenos data-linenos=" 39 "></span></a>        
</span><span id=__span-29-40><a id=__codelineno-29-40 name=__codelineno-29-40></a><a href=#__codelineno-29-40><span class=linenos data-linenos=" 40 "></span></a>        <span class=c1># Calculate hash for integrity</span>
</span><span id=__span-29-41><a id=__codelineno-29-41 name=__codelineno-29-41></a><a href=#__codelineno-29-41><span class=linenos data-linenos=" 41 "></span></a>        <span class=n>record_json</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>audit_record</span><span class=p>,</span> <span class=n>sort_keys</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-29-42><a id=__codelineno-29-42 name=__codelineno-29-42></a><a href=#__codelineno-29-42><span class=linenos data-linenos=" 42 "></span></a>        <span class=n>current_hash</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>record_json</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span><span id=__span-29-43><a id=__codelineno-29-43 name=__codelineno-29-43></a><a href=#__codelineno-29-43><span class=linenos data-linenos=" 43 "></span></a>        <span class=n>audit_record</span><span class=p>[</span><span class=s1>&#39;record_hash&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>current_hash</span>
</span><span id=__span-29-44><a id=__codelineno-29-44 name=__codelineno-29-44></a><a href=#__codelineno-29-44><span class=linenos data-linenos=" 44 "></span></a>        
</span><span id=__span-29-45><a id=__codelineno-29-45 name=__codelineno-29-45></a><a href=#__codelineno-29-45><span class=linenos data-linenos=" 45 "></span></a>        <span class=c1># Write to log file</span>
</span><span id=__span-29-46><a id=__codelineno-29-46 name=__codelineno-29-46></a><a href=#__codelineno-29-46><span class=linenos data-linenos=" 46 "></span></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>log_file</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-29-47><a id=__codelineno-29-47 name=__codelineno-29-47></a><a href=#__codelineno-29-47><span class=linenos data-linenos=" 47 "></span></a>            <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>audit_record</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span><span id=__span-29-48><a id=__codelineno-29-48 name=__codelineno-29-48></a><a href=#__codelineno-29-48><span class=linenos data-linenos=" 48 "></span></a>        
</span><span id=__span-29-49><a id=__codelineno-29-49 name=__codelineno-29-49></a><a href=#__codelineno-29-49><span class=linenos data-linenos=" 49 "></span></a>        <span class=c1># Update sequence and hash</span>
</span><span id=__span-29-50><a id=__codelineno-29-50 name=__codelineno-29-50></a><a href=#__codelineno-29-50><span class=linenos data-linenos=" 50 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>sequence_number</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-29-51><a id=__codelineno-29-51 name=__codelineno-29-51></a><a href=#__codelineno-29-51><span class=linenos data-linenos=" 51 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>last_hash</span> <span class=o>=</span> <span class=n>current_hash</span>
</span><span id=__span-29-52><a id=__codelineno-29-52 name=__codelineno-29-52></a><a href=#__codelineno-29-52><span class=linenos data-linenos=" 52 "></span></a>    
</span><span id=__span-29-53><a id=__codelineno-29-53 name=__codelineno-29-53></a><a href=#__codelineno-29-53><span class=linenos data-linenos=" 53 "></span></a>    <span class=k>def</span> <span class=nf>log_authentication</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>success</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span> <span class=n>ip_address</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span><span id=__span-29-54><a id=__codelineno-29-54 name=__codelineno-29-54></a><a href=#__codelineno-29-54><span class=linenos data-linenos=" 54 "></span></a>                          <span class=n>user_agent</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-29-55><a id=__codelineno-29-55 name=__codelineno-29-55></a><a href=#__codelineno-29-55><span class=linenos data-linenos=" 55 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Log authentication events&quot;&quot;&quot;</span>
</span><span id=__span-29-56><a id=__codelineno-29-56 name=__codelineno-29-56></a><a href=#__codelineno-29-56><span class=linenos data-linenos=" 56 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>log_event</span><span class=p>(</span>
</span><span id=__span-29-57><a id=__codelineno-29-57 name=__codelineno-29-57></a><a href=#__codelineno-29-57><span class=linenos data-linenos=" 57 "></span></a>            <span class=n>event_type</span><span class=o>=</span><span class=s1>&#39;authentication&#39;</span><span class=p>,</span>
</span><span id=__span-29-58><a id=__codelineno-29-58 name=__codelineno-29-58></a><a href=#__codelineno-29-58><span class=linenos data-linenos=" 58 "></span></a>            <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>,</span>
</span><span id=__span-29-59><a id=__codelineno-29-59 name=__codelineno-29-59></a><a href=#__codelineno-29-59><span class=linenos data-linenos=" 59 "></span></a>            <span class=n>details</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-29-60><a id=__codelineno-29-60 name=__codelineno-29-60></a><a href=#__codelineno-29-60><span class=linenos data-linenos=" 60 "></span></a>                <span class=s1>&#39;success&#39;</span><span class=p>:</span> <span class=n>success</span><span class=p>,</span>
</span><span id=__span-29-61><a id=__codelineno-29-61 name=__codelineno-29-61></a><a href=#__codelineno-29-61><span class=linenos data-linenos=" 61 "></span></a>                <span class=s1>&#39;ip_address&#39;</span><span class=p>:</span> <span class=n>ip_address</span><span class=p>,</span>
</span><span id=__span-29-62><a id=__codelineno-29-62 name=__codelineno-29-62></a><a href=#__codelineno-29-62><span class=linenos data-linenos=" 62 "></span></a>                <span class=s1>&#39;user_agent&#39;</span><span class=p>:</span> <span class=n>user_agent</span><span class=p>,</span>
</span><span id=__span-29-63><a id=__codelineno-29-63 name=__codelineno-29-63></a><a href=#__codelineno-29-63><span class=linenos data-linenos=" 63 "></span></a>                <span class=s1>&#39;session_id&#39;</span><span class=p>:</span> <span class=n>session_id</span><span class=p>,</span>
</span><span id=__span-29-64><a id=__codelineno-29-64 name=__codelineno-29-64></a><a href=#__codelineno-29-64><span class=linenos data-linenos=" 64 "></span></a>                <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-29-65><a id=__codelineno-29-65 name=__codelineno-29-65></a><a href=#__codelineno-29-65><span class=linenos data-linenos=" 65 "></span></a>            <span class=p>}</span>
</span><span id=__span-29-66><a id=__codelineno-29-66 name=__codelineno-29-66></a><a href=#__codelineno-29-66><span class=linenos data-linenos=" 66 "></span></a>        <span class=p>)</span>
</span><span id=__span-29-67><a id=__codelineno-29-67 name=__codelineno-29-67></a><a href=#__codelineno-29-67><span class=linenos data-linenos=" 67 "></span></a>    
</span><span id=__span-29-68><a id=__codelineno-29-68 name=__codelineno-29-68></a><a href=#__codelineno-29-68><span class=linenos data-linenos=" 68 "></span></a>    <span class=k>def</span> <span class=nf>log_authorization</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>resource</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>action</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span><span id=__span-29-69><a id=__codelineno-29-69 name=__codelineno-29-69></a><a href=#__codelineno-29-69><span class=linenos data-linenos=" 69 "></span></a>                         <span class=n>granted</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span> <span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-29-70><a id=__codelineno-29-70 name=__codelineno-29-70></a><a href=#__codelineno-29-70><span class=linenos data-linenos=" 70 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Log authorization events&quot;&quot;&quot;</span>
</span><span id=__span-29-71><a id=__codelineno-29-71 name=__codelineno-29-71></a><a href=#__codelineno-29-71><span class=linenos data-linenos=" 71 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>log_event</span><span class=p>(</span>
</span><span id=__span-29-72><a id=__codelineno-29-72 name=__codelineno-29-72></a><a href=#__codelineno-29-72><span class=linenos data-linenos=" 72 "></span></a>            <span class=n>event_type</span><span class=o>=</span><span class=s1>&#39;authorization&#39;</span><span class=p>,</span>
</span><span id=__span-29-73><a id=__codelineno-29-73 name=__codelineno-29-73></a><a href=#__codelineno-29-73><span class=linenos data-linenos=" 73 "></span></a>            <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>,</span>
</span><span id=__span-29-74><a id=__codelineno-29-74 name=__codelineno-29-74></a><a href=#__codelineno-29-74><span class=linenos data-linenos=" 74 "></span></a>            <span class=n>details</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-29-75><a id=__codelineno-29-75 name=__codelineno-29-75></a><a href=#__codelineno-29-75><span class=linenos data-linenos=" 75 "></span></a>                <span class=s1>&#39;resource&#39;</span><span class=p>:</span> <span class=n>resource</span><span class=p>,</span>
</span><span id=__span-29-76><a id=__codelineno-29-76 name=__codelineno-29-76></a><a href=#__codelineno-29-76><span class=linenos data-linenos=" 76 "></span></a>                <span class=s1>&#39;action&#39;</span><span class=p>:</span> <span class=n>action</span><span class=p>,</span>
</span><span id=__span-29-77><a id=__codelineno-29-77 name=__codelineno-29-77></a><a href=#__codelineno-29-77><span class=linenos data-linenos=" 77 "></span></a>                <span class=s1>&#39;granted&#39;</span><span class=p>:</span> <span class=n>granted</span><span class=p>,</span>
</span><span id=__span-29-78><a id=__codelineno-29-78 name=__codelineno-29-78></a><a href=#__codelineno-29-78><span class=linenos data-linenos=" 78 "></span></a>                <span class=s1>&#39;session_id&#39;</span><span class=p>:</span> <span class=n>session_id</span><span class=p>,</span>
</span><span id=__span-29-79><a id=__codelineno-29-79 name=__codelineno-29-79></a><a href=#__codelineno-29-79><span class=linenos data-linenos=" 79 "></span></a>                <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-29-80><a id=__codelineno-29-80 name=__codelineno-29-80></a><a href=#__codelineno-29-80><span class=linenos data-linenos=" 80 "></span></a>            <span class=p>}</span>
</span><span id=__span-29-81><a id=__codelineno-29-81 name=__codelineno-29-81></a><a href=#__codelineno-29-81><span class=linenos data-linenos=" 81 "></span></a>        <span class=p>)</span>
</span><span id=__span-29-82><a id=__codelineno-29-82 name=__codelineno-29-82></a><a href=#__codelineno-29-82><span class=linenos data-linenos=" 82 "></span></a>    
</span><span id=__span-29-83><a id=__codelineno-29-83 name=__codelineno-29-83></a><a href=#__codelineno-29-83><span class=linenos data-linenos=" 83 "></span></a>    <span class=k>def</span> <span class=nf>log_data_access</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>data_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>operation</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span><span id=__span-29-84><a id=__codelineno-29-84 name=__codelineno-29-84></a><a href=#__codelineno-29-84><span class=linenos data-linenos=" 84 "></span></a>                       <span class=n>record_count</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-29-85><a id=__codelineno-29-85 name=__codelineno-29-85></a><a href=#__codelineno-29-85><span class=linenos data-linenos=" 85 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Log data access events&quot;&quot;&quot;</span>
</span><span id=__span-29-86><a id=__codelineno-29-86 name=__codelineno-29-86></a><a href=#__codelineno-29-86><span class=linenos data-linenos=" 86 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>log_event</span><span class=p>(</span>
</span><span id=__span-29-87><a id=__codelineno-29-87 name=__codelineno-29-87></a><a href=#__codelineno-29-87><span class=linenos data-linenos=" 87 "></span></a>            <span class=n>event_type</span><span class=o>=</span><span class=s1>&#39;data_access&#39;</span><span class=p>,</span>
</span><span id=__span-29-88><a id=__codelineno-29-88 name=__codelineno-29-88></a><a href=#__codelineno-29-88><span class=linenos data-linenos=" 88 "></span></a>            <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>,</span>
</span><span id=__span-29-89><a id=__codelineno-29-89 name=__codelineno-29-89></a><a href=#__codelineno-29-89><span class=linenos data-linenos=" 89 "></span></a>            <span class=n>details</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-29-90><a id=__codelineno-29-90 name=__codelineno-29-90></a><a href=#__codelineno-29-90><span class=linenos data-linenos=" 90 "></span></a>                <span class=s1>&#39;data_type&#39;</span><span class=p>:</span> <span class=n>data_type</span><span class=p>,</span>
</span><span id=__span-29-91><a id=__codelineno-29-91 name=__codelineno-29-91></a><a href=#__codelineno-29-91><span class=linenos data-linenos=" 91 "></span></a>                <span class=s1>&#39;operation&#39;</span><span class=p>:</span> <span class=n>operation</span><span class=p>,</span>
</span><span id=__span-29-92><a id=__codelineno-29-92 name=__codelineno-29-92></a><a href=#__codelineno-29-92><span class=linenos data-linenos=" 92 "></span></a>                <span class=s1>&#39;record_count&#39;</span><span class=p>:</span> <span class=n>record_count</span><span class=p>,</span>
</span><span id=__span-29-93><a id=__codelineno-29-93 name=__codelineno-29-93></a><a href=#__codelineno-29-93><span class=linenos data-linenos=" 93 "></span></a>                <span class=s1>&#39;session_id&#39;</span><span class=p>:</span> <span class=n>session_id</span><span class=p>,</span>
</span><span id=__span-29-94><a id=__codelineno-29-94 name=__codelineno-29-94></a><a href=#__codelineno-29-94><span class=linenos data-linenos=" 94 "></span></a>                <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-29-95><a id=__codelineno-29-95 name=__codelineno-29-95></a><a href=#__codelineno-29-95><span class=linenos data-linenos=" 95 "></span></a>            <span class=p>}</span>
</span><span id=__span-29-96><a id=__codelineno-29-96 name=__codelineno-29-96></a><a href=#__codelineno-29-96><span class=linenos data-linenos=" 96 "></span></a>        <span class=p>)</span>
</span><span id=__span-29-97><a id=__codelineno-29-97 name=__codelineno-29-97></a><a href=#__codelineno-29-97><span class=linenos data-linenos=" 97 "></span></a>    
</span><span id=__span-29-98><a id=__codelineno-29-98 name=__codelineno-29-98></a><a href=#__codelineno-29-98><span class=linenos data-linenos=" 98 "></span></a>    <span class=k>def</span> <span class=nf>log_configuration_change</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>component</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span><span id=__span-29-99><a id=__codelineno-29-99 name=__codelineno-29-99></a><a href=#__codelineno-29-99><span class=linenos data-linenos=" 99 "></span></a>                                <span class=n>old_value</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>new_value</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>session_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-29-100><a id=__codelineno-29-100 name=__codelineno-29-100></a><a href=#__codelineno-29-100><span class=linenos data-linenos="100 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Log configuration changes&quot;&quot;&quot;</span>
</span><span id=__span-29-101><a id=__codelineno-29-101 name=__codelineno-29-101></a><a href=#__codelineno-29-101><span class=linenos data-linenos="101 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>log_event</span><span class=p>(</span>
</span><span id=__span-29-102><a id=__codelineno-29-102 name=__codelineno-29-102></a><a href=#__codelineno-29-102><span class=linenos data-linenos="102 "></span></a>            <span class=n>event_type</span><span class=o>=</span><span class=s1>&#39;configuration_change&#39;</span><span class=p>,</span>
</span><span id=__span-29-103><a id=__codelineno-29-103 name=__codelineno-29-103></a><a href=#__codelineno-29-103><span class=linenos data-linenos="103 "></span></a>            <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>,</span>
</span><span id=__span-29-104><a id=__codelineno-29-104 name=__codelineno-29-104></a><a href=#__codelineno-29-104><span class=linenos data-linenos="104 "></span></a>            <span class=n>details</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-29-105><a id=__codelineno-29-105 name=__codelineno-29-105></a><a href=#__codelineno-29-105><span class=linenos data-linenos="105 "></span></a>                <span class=s1>&#39;component&#39;</span><span class=p>:</span> <span class=n>component</span><span class=p>,</span>
</span><span id=__span-29-106><a id=__codelineno-29-106 name=__codelineno-29-106></a><a href=#__codelineno-29-106><span class=linenos data-linenos="106 "></span></a>                <span class=s1>&#39;session_id&#39;</span><span class=p>:</span> <span class=n>session_id</span><span class=p>,</span>
</span><span id=__span-29-107><a id=__codelineno-29-107 name=__codelineno-29-107></a><a href=#__codelineno-29-107><span class=linenos data-linenos="107 "></span></a>                <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-29-108><a id=__codelineno-29-108 name=__codelineno-29-108></a><a href=#__codelineno-29-108><span class=linenos data-linenos="108 "></span></a>            <span class=p>},</span>
</span><span id=__span-29-109><a id=__codelineno-29-109 name=__codelineno-29-109></a><a href=#__codelineno-29-109><span class=linenos data-linenos="109 "></span></a>            <span class=n>sensitive_data</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-29-110><a id=__codelineno-29-110 name=__codelineno-29-110></a><a href=#__codelineno-29-110><span class=linenos data-linenos="110 "></span></a>                <span class=s1>&#39;old_value&#39;</span><span class=p>:</span> <span class=n>old_value</span><span class=p>,</span>
</span><span id=__span-29-111><a id=__codelineno-29-111 name=__codelineno-29-111></a><a href=#__codelineno-29-111><span class=linenos data-linenos="111 "></span></a>                <span class=s1>&#39;new_value&#39;</span><span class=p>:</span> <span class=n>new_value</span>
</span><span id=__span-29-112><a id=__codelineno-29-112 name=__codelineno-29-112></a><a href=#__codelineno-29-112><span class=linenos data-linenos="112 "></span></a>            <span class=p>}</span>
</span><span id=__span-29-113><a id=__codelineno-29-113 name=__codelineno-29-113></a><a href=#__codelineno-29-113><span class=linenos data-linenos="113 "></span></a>        <span class=p>)</span>
</span><span id=__span-29-114><a id=__codelineno-29-114 name=__codelineno-29-114></a><a href=#__codelineno-29-114><span class=linenos data-linenos="114 "></span></a>    
</span><span id=__span-29-115><a id=__codelineno-29-115 name=__codelineno-29-115></a><a href=#__codelineno-29-115><span class=linenos data-linenos="115 "></span></a>    <span class=k>def</span> <span class=nf>verify_log_integrity</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span><span id=__span-29-116><a id=__codelineno-29-116 name=__codelineno-29-116></a><a href=#__codelineno-29-116><span class=linenos data-linenos="116 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Verify audit log integrity&quot;&quot;&quot;</span>
</span><span id=__span-29-117><a id=__codelineno-29-117 name=__codelineno-29-117></a><a href=#__codelineno-29-117><span class=linenos data-linenos="117 "></span></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-29-118><a id=__codelineno-29-118 name=__codelineno-29-118></a><a href=#__codelineno-29-118><span class=linenos data-linenos="118 "></span></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>log_file</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-29-119><a id=__codelineno-29-119 name=__codelineno-29-119></a><a href=#__codelineno-29-119><span class=linenos data-linenos="119 "></span></a>                <span class=n>previous_hash</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-29-120><a id=__codelineno-29-120 name=__codelineno-29-120></a><a href=#__codelineno-29-120><span class=linenos data-linenos="120 "></span></a>                <span class=k>for</span> <span class=n>line_num</span><span class=p>,</span> <span class=n>line</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=mi>1</span><span class=p>):</span>
</span><span id=__span-29-121><a id=__codelineno-29-121 name=__codelineno-29-121></a><a href=#__codelineno-29-121><span class=linenos data-linenos="121 "></span></a>                    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-29-122><a id=__codelineno-29-122 name=__codelineno-29-122></a><a href=#__codelineno-29-122><span class=linenos data-linenos="122 "></span></a>                        <span class=n>record</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>())</span>
</span><span id=__span-29-123><a id=__codelineno-29-123 name=__codelineno-29-123></a><a href=#__codelineno-29-123><span class=linenos data-linenos="123 "></span></a>                        
</span><span id=__span-29-124><a id=__codelineno-29-124 name=__codelineno-29-124></a><a href=#__codelineno-29-124><span class=linenos data-linenos="124 "></span></a>                        <span class=c1># Verify hash chain</span>
</span><span id=__span-29-125><a id=__codelineno-29-125 name=__codelineno-29-125></a><a href=#__codelineno-29-125><span class=linenos data-linenos="125 "></span></a>                        <span class=k>if</span> <span class=n>previous_hash</span> <span class=o>!=</span> <span class=n>record</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;previous_hash&#39;</span><span class=p>):</span>
</span><span id=__span-29-126><a id=__codelineno-29-126 name=__codelineno-29-126></a><a href=#__codelineno-29-126><span class=linenos data-linenos="126 "></span></a>                            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Hash chain broken at line </span><span class=si>{</span><span class=n>line_num</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-29-127><a id=__codelineno-29-127 name=__codelineno-29-127></a><a href=#__codelineno-29-127><span class=linenos data-linenos="127 "></span></a>                            <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-29-128><a id=__codelineno-29-128 name=__codelineno-29-128></a><a href=#__codelineno-29-128><span class=linenos data-linenos="128 "></span></a>                        
</span><span id=__span-29-129><a id=__codelineno-29-129 name=__codelineno-29-129></a><a href=#__codelineno-29-129><span class=linenos data-linenos="129 "></span></a>                        <span class=c1># Verify record hash</span>
</span><span id=__span-29-130><a id=__codelineno-29-130 name=__codelineno-29-130></a><a href=#__codelineno-29-130><span class=linenos data-linenos="130 "></span></a>                        <span class=n>record_copy</span> <span class=o>=</span> <span class=n>record</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span><span id=__span-29-131><a id=__codelineno-29-131 name=__codelineno-29-131></a><a href=#__codelineno-29-131><span class=linenos data-linenos="131 "></span></a>                        <span class=n>record_hash</span> <span class=o>=</span> <span class=n>record_copy</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s1>&#39;record_hash&#39;</span><span class=p>)</span>
</span><span id=__span-29-132><a id=__codelineno-29-132 name=__codelineno-29-132></a><a href=#__codelineno-29-132><span class=linenos data-linenos="132 "></span></a>                        <span class=n>calculated_hash</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span>
</span><span id=__span-29-133><a id=__codelineno-29-133 name=__codelineno-29-133></a><a href=#__codelineno-29-133><span class=linenos data-linenos="133 "></span></a>                            <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>record_copy</span><span class=p>,</span> <span class=n>sort_keys</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span>
</span><span id=__span-29-134><a id=__codelineno-29-134 name=__codelineno-29-134></a><a href=#__codelineno-29-134><span class=linenos data-linenos="134 "></span></a>                        <span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span><span id=__span-29-135><a id=__codelineno-29-135 name=__codelineno-29-135></a><a href=#__codelineno-29-135><span class=linenos data-linenos="135 "></span></a>                        
</span><span id=__span-29-136><a id=__codelineno-29-136 name=__codelineno-29-136></a><a href=#__codelineno-29-136><span class=linenos data-linenos="136 "></span></a>                        <span class=k>if</span> <span class=n>record_hash</span> <span class=o>!=</span> <span class=n>calculated_hash</span><span class=p>:</span>
</span><span id=__span-29-137><a id=__codelineno-29-137 name=__codelineno-29-137></a><a href=#__codelineno-29-137><span class=linenos data-linenos="137 "></span></a>                            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Record hash mismatch at line </span><span class=si>{</span><span class=n>line_num</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-29-138><a id=__codelineno-29-138 name=__codelineno-29-138></a><a href=#__codelineno-29-138><span class=linenos data-linenos="138 "></span></a>                            <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-29-139><a id=__codelineno-29-139 name=__codelineno-29-139></a><a href=#__codelineno-29-139><span class=linenos data-linenos="139 "></span></a>                        
</span><span id=__span-29-140><a id=__codelineno-29-140 name=__codelineno-29-140></a><a href=#__codelineno-29-140><span class=linenos data-linenos="140 "></span></a>                        <span class=n>previous_hash</span> <span class=o>=</span> <span class=n>record_hash</span>
</span><span id=__span-29-141><a id=__codelineno-29-141 name=__codelineno-29-141></a><a href=#__codelineno-29-141><span class=linenos data-linenos="141 "></span></a>                        
</span><span id=__span-29-142><a id=__codelineno-29-142 name=__codelineno-29-142></a><a href=#__codelineno-29-142><span class=linenos data-linenos="142 "></span></a>                    <span class=k>except</span> <span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span><span class=p>:</span>
</span><span id=__span-29-143><a id=__codelineno-29-143 name=__codelineno-29-143></a><a href=#__codelineno-29-143><span class=linenos data-linenos="143 "></span></a>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Invalid JSON at line </span><span class=si>{</span><span class=n>line_num</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-29-144><a id=__codelineno-29-144 name=__codelineno-29-144></a><a href=#__codelineno-29-144><span class=linenos data-linenos="144 "></span></a>                        <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-29-145><a id=__codelineno-29-145 name=__codelineno-29-145></a><a href=#__codelineno-29-145><span class=linenos data-linenos="145 "></span></a>                        
</span><span id=__span-29-146><a id=__codelineno-29-146 name=__codelineno-29-146></a><a href=#__codelineno-29-146><span class=linenos data-linenos="146 "></span></a>            <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-29-147><a id=__codelineno-29-147 name=__codelineno-29-147></a><a href=#__codelineno-29-147><span class=linenos data-linenos="147 "></span></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-29-148><a id=__codelineno-29-148 name=__codelineno-29-148></a><a href=#__codelineno-29-148><span class=linenos data-linenos="148 "></span></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error verifying log integrity: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-29-149><a id=__codelineno-29-149 name=__codelineno-29-149></a><a href=#__codelineno-29-149><span class=linenos data-linenos="149 "></span></a>            <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-29-150><a id=__codelineno-29-150 name=__codelineno-29-150></a><a href=#__codelineno-29-150><span class=linenos data-linenos="150 "></span></a>
</span><span id=__span-29-151><a id=__codelineno-29-151 name=__codelineno-29-151></a><a href=#__codelineno-29-151><span class=linenos data-linenos="151 "></span></a><span class=c1># Global audit logger instance</span>
</span><span id=__span-29-152><a id=__codelineno-29-152 name=__codelineno-29-152></a><a href=#__codelineno-29-152><span class=linenos data-linenos="152 "></span></a><span class=n>audit_logger</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-29-153><a id=__codelineno-29-153 name=__codelineno-29-153></a><a href=#__codelineno-29-153><span class=linenos data-linenos="153 "></span></a>
</span><span id=__span-29-154><a id=__codelineno-29-154 name=__codelineno-29-154></a><a href=#__codelineno-29-154><span class=linenos data-linenos="154 "></span></a><span class=k>def</span> <span class=nf>initialize_audit_logger</span><span class=p>(</span><span class=n>encryption_key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>):</span>
</span><span id=__span-29-155><a id=__codelineno-29-155 name=__codelineno-29-155></a><a href=#__codelineno-29-155><span class=linenos data-linenos="155 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Initialize global audit logger&quot;&quot;&quot;</span>
</span><span id=__span-29-156><a id=__codelineno-29-156 name=__codelineno-29-156></a><a href=#__codelineno-29-156><span class=linenos data-linenos="156 "></span></a>    <span class=k>global</span> <span class=n>audit_logger</span>
</span><span id=__span-29-157><a id=__codelineno-29-157 name=__codelineno-29-157></a><a href=#__codelineno-29-157><span class=linenos data-linenos="157 "></span></a>    <span class=n>audit_logger</span> <span class=o>=</span> <span class=n>AuditLogger</span><span class=p>(</span><span class=n>encryption_key</span><span class=p>)</span>
</span></code></pre></div><h3 id=compliance-monitoring>Compliance Monitoring<a class=headerlink href=#compliance-monitoring title="Permanent link">&para;</a></h3><div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1></a><a href=#__codelineno-30-1><span class=linenos data-linenos="  1 "></span></a><span class=c1># lib/compliance_monitor.py</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2></a><a href=#__codelineno-30-2><span class=linenos data-linenos="  2 "></span></a><span class=kn>import</span> <span class=nn>asyncio</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3></a><a href=#__codelineno-30-3><span class=linenos data-linenos="  3 "></span></a><span class=kn>import</span> <span class=nn>aiohttp</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4></a><a href=#__codelineno-30-4><span class=linenos data-linenos="  4 "></span></a><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5></a><a href=#__codelineno-30-5><span class=linenos data-linenos="  5 "></span></a><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Any</span>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6></a><a href=#__codelineno-30-6><span class=linenos data-linenos="  6 "></span></a><span class=kn>import</span> <span class=nn>json</span>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7></a><a href=#__codelineno-30-7><span class=linenos data-linenos="  7 "></span></a>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8></a><a href=#__codelineno-30-8><span class=linenos data-linenos="  8 "></span></a><span class=k>class</span> <span class=nc>ComplianceMonitor</span><span class=p>:</span>
</span><span id=__span-30-9><a id=__codelineno-30-9 name=__codelineno-30-9></a><a href=#__codelineno-30-9><span class=linenos data-linenos="  9 "></span></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Automated compliance monitoring and reporting&quot;&quot;&quot;</span>
</span><span id=__span-30-10><a id=__codelineno-30-10 name=__codelineno-30-10></a><a href=#__codelineno-30-10><span class=linenos data-linenos=" 10 "></span></a>    
</span><span id=__span-30-11><a id=__codelineno-30-11 name=__codelineno-30-11></a><a href=#__codelineno-30-11><span class=linenos data-linenos=" 11 "></span></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-30-12><a id=__codelineno-30-12 name=__codelineno-30-12></a><a href=#__codelineno-30-12><span class=linenos data-linenos=" 12 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>compliance_rules</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>load_compliance_rules</span><span class=p>()</span>
</span><span id=__span-30-13><a id=__codelineno-30-13 name=__codelineno-30-13></a><a href=#__codelineno-30-13><span class=linenos data-linenos=" 13 "></span></a>        <span class=bp>self</span><span class=o>.</span><span class=n>violations</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-30-14><a id=__codelineno-30-14 name=__codelineno-30-14></a><a href=#__codelineno-30-14><span class=linenos data-linenos=" 14 "></span></a>    
</span><span id=__span-30-15><a id=__codelineno-30-15 name=__codelineno-30-15></a><a href=#__codelineno-30-15><span class=linenos data-linenos=" 15 "></span></a>    <span class=k>def</span> <span class=nf>load_compliance_rules</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
</span><span id=__span-30-16><a id=__codelineno-30-16 name=__codelineno-30-16></a><a href=#__codelineno-30-16><span class=linenos data-linenos=" 16 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Load compliance rules from configuration&quot;&quot;&quot;</span>
</span><span id=__span-30-17><a id=__codelineno-30-17 name=__codelineno-30-17></a><a href=#__codelineno-30-17><span class=linenos data-linenos=" 17 "></span></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;compliance/rules.json&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-30-18><a id=__codelineno-30-18 name=__codelineno-30-18></a><a href=#__codelineno-30-18><span class=linenos data-linenos=" 18 "></span></a>            <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span><span id=__span-30-19><a id=__codelineno-30-19 name=__codelineno-30-19></a><a href=#__codelineno-30-19><span class=linenos data-linenos=" 19 "></span></a>    
</span><span id=__span-30-20><a id=__codelineno-30-20 name=__codelineno-30-20></a><a href=#__codelineno-30-20><span class=linenos data-linenos=" 20 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>check_access_controls</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-30-21><a id=__codelineno-30-21 name=__codelineno-30-21></a><a href=#__codelineno-30-21><span class=linenos data-linenos=" 21 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Check access control compliance&quot;&quot;&quot;</span>
</span><span id=__span-30-22><a id=__codelineno-30-22 name=__codelineno-30-22></a><a href=#__codelineno-30-22><span class=linenos data-linenos=" 22 "></span></a>        <span class=n>violations</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-30-23><a id=__codelineno-30-23 name=__codelineno-30-23></a><a href=#__codelineno-30-23><span class=linenos data-linenos=" 23 "></span></a>        
</span><span id=__span-30-24><a id=__codelineno-30-24 name=__codelineno-30-24></a><a href=#__codelineno-30-24><span class=linenos data-linenos=" 24 "></span></a>        <span class=c1># Check for users without MFA</span>
</span><span id=__span-30-25><a id=__codelineno-30-25 name=__codelineno-30-25></a><a href=#__codelineno-30-25><span class=linenos data-linenos=" 25 "></span></a>        <span class=n>users_without_mfa</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_users_without_mfa</span><span class=p>()</span>
</span><span id=__span-30-26><a id=__codelineno-30-26 name=__codelineno-30-26></a><a href=#__codelineno-30-26><span class=linenos data-linenos=" 26 "></span></a>        <span class=k>if</span> <span class=n>users_without_mfa</span><span class=p>:</span>
</span><span id=__span-30-27><a id=__codelineno-30-27 name=__codelineno-30-27></a><a href=#__codelineno-30-27><span class=linenos data-linenos=" 27 "></span></a>            <span class=n>violations</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-30-28><a id=__codelineno-30-28 name=__codelineno-30-28></a><a href=#__codelineno-30-28><span class=linenos data-linenos=" 28 "></span></a>                <span class=s1>&#39;rule&#39;</span><span class=p>:</span> <span class=s1>&#39;MFA_REQUIRED&#39;</span><span class=p>,</span>
</span><span id=__span-30-29><a id=__codelineno-30-29 name=__codelineno-30-29></a><a href=#__codelineno-30-29><span class=linenos data-linenos=" 29 "></span></a>                <span class=s1>&#39;severity&#39;</span><span class=p>:</span> <span class=s1>&#39;HIGH&#39;</span><span class=p>,</span>
</span><span id=__span-30-30><a id=__codelineno-30-30 name=__codelineno-30-30></a><a href=#__codelineno-30-30><span class=linenos data-linenos=" 30 "></span></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Users without multi-factor authentication&#39;</span><span class=p>,</span>
</span><span id=__span-30-31><a id=__codelineno-30-31 name=__codelineno-30-31></a><a href=#__codelineno-30-31><span class=linenos data-linenos=" 31 "></span></a>                <span class=s1>&#39;affected_users&#39;</span><span class=p>:</span> <span class=n>users_without_mfa</span><span class=p>,</span>
</span><span id=__span-30-32><a id=__codelineno-30-32 name=__codelineno-30-32></a><a href=#__codelineno-30-32><span class=linenos data-linenos=" 32 "></span></a>                <span class=s1>&#39;remediation&#39;</span><span class=p>:</span> <span class=s1>&#39;Enable MFA for all users&#39;</span>
</span><span id=__span-30-33><a id=__codelineno-30-33 name=__codelineno-30-33></a><a href=#__codelineno-30-33><span class=linenos data-linenos=" 33 "></span></a>            <span class=p>})</span>
</span><span id=__span-30-34><a id=__codelineno-30-34 name=__codelineno-30-34></a><a href=#__codelineno-30-34><span class=linenos data-linenos=" 34 "></span></a>        
</span><span id=__span-30-35><a id=__codelineno-30-35 name=__codelineno-30-35></a><a href=#__codelineno-30-35><span class=linenos data-linenos=" 35 "></span></a>        <span class=c1># Check for excessive privileges</span>
</span><span id=__span-30-36><a id=__codelineno-30-36 name=__codelineno-30-36></a><a href=#__codelineno-30-36><span class=linenos data-linenos=" 36 "></span></a>        <span class=n>over_privileged_users</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>check_excessive_privileges</span><span class=p>()</span>
</span><span id=__span-30-37><a id=__codelineno-30-37 name=__codelineno-30-37></a><a href=#__codelineno-30-37><span class=linenos data-linenos=" 37 "></span></a>        <span class=k>if</span> <span class=n>over_privileged_users</span><span class=p>:</span>
</span><span id=__span-30-38><a id=__codelineno-30-38 name=__codelineno-30-38></a><a href=#__codelineno-30-38><span class=linenos data-linenos=" 38 "></span></a>            <span class=n>violations</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-30-39><a id=__codelineno-30-39 name=__codelineno-30-39></a><a href=#__codelineno-30-39><span class=linenos data-linenos=" 39 "></span></a>                <span class=s1>&#39;rule&#39;</span><span class=p>:</span> <span class=s1>&#39;LEAST_PRIVILEGE&#39;</span><span class=p>,</span>
</span><span id=__span-30-40><a id=__codelineno-30-40 name=__codelineno-30-40></a><a href=#__codelineno-30-40><span class=linenos data-linenos=" 40 "></span></a>                <span class=s1>&#39;severity&#39;</span><span class=p>:</span> <span class=s1>&#39;MEDIUM&#39;</span><span class=p>,</span>
</span><span id=__span-30-41><a id=__codelineno-30-41 name=__codelineno-30-41></a><a href=#__codelineno-30-41><span class=linenos data-linenos=" 41 "></span></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Users with excessive privileges&#39;</span><span class=p>,</span>
</span><span id=__span-30-42><a id=__codelineno-30-42 name=__codelineno-30-42></a><a href=#__codelineno-30-42><span class=linenos data-linenos=" 42 "></span></a>                <span class=s1>&#39;affected_users&#39;</span><span class=p>:</span> <span class=n>over_privileged_users</span><span class=p>,</span>
</span><span id=__span-30-43><a id=__codelineno-30-43 name=__codelineno-30-43></a><a href=#__codelineno-30-43><span class=linenos data-linenos=" 43 "></span></a>                <span class=s1>&#39;remediation&#39;</span><span class=p>:</span> <span class=s1>&#39;Review and reduce user privileges&#39;</span>
</span><span id=__span-30-44><a id=__codelineno-30-44 name=__codelineno-30-44></a><a href=#__codelineno-30-44><span class=linenos data-linenos=" 44 "></span></a>            <span class=p>})</span>
</span><span id=__span-30-45><a id=__codelineno-30-45 name=__codelineno-30-45></a><a href=#__codelineno-30-45><span class=linenos data-linenos=" 45 "></span></a>        
</span><span id=__span-30-46><a id=__codelineno-30-46 name=__codelineno-30-46></a><a href=#__codelineno-30-46><span class=linenos data-linenos=" 46 "></span></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-30-47><a id=__codelineno-30-47 name=__codelineno-30-47></a><a href=#__codelineno-30-47><span class=linenos data-linenos=" 47 "></span></a>            <span class=s1>&#39;category&#39;</span><span class=p>:</span> <span class=s1>&#39;access_controls&#39;</span><span class=p>,</span>
</span><span id=__span-30-48><a id=__codelineno-30-48 name=__codelineno-30-48></a><a href=#__codelineno-30-48><span class=linenos data-linenos=" 48 "></span></a>            <span class=s1>&#39;violations&#39;</span><span class=p>:</span> <span class=n>violations</span><span class=p>,</span>
</span><span id=__span-30-49><a id=__codelineno-30-49 name=__codelineno-30-49></a><a href=#__codelineno-30-49><span class=linenos data-linenos=" 49 "></span></a>            <span class=s1>&#39;last_checked&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span><span id=__span-30-50><a id=__codelineno-30-50 name=__codelineno-30-50></a><a href=#__codelineno-30-50><span class=linenos data-linenos=" 50 "></span></a>        <span class=p>}</span>
</span><span id=__span-30-51><a id=__codelineno-30-51 name=__codelineno-30-51></a><a href=#__codelineno-30-51><span class=linenos data-linenos=" 51 "></span></a>    
</span><span id=__span-30-52><a id=__codelineno-30-52 name=__codelineno-30-52></a><a href=#__codelineno-30-52><span class=linenos data-linenos=" 52 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>check_data_encryption</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-30-53><a id=__codelineno-30-53 name=__codelineno-30-53></a><a href=#__codelineno-30-53><span class=linenos data-linenos=" 53 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Check data encryption compliance&quot;&quot;&quot;</span>
</span><span id=__span-30-54><a id=__codelineno-30-54 name=__codelineno-30-54></a><a href=#__codelineno-30-54><span class=linenos data-linenos=" 54 "></span></a>        <span class=n>violations</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-30-55><a id=__codelineno-30-55 name=__codelineno-30-55></a><a href=#__codelineno-30-55><span class=linenos data-linenos=" 55 "></span></a>        
</span><span id=__span-30-56><a id=__codelineno-30-56 name=__codelineno-30-56></a><a href=#__codelineno-30-56><span class=linenos data-linenos=" 56 "></span></a>        <span class=c1># Check database encryption</span>
</span><span id=__span-30-57><a id=__codelineno-30-57 name=__codelineno-30-57></a><a href=#__codelineno-30-57><span class=linenos data-linenos=" 57 "></span></a>        <span class=k>if</span> <span class=ow>not</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>verify_database_encryption</span><span class=p>():</span>
</span><span id=__span-30-58><a id=__codelineno-30-58 name=__codelineno-30-58></a><a href=#__codelineno-30-58><span class=linenos data-linenos=" 58 "></span></a>            <span class=n>violations</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-30-59><a id=__codelineno-30-59 name=__codelineno-30-59></a><a href=#__codelineno-30-59><span class=linenos data-linenos=" 59 "></span></a>                <span class=s1>&#39;rule&#39;</span><span class=p>:</span> <span class=s1>&#39;DATA_ENCRYPTION_AT_REST&#39;</span><span class=p>,</span>
</span><span id=__span-30-60><a id=__codelineno-30-60 name=__codelineno-30-60></a><a href=#__codelineno-30-60><span class=linenos data-linenos=" 60 "></span></a>                <span class=s1>&#39;severity&#39;</span><span class=p>:</span> <span class=s1>&#39;HIGH&#39;</span><span class=p>,</span>
</span><span id=__span-30-61><a id=__codelineno-30-61 name=__codelineno-30-61></a><a href=#__codelineno-30-61><span class=linenos data-linenos=" 61 "></span></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Database encryption not enabled&#39;</span><span class=p>,</span>
</span><span id=__span-30-62><a id=__codelineno-30-62 name=__codelineno-30-62></a><a href=#__codelineno-30-62><span class=linenos data-linenos=" 62 "></span></a>                <span class=s1>&#39;remediation&#39;</span><span class=p>:</span> <span class=s1>&#39;Enable database encryption&#39;</span>
</span><span id=__span-30-63><a id=__codelineno-30-63 name=__codelineno-30-63></a><a href=#__codelineno-30-63><span class=linenos data-linenos=" 63 "></span></a>            <span class=p>})</span>
</span><span id=__span-30-64><a id=__codelineno-30-64 name=__codelineno-30-64></a><a href=#__codelineno-30-64><span class=linenos data-linenos=" 64 "></span></a>        
</span><span id=__span-30-65><a id=__codelineno-30-65 name=__codelineno-30-65></a><a href=#__codelineno-30-65><span class=linenos data-linenos=" 65 "></span></a>        <span class=c1># Check backup encryption</span>
</span><span id=__span-30-66><a id=__codelineno-30-66 name=__codelineno-30-66></a><a href=#__codelineno-30-66><span class=linenos data-linenos=" 66 "></span></a>        <span class=k>if</span> <span class=ow>not</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>verify_backup_encryption</span><span class=p>():</span>
</span><span id=__span-30-67><a id=__codelineno-30-67 name=__codelineno-30-67></a><a href=#__codelineno-30-67><span class=linenos data-linenos=" 67 "></span></a>            <span class=n>violations</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-30-68><a id=__codelineno-30-68 name=__codelineno-30-68></a><a href=#__codelineno-30-68><span class=linenos data-linenos=" 68 "></span></a>                <span class=s1>&#39;rule&#39;</span><span class=p>:</span> <span class=s1>&#39;BACKUP_ENCRYPTION&#39;</span><span class=p>,</span>
</span><span id=__span-30-69><a id=__codelineno-30-69 name=__codelineno-30-69></a><a href=#__codelineno-30-69><span class=linenos data-linenos=" 69 "></span></a>                <span class=s1>&#39;severity&#39;</span><span class=p>:</span> <span class=s1>&#39;HIGH&#39;</span><span class=p>,</span>
</span><span id=__span-30-70><a id=__codelineno-30-70 name=__codelineno-30-70></a><a href=#__codelineno-30-70><span class=linenos data-linenos=" 70 "></span></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Backup encryption not enabled&#39;</span><span class=p>,</span>
</span><span id=__span-30-71><a id=__codelineno-30-71 name=__codelineno-30-71></a><a href=#__codelineno-30-71><span class=linenos data-linenos=" 71 "></span></a>                <span class=s1>&#39;remediation&#39;</span><span class=p>:</span> <span class=s1>&#39;Enable backup encryption&#39;</span>
</span><span id=__span-30-72><a id=__codelineno-30-72 name=__codelineno-30-72></a><a href=#__codelineno-30-72><span class=linenos data-linenos=" 72 "></span></a>            <span class=p>})</span>
</span><span id=__span-30-73><a id=__codelineno-30-73 name=__codelineno-30-73></a><a href=#__codelineno-30-73><span class=linenos data-linenos=" 73 "></span></a>        
</span><span id=__span-30-74><a id=__codelineno-30-74 name=__codelineno-30-74></a><a href=#__codelineno-30-74><span class=linenos data-linenos=" 74 "></span></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-30-75><a id=__codelineno-30-75 name=__codelineno-30-75></a><a href=#__codelineno-30-75><span class=linenos data-linenos=" 75 "></span></a>            <span class=s1>&#39;category&#39;</span><span class=p>:</span> <span class=s1>&#39;data_encryption&#39;</span><span class=p>,</span>
</span><span id=__span-30-76><a id=__codelineno-30-76 name=__codelineno-30-76></a><a href=#__codelineno-30-76><span class=linenos data-linenos=" 76 "></span></a>            <span class=s1>&#39;violations&#39;</span><span class=p>:</span> <span class=n>violations</span><span class=p>,</span>
</span><span id=__span-30-77><a id=__codelineno-30-77 name=__codelineno-30-77></a><a href=#__codelineno-30-77><span class=linenos data-linenos=" 77 "></span></a>            <span class=s1>&#39;last_checked&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span><span id=__span-30-78><a id=__codelineno-30-78 name=__codelineno-30-78></a><a href=#__codelineno-30-78><span class=linenos data-linenos=" 78 "></span></a>        <span class=p>}</span>
</span><span id=__span-30-79><a id=__codelineno-30-79 name=__codelineno-30-79></a><a href=#__codelineno-30-79><span class=linenos data-linenos=" 79 "></span></a>    
</span><span id=__span-30-80><a id=__codelineno-30-80 name=__codelineno-30-80></a><a href=#__codelineno-30-80><span class=linenos data-linenos=" 80 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>check_audit_logging</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-30-81><a id=__codelineno-30-81 name=__codelineno-30-81></a><a href=#__codelineno-30-81><span class=linenos data-linenos=" 81 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Check audit logging compliance&quot;&quot;&quot;</span>
</span><span id=__span-30-82><a id=__codelineno-30-82 name=__codelineno-30-82></a><a href=#__codelineno-30-82><span class=linenos data-linenos=" 82 "></span></a>        <span class=n>violations</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-30-83><a id=__codelineno-30-83 name=__codelineno-30-83></a><a href=#__codelineno-30-83><span class=linenos data-linenos=" 83 "></span></a>        
</span><span id=__span-30-84><a id=__codelineno-30-84 name=__codelineno-30-84></a><a href=#__codelineno-30-84><span class=linenos data-linenos=" 84 "></span></a>        <span class=c1># Check log retention</span>
</span><span id=__span-30-85><a id=__codelineno-30-85 name=__codelineno-30-85></a><a href=#__codelineno-30-85><span class=linenos data-linenos=" 85 "></span></a>        <span class=k>if</span> <span class=ow>not</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>verify_log_retention</span><span class=p>():</span>
</span><span id=__span-30-86><a id=__codelineno-30-86 name=__codelineno-30-86></a><a href=#__codelineno-30-86><span class=linenos data-linenos=" 86 "></span></a>            <span class=n>violations</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-30-87><a id=__codelineno-30-87 name=__codelineno-30-87></a><a href=#__codelineno-30-87><span class=linenos data-linenos=" 87 "></span></a>                <span class=s1>&#39;rule&#39;</span><span class=p>:</span> <span class=s1>&#39;LOG_RETENTION&#39;</span><span class=p>,</span>
</span><span id=__span-30-88><a id=__codelineno-30-88 name=__codelineno-30-88></a><a href=#__codelineno-30-88><span class=linenos data-linenos=" 88 "></span></a>                <span class=s1>&#39;severity&#39;</span><span class=p>:</span> <span class=s1>&#39;MEDIUM&#39;</span><span class=p>,</span>
</span><span id=__span-30-89><a id=__codelineno-30-89 name=__codelineno-30-89></a><a href=#__codelineno-30-89><span class=linenos data-linenos=" 89 "></span></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Audit log retention period not compliant&#39;</span><span class=p>,</span>
</span><span id=__span-30-90><a id=__codelineno-30-90 name=__codelineno-30-90></a><a href=#__codelineno-30-90><span class=linenos data-linenos=" 90 "></span></a>                <span class=s1>&#39;remediation&#39;</span><span class=p>:</span> <span class=s1>&#39;Configure proper log retention (minimum 1 year)&#39;</span>
</span><span id=__span-30-91><a id=__codelineno-30-91 name=__codelineno-30-91></a><a href=#__codelineno-30-91><span class=linenos data-linenos=" 91 "></span></a>            <span class=p>})</span>
</span><span id=__span-30-92><a id=__codelineno-30-92 name=__codelineno-30-92></a><a href=#__codelineno-30-92><span class=linenos data-linenos=" 92 "></span></a>        
</span><span id=__span-30-93><a id=__codelineno-30-93 name=__codelineno-30-93></a><a href=#__codelineno-30-93><span class=linenos data-linenos=" 93 "></span></a>        <span class=c1># Check log integrity</span>
</span><span id=__span-30-94><a id=__codelineno-30-94 name=__codelineno-30-94></a><a href=#__codelineno-30-94><span class=linenos data-linenos=" 94 "></span></a>        <span class=k>if</span> <span class=ow>not</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>verify_log_integrity</span><span class=p>():</span>
</span><span id=__span-30-95><a id=__codelineno-30-95 name=__codelineno-30-95></a><a href=#__codelineno-30-95><span class=linenos data-linenos=" 95 "></span></a>            <span class=n>violations</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-30-96><a id=__codelineno-30-96 name=__codelineno-30-96></a><a href=#__codelineno-30-96><span class=linenos data-linenos=" 96 "></span></a>                <span class=s1>&#39;rule&#39;</span><span class=p>:</span> <span class=s1>&#39;LOG_INTEGRITY&#39;</span><span class=p>,</span>
</span><span id=__span-30-97><a id=__codelineno-30-97 name=__codelineno-30-97></a><a href=#__codelineno-30-97><span class=linenos data-linenos=" 97 "></span></a>                <span class=s1>&#39;severity&#39;</span><span class=p>:</span> <span class=s1>&#39;HIGH&#39;</span><span class=p>,</span>
</span><span id=__span-30-98><a id=__codelineno-30-98 name=__codelineno-30-98></a><a href=#__codelineno-30-98><span class=linenos data-linenos=" 98 "></span></a>                <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;Audit log integrity verification failed&#39;</span><span class=p>,</span>
</span><span id=__span-30-99><a id=__codelineno-30-99 name=__codelineno-30-99></a><a href=#__codelineno-30-99><span class=linenos data-linenos=" 99 "></span></a>                <span class=s1>&#39;remediation&#39;</span><span class=p>:</span> <span class=s1>&#39;Investigate potential log tampering&#39;</span>
</span><span id=__span-30-100><a id=__codelineno-30-100 name=__codelineno-30-100></a><a href=#__codelineno-30-100><span class=linenos data-linenos="100 "></span></a>            <span class=p>})</span>
</span><span id=__span-30-101><a id=__codelineno-30-101 name=__codelineno-30-101></a><a href=#__codelineno-30-101><span class=linenos data-linenos="101 "></span></a>        
</span><span id=__span-30-102><a id=__codelineno-30-102 name=__codelineno-30-102></a><a href=#__codelineno-30-102><span class=linenos data-linenos="102 "></span></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-30-103><a id=__codelineno-30-103 name=__codelineno-30-103></a><a href=#__codelineno-30-103><span class=linenos data-linenos="103 "></span></a>            <span class=s1>&#39;category&#39;</span><span class=p>:</span> <span class=s1>&#39;audit_logging&#39;</span><span class=p>,</span>
</span><span id=__span-30-104><a id=__codelineno-30-104 name=__codelineno-30-104></a><a href=#__codelineno-30-104><span class=linenos data-linenos="104 "></span></a>            <span class=s1>&#39;violations&#39;</span><span class=p>:</span> <span class=n>violations</span><span class=p>,</span>
</span><span id=__span-30-105><a id=__codelineno-30-105 name=__codelineno-30-105></a><a href=#__codelineno-30-105><span class=linenos data-linenos="105 "></span></a>            <span class=s1>&#39;last_checked&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span><span id=__span-30-106><a id=__codelineno-30-106 name=__codelineno-30-106></a><a href=#__codelineno-30-106><span class=linenos data-linenos="106 "></span></a>        <span class=p>}</span>
</span><span id=__span-30-107><a id=__codelineno-30-107 name=__codelineno-30-107></a><a href=#__codelineno-30-107><span class=linenos data-linenos="107 "></span></a>    
</span><span id=__span-30-108><a id=__codelineno-30-108 name=__codelineno-30-108></a><a href=#__codelineno-30-108><span class=linenos data-linenos="108 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>generate_compliance_report</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-30-109><a id=__codelineno-30-109 name=__codelineno-30-109></a><a href=#__codelineno-30-109><span class=linenos data-linenos="109 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Generate comprehensive compliance report&quot;&quot;&quot;</span>
</span><span id=__span-30-110><a id=__codelineno-30-110 name=__codelineno-30-110></a><a href=#__codelineno-30-110><span class=linenos data-linenos="110 "></span></a>        <span class=n>report</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-30-111><a id=__codelineno-30-111 name=__codelineno-30-111></a><a href=#__codelineno-30-111><span class=linenos data-linenos="111 "></span></a>            <span class=s1>&#39;report_date&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span><span id=__span-30-112><a id=__codelineno-30-112 name=__codelineno-30-112></a><a href=#__codelineno-30-112><span class=linenos data-linenos="112 "></span></a>            <span class=s1>&#39;compliance_checks&#39;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-30-113><a id=__codelineno-30-113 name=__codelineno-30-113></a><a href=#__codelineno-30-113><span class=linenos data-linenos="113 "></span></a>            <span class=s1>&#39;overall_status&#39;</span><span class=p>:</span> <span class=s1>&#39;COMPLIANT&#39;</span><span class=p>,</span>
</span><span id=__span-30-114><a id=__codelineno-30-114 name=__codelineno-30-114></a><a href=#__codelineno-30-114><span class=linenos data-linenos="114 "></span></a>            <span class=s1>&#39;total_violations&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-30-115><a id=__codelineno-30-115 name=__codelineno-30-115></a><a href=#__codelineno-30-115><span class=linenos data-linenos="115 "></span></a>            <span class=s1>&#39;high_severity_violations&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-30-116><a id=__codelineno-30-116 name=__codelineno-30-116></a><a href=#__codelineno-30-116><span class=linenos data-linenos="116 "></span></a>            <span class=s1>&#39;medium_severity_violations&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-30-117><a id=__codelineno-30-117 name=__codelineno-30-117></a><a href=#__codelineno-30-117><span class=linenos data-linenos="117 "></span></a>            <span class=s1>&#39;low_severity_violations&#39;</span><span class=p>:</span> <span class=mi>0</span>
</span><span id=__span-30-118><a id=__codelineno-30-118 name=__codelineno-30-118></a><a href=#__codelineno-30-118><span class=linenos data-linenos="118 "></span></a>        <span class=p>}</span>
</span><span id=__span-30-119><a id=__codelineno-30-119 name=__codelineno-30-119></a><a href=#__codelineno-30-119><span class=linenos data-linenos="119 "></span></a>        
</span><span id=__span-30-120><a id=__codelineno-30-120 name=__codelineno-30-120></a><a href=#__codelineno-30-120><span class=linenos data-linenos="120 "></span></a>        <span class=c1># Run all compliance checks</span>
</span><span id=__span-30-121><a id=__codelineno-30-121 name=__codelineno-30-121></a><a href=#__codelineno-30-121><span class=linenos data-linenos="121 "></span></a>        <span class=n>checks</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-30-122><a id=__codelineno-30-122 name=__codelineno-30-122></a><a href=#__codelineno-30-122><span class=linenos data-linenos="122 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>check_access_controls</span><span class=p>(),</span>
</span><span id=__span-30-123><a id=__codelineno-30-123 name=__codelineno-30-123></a><a href=#__codelineno-30-123><span class=linenos data-linenos="123 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>check_data_encryption</span><span class=p>(),</span>
</span><span id=__span-30-124><a id=__codelineno-30-124 name=__codelineno-30-124></a><a href=#__codelineno-30-124><span class=linenos data-linenos="124 "></span></a>            <span class=bp>self</span><span class=o>.</span><span class=n>check_audit_logging</span><span class=p>()</span>
</span><span id=__span-30-125><a id=__codelineno-30-125 name=__codelineno-30-125></a><a href=#__codelineno-30-125><span class=linenos data-linenos="125 "></span></a>        <span class=p>]</span>
</span><span id=__span-30-126><a id=__codelineno-30-126 name=__codelineno-30-126></a><a href=#__codelineno-30-126><span class=linenos data-linenos="126 "></span></a>        
</span><span id=__span-30-127><a id=__codelineno-30-127 name=__codelineno-30-127></a><a href=#__codelineno-30-127><span class=linenos data-linenos="127 "></span></a>        <span class=n>results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>checks</span><span class=p>)</span>
</span><span id=__span-30-128><a id=__codelineno-30-128 name=__codelineno-30-128></a><a href=#__codelineno-30-128><span class=linenos data-linenos="128 "></span></a>        
</span><span id=__span-30-129><a id=__codelineno-30-129 name=__codelineno-30-129></a><a href=#__codelineno-30-129><span class=linenos data-linenos="129 "></span></a>        <span class=c1># Aggregate results</span>
</span><span id=__span-30-130><a id=__codelineno-30-130 name=__codelineno-30-130></a><a href=#__codelineno-30-130><span class=linenos data-linenos="130 "></span></a>        <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>results</span><span class=p>:</span>
</span><span id=__span-30-131><a id=__codelineno-30-131 name=__codelineno-30-131></a><a href=#__codelineno-30-131><span class=linenos data-linenos="131 "></span></a>            <span class=n>report</span><span class=p>[</span><span class=s1>&#39;compliance_checks&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span><span id=__span-30-132><a id=__codelineno-30-132 name=__codelineno-30-132></a><a href=#__codelineno-30-132><span class=linenos data-linenos="132 "></span></a>            
</span><span id=__span-30-133><a id=__codelineno-30-133 name=__codelineno-30-133></a><a href=#__codelineno-30-133><span class=linenos data-linenos="133 "></span></a>            <span class=k>for</span> <span class=n>violation</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;violations&#39;</span><span class=p>]:</span>
</span><span id=__span-30-134><a id=__codelineno-30-134 name=__codelineno-30-134></a><a href=#__codelineno-30-134><span class=linenos data-linenos="134 "></span></a>                <span class=n>report</span><span class=p>[</span><span class=s1>&#39;total_violations&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-30-135><a id=__codelineno-30-135 name=__codelineno-30-135></a><a href=#__codelineno-30-135><span class=linenos data-linenos="135 "></span></a>                <span class=n>severity</span> <span class=o>=</span> <span class=n>violation</span><span class=p>[</span><span class=s1>&#39;severity&#39;</span><span class=p>]</span>
</span><span id=__span-30-136><a id=__codelineno-30-136 name=__codelineno-30-136></a><a href=#__codelineno-30-136><span class=linenos data-linenos="136 "></span></a>                <span class=k>if</span> <span class=n>severity</span> <span class=o>==</span> <span class=s1>&#39;HIGH&#39;</span><span class=p>:</span>
</span><span id=__span-30-137><a id=__codelineno-30-137 name=__codelineno-30-137></a><a href=#__codelineno-30-137><span class=linenos data-linenos="137 "></span></a>                    <span class=n>report</span><span class=p>[</span><span class=s1>&#39;high_severity_violations&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-30-138><a id=__codelineno-30-138 name=__codelineno-30-138></a><a href=#__codelineno-30-138><span class=linenos data-linenos="138 "></span></a>                    <span class=n>report</span><span class=p>[</span><span class=s1>&#39;overall_status&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;NON_COMPLIANT&#39;</span>
</span><span id=__span-30-139><a id=__codelineno-30-139 name=__codelineno-30-139></a><a href=#__codelineno-30-139><span class=linenos data-linenos="139 "></span></a>                <span class=k>elif</span> <span class=n>severity</span> <span class=o>==</span> <span class=s1>&#39;MEDIUM&#39;</span><span class=p>:</span>
</span><span id=__span-30-140><a id=__codelineno-30-140 name=__codelineno-30-140></a><a href=#__codelineno-30-140><span class=linenos data-linenos="140 "></span></a>                    <span class=n>report</span><span class=p>[</span><span class=s1>&#39;medium_severity_violations&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-30-141><a id=__codelineno-30-141 name=__codelineno-30-141></a><a href=#__codelineno-30-141><span class=linenos data-linenos="141 "></span></a>                <span class=k>else</span><span class=p>:</span>
</span><span id=__span-30-142><a id=__codelineno-30-142 name=__codelineno-30-142></a><a href=#__codelineno-30-142><span class=linenos data-linenos="142 "></span></a>                    <span class=n>report</span><span class=p>[</span><span class=s1>&#39;low_severity_violations&#39;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-30-143><a id=__codelineno-30-143 name=__codelineno-30-143></a><a href=#__codelineno-30-143><span class=linenos data-linenos="143 "></span></a>        
</span><span id=__span-30-144><a id=__codelineno-30-144 name=__codelineno-30-144></a><a href=#__codelineno-30-144><span class=linenos data-linenos="144 "></span></a>        <span class=k>return</span> <span class=n>report</span>
</span><span id=__span-30-145><a id=__codelineno-30-145 name=__codelineno-30-145></a><a href=#__codelineno-30-145><span class=linenos data-linenos="145 "></span></a>    
</span><span id=__span-30-146><a id=__codelineno-30-146 name=__codelineno-30-146></a><a href=#__codelineno-30-146><span class=linenos data-linenos="146 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>get_users_without_mfa</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-30-147><a id=__codelineno-30-147 name=__codelineno-30-147></a><a href=#__codelineno-30-147><span class=linenos data-linenos="147 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get list of users without MFA enabled&quot;&quot;&quot;</span>
</span><span id=__span-30-148><a id=__codelineno-30-148 name=__codelineno-30-148></a><a href=#__codelineno-30-148><span class=linenos data-linenos="148 "></span></a>        <span class=c1># Implementation would query user database</span>
</span><span id=__span-30-149><a id=__codelineno-30-149 name=__codelineno-30-149></a><a href=#__codelineno-30-149><span class=linenos data-linenos="149 "></span></a>        <span class=c1># This is a placeholder</span>
</span><span id=__span-30-150><a id=__codelineno-30-150 name=__codelineno-30-150></a><a href=#__codelineno-30-150><span class=linenos data-linenos="150 "></span></a>        <span class=k>return</span> <span class=p>[]</span>
</span><span id=__span-30-151><a id=__codelineno-30-151 name=__codelineno-30-151></a><a href=#__codelineno-30-151><span class=linenos data-linenos="151 "></span></a>    
</span><span id=__span-30-152><a id=__codelineno-30-152 name=__codelineno-30-152></a><a href=#__codelineno-30-152><span class=linenos data-linenos="152 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>check_excessive_privileges</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-30-153><a id=__codelineno-30-153 name=__codelineno-30-153></a><a href=#__codelineno-30-153><span class=linenos data-linenos="153 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Check for users with excessive privileges&quot;&quot;&quot;</span>
</span><span id=__span-30-154><a id=__codelineno-30-154 name=__codelineno-30-154></a><a href=#__codelineno-30-154><span class=linenos data-linenos="154 "></span></a>        <span class=c1># Implementation would analyze user roles and permissions</span>
</span><span id=__span-30-155><a id=__codelineno-30-155 name=__codelineno-30-155></a><a href=#__codelineno-30-155><span class=linenos data-linenos="155 "></span></a>        <span class=c1># This is a placeholder</span>
</span><span id=__span-30-156><a id=__codelineno-30-156 name=__codelineno-30-156></a><a href=#__codelineno-30-156><span class=linenos data-linenos="156 "></span></a>        <span class=k>return</span> <span class=p>[]</span>
</span><span id=__span-30-157><a id=__codelineno-30-157 name=__codelineno-30-157></a><a href=#__codelineno-30-157><span class=linenos data-linenos="157 "></span></a>    
</span><span id=__span-30-158><a id=__codelineno-30-158 name=__codelineno-30-158></a><a href=#__codelineno-30-158><span class=linenos data-linenos="158 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>verify_database_encryption</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span><span id=__span-30-159><a id=__codelineno-30-159 name=__codelineno-30-159></a><a href=#__codelineno-30-159><span class=linenos data-linenos="159 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Verify database encryption is enabled&quot;&quot;&quot;</span>
</span><span id=__span-30-160><a id=__codelineno-30-160 name=__codelineno-30-160></a><a href=#__codelineno-30-160><span class=linenos data-linenos="160 "></span></a>        <span class=c1># Implementation would check database encryption settings</span>
</span><span id=__span-30-161><a id=__codelineno-30-161 name=__codelineno-30-161></a><a href=#__codelineno-30-161><span class=linenos data-linenos="161 "></span></a>        <span class=c1># This is a placeholder</span>
</span><span id=__span-30-162><a id=__codelineno-30-162 name=__codelineno-30-162></a><a href=#__codelineno-30-162><span class=linenos data-linenos="162 "></span></a>        <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-30-163><a id=__codelineno-30-163 name=__codelineno-30-163></a><a href=#__codelineno-30-163><span class=linenos data-linenos="163 "></span></a>    
</span><span id=__span-30-164><a id=__codelineno-30-164 name=__codelineno-30-164></a><a href=#__codelineno-30-164><span class=linenos data-linenos="164 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>verify_backup_encryption</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span><span id=__span-30-165><a id=__codelineno-30-165 name=__codelineno-30-165></a><a href=#__codelineno-30-165><span class=linenos data-linenos="165 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Verify backup encryption is enabled&quot;&quot;&quot;</span>
</span><span id=__span-30-166><a id=__codelineno-30-166 name=__codelineno-30-166></a><a href=#__codelineno-30-166><span class=linenos data-linenos="166 "></span></a>        <span class=c1># Implementation would check backup encryption settings</span>
</span><span id=__span-30-167><a id=__codelineno-30-167 name=__codelineno-30-167></a><a href=#__codelineno-30-167><span class=linenos data-linenos="167 "></span></a>        <span class=c1># This is a placeholder</span>
</span><span id=__span-30-168><a id=__codelineno-30-168 name=__codelineno-30-168></a><a href=#__codelineno-30-168><span class=linenos data-linenos="168 "></span></a>        <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-30-169><a id=__codelineno-30-169 name=__codelineno-30-169></a><a href=#__codelineno-30-169><span class=linenos data-linenos="169 "></span></a>    
</span><span id=__span-30-170><a id=__codelineno-30-170 name=__codelineno-30-170></a><a href=#__codelineno-30-170><span class=linenos data-linenos="170 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>verify_log_retention</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span><span id=__span-30-171><a id=__codelineno-30-171 name=__codelineno-30-171></a><a href=#__codelineno-30-171><span class=linenos data-linenos="171 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Verify log retention compliance&quot;&quot;&quot;</span>
</span><span id=__span-30-172><a id=__codelineno-30-172 name=__codelineno-30-172></a><a href=#__codelineno-30-172><span class=linenos data-linenos="172 "></span></a>        <span class=c1># Implementation would check log retention settings</span>
</span><span id=__span-30-173><a id=__codelineno-30-173 name=__codelineno-30-173></a><a href=#__codelineno-30-173><span class=linenos data-linenos="173 "></span></a>        <span class=c1># This is a placeholder</span>
</span><span id=__span-30-174><a id=__codelineno-30-174 name=__codelineno-30-174></a><a href=#__codelineno-30-174><span class=linenos data-linenos="174 "></span></a>        <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-30-175><a id=__codelineno-30-175 name=__codelineno-30-175></a><a href=#__codelineno-30-175><span class=linenos data-linenos="175 "></span></a>    
</span><span id=__span-30-176><a id=__codelineno-30-176 name=__codelineno-30-176></a><a href=#__codelineno-30-176><span class=linenos data-linenos="176 "></span></a>    <span class=k>async</span> <span class=k>def</span> <span class=nf>verify_log_integrity</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span><span id=__span-30-177><a id=__codelineno-30-177 name=__codelineno-30-177></a><a href=#__codelineno-30-177><span class=linenos data-linenos="177 "></span></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Verify audit log integrity&quot;&quot;&quot;</span>
</span><span id=__span-30-178><a id=__codelineno-30-178 name=__codelineno-30-178></a><a href=#__codelineno-30-178><span class=linenos data-linenos="178 "></span></a>        <span class=c1># Implementation would verify log integrity</span>
</span><span id=__span-30-179><a id=__codelineno-30-179 name=__codelineno-30-179></a><a href=#__codelineno-30-179><span class=linenos data-linenos="179 "></span></a>        <span class=c1># This is a placeholder</span>
</span><span id=__span-30-180><a id=__codelineno-30-180 name=__codelineno-30-180></a><a href=#__codelineno-30-180><span class=linenos data-linenos="180 "></span></a>        <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-30-181><a id=__codelineno-30-181 name=__codelineno-30-181></a><a href=#__codelineno-30-181><span class=linenos data-linenos="181 "></span></a>
</span><span id=__span-30-182><a id=__codelineno-30-182 name=__codelineno-30-182></a><a href=#__codelineno-30-182><span class=linenos data-linenos="182 "></span></a><span class=c1># Global compliance monitor instance</span>
</span><span id=__span-30-183><a id=__codelineno-30-183 name=__codelineno-30-183></a><a href=#__codelineno-30-183><span class=linenos data-linenos="183 "></span></a><span class=n>compliance_monitor</span> <span class=o>=</span> <span class=n>ComplianceMonitor</span><span class=p>()</span>
</span></code></pre></div><h2 id=deployment-checklist>Deployment Checklist<a class=headerlink href=#deployment-checklist title="Permanent link">&para;</a></h2><h3 id=pre-deployment-checklist>Pre-Deployment Checklist<a class=headerlink href=#pre-deployment-checklist title="Permanent link">&para;</a></h3><div class="language-markdown highlight"><span class=filename>Markdown</span><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1></a><a href=#__codelineno-31-1><span class=linenos data-linenos=" 1 "></span></a><span class=gu>## Pre-Deployment Checklist</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2></a><a href=#__codelineno-31-2><span class=linenos data-linenos=" 2 "></span></a>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3></a><a href=#__codelineno-31-3><span class=linenos data-linenos=" 3 "></span></a><span class=gu>### Environment Setup</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4></a><a href=#__codelineno-31-4><span class=linenos data-linenos=" 4 "></span></a><span class=k>- [ ]</span> Production environment configured
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5></a><a href=#__codelineno-31-5><span class=linenos data-linenos=" 5 "></span></a><span class=k>- [ ]</span> DNS records configured
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6></a><a href=#__codelineno-31-6><span class=linenos data-linenos=" 6 "></span></a><span class=k>- [ ]</span> SSL certificates installed and configured
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7></a><a href=#__codelineno-31-7><span class=linenos data-linenos=" 7 "></span></a><span class=k>- [ ]</span> Load balancer configured
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8></a><a href=#__codelineno-31-8><span class=linenos data-linenos=" 8 "></span></a><span class=k>- [ ]</span> Database servers configured with replication
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9></a><a href=#__codelineno-31-9><span class=linenos data-linenos=" 9 "></span></a><span class=k>- [ ]</span> Cache servers configured with clustering
</span><span id=__span-31-10><a id=__codelineno-31-10 name=__codelineno-31-10></a><a href=#__codelineno-31-10><span class=linenos data-linenos="10 "></span></a><span class=k>- [ ]</span> Monitoring systems deployed
</span><span id=__span-31-11><a id=__codelineno-31-11 name=__codelineno-31-11></a><a href=#__codelineno-31-11><span class=linenos data-linenos="11 "></span></a><span class=k>- [ ]</span> Log aggregation configured
</span><span id=__span-31-12><a id=__codelineno-31-12 name=__codelineno-31-12></a><a href=#__codelineno-31-12><span class=linenos data-linenos="12 "></span></a><span class=k>- [ ]</span> Backup systems configured and tested
</span><span id=__span-31-13><a id=__codelineno-31-13 name=__codelineno-31-13></a><a href=#__codelineno-31-13><span class=linenos data-linenos="13 "></span></a>
</span><span id=__span-31-14><a id=__codelineno-31-14 name=__codelineno-31-14></a><a href=#__codelineno-31-14><span class=linenos data-linenos="14 "></span></a><span class=gu>### Security Configuration</span>
</span><span id=__span-31-15><a id=__codelineno-31-15 name=__codelineno-31-15></a><a href=#__codelineno-31-15><span class=linenos data-linenos="15 "></span></a><span class=k>- [ ]</span> Firewall rules configured
</span><span id=__span-31-16><a id=__codelineno-31-16 name=__codelineno-31-16></a><a href=#__codelineno-31-16><span class=linenos data-linenos="16 "></span></a><span class=k>- [ ]</span> Security groups configured
</span><span id=__span-31-17><a id=__codelineno-31-17 name=__codelineno-31-17></a><a href=#__codelineno-31-17><span class=linenos data-linenos="17 "></span></a><span class=k>- [ ]</span> Secrets management configured
</span><span id=__span-31-18><a id=__codelineno-31-18 name=__codelineno-31-18></a><a href=#__codelineno-31-18><span class=linenos data-linenos="18 "></span></a><span class=k>- [ ]</span> Encryption at rest enabled
</span><span id=__span-31-19><a id=__codelineno-31-19 name=__codelineno-31-19></a><a href=#__codelineno-31-19><span class=linenos data-linenos="19 "></span></a><span class=k>- [ ]</span> Encryption in transit enabled
</span><span id=__span-31-20><a id=__codelineno-31-20 name=__codelineno-31-20></a><a href=#__codelineno-31-20><span class=linenos data-linenos="20 "></span></a><span class=k>- [ ]</span> Access controls configured
</span><span id=__span-31-21><a id=__codelineno-31-21 name=__codelineno-31-21></a><a href=#__codelineno-31-21><span class=linenos data-linenos="21 "></span></a><span class=k>- [ ]</span> Audit logging enabled
</span><span id=__span-31-22><a id=__codelineno-31-22 name=__codelineno-31-22></a><a href=#__codelineno-31-22><span class=linenos data-linenos="22 "></span></a><span class=k>- [ ]</span> Vulnerability scanning completed
</span><span id=__span-31-23><a id=__codelineno-31-23 name=__codelineno-31-23></a><a href=#__codelineno-31-23><span class=linenos data-linenos="23 "></span></a><span class=k>- [ ]</span> Penetration testing completed
</span><span id=__span-31-24><a id=__codelineno-31-24 name=__codelineno-31-24></a><a href=#__codelineno-31-24><span class=linenos data-linenos="24 "></span></a>
</span><span id=__span-31-25><a id=__codelineno-31-25 name=__codelineno-31-25></a><a href=#__codelineno-31-25><span class=linenos data-linenos="25 "></span></a><span class=gu>### Application Configuration</span>
</span><span id=__span-31-26><a id=__codelineno-31-26 name=__codelineno-31-26></a><a href=#__codelineno-31-26><span class=linenos data-linenos="26 "></span></a><span class=k>- [ ]</span> Environment variables configured
</span><span id=__span-31-27><a id=__codelineno-31-27 name=__codelineno-31-27></a><a href=#__codelineno-31-27><span class=linenos data-linenos="27 "></span></a><span class=k>- [ ]</span> Database migrations completed
</span><span id=__span-31-28><a id=__codelineno-31-28 name=__codelineno-31-28></a><a href=#__codelineno-31-28><span class=linenos data-linenos="28 "></span></a><span class=k>- [ ]</span> Application configuration validated
</span><span id=__span-31-29><a id=__codelineno-31-29 name=__codelineno-31-29></a><a href=#__codelineno-31-29><span class=linenos data-linenos="29 "></span></a><span class=k>- [ ]</span> Health checks configured
</span><span id=__span-31-30><a id=__codelineno-31-30 name=__codelineno-31-30></a><a href=#__codelineno-31-30><span class=linenos data-linenos="30 "></span></a><span class=k>- [ ]</span> Metrics collection configured
</span><span id=__span-31-31><a id=__codelineno-31-31 name=__codelineno-31-31></a><a href=#__codelineno-31-31><span class=linenos data-linenos="31 "></span></a><span class=k>- [ ]</span> Error tracking configured
</span><span id=__span-31-32><a id=__codelineno-31-32 name=__codelineno-31-32></a><a href=#__codelineno-31-32><span class=linenos data-linenos="32 "></span></a><span class=k>- [ ]</span> Performance monitoring configured
</span><span id=__span-31-33><a id=__codelineno-31-33 name=__codelineno-31-33></a><a href=#__codelineno-31-33><span class=linenos data-linenos="33 "></span></a><span class=k>- [ ]</span> Feature flags configured
</span><span id=__span-31-34><a id=__codelineno-31-34 name=__codelineno-31-34></a><a href=#__codelineno-31-34><span class=linenos data-linenos="34 "></span></a><span class=k>- [ ]</span> Rate limiting configured
</span><span id=__span-31-35><a id=__codelineno-31-35 name=__codelineno-31-35></a><a href=#__codelineno-31-35><span class=linenos data-linenos="35 "></span></a>
</span><span id=__span-31-36><a id=__codelineno-31-36 name=__codelineno-31-36></a><a href=#__codelineno-31-36><span class=linenos data-linenos="36 "></span></a><span class=gu>### Testing &amp; Validation</span>
</span><span id=__span-31-37><a id=__codelineno-31-37 name=__codelineno-31-37></a><a href=#__codelineno-31-37><span class=linenos data-linenos="37 "></span></a><span class=k>- [ ]</span> Unit tests passing
</span><span id=__span-31-38><a id=__codelineno-31-38 name=__codelineno-31-38></a><a href=#__codelineno-31-38><span class=linenos data-linenos="38 "></span></a><span class=k>- [ ]</span> Integration tests passing
</span><span id=__span-31-39><a id=__codelineno-31-39 name=__codelineno-31-39></a><a href=#__codelineno-31-39><span class=linenos data-linenos="39 "></span></a><span class=k>- [ ]</span> End-to-end tests passing
</span><span id=__span-31-40><a id=__codelineno-31-40 name=__codelineno-31-40></a><a href=#__codelineno-31-40><span class=linenos data-linenos="40 "></span></a><span class=k>- [ ]</span> Performance tests passing
</span><span id=__span-31-41><a id=__codelineno-31-41 name=__codelineno-31-41></a><a href=#__codelineno-31-41><span class=linenos data-linenos="41 "></span></a><span class=k>- [ ]</span> Security tests passing
</span><span id=__span-31-42><a id=__codelineno-31-42 name=__codelineno-31-42></a><a href=#__codelineno-31-42><span class=linenos data-linenos="42 "></span></a><span class=k>- [ ]</span> Load testing completed
</span><span id=__span-31-43><a id=__codelineno-31-43 name=__codelineno-31-43></a><a href=#__codelineno-31-43><span class=linenos data-linenos="43 "></span></a><span class=k>- [ ]</span> Disaster recovery testing completed
</span><span id=__span-31-44><a id=__codelineno-31-44 name=__codelineno-31-44></a><a href=#__codelineno-31-44><span class=linenos data-linenos="44 "></span></a><span class=k>- [ ]</span> Rollback procedures tested
</span><span id=__span-31-45><a id=__codelineno-31-45 name=__codelineno-31-45></a><a href=#__codelineno-31-45><span class=linenos data-linenos="45 "></span></a><span class=k>- [ ]</span> Monitoring and alerting tested
</span><span id=__span-31-46><a id=__codelineno-31-46 name=__codelineno-31-46></a><a href=#__codelineno-31-46><span class=linenos data-linenos="46 "></span></a>
</span><span id=__span-31-47><a id=__codelineno-31-47 name=__codelineno-31-47></a><a href=#__codelineno-31-47><span class=linenos data-linenos="47 "></span></a><span class=gu>### Documentation &amp; Training</span>
</span><span id=__span-31-48><a id=__codelineno-31-48 name=__codelineno-31-48></a><a href=#__codelineno-31-48><span class=linenos data-linenos="48 "></span></a><span class=k>- [ ]</span> Deployment documentation updated
</span><span id=__span-31-49><a id=__codelineno-31-49 name=__codelineno-31-49></a><a href=#__codelineno-31-49><span class=linenos data-linenos="49 "></span></a><span class=k>- [ ]</span> Runbook documentation updated
</span><span id=__span-31-50><a id=__codelineno-31-50 name=__codelineno-31-50></a><a href=#__codelineno-31-50><span class=linenos data-linenos="50 "></span></a><span class=k>- [ ]</span> Incident response procedures documented
</span><span id=__span-31-51><a id=__codelineno-31-51 name=__codelineno-31-51></a><a href=#__codelineno-31-51><span class=linenos data-linenos="51 "></span></a><span class=k>- [ ]</span> Team training completed
</span><span id=__span-31-52><a id=__codelineno-31-52 name=__codelineno-31-52></a><a href=#__codelineno-31-52><span class=linenos data-linenos="52 "></span></a><span class=k>- [ ]</span> Support documentation updated
</span><span id=__span-31-53><a id=__codelineno-31-53 name=__codelineno-31-53></a><a href=#__codelineno-31-53><span class=linenos data-linenos="53 "></span></a><span class=k>- [ ]</span> User documentation updated
</span><span id=__span-31-54><a id=__codelineno-31-54 name=__codelineno-31-54></a><a href=#__codelineno-31-54><span class=linenos data-linenos="54 "></span></a><span class=k>- [ ]</span> API documentation updated
</span><span id=__span-31-55><a id=__codelineno-31-55 name=__codelineno-31-55></a><a href=#__codelineno-31-55><span class=linenos data-linenos="55 "></span></a><span class=k>- [ ]</span> Compliance documentation updated
</span></code></pre></div><h3 id=post-deployment-checklist>Post-Deployment Checklist<a class=headerlink href=#post-deployment-checklist title="Permanent link">&para;</a></h3><div class="language-markdown highlight"><span class=filename>Markdown</span><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1></a><a href=#__codelineno-32-1><span class=linenos data-linenos=" 1 "></span></a><span class=gu>## Post-Deployment Checklist</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2></a><a href=#__codelineno-32-2><span class=linenos data-linenos=" 2 "></span></a>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3></a><a href=#__codelineno-32-3><span class=linenos data-linenos=" 3 "></span></a><span class=gu>### Verification</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4></a><a href=#__codelineno-32-4><span class=linenos data-linenos=" 4 "></span></a><span class=k>- [ ]</span> Application is accessible via HTTPS
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5></a><a href=#__codelineno-32-5><span class=linenos data-linenos=" 5 "></span></a><span class=k>- [ ]</span> Health checks are passing
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6></a><a href=#__codelineno-32-6><span class=linenos data-linenos=" 6 "></span></a><span class=k>- [ ]</span> Database connectivity verified
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7></a><a href=#__codelineno-32-7><span class=linenos data-linenos=" 7 "></span></a><span class=k>- [ ]</span> Cache connectivity verified
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8></a><a href=#__codelineno-32-8><span class=linenos data-linenos=" 8 "></span></a><span class=k>- [ ]</span> External API connectivity verified
</span><span id=__span-32-9><a id=__codelineno-32-9 name=__codelineno-32-9></a><a href=#__codelineno-32-9><span class=linenos data-linenos=" 9 "></span></a><span class=k>- [ ]</span> SSL certificate validation
</span><span id=__span-32-10><a id=__codelineno-32-10 name=__codelineno-32-10></a><a href=#__codelineno-32-10><span class=linenos data-linenos="10 "></span></a><span class=k>- [ ]</span> DNS resolution verified
</span><span id=__span-32-11><a id=__codelineno-32-11 name=__codelineno-32-11></a><a href=#__codelineno-32-11><span class=linenos data-linenos="11 "></span></a><span class=k>- [ ]</span> Load balancer health checks passing
</span><span id=__span-32-12><a id=__codelineno-32-12 name=__codelineno-32-12></a><a href=#__codelineno-32-12><span class=linenos data-linenos="12 "></span></a><span class=k>- [ ]</span> Monitoring systems receiving data
</span><span id=__span-32-13><a id=__codelineno-32-13 name=__codelineno-32-13></a><a href=#__codelineno-32-13><span class=linenos data-linenos="13 "></span></a>
</span><span id=__span-32-14><a id=__codelineno-32-14 name=__codelineno-32-14></a><a href=#__codelineno-32-14><span class=linenos data-linenos="14 "></span></a><span class=gu>### Performance Validation</span>
</span><span id=__span-32-15><a id=__codelineno-32-15 name=__codelineno-32-15></a><a href=#__codelineno-32-15><span class=linenos data-linenos="15 "></span></a><span class=k>- [ ]</span> Response times within acceptable limits
</span><span id=__span-32-16><a id=__codelineno-32-16 name=__codelineno-32-16></a><a href=#__codelineno-32-16><span class=linenos data-linenos="16 "></span></a><span class=k>- [ ]</span> Throughput meets requirements
</span><span id=__span-32-17><a id=__codelineno-32-17 name=__codelineno-32-17></a><a href=#__codelineno-32-17><span class=linenos data-linenos="17 "></span></a><span class=k>- [ ]</span> Error rates within acceptable limits
</span><span id=__span-32-18><a id=__codelineno-32-18 name=__codelineno-32-18></a><a href=#__codelineno-32-18><span class=linenos data-linenos="18 "></span></a><span class=k>- [ ]</span> Database performance acceptable
</span><span id=__span-32-19><a id=__codelineno-32-19 name=__codelineno-32-19></a><a href=#__codelineno-32-19><span class=linenos data-linenos="19 "></span></a><span class=k>- [ ]</span> Cache hit rates acceptable
</span><span id=__span-32-20><a id=__codelineno-32-20 name=__codelineno-32-20></a><a href=#__codelineno-32-20><span class=linenos data-linenos="20 "></span></a><span class=k>- [ ]</span> Memory usage within limits
</span><span id=__span-32-21><a id=__codelineno-32-21 name=__codelineno-32-21></a><a href=#__codelineno-32-21><span class=linenos data-linenos="21 "></span></a><span class=k>- [ ]</span> CPU usage within limits
</span><span id=__span-32-22><a id=__codelineno-32-22 name=__codelineno-32-22></a><a href=#__codelineno-32-22><span class=linenos data-linenos="22 "></span></a><span class=k>- [ ]</span> Disk usage within limits
</span><span id=__span-32-23><a id=__codelineno-32-23 name=__codelineno-32-23></a><a href=#__codelineno-32-23><span class=linenos data-linenos="23 "></span></a><span class=k>- [ ]</span> Network usage within limits
</span><span id=__span-32-24><a id=__codelineno-32-24 name=__codelineno-32-24></a><a href=#__codelineno-32-24><span class=linenos data-linenos="24 "></span></a>
</span><span id=__span-32-25><a id=__codelineno-32-25 name=__codelineno-32-25></a><a href=#__codelineno-32-25><span class=linenos data-linenos="25 "></span></a><span class=gu>### Security Validation</span>
</span><span id=__span-32-26><a id=__codelineno-32-26 name=__codelineno-32-26></a><a href=#__codelineno-32-26><span class=linenos data-linenos="26 "></span></a><span class=k>- [ ]</span> Security headers configured correctly
</span><span id=__span-32-27><a id=__codelineno-32-27 name=__codelineno-32-27></a><a href=#__codelineno-32-27><span class=linenos data-linenos="27 "></span></a><span class=k>- [ ]</span> HTTPS redirect working
</span><span id=__span-32-28><a id=__codelineno-32-28 name=__codelineno-32-28></a><a href=#__codelineno-32-28><span class=linenos data-linenos="28 "></span></a><span class=k>- [ ]</span> Authentication working correctly
</span><span id=__span-32-29><a id=__codelineno-32-29 name=__codelineno-32-29></a><a href=#__codelineno-32-29><span class=linenos data-linenos="29 "></span></a><span class=k>- [ ]</span> Authorization working correctly
</span><span id=__span-32-30><a id=__codelineno-32-30 name=__codelineno-32-30></a><a href=#__codelineno-32-30><span class=linenos data-linenos="30 "></span></a><span class=k>- [ ]</span> Rate limiting working correctly
</span><span id=__span-32-31><a id=__codelineno-32-31 name=__codelineno-32-31></a><a href=#__codelineno-32-31><span class=linenos data-linenos="31 "></span></a><span class=k>- [ ]</span> Input validation working correctly
</span><span id=__span-32-32><a id=__codelineno-32-32 name=__codelineno-32-32></a><a href=#__codelineno-32-32><span class=linenos data-linenos="32 "></span></a><span class=k>- [ ]</span> Error handling not exposing sensitive data
</span><span id=__span-32-33><a id=__codelineno-32-33 name=__codelineno-32-33></a><a href=#__codelineno-32-33><span class=linenos data-linenos="33 "></span></a><span class=k>- [ ]</span> Audit logging working correctly
</span><span id=__span-32-34><a id=__codelineno-32-34 name=__codelineno-32-34></a><a href=#__codelineno-32-34><span class=linenos data-linenos="34 "></span></a><span class=k>- [ ]</span> Security monitoring active
</span><span id=__span-32-35><a id=__codelineno-32-35 name=__codelineno-32-35></a><a href=#__codelineno-32-35><span class=linenos data-linenos="35 "></span></a>
</span><span id=__span-32-36><a id=__codelineno-32-36 name=__codelineno-32-36></a><a href=#__codelineno-32-36><span class=linenos data-linenos="36 "></span></a><span class=gu>### Monitoring &amp; Alerting</span>
</span><span id=__span-32-37><a id=__codelineno-32-37 name=__codelineno-32-37></a><a href=#__codelineno-32-37><span class=linenos data-linenos="37 "></span></a><span class=k>- [ ]</span> Application metrics being collected
</span><span id=__span-32-38><a id=__codelineno-32-38 name=__codelineno-32-38></a><a href=#__codelineno-32-38><span class=linenos data-linenos="38 "></span></a><span class=k>- [ ]</span> Infrastructure metrics being collected
</span><span id=__span-32-39><a id=__codelineno-32-39 name=__codelineno-32-39></a><a href=#__codelineno-32-39><span class=linenos data-linenos="39 "></span></a><span class=k>- [ ]</span> Log aggregation working
</span><span id=__span-32-40><a id=__codelineno-32-40 name=__codelineno-32-40></a><a href=#__codelineno-32-40><span class=linenos data-linenos="40 "></span></a><span class=k>- [ ]</span> Alerting rules configured
</span><span id=__span-32-41><a id=__codelineno-32-41 name=__codelineno-32-41></a><a href=#__codelineno-32-41><span class=linenos data-linenos="41 "></span></a><span class=k>- [ ]</span> Notification channels configured
</span><span id=__span-32-42><a id=__codelineno-32-42 name=__codelineno-32-42></a><a href=#__codelineno-32-42><span class=linenos data-linenos="42 "></span></a><span class=k>- [ ]</span> Dashboard access verified
</span><span id=__span-32-43><a id=__codelineno-32-43 name=__codelineno-32-43></a><a href=#__codelineno-32-43><span class=linenos data-linenos="43 "></span></a><span class=k>- [ ]</span> Escalation procedures tested
</span><span id=__span-32-44><a id=__codelineno-32-44 name=__codelineno-32-44></a><a href=#__codelineno-32-44><span class=linenos data-linenos="44 "></span></a><span class=k>- [ ]</span> On-call rotation updated
</span><span id=__span-32-45><a id=__codelineno-32-45 name=__codelineno-32-45></a><a href=#__codelineno-32-45><span class=linenos data-linenos="45 "></span></a><span class=k>- [ ]</span> Incident response team notified
</span><span id=__span-32-46><a id=__codelineno-32-46 name=__codelineno-32-46></a><a href=#__codelineno-32-46><span class=linenos data-linenos="46 "></span></a>
</span><span id=__span-32-47><a id=__codelineno-32-47 name=__codelineno-32-47></a><a href=#__codelineno-32-47><span class=linenos data-linenos="47 "></span></a><span class=gu>### Documentation &amp; Communication</span>
</span><span id=__span-32-48><a id=__codelineno-32-48 name=__codelineno-32-48></a><a href=#__codelineno-32-48><span class=linenos data-linenos="48 "></span></a><span class=k>- [ ]</span> Deployment notes documented
</span><span id=__span-32-49><a id=__codelineno-32-49 name=__codelineno-32-49></a><a href=#__codelineno-32-49><span class=linenos data-linenos="49 "></span></a><span class=k>- [ ]</span> Known issues documented
</span><span id=__span-32-50><a id=__codelineno-32-50 name=__codelineno-32-50></a><a href=#__codelineno-32-50><span class=linenos data-linenos="50 "></span></a><span class=k>- [ ]</span> Rollback procedures documented
</span><span id=__span-32-51><a id=__codelineno-32-51 name=__codelineno-32-51></a><a href=#__codelineno-32-51><span class=linenos data-linenos="51 "></span></a><span class=k>- [ ]</span> Stakeholders notified
</span><span id=__span-32-52><a id=__codelineno-32-52 name=__codelineno-32-52></a><a href=#__codelineno-32-52><span class=linenos data-linenos="52 "></span></a><span class=k>- [ ]</span> Team briefed on changes
</span><span id=__span-32-53><a id=__codelineno-32-53 name=__codelineno-32-53></a><a href=#__codelineno-32-53><span class=linenos data-linenos="53 "></span></a><span class=k>- [ ]</span> Support team briefed
</span><span id=__span-32-54><a id=__codelineno-32-54 name=__codelineno-32-54></a><a href=#__codelineno-32-54><span class=linenos data-linenos="54 "></span></a><span class=k>- [ ]</span> Customer communication sent
</span><span id=__span-32-55><a id=__codelineno-32-55 name=__codelineno-32-55></a><a href=#__codelineno-32-55><span class=linenos data-linenos="55 "></span></a><span class=k>- [ ]</span> Change management updated
</span></code></pre></div><h2 id=troubleshooting-guide>Troubleshooting Guide<a class=headerlink href=#troubleshooting-guide title="Permanent link">&para;</a></h2><h3 id=common-issues-and-solutions>Common Issues and Solutions<a class=headerlink href=#common-issues-and-solutions title="Permanent link">&para;</a></h3><div class="language-markdown highlight"><span class=filename>Markdown</span><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1></a><a href=#__codelineno-33-1><span class=linenos data-linenos=" 1 "></span></a><span class=gu>## Common Production Issues</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2></a><a href=#__codelineno-33-2><span class=linenos data-linenos=" 2 "></span></a>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3></a><a href=#__codelineno-33-3><span class=linenos data-linenos=" 3 "></span></a><span class=gu>### High Memory Usage</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4></a><a href=#__codelineno-33-4><span class=linenos data-linenos=" 4 "></span></a><span class=gs>**Symptoms:**</span> Application becomes slow, OOM errors
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5></a><a href=#__codelineno-33-5><span class=linenos data-linenos=" 5 "></span></a><span class=gs>**Causes:**</span> Memory leaks, inefficient caching, large datasets
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6></a><a href=#__codelineno-33-6><span class=linenos data-linenos=" 6 "></span></a><span class=gs>**Solutions:**</span>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7></a><a href=#__codelineno-33-7><span class=linenos data-linenos=" 7 "></span></a><span class=k>-</span><span class=w> </span>Increase memory limits in Docker/Kubernetes
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8></a><a href=#__codelineno-33-8><span class=linenos data-linenos=" 8 "></span></a><span class=k>-</span><span class=w> </span>Implement memory profiling
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9></a><a href=#__codelineno-33-9><span class=linenos data-linenos=" 9 "></span></a><span class=k>-</span><span class=w> </span>Optimize caching strategies
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10></a><a href=#__codelineno-33-10><span class=linenos data-linenos="10 "></span></a><span class=k>-</span><span class=w> </span>Add memory monitoring alerts
</span><span id=__span-33-11><a id=__codelineno-33-11 name=__codelineno-33-11></a><a href=#__codelineno-33-11><span class=linenos data-linenos="11 "></span></a>
</span><span id=__span-33-12><a id=__codelineno-33-12 name=__codelineno-33-12></a><a href=#__codelineno-33-12><span class=linenos data-linenos="12 "></span></a><span class=gu>### Database Connection Issues</span>
</span><span id=__span-33-13><a id=__codelineno-33-13 name=__codelineno-33-13></a><a href=#__codelineno-33-13><span class=linenos data-linenos="13 "></span></a><span class=gs>**Symptoms:**</span> Connection timeouts, pool exhaustion
</span><span id=__span-33-14><a id=__codelineno-33-14 name=__codelineno-33-14></a><a href=#__codelineno-33-14><span class=linenos data-linenos="14 "></span></a><span class=gs>**Causes:**</span> Connection pool misconfiguration, long-running queries
</span><span id=__span-33-15><a id=__codelineno-33-15 name=__codelineno-33-15></a><a href=#__codelineno-33-15><span class=linenos data-linenos="15 "></span></a><span class=gs>**Solutions:**</span>
</span><span id=__span-33-16><a id=__codelineno-33-16 name=__codelineno-33-16></a><a href=#__codelineno-33-16><span class=linenos data-linenos="16 "></span></a><span class=k>-</span><span class=w> </span>Increase connection pool size
</span><span id=__span-33-17><a id=__codelineno-33-17 name=__codelineno-33-17></a><a href=#__codelineno-33-17><span class=linenos data-linenos="17 "></span></a><span class=k>-</span><span class=w> </span>Optimize slow queries
</span><span id=__span-33-18><a id=__codelineno-33-18 name=__codelineno-33-18></a><a href=#__codelineno-33-18><span class=linenos data-linenos="18 "></span></a><span class=k>-</span><span class=w> </span>Implement connection monitoring
</span><span id=__span-33-19><a id=__codelineno-33-19 name=__codelineno-33-19></a><a href=#__codelineno-33-19><span class=linenos data-linenos="19 "></span></a><span class=k>-</span><span class=w> </span>Add database read replicas
</span><span id=__span-33-20><a id=__codelineno-33-20 name=__codelineno-33-20></a><a href=#__codelineno-33-20><span class=linenos data-linenos="20 "></span></a>
</span><span id=__span-33-21><a id=__codelineno-33-21 name=__codelineno-33-21></a><a href=#__codelineno-33-21><span class=linenos data-linenos="21 "></span></a><span class=gu>### Redis Connection Issues</span>
</span><span id=__span-33-22><a id=__codelineno-33-22 name=__codelineno-33-22></a><a href=#__codelineno-33-22><span class=linenos data-linenos="22 "></span></a><span class=gs>**Symptoms:**</span> Cache misses, connection timeouts
</span><span id=__span-33-23><a id=__codelineno-33-23 name=__codelineno-33-23></a><a href=#__codelineno-33-23><span class=linenos data-linenos="23 "></span></a><span class=gs>**Causes:**</span> Redis server overload, network issues
</span><span id=__span-33-24><a id=__codelineno-33-24 name=__codelineno-33-24></a><a href=#__codelineno-33-24><span class=linenos data-linenos="24 "></span></a><span class=gs>**Solutions:**</span>
</span><span id=__span-33-25><a id=__codelineno-33-25 name=__codelineno-33-25></a><a href=#__codelineno-33-25><span class=linenos data-linenos="25 "></span></a><span class=k>-</span><span class=w> </span>Scale Redis cluster
</span><span id=__span-33-26><a id=__codelineno-33-26 name=__codelineno-33-26></a><a href=#__codelineno-33-26><span class=linenos data-linenos="26 "></span></a><span class=k>-</span><span class=w> </span>Optimize cache usage patterns
</span><span id=__span-33-27><a id=__codelineno-33-27 name=__codelineno-33-27></a><a href=#__codelineno-33-27><span class=linenos data-linenos="27 "></span></a><span class=k>-</span><span class=w> </span>Implement cache monitoring
</span><span id=__span-33-28><a id=__codelineno-33-28 name=__codelineno-33-28></a><a href=#__codelineno-33-28><span class=linenos data-linenos="28 "></span></a><span class=k>-</span><span class=w> </span>Add Redis Sentinel for high availability
</span><span id=__span-33-29><a id=__codelineno-33-29 name=__codelineno-33-29></a><a href=#__codelineno-33-29><span class=linenos data-linenos="29 "></span></a>
</span><span id=__span-33-30><a id=__codelineno-33-30 name=__codelineno-33-30></a><a href=#__codelineno-33-30><span class=linenos data-linenos="30 "></span></a><span class=gu>### SSL Certificate Issues</span>
</span><span id=__span-33-31><a id=__codelineno-33-31 name=__codelineno-33-31></a><a href=#__codelineno-33-31><span class=linenos data-linenos="31 "></span></a><span class=gs>**Symptoms:**</span> Certificate warnings, HTTPS errors
</span><span id=__span-33-32><a id=__codelineno-33-32 name=__codelineno-33-32></a><a href=#__codelineno-33-32><span class=linenos data-linenos="32 "></span></a><span class=gs>**Causes:**</span> Expired certificates, misconfigured certificates
</span><span id=__span-33-33><a id=__codelineno-33-33 name=__codelineno-33-33></a><a href=#__codelineno-33-33><span class=linenos data-linenos="33 "></span></a><span class=gs>**Solutions:**</span>
</span><span id=__span-33-34><a id=__codelineno-33-34 name=__codelineno-33-34></a><a href=#__codelineno-33-34><span class=linenos data-linenos="34 "></span></a><span class=k>-</span><span class=w> </span>Implement certificate auto-renewal
</span><span id=__span-33-35><a id=__codelineno-33-35 name=__codelineno-33-35></a><a href=#__codelineno-33-35><span class=linenos data-linenos="35 "></span></a><span class=k>-</span><span class=w> </span>Monitor certificate expiration
</span><span id=__span-33-36><a id=__codelineno-33-36 name=__codelineno-33-36></a><a href=#__codelineno-33-36><span class=linenos data-linenos="36 "></span></a><span class=k>-</span><span class=w> </span>Verify certificate chain
</span><span id=__span-33-37><a id=__codelineno-33-37 name=__codelineno-33-37></a><a href=#__codelineno-33-37><span class=linenos data-linenos="37 "></span></a><span class=k>-</span><span class=w> </span>Update certificate configuration
</span><span id=__span-33-38><a id=__codelineno-33-38 name=__codelineno-33-38></a><a href=#__codelineno-33-38><span class=linenos data-linenos="38 "></span></a>
</span><span id=__span-33-39><a id=__codelineno-33-39 name=__codelineno-33-39></a><a href=#__codelineno-33-39><span class=linenos data-linenos="39 "></span></a><span class=gu>### Performance Degradation</span>
</span><span id=__span-33-40><a id=__codelineno-33-40 name=__codelineno-33-40></a><a href=#__codelineno-33-40><span class=linenos data-linenos="40 "></span></a><span class=gs>**Symptoms:**</span> Slow response times, high CPU usage
</span><span id=__span-33-41><a id=__codelineno-33-41 name=__codelineno-33-41></a><a href=#__codelineno-33-41><span class=linenos data-linenos="41 "></span></a><span class=gs>**Causes:**</span> Inefficient queries, resource contention
</span><span id=__span-33-42><a id=__codelineno-33-42 name=__codelineno-33-42></a><a href=#__codelineno-33-42><span class=linenos data-linenos="42 "></span></a><span class=gs>**Solutions:**</span>
</span><span id=__span-33-43><a id=__codelineno-33-43 name=__codelineno-33-43></a><a href=#__codelineno-33-43><span class=linenos data-linenos="43 "></span></a><span class=k>-</span><span class=w> </span>Implement performance monitoring
</span><span id=__span-33-44><a id=__codelineno-33-44 name=__codelineno-33-44></a><a href=#__codelineno-33-44><span class=linenos data-linenos="44 "></span></a><span class=k>-</span><span class=w> </span>Optimize database queries
</span><span id=__span-33-45><a id=__codelineno-33-45 name=__codelineno-33-45></a><a href=#__codelineno-33-45><span class=linenos data-linenos="45 "></span></a><span class=k>-</span><span class=w> </span>Scale application horizontally
</span><span id=__span-33-46><a id=__codelineno-33-46 name=__codelineno-33-46></a><a href=#__codelineno-33-46><span class=linenos data-linenos="46 "></span></a><span class=k>-</span><span class=w> </span>Implement caching strategies
</span></code></pre></div><h3 id=debugging-commands>Debugging Commands<a class=headerlink href=#debugging-commands title="Permanent link">&para;</a></h3><div class="language-bash highlight"><span class=filename>Bash</span><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1></a><a href=#__codelineno-34-1><span class=linenos data-linenos=" 1 "></span></a><span class=c1># Application debugging</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2></a><a href=#__codelineno-34-2><span class=linenos data-linenos=" 2 "></span></a>docker<span class=w> </span>logs<span class=w> </span>-f<span class=w> </span>agent-workflow-orchestrator
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3></a><a href=#__codelineno-34-3><span class=linenos data-linenos=" 3 "></span></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>agent-workflow-orchestrator<span class=w> </span>/bin/bash
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4></a><a href=#__codelineno-34-4><span class=linenos data-linenos=" 4 "></span></a>docker<span class=w> </span>stats<span class=w> </span>agent-workflow-orchestrator
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5></a><a href=#__codelineno-34-5><span class=linenos data-linenos=" 5 "></span></a>
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6></a><a href=#__codelineno-34-6><span class=linenos data-linenos=" 6 "></span></a><span class=c1># Database debugging</span>
</span><span id=__span-34-7><a id=__codelineno-34-7 name=__codelineno-34-7></a><a href=#__codelineno-34-7><span class=linenos data-linenos=" 7 "></span></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>agent-workflow-postgres<span class=w> </span>psql<span class=w> </span>-U<span class=w> </span>agent_workflow<span class=w> </span>-d<span class=w> </span>agent_workflow
</span><span id=__span-34-8><a id=__codelineno-34-8 name=__codelineno-34-8></a><a href=#__codelineno-34-8><span class=linenos data-linenos=" 8 "></span></a>SELECT<span class=w> </span>*<span class=w> </span>FROM<span class=w> </span>pg_stat_activity<span class=w> </span>WHERE<span class=w> </span><span class=nv>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;active&#39;</span><span class=p>;</span>
</span><span id=__span-34-9><a id=__codelineno-34-9 name=__codelineno-34-9></a><a href=#__codelineno-34-9><span class=linenos data-linenos=" 9 "></span></a>SELECT<span class=w> </span>*<span class=w> </span>FROM<span class=w> </span>pg_locks<span class=w> </span>WHERE<span class=w> </span>NOT<span class=w> </span>GRANTED<span class=p>;</span>
</span><span id=__span-34-10><a id=__codelineno-34-10 name=__codelineno-34-10></a><a href=#__codelineno-34-10><span class=linenos data-linenos="10 "></span></a>
</span><span id=__span-34-11><a id=__codelineno-34-11 name=__codelineno-34-11></a><a href=#__codelineno-34-11><span class=linenos data-linenos="11 "></span></a><span class=c1># Redis debugging</span>
</span><span id=__span-34-12><a id=__codelineno-34-12 name=__codelineno-34-12></a><a href=#__codelineno-34-12><span class=linenos data-linenos="12 "></span></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>agent-workflow-redis<span class=w> </span>redis-cli
</span><span id=__span-34-13><a id=__codelineno-34-13 name=__codelineno-34-13></a><a href=#__codelineno-34-13><span class=linenos data-linenos="13 "></span></a>INFO<span class=w> </span>memory
</span><span id=__span-34-14><a id=__codelineno-34-14 name=__codelineno-34-14></a><a href=#__codelineno-34-14><span class=linenos data-linenos="14 "></span></a>MONITOR
</span><span id=__span-34-15><a id=__codelineno-34-15 name=__codelineno-34-15></a><a href=#__codelineno-34-15><span class=linenos data-linenos="15 "></span></a>SLOWLOG<span class=w> </span>GET<span class=w> </span><span class=m>10</span>
</span><span id=__span-34-16><a id=__codelineno-34-16 name=__codelineno-34-16></a><a href=#__codelineno-34-16><span class=linenos data-linenos="16 "></span></a>
</span><span id=__span-34-17><a id=__codelineno-34-17 name=__codelineno-34-17></a><a href=#__codelineno-34-17><span class=linenos data-linenos="17 "></span></a><span class=c1># Network debugging</span>
</span><span id=__span-34-18><a id=__codelineno-34-18 name=__codelineno-34-18></a><a href=#__codelineno-34-18><span class=linenos data-linenos="18 "></span></a>docker<span class=w> </span>network<span class=w> </span>ls
</span><span id=__span-34-19><a id=__codelineno-34-19 name=__codelineno-34-19></a><a href=#__codelineno-34-19><span class=linenos data-linenos="19 "></span></a>docker<span class=w> </span>network<span class=w> </span>inspect<span class=w> </span>agent-workflow_agent-network
</span><span id=__span-34-20><a id=__codelineno-34-20 name=__codelineno-34-20></a><a href=#__codelineno-34-20><span class=linenos data-linenos="20 "></span></a>netstat<span class=w> </span>-tulpn<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>:8080
</span><span id=__span-34-21><a id=__codelineno-34-21 name=__codelineno-34-21></a><a href=#__codelineno-34-21><span class=linenos data-linenos="21 "></span></a>telnet<span class=w> </span>localhost<span class=w> </span><span class=m>8080</span>
</span><span id=__span-34-22><a id=__codelineno-34-22 name=__codelineno-34-22></a><a href=#__codelineno-34-22><span class=linenos data-linenos="22 "></span></a>
</span><span id=__span-34-23><a id=__codelineno-34-23 name=__codelineno-34-23></a><a href=#__codelineno-34-23><span class=linenos data-linenos="23 "></span></a><span class=c1># Performance debugging</span>
</span><span id=__span-34-24><a id=__codelineno-34-24 name=__codelineno-34-24></a><a href=#__codelineno-34-24><span class=linenos data-linenos="24 "></span></a>htop
</span><span id=__span-34-25><a id=__codelineno-34-25 name=__codelineno-34-25></a><a href=#__codelineno-34-25><span class=linenos data-linenos="25 "></span></a>iotop
</span><span id=__span-34-26><a id=__codelineno-34-26 name=__codelineno-34-26></a><a href=#__codelineno-34-26><span class=linenos data-linenos="26 "></span></a>iostat<span class=w> </span>-x<span class=w> </span><span class=m>1</span>
</span><span id=__span-34-27><a id=__codelineno-34-27 name=__codelineno-34-27></a><a href=#__codelineno-34-27><span class=linenos data-linenos="27 "></span></a>vmstat<span class=w> </span><span class=m>1</span>
</span></code></pre></div><h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">&para;</a></h2><p>This production deployment guide provides comprehensive coverage of enterprise-grade deployment strategies for the AI Agent TDD-Scrum workflow system. The guide includes:</p><ul><li><strong>Multi-tier deployment options</strong> from hobby to enterprise</li><li><strong>One-click deployment</strong> to major cloud platforms</li><li><strong>Interactive cost calculator</strong> for deployment planning</li><li><strong>Comprehensive security hardening</strong> with compliance features</li><li><strong>High availability</strong> with disaster recovery procedures</li><li><strong>Performance optimization</strong> strategies</li><li><strong>Monitoring and observability</strong> solutions</li><li><strong>Compliance frameworks</strong> including SOC 2</li></ul><p>For additional support or enterprise consulting, contact our team at <a href=mailto:enterprise@agent-workflow.com>enterprise@agent-workflow.com</a>.</p><style>
.deployment-picker {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
  margin: 2rem 0;
}

.tier-card {
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  padding: 1.5rem;
  background: #f9fafb;
  transition: all 0.3s ease;
}

.tier-card:hover {
  border-color: #3b82f6;
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
}

.tier-card.startup {
  border-color: #10b981;
  background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%);
}

.tier-card.enterprise {
  border-color: #8b5cf6;
  background: linear-gradient(135deg, #f3f4f6 0%, #faf7ff 100%);
}

.tier-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.tier-header h3 {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
}

.price {
  font-size: 1.5rem;
  font-weight: 700;
  color: #1f2937;
}

.price span {
  font-size: 0.875rem;
  font-weight: 400;
  color: #6b7280;
}

.tier-features ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.tier-features li {
  padding: 0.5rem 0;
  font-size: 0.875rem;
}

.btn-primary {
  display: inline-block;
  background: #3b82f6;
  color: white;
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 500;
  text-align: center;
  transition: background-color 0.2s;
}

.btn-primary:hover {
  background: #2563eb;
}

.deploy-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin: 2rem 0;
}

.deploy-btn {
  display: inline-block;
  transition: transform 0.2s;
}

.deploy-btn:hover {
  transform: translateY(-2px);
}

.cost-calculator {
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  padding: 2rem;
  margin: 2rem 0;
  background: #f9fafb;
}

.calculator-inputs {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.input-group label {
  display: block;
  font-weight: 500;
  margin-bottom: 0.5rem;
}

.input-group input,
.input-group select {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  font-size: 0.875rem;
}

.cost-breakdown {
  border-top: 1px solid #e5e7eb;
  padding-top: 1rem;
}

.cost-item {
  display: flex;
  justify-content: space-between;
  padding: 0.5rem 0;
  font-size: 0.875rem;
}

.cost-total {
  display: flex;
  justify-content: space-between;
  padding: 1rem 0;
  border-top: 2px solid #e5e7eb;
  margin-top: 1rem;
  font-size: 1.125rem;
}

.architecture-viewer {
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  margin: 2rem 0;
  background: white;
}

.architecture-tabs {
  display: flex;
  border-bottom: 1px solid #e5e7eb;
}

.tab-btn {
  flex: 1;
  padding: 1rem;
  border: none;
  background: none;
  cursor: pointer;
  font-weight: 500;
  color: #6b7280;
  transition: all 0.2s;
}

.tab-btn.active {
  color: #3b82f6;
  border-bottom: 2px solid #3b82f6;
  background: #f8fafc;
}

.tab-btn:hover {
  background: #f3f4f6;
}

.architecture-content {
  position: relative;
}

.diagram-container {
  display: none;
  padding: 2rem;
}

.diagram-container.active {
  display: block;
}

.diagram-zoom-controls {
  position: absolute;
  top: 1rem;
  right: 1rem;
  display: flex;
  gap: 0.5rem;
  z-index: 10;
}

.zoom-btn {
  width: 2rem;
  height: 2rem;
  border: 1px solid #d1d5db;
  border-radius: 4px;
  background: white;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.2s;
}

.zoom-btn:hover {
  background: #f3f4f6;
  border-color: #9ca3af;
}

.diagram-svg {
  width: 100%;
  height: 500px;
  overflow: hidden;
}

.architecture-svg {
  width: 100%;
  height: 100%;
}

.diagram-node {
  cursor: pointer;
  transition: all 0.2s;
}

.diagram-node:hover {
  opacity: 0.8;
  transform: scale(1.05);
}

.diagram-placeholder {
  text-align: center;
  padding: 4rem 2rem;
  color: #6b7280;
}

.diagram-placeholder h3 {
  margin-bottom: 1rem;
  color: #374151;
}
</style><script>
// Cost Calculator Logic
document.addEventListener('DOMContentLoaded', function() {
  const costInputs = document.querySelectorAll('.calculator-inputs input, .calculator-inputs select');
  const costElements = {
    compute: document.getElementById('compute-cost'),
    storage: document.getElementById('storage-cost'),
    network: document.getElementById('network-cost'),
    monitoring: document.getElementById('monitoring-cost'),
    total: document.getElementById('total-cost')
  };

  function calculateCosts() {
    const projects = parseInt(document.getElementById('projects').value) || 1;
    const teamSize = parseInt(document.getElementById('team-size').value) || 5;
    const activeHours = parseInt(document.getElementById('active-hours').value) || 8;
    const region = document.getElementById('region').value;

    // Regional multipliers
    const regionMultipliers = {
      'us-east-1': 1.0,
      'us-west-2': 1.1,
      'eu-west-1': 1.15,
      'ap-southeast-1': 1.2
    };

    const multiplier = regionMultipliers[region] || 1.0;

    // Calculate costs
    const computeCost = projects * (20 + (teamSize * 2) + (activeHours * 0.5)) * multiplier;
    const storageCost = projects * (10 + (teamSize * 1)) * multiplier;
    const networkCost = projects * (5 + (teamSize * 0.5)) * multiplier;
    const monitoringCost = projects * (15 + (teamSize * 1)) * multiplier;

    const totalCost = computeCost + storageCost + networkCost + monitoringCost;

    // Update UI
    if (costElements.compute) costElements.compute.textContent = `$${computeCost.toFixed(2)}`;
    if (costElements.storage) costElements.storage.textContent = `$${storageCost.toFixed(2)}`;
    if (costElements.network) costElements.network.textContent = `$${networkCost.toFixed(2)}`;
    if (costElements.monitoring) costElements.monitoring.textContent = `$${monitoringCost.toFixed(2)}`;
    if (costElements.total) costElements.total.textContent = `$${totalCost.toFixed(2)}`;
  }

  // Add event listeners
  costInputs.forEach(input => {
    input.addEventListener('input', calculateCosts);
    input.addEventListener('change', calculateCosts);
  });

  // Initial calculation
  calculateCosts();

  // Architecture Viewer Logic
  const tabButtons = document.querySelectorAll('.tab-btn');
  const diagramContainers = document.querySelectorAll('.diagram-container');

  tabButtons.forEach(button => {
    button.addEventListener('click', function() {
      const tabName = this.getAttribute('data-tab');

      // Update active tab
      tabButtons.forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');

      // Update active diagram
      diagramContainers.forEach(container => {
        container.classList.remove('active');
        if (container.id === `${tabName}-diagram`) {
          container.classList.add('active');
        }
      });
    });
  });

  // Zoom controls
  const zoomButtons = document.querySelectorAll('.zoom-btn');

  zoomButtons.forEach(button => {
    button.addEventListener('click', function() {
      const action = this.getAttribute('data-action');
      const svg = this.closest('.diagram-container').querySelector('.architecture-svg');

      if (!svg) return;

      const currentTransform = svg.style.transform || 'scale(1)';
      const currentScale = parseFloat(currentTransform.match(/scale\(([^)]+)\)/)?.[1] || 1);

      let newScale = currentScale;

      switch (action) {
        case 'zoom-in':
          newScale = Math.min(currentScale * 1.2, 3);
          break;
        case 'zoom-out':
          newScale = Math.max(currentScale / 1.2, 0.5);
          break;
        case 'reset':
          newScale = 1;
          break;
      }

      svg.style.transform = `scale(${newScale})`;
      svg.style.transformOrigin = 'center center';
    });
  });
});
</script><aside class=md-source-file><span class=md-source-file__fact><span class=md-icon title="Last update"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="June 19, 2025 03:12:57 UTC">June 19, 2025 03:12:57</span></span><span class=md-source-file__fact><span class=md-icon title=Created><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="June 17, 2025 16:04:07 UTC">June 17, 2025 16:04:07</span></span></aside><form class=md-feedback name=feedback hidden><fieldset><legend class=md-feedback__title> Was this page helpful? </legend><div class=md-feedback__inner><div class=md-feedback__list><button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg></button><button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg></button></div><div class=md-feedback__note><div data-md-value=1 hidden> Thanks for your feedback! </div><div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by <a href="https://github.com/jmontp/agent-workflow/issues/new/?title=[Feedback]+Production%20Deployment+-+/deployment/production/" target=_blank rel=noopener>telling us what you found confusing</a>. </div></div></div></fieldset></form></article></div><script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script><script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script></div><button type=button class="md-top md-icon" data-md-component=top hidden><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button></main><footer class=md-footer><nav class="md-footer__inner md-grid" aria-label=Footer><a href=../DISCORD_SETUP_SUMMARY/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Discord Setup Summary"><div class="md-footer__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M15.41 16.58 10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg></div><div class=md-footer__title><span class=md-footer__direction> Previous </span><div class=md-ellipsis> Discord Setup Summary </div></div></a><a href=../github-pages/ class="md-footer__link md-footer__link--next" aria-label="Next: GitHub Pages"><div class=md-footer__title><span class=md-footer__direction> Next </span><div class=md-ellipsis> GitHub Pages </div></div><div class="md-footer__button md-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg></div></a></nav><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-copyright></div><div class=md-social><a href=https://github.com/jmontp/agent-workflow target=_blank rel=noopener title="GitHub Repository" class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg></a><a href=https://jmontp.github.io/agent-workflow/ target=_blank rel=noopener title="Documentation Site" class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg></a><a href=https://discord.gg/your-discord-server target=_blank rel=noopener title="Discord Community" class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3c5.5 0 10 3.58 10 8s-4.5 8-10 8c-1.24 0-2.43-.18-3.53-.5C5.55 21 2 21 2 21c2.33-2.33 2.7-3.9 2.75-4.5C3.05 15.07 2 13.13 2 11c0-4.42 4.5-8 10-8"/></svg></a><a href=https://github.com/sponsors/jmontp target=_blank rel=noopener title=Sponsor class=md-social__link><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12 21.35-1.45-1.32C5.4 15.36 2 12.27 2 8.5 2 5.41 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.08C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53z"/></svg></a></div></div></div></footer></div><div class=md-dialog data-md-component=dialog><div class="md-dialog__inner md-typeset"></div></div><div class=md-progress data-md-component=progress role=progressbar></div><div class=md-consent data-md-component=consent id=__consent hidden><div class=md-consent__overlay></div><aside class=md-consent__inner><form class="md-consent__form md-grid md-typeset" name=consent><h4>Cookie consent</h4><p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p><input class=md-toggle type=checkbox id=__settings><div class=md-consent__settings><ul class=task-list><li class=task-list-item><label class=task-list-control><input type=checkbox name=analytics checked><span class=task-list-indicator></span> Google Analytics </label></li><li class=task-list-item><label class=task-list-control><input type=checkbox name=github checked><span class=task-list-indicator></span> GitHub </label></li></ul></div><div class=md-consent__controls><button class="md-button md-button--primary">Accept</button><button type=reset class="md-button md-button--primary">Reject</button><label class=md-button for=__settings>Manage settings</label></div></form></aside></div><script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script><script id=__config type=application/json>{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.footnote.tooltips", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": {"API": "api", "Architecture": "architecture", "CSS": "css", "Discord": "discord", "HTML5": "html", "JavaScript": "js", "Python": "python", "Scrum": "scrum", "TDD": "tdd"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script><script src=../../assets/javascripts/bundle.13a4f30d.min.js></script><script src=https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mtml-chtml.js></script><script src=../../js/mermaid-zoom.js></script><script src=../../js/universal-search.js></script><script src=../../js/enhanced-navigation.js></script><script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body></html>